webpackJsonp([3],{"+2h+":function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i("6nA8"),o=function(t){function e(e,i,n,r){var o=t.call(this,r)||this;return o.game=e,o.pixels=i,o.resolution=n,o.waterPoints=r,o.passThroughs=1,o.spread=.25,o.game.physics.p2.enable(o),o.setHeight(),o}return n(e,t),e.prototype.update=function(){for(var t=0;t<this.waterPoints.length-2;t++)this.waterPoints[t].update(.025,.025);this.applyPhysics(),this.fixWaterPositions(),this.anchorBottomPoints(),this.points=this.waterPoints},e.prototype.splash=function(t,e){var i=this.game.width/this.resolution,n=Math.round(t/i);n>=0&&n<this.waterPoints.length&&(this.waterPoints[n].speed=e)},e.prototype.setHeight=function(){for(var t=0;t<=this.waterPoints.length-3;t++)this.waterPoints[t].setHeight(this.game.height-this.pixels)},e.prototype.getWaterLevel=function(t){var e=this.game.width/this.resolution,i=Math.round(t/e);return i>=this.waterPoints.length||i<0?new r.Point(0,this.waterPoints[0].y):new r.Point(0,this.waterPoints[i].y)},Object.defineProperty(e.prototype,"Height",{get:function(){return this.pixels},enumerable:!0,configurable:!0}),e.prototype.applyPhysics=function(){for(var t=Array(),e=Array(),i=0;i<this.passThroughs;i++){for(var n=0;n<this.waterPoints.length-2;n++)n>0&&(t[n]=this.spread*(this.waterPoints[n].y-this.waterPoints[n-1].y),this.waterPoints[n-1].speed+=t[n]),n<this.waterPoints.length-1&&(e[n]=this.spread*(this.waterPoints[n].y-this.waterPoints[n+1].y),this.waterPoints[n+1].speed+=e[n]);for(n=0;n<this.waterPoints.length-2;n++)n>0?this.waterPoints[n-1].y+=t[n]:n<this.waterPoints.length-1&&(this.waterPoints[n+1].y+=e[n])}},e.prototype.fixWaterPositions=function(){for(var t=this.game.width/this.resolution,e=0;e<=this.waterPoints.length-3;e++)this.waterPoints[e].x=t*e},e.prototype.anchorBottomPoints=function(){this.waterPoints[this.waterPoints.length-2].x=this.game.width,this.waterPoints[this.waterPoints.length-2].y=this.game.height,this.waterPoints[this.waterPoints.length-1].y=this.game.height},e}(r.Polygon);e.Water=o},"+51+":function(t,e,i){var n,r;!function(o,s){n=[i("ComB")],void 0===(r=(function(t){return s(o,t)}).apply(e,n))||(t.exports=r)}(window,function(t,e){"use strict";var i={};i.extend=function(t,e){for(var i in e)t[i]=e[i];return t},i.modulo=function(t,e){return(t%e+e)%e},i.makeArray=function(t){var e=[];if(Array.isArray(t))e=t;else if(t&&"object"==typeof t&&"number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e},i.removeFrom=function(t,e){var i=t.indexOf(e);-1!=i&&t.splice(i,1)},i.getParent=function(t,i){for(;t.parentNode&&t!=document.body;)if(t=t.parentNode,e(t,i))return t},i.getQueryElement=function(t){return"string"==typeof t?document.querySelector(t):t},i.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},i.filterFindElements=function(t,n){var r=[];return(t=i.makeArray(t)).forEach(function(t){if(t instanceof HTMLElement)if(n){e(t,n)&&r.push(t);for(var i=t.querySelectorAll(n),o=0;o<i.length;o++)r.push(i[o])}else r.push(t)}),r},i.debounceMethod=function(t,e,i){var n=t.prototype[e],r=e+"Timeout";t.prototype[e]=function(){var t=this[r];t&&clearTimeout(t);var e=arguments,o=this;this[r]=setTimeout(function(){n.apply(o,e),delete o[r]},i||100)}},i.docReady=function(t){var e=document.readyState;"complete"==e||"interactive"==e?setTimeout(t):document.addEventListener("DOMContentLoaded",t)},i.toDashed=function(t){return t.replace(/(.)([A-Z])/g,function(t,e,i){return e+"-"+i}).toLowerCase()};var n=t.console;return i.htmlInit=function(e,r){i.docReady(function(){var o=i.toDashed(r),s="data-"+o,a=document.querySelectorAll("["+s+"]"),h=document.querySelectorAll(".js-"+o),u=i.makeArray(a).concat(i.makeArray(h)),c=s+"-options",l=t.jQuery;u.forEach(function(t){var i,o=t.getAttribute(s)||t.getAttribute(c);try{i=o&&JSON.parse(o)}catch(e){return void(n&&n.error("Error parsing "+s+" on "+t.className+": "+e))}var a=new e(t,i);l&&l.data(t,r,a)})})},i})},"/oeL":function(t,e,i){"use strict";(function(t){function n(){if(!Hi){var t=Vi.Symbol;if(t&&t.iterator)Hi=t.iterator;else for(var e=Object.getOwnPropertyNames(Map.prototype),i=0;i<e.length;++i){var n=e[i];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Hi=n)}}return Hi}function r(t){Zone.current.scheduleMicroTask("scheduleMicrotask",t)}function o(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function s(t){if("string"==typeof t)return t;if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var e=t.toString();if(null==e)return""+e;var i=e.indexOf("\n");return-1===i?e:e.substring(0,i)}function a(t){return"function"==typeof t&&t.hasOwnProperty("annotation")&&(t=t.annotation),t}function h(t,e){if(t===Object||t===String||t===Function||t===Number||t===Array)throw new Error("Can not use native "+s(t)+" as constructor");if("function"==typeof t)return t;if(Array.isArray(t)){var i=t,n=i.length-1,r=t[n];if("function"!=typeof r)throw new Error("Last position of Class method array must be Function in key "+e+" was '"+s(r)+"'");if(n!=r.length)throw new Error("Number of annotations ("+n+") does not match number of arguments ("+r.length+") in the function: "+s(r));for(var o=[],h=0,u=i.length-1;h<u;h++){var c=[];o.push(c);var l=i[h];if(Array.isArray(l))for(var d=0;d<l.length;d++)c.push(a(l[d]));else"function"==typeof l?c.push(a(l)):c.push(l)}return Wi.defineMetadata("parameters",o,r),r}throw new Error("Only Function or Array is supported in Class definition for key '"+e+"' is '"+s(t)+"'")}function u(t){var e=h(t.hasOwnProperty("constructor")?t.constructor:void 0,"constructor"),i=e.prototype;if(t.hasOwnProperty("extends")){if("function"!=typeof t.extends)throw new Error("Class definition 'extends' property must be a constructor function was: "+s(t.extends));e.prototype=i=Object.create(t.extends.prototype)}for(var n in t)"extends"!==n&&"prototype"!==n&&t.hasOwnProperty(n)&&(i[n]=h(t[n],n));this&&this.annotations instanceof Array&&Wi.defineMetadata("annotations",this.annotations,e);var r=e.name;return r&&"constructor"!==r||(e.overriddenName="class"+zi++),e}function c(t,e,i,n){function r(t){if(!Wi||!Wi.getOwnMetadata)throw"reflect-metadata shim is required when using class decorators";if(this instanceof r)return o.call(this,t),this;var e=new r(t),i="function"==typeof this&&Array.isArray(this.annotations)?this.annotations:[];i.push(e);var s=function(t){var i=Wi.getOwnMetadata("annotations",t)||[];return i.push(e),Wi.defineMetadata("annotations",i,t),t};return s.annotations=i,s.Class=u,n&&n(s),s}var o=l(e);return i&&(r.prototype=Object.create(i.prototype)),r.prototype.toString=function(){return"@"+t},r.annotationCls=r,r}function l(t){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(t){var n=t.apply(void 0,e);for(var r in n)this[r]=n[r]}}}function d(t,e,i){function n(){function t(t,e,i){for(var n=Wi.getOwnMetadata("parameters",t)||[];n.length<=i;)n.push(null);return n[i]=n[i]||[],n[i].push(o),Wi.defineMetadata("parameters",n,t),t}for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(this instanceof n)return r.apply(this,e),this;var o=new(n.bind.apply(n,[void 0].concat(e)));return t.annotation=o,t}var r=l(e);return i&&(n.prototype=Object.create(i.prototype)),n.prototype.toString=function(){return"@"+t},n.annotationCls=n,n}function p(t,e,i){function n(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this instanceof n)return r.apply(this,t),this;var i=new(n.bind.apply(n,[void 0].concat(t)));return function(t,e){var n=Wi.getOwnMetadata("propMetadata",t.constructor)||{};n[e]=n.hasOwnProperty(e)&&n[e]||[],n[e].unshift(i),Wi.defineMetadata("propMetadata",n,t.constructor)}}var r=l(e);return i&&(n.prototype=Object.create(i.prototype)),n.prototype.toString=function(){return"@"+t},n.annotationCls=n,n}function f(t){return t.__forward_ref__=f,t.toString=function(){return s(this())},t}function m(t){return"function"==typeof t&&t.hasOwnProperty("__forward_ref__")&&t.__forward_ref__===f?t():t}function g(t){return t[bn]}function y(t){return t[xn]}function v(t){if(t.length>1){return" ("+function(t){for(var e=[],i=0;i<t.length;++i){if(e.indexOf(t[i])>-1)return e.push(t[i]),e;e.push(t[i])}return e}(t.slice().reverse()).map(function(t){return s(t.token)}).join(" -> ")+")"}return""}function b(t,e,i,n){var r=[e],o=i(r),s=n?function(t,e){var i=t+" caused by: "+(e instanceof Error?e.message:e),n=Error(i);return n[xn]=e,n}(o,n):Error(o);return s.addKey=x,s.keys=r,s.injectors=[t],s.constructResolvingMessage=i,s[xn]=n,s}function x(t,e){this.injectors.push(t),this.keys.push(e),this.message=this.constructResolvingMessage(this.keys)}function _(t,e){for(var i=[],n=0,r=e.length;n<r;n++){var o=e[n];o&&0!=o.length?i.push(o.map(s).join(" ")):i.push("?")}return Error("Cannot resolve all parameters for '"+s(t)+"'("+i.join(", ")+"). Make sure that all the parameters are decorated with Inject or have valid type annotations and that '"+s(t)+"' is decorated with Injectable.")}function w(t,e){return Error("Cannot mix multi providers and regular providers, got: "+t+" "+e)}function T(t){return"function"==typeof t}function S(t){return t?t.map(function(t){var e=t.type.annotationCls,i=t.args?t.args:[];return new(e.bind.apply(e,[void 0].concat(i)))}):[]}function E(t){var e=Object.getPrototypeOf(t.prototype);return(e?e.constructor:null)||Object}function C(t){var e,i;if(t.useClass){var n=m(t.useClass);e=An.factory(n),i=R(n)}else t.useExisting?(e=function(t){return t},i=[Rn.fromKey(Tn.get(t.useExisting))]):t.useFactory?(e=t.useFactory,i=function(t,e){if(e){var i=e.map(function(t){return[t]});return e.map(function(e){return L(t,e,i)})}return R(t)}(t.useFactory,t.deps)):(e=function(){return t.useValue},i=Ln);return new In(e,i)}function P(t){return new On(Tn.get(t.provide),[C(t)],t.multi||!1)}function M(t){var e=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=e.get(n.key.id);if(r){if(n.multiProvider!==r.multiProvider)throw w(r,n);if(n.multiProvider)for(var o=0;o<n.resolvedFactories.length;o++)r.resolvedFactories.push(n.resolvedFactories[o]);else e.set(n.key.id,n)}else{var s=void 0;s=n.multiProvider?new On(n.key,n.resolvedFactories.slice(),n.multiProvider):n,e.set(n.key.id,s)}}return e}(A(t,[]).map(P),new Map);return Array.from(e.values())}function A(t,e){return t.forEach(function(t){if(t instanceof En)e.push({provide:t,useClass:t});else if(t&&"object"==typeof t&&void 0!==t.provide)e.push(t);else{if(!(t instanceof Array))throw function(t){return Error("Invalid provider - only instances of Provider and Type are allowed, got: "+t)}(t);A(t,e)}}),e}function R(t){var e=An.parameters(t);if(!e)return[];if(e.some(function(t){return null==t}))throw _(t,e);return e.map(function(i){return L(t,i,e)})}function L(t,e,i){var n=null,r=!1;if(!Array.isArray(e))return O(e instanceof un?e.token:e,r,null);for(var o=null,s=0;s<e.length;++s){var a=e[s];a instanceof En?n=a:a instanceof un?n=a.token:a instanceof cn?r=!0:a instanceof dn||a instanceof pn?o=a:a instanceof Ni&&(n=a)}if(null!=(n=m(n)))return O(n,r,o);throw _(t,i)}function O(t,e,i){return new Rn(Tn.get(t),e,i)}function I(t){return!!t&&"function"==typeof t.then}function B(t){return!!t&&"function"==typeof t.subscribe}function k(){return""+D()+D()+D()}function D(){return String.fromCharCode(97+Math.floor(25*Math.random()))}function F(){throw new Error("Runtime compiler is not loaded")}function U(t){var e=Error("No component factory found for "+s(t)+". Did you add it to @NgModule.entryComponents?");return e[Zn]=t,e}function N(t,e){return null}function G(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(function(){return t.onStable.emit(null)})}finally{t.isStable=!0}}}function j(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function V(t){t._nesting--,G(t)}function H(t){pr=t}function z(){if(mr)throw new Error("Cannot enable prod mode after platform setup.");fr=!1}function W(){return mr=!0,fr}function X(t,e,i){void 0===i&&(i=[]);var n=new Ni("Platform: "+e);return function(e){void 0===e&&(e=[]);var r=q();return r&&!r.injector.get(gr,!1)||(t?t(i.concat(e).concat({provide:n,useValue:!0})):function(t){if(dr&&!dr.destroyed&&!dr.injector.get(gr,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");dr=t.get(vr);var e=t.get(Vn,null);e&&e.forEach(function(t){return t()})}(kn.resolveAndCreate(i.concat(e).concat({provide:n,useValue:!0})))),function(t){var e=q();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(n)}}function q(){return dr&&!dr.destroyed?dr:null}function Y(t,e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}function K(t){return t.reduce(function(t,e){var i=Array.isArray(e)?K(e):e;return t.concat(i)},[])}function Z(t,e,i){if(!t)throw new Error("Cannot find '"+i+"' in '"+e+"'");return t}function Q(t,e,i){t.childNodes.forEach(function(t){t instanceof Fr&&(e(t)&&i.push(t),Q(t,e,i))})}function J(t,e,i){t instanceof Fr&&t.childNodes.forEach(function(t){e(t)&&i.push(t),t instanceof Fr&&J(t,e,i)})}function $(t){return Ur.get(t)||null}function tt(t){Ur.set(t.nativeNode,t)}function et(t,e){var i=it(t),r=it(e);if(i&&r)return function(t,e,i){var r=t[n()](),o=e[n()]();for(;;){var s=r.next(),a=o.next();if(s.done&&a.done)return!0;if(s.done||a.done)return!1;if(!i(s.value,a.value))return!1}}(t,e,et);return!(i||!(t&&("object"==typeof t||"function"==typeof t))||r||!(e&&("object"==typeof e||"function"==typeof e)))||o(t,e)}function it(t){return!!nt(t)&&(Array.isArray(t)||!(t instanceof Map)&&n()in t)}function nt(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function rt(t,e,i){var n=t.previousIndex;if(null===n)return n;var r=0;return i&&n<i.length&&(r=i[n]),n+e+r}function ot(){return to}function st(){return eo}function at(t){return t||"en-US"}function ht(t,e){return t.nodes[e]}function ut(t,e){return t.nodes[e]}function ct(t,e){return t.nodes[e]}function lt(t,e){return t.nodes[e]}function dt(t,e){return t.nodes[e]}function pt(t,e,i,n){var r="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '"+e+"'. Current value: '"+i+"'.";return n&&(r+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){var i=new Error(t);return ft(i,e),i}(r,t)}function ft(t,e){t[bn]=e,t[_n]=e.logError.bind(e)}function mt(t){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+t)}function gt(t){var e=co.get(t);return e||(e=s(t)+"_"+co.size,co.set(t,e)),e}function yt(t,e,i,n){if(n instanceof Nr){n=n.wrapped;var r=t.def.nodes[e].bindingIndex+i,o=t.oldValues[r];o instanceof Nr&&(o=o.wrapped),t.oldValues[r]=new Nr(o)}return n}function vt(t){return{id:lo,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}function bt(t,e,i,n){var r=t.oldValues;return!(!(2&t.state)&&o(r[e.bindingIndex+i],n))}function xt(t,e,i,n){return!!bt(t,e,i,n)&&(t.oldValues[e.bindingIndex+i]=n,!0)}function _t(t,e,i,n){var r=t.oldValues[e.bindingIndex+i];if(1&t.state||!et(r,n))throw pt(ho.createDebugContext(t,e.nodeIndex),r,n,0!=(1&t.state))}function wt(t){for(var e=t;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function Tt(t,e){for(var i=t;i&&i!==e;)i.state|=64,i=i.viewContainerParent||i.parent}function St(t,e,i,n){return wt(33554432&t.def.nodes[e].flags?ut(t,e).componentView:t),ho.handleEvent(t,e,i,n)}function Et(t){if(t.parent){return ut(t.parent,t.parentNodeDef.nodeIndex)}return null}function Ct(t){return t.parent?t.parentNodeDef.parent:null}function Pt(t,e){switch(201347067&e.flags){case 1:return ut(t,e.nodeIndex).renderElement;case 2:return ht(t,e.nodeIndex).renderText}}function Mt(t,e){return t?t+":"+e:e}function At(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function Rt(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function Lt(t){return 1<<t%32}function Ot(t){var e={},i=0,n={};return t&&t.forEach(function(t){var r=t[0],o=t[1];"number"==typeof r?(e[r]=o,i|=Lt(r)):n[r]=o}),{matchedQueries:e,references:n,matchedQueryIds:i}}function It(t){return t.map(function(t){var e,i;return Array.isArray(t)?(i=t[0],e=t[1]):(i=0,e=t),{flags:i,token:e,tokenKey:gt(e)}})}function Bt(t,e,i){var n=i.renderParent;return n?0==(1&n.flags)||0==(33554432&n.flags)||n.element.componentRendererType&&n.element.componentRendererType.encapsulation===sn.Native?ut(t,i.renderParent.nodeIndex).renderElement:void 0:e}function kt(t){var e=mo.get(t);return e||((e=t(function(){return uo})).factory=t,mo.set(t,e)),e}function Dt(t,e,i,n,r){3===e&&(i=t.renderer.parentNode(Pt(t,t.def.lastRenderRootNode))),Ft(t,e,0,t.def.nodes.length-1,i,n,r)}function Ft(t,e,i,n,r,o,s){for(var a=i;a<=n;a++){var h=t.def.nodes[a];11&h.flags&&Nt(t,h,e,r,o,s),a+=h.childCount}}function Ut(t,e,i,n,r,o){for(var s=t;s&&!At(s);)s=s.parent;for(var a=s.parent,h=Ct(s),u=h.nodeIndex+1,c=h.nodeIndex+h.childCount,l=u;l<=c;l++){var d=a.def.nodes[l];d.ngContentIndex===e&&Nt(a,d,i,n,r,o),l+=d.childCount}if(!a.parent){var p=t.root.projectableNodes[e];if(p)for(l=0;l<p.length;l++)Gt(t,p[l],i,n,r,o)}}function Nt(t,e,i,n,r,o){if(8&e.flags)Ut(t,e.ngContent.index,i,n,r,o);else{var s=Pt(t,e);if(3===i&&33554432&e.flags&&48&e.bindingFlags){if(16&e.bindingFlags&&Gt(t,s,i,n,r,o),32&e.bindingFlags){Gt(ut(t,e.nodeIndex).componentView,s,i,n,r,o)}}else Gt(t,s,i,n,r,o);if(16777216&e.flags)for(var a=ut(t,e.nodeIndex).viewContainer._embeddedViews,h=0;h<a.length;h++)Dt(a[h],i,n,r,o);1&e.flags&&!e.element.name&&Ft(t,i,e.nodeIndex+1,e.nodeIndex+e.childCount,n,r,o)}}function Gt(t,e,i,n,r,o){var s=t.renderer;switch(i){case 1:s.appendChild(n,e);break;case 2:s.insertBefore(n,e,r);break;case 3:s.removeChild(n,e);break;case 0:o.push(e)}}function jt(t){if(":"===t[0]){var e=t.match(go);return[e[1],e[2]]}return["",t]}function Vt(t){for(var e=0,i=0;i<t.length;i++)e|=t[i].flags;return e}function Ht(t,e,i,n,r,o,s,a,h,u,c,l,d,p,f,m,g,y,v,b){switch(t){case 1:return e+zt(i)+n;case 2:return e+zt(i)+n+zt(r)+o;case 3:return e+zt(i)+n+zt(r)+o+zt(s)+a;case 4:return e+zt(i)+n+zt(r)+o+zt(s)+a+zt(h)+u;case 5:return e+zt(i)+n+zt(r)+o+zt(s)+a+zt(h)+u+zt(c)+l;case 6:return e+zt(i)+n+zt(r)+o+zt(s)+a+zt(h)+u+zt(c)+l+zt(d)+p;case 7:return e+zt(i)+n+zt(r)+o+zt(s)+a+zt(h)+u+zt(c)+l+zt(d)+p+zt(f)+m;case 8:return e+zt(i)+n+zt(r)+o+zt(s)+a+zt(h)+u+zt(c)+l+zt(d)+p+zt(f)+m+zt(g)+y;case 9:return e+zt(i)+n+zt(r)+o+zt(s)+a+zt(h)+u+zt(c)+l+zt(d)+p+zt(f)+m+zt(g)+y+zt(v)+b;default:throw new Error("Does not support more than 9 expressions")}}function zt(t){return null!=t?t.toString():""}function Wt(t,e,i,n,r,o){t|=1;var s=Ot(e),a=s.matchedQueries,h=s.references;return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a,matchedQueryIds:s.matchedQueryIds,references:h,ngContentIndex:i,childCount:n,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?kt(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:r||uo},provider:null,text:null,query:null,ngContent:null}}function Xt(t,e,i,n,r,o,s,a,h,u,c,l){void 0===s&&(s=[]),u||(u=uo);var d=Ot(i),p=d.matchedQueries,f=d.references,m=d.matchedQueryIds,g=null,y=null;o&&(g=(B=jt(o))[0],y=B[1]),a=a||[];for(var v=new Array(a.length),b=0;b<a.length;b++){var x=a[b],_=x[0],w=x[1],T=x[2],S=jt(w),E=S[0],C=S[1],P=void 0,M=void 0;switch(15&_){case 4:M=T;break;case 1:case 8:P=T}v[b]={flags:_,ns:E,name:C,nonMinifiedName:C,securityContext:P,suffix:M}}h=h||[];var A=new Array(h.length);for(b=0;b<h.length;b++){var R=h[b],L=R[0],O=R[1];A[b]={type:0,target:L,eventName:O,propName:null}}var I=(s=s||[]).map(function(t){var e=t[0],i=t[1],n=jt(e);return[n[0],n[1],i]});return l=function(t){if(t&&t.id===lo){var e=null!=t.encapsulation&&t.encapsulation!==sn.None||t.styles.length||Object.keys(t.data).length;t.id=e?"c"+fo++:po}return t&&t.id===po&&(t=null),t||null}(l),c&&(e|=33554432),e|=1,{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:p,matchedQueryIds:m,references:f,ngContentIndex:n,childCount:r,bindings:v,bindingFlags:Vt(v),outputs:A,element:{ns:g,name:y,attrs:I,template:null,componentProvider:null,componentView:c||null,componentRendererType:l,publicProviders:null,allProviders:null,handleEvent:u||uo},provider:null,text:null,query:null,ngContent:null};var B}function qt(t,e,i){var n,r=i.element,o=t.root.selectorOrNode,s=t.renderer;if(t.parent||!o){n=r.name?s.createElement(r.name,r.ns):s.createComment("");var a=Bt(t,e,i);a&&s.appendChild(a,n)}else n=s.selectRootElement(o);if(r.attrs)for(var h=0;h<r.attrs.length;h++){var u=r.attrs[h],c=u[0],l=u[1],d=u[2];s.setAttribute(n,l,d,c)}return n}function Yt(t,e,i,n){for(var r=0;r<i.outputs.length;r++){var o=i.outputs[r],s=function(t,e,i){return function(n){try{return St(t,e,i,n)}catch(e){t.root.errorHandler.handleError(e)}}}(t,i.nodeIndex,Mt(o.target,o.eventName)),a=o.target,h=t;"component"===o.target&&(a=null,h=e);var u=h.renderer.listen(a||n,o.eventName,s);t.disposables[i.outputIndex+r]=u}}function Kt(t,e,i,n){if(!xt(t,e,i,n))return!1;var r=e.bindings[i],o=ut(t,e.nodeIndex),s=o.renderElement,a=r.name;switch(15&r.flags){case 1:!function(t,e,i,n,r,o){var s=e.securityContext,a=s?t.root.sanitizer.sanitize(s,o):o;a=null!=a?a.toString():null;var h=t.renderer;null!=o?h.setAttribute(i,r,a,n):h.removeAttribute(i,r,n)}(t,r,s,r.ns,a,n);break;case 2:!function(t,e,i,n){var r=t.renderer;n?r.addClass(e,i):r.removeClass(e,i)}(t,s,a,n);break;case 4:!function(t,e,i,n,r){var o=t.root.sanitizer.sanitize(so.STYLE,r);if(null!=o){o=o.toString();var s=e.suffix;null!=s&&(o+=s)}else o=null;var a=t.renderer;null!=o?a.setStyle(i,n,o):a.removeStyle(i,n)}(t,r,s,a,n);break;case 8:!function(t,e,i,n,r){var o=e.securityContext,s=o?t.root.sanitizer.sanitize(o,r):r;t.renderer.setProperty(i,n,s)}(33554432&e.flags&&32&r.flags?o.componentView:t,r,s,a,n)}return!0}function Zt(t,e,i,n){return{index:-1,deps:It(n),flags:t,token:e,value:i}}function Qt(t){for(var e={},i=0;i<t.length;i++){var n=t[i];n.index=i,e[gt(n.token)]=n}return{factory:null,providersByKey:e,providers:t}}function Jt(t,e,i){if(void 0===i&&(i=vn.THROW_IF_NOT_FOUND),8&e.flags)return e.token;if(2&e.flags&&(i=null),1&e.flags)return t._parent.get(e.token,i);var n=e.tokenKey;switch(n){case vo:case bo:return t}var r=t._def.providersByKey[n];if(r){var o=t._providers[r.index];return void 0===o&&(o=t._providers[r.index]=$t(t,r)),o===yo?void 0:o}return t._parent.get(e.token,i)}function $t(t,e){var i;switch(201347067&e.flags){case 512:i=function(t,e,i){var n=i.length;switch(n){case 0:return new e;case 1:return new e(Jt(t,i[0]));case 2:return new e(Jt(t,i[0]),Jt(t,i[1]));case 3:return new e(Jt(t,i[0]),Jt(t,i[1]),Jt(t,i[2]));default:for(var r=new Array(n),o=0;o<n;o++)r[o]=Jt(t,i[o]);return new(e.bind.apply(e,[void 0].concat(r)))}}(t,e.value,e.deps);break;case 1024:i=function(t,e,i){var n=i.length;switch(n){case 0:return e();case 1:return e(Jt(t,i[0]));case 2:return e(Jt(t,i[0]),Jt(t,i[1]));case 3:return e(Jt(t,i[0]),Jt(t,i[1]),Jt(t,i[2]));default:for(var r=Array(n),o=0;o<n;o++)r[o]=Jt(t,i[o]);return e.apply(void 0,r)}}(t,e.value,e.deps);break;case 2048:i=Jt(t,e.deps[0]);break;case 256:i=e.value}return void 0===i?yo:i}function te(t,e,i,n){var r=e.viewContainer._embeddedViews;null!==i&&void 0!==i||(i=r.length),n.viewContainerParent=t,re(r,i,n),function(t,e){var i=Et(e);if(!i||i===t||16&e.state)return;e.state|=16;var n=i.template._projectedViews;n||(n=i.template._projectedViews=[]);n.push(e),function(t,e){if(4&e.flags)return;t.nodeFlags|=4,e.flags|=4;var i=e.parent;for(;i;)i.childFlags|=4,i=i.parent}(e.parent.def,e.parentNodeDef)}(e,n),ho.dirtyParentQueries(n);ie(e,i>0?r[i-1]:null,n)}function ee(t,e){var i=t.viewContainer._embeddedViews;if((null==e||e>=i.length)&&(e=i.length-1),e<0)return null;var n=i[e];return n.viewContainerParent=null,oe(i,e),ho.dirtyParentQueries(n),ne(n),n}function ie(t,e,i){var n=e?Pt(e,e.def.lastRenderRootNode):t.renderElement;Dt(i,2,i.renderer.parentNode(n),i.renderer.nextSibling(n),void 0)}function ne(t){Dt(t,3,null,null,void 0)}function re(t,e,i){e>=t.length?t.push(i):t.splice(e,0,i)}function oe(t,e){e>=t.length-1?t.pop():t.splice(e,1)}function se(t,e,i,n,r,o){return new _o(t,e,i,n,r,o)}function ae(t,e,i){return new To(t,e,i)}function he(t){return new So(t)}function ue(t,e){return new Eo(t,e)}function ce(t,e){return new Co(t,e)}function le(t,e){var i=t.def.nodes[e];if(1&i.flags){var n=ut(t,i.nodeIndex);return i.element.template?n.template:n.renderElement}if(2&i.flags)return ht(t,i.nodeIndex).renderText;if(20240&i.flags)return ct(t,i.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index "+e)}function de(t){return new Po(t.renderer)}function pe(t,e,i,n){return new Mo(t,e,i,n)}function fe(t,e,i,n,r,o,s,a){var h=[];if(s)for(var u in s){var c=s[u],l=c[0],d=c[1];h[l]={flags:8,name:u,nonMinifiedName:d,ns:null,securityContext:null,suffix:null}}var p=[];if(a)for(var f in a)p.push({type:1,propName:f,target:null,eventName:a[f]});return e|=16384,ge(t,e,i,n,r,r,o,h,p)}function me(t,e,i){return t|=16,ge(-1,t,null,0,e,e,i)}function ge(t,e,i,n,r,o,s,a,h){var u=Ot(i),c=u.matchedQueries,l=u.references,d=u.matchedQueryIds;h||(h=[]),a||(a=[]);var p=It(s);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:d,references:l,ngContentIndex:-1,childCount:n,bindings:a,bindingFlags:Vt(a),outputs:h,element:null,provider:{token:r,value:o,deps:p},text:null,query:null,ngContent:null}}function ye(t,e){return xe(t,e)}function ve(t,e){for(var i=t;i.parent&&!At(i);)i=i.parent;return _e(i.parent,Ct(i),!0,e.provider.value,e.provider.deps)}function be(t,e){var i=(32768&e.flags)>0,n=_e(t,e.parent,i,e.provider.value,e.provider.deps);if(e.outputs.length)for(var r=0;r<e.outputs.length;r++){var o=e.outputs[r],s=n[o.propName].subscribe(function(t,e,i){return function(n){try{return St(t,e,i,n)}catch(e){t.root.errorHandler.handleError(e)}}}(t,e.parent.nodeIndex,o.eventName));t.disposables[e.outputIndex+r]=s.unsubscribe.bind(s)}return n}function xe(t,e){var i=(8192&e.flags)>0,n=e.provider;switch(201347067&e.flags){case 512:return _e(t,e.parent,i,n.value,n.deps);case 1024:return function(t,e,i,n,r){var o=r.length;switch(o){case 0:return n();case 1:return n(we(t,e,i,r[0]));case 2:return n(we(t,e,i,r[0]),we(t,e,i,r[1]));case 3:return n(we(t,e,i,r[0]),we(t,e,i,r[1]),we(t,e,i,r[2]));default:for(var s=Array(o),a=0;a<o;a++)s[a]=we(t,e,i,r[a]);return n.apply(void 0,s)}}(t,e.parent,i,n.value,n.deps);case 2048:return we(t,e.parent,i,n.deps[0]);case 256:return n.value}}function _e(t,e,i,n,r){var o=r.length;switch(o){case 0:return new n;case 1:return new n(we(t,e,i,r[0]));case 2:return new n(we(t,e,i,r[0]),we(t,e,i,r[1]));case 3:return new n(we(t,e,i,r[0]),we(t,e,i,r[1]),we(t,e,i,r[2]));default:for(var s=new Array(o),a=0;a<o;a++)s[a]=we(t,e,i,r[a]);return new(n.bind.apply(n,[void 0].concat(s)))}}function we(t,e,i,n,r){if(void 0===r&&(r=vn.THROW_IF_NOT_FOUND),8&n.flags)return n.token;var o=t;2&n.flags&&(r=null);var s=n.tokenKey;for(s===Bo&&(i=!(!e||!e.element.componentView)),e&&1&n.flags&&(i=!1,e=e.parent);t;){if(e)switch(s){case Ao:return de(Te(t,e,i));case Ro:return Te(t,e,i).renderer;case Lo:return new Cr(ut(t,e.nodeIndex).renderElement);case Oo:return ut(t,e.nodeIndex).viewContainer;case Io:if(e.element.template)return ut(t,e.nodeIndex).template;break;case Bo:return he(Te(t,e,i));case ko:return ce(t,e);default:var a=(i?e.element.allProviders:e.element.publicProviders)[s];if(a){var h=ct(t,a.nodeIndex);return h||(h={instance:xe(t,a)},t.nodes[a.nodeIndex]=h),h.instance}}i=At(t),e=Ct(t),t=t.parent}var u=o.root.injector.get(n.token,Do);return u!==Do||r===Do?u:o.root.ngModule.injector.get(n.token,r)}function Te(t,e,i){var n;if(i)n=ut(t,e.nodeIndex).componentView;else for(n=t;n.parent&&!At(n);)n=n.parent;return n}function Se(t,e,i,n,r,o){if(32768&i.flags){var s=ut(t,i.parent.nodeIndex).componentView;2&s.def.flags&&(s.state|=8)}var a=i.bindings[n].name;if(e.instance[a]=r,524288&i.flags){o=o||{};var h=t.oldValues[i.bindingIndex+n];h instanceof Nr&&(h=h.wrapped);o[i.bindings[n].nonMinifiedName]=new Gr(h,r,0!=(2&t.state))}return t.oldValues[i.bindingIndex+n]=r,o}function Ee(t,e){if(t.def.nodeFlags&e)for(var i=t.def.nodes,n=0;n<i.length;n++){var r=i[n],o=r.parent;for(!o&&r.flags&e&&Ce(t,n,r.flags&e),0==(r.childFlags&e)&&(n+=r.childCount);o&&1&o.flags&&n===o.nodeIndex+o.childCount;)o.directChildFlags&e&&function(t,e,i){for(var n=e.nodeIndex+1;n<=e.nodeIndex+e.childCount;n++){var r=t.def.nodes[n];r.flags&i&&Ce(t,n,r.flags&i),n+=r.childCount}}(t,o,e),o=o.parent}}function Ce(t,e,i){var n=ct(t,e);if(n){var r=n.instance;r&&(ho.setCurrentNode(t,e),1048576&i&&r.ngAfterContentInit(),2097152&i&&r.ngAfterContentChecked(),4194304&i&&r.ngAfterViewInit(),8388608&i&&r.ngAfterViewChecked(),131072&i&&r.ngOnDestroy())}}function Pe(t,e,i){var n=[];for(var r in i){var o=i[r];n.push({propName:r,bindingType:o})}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:Lt(e),bindings:n},ngContent:null}}function Me(){return new Mr}function Ae(t){for(var e=t.def.nodeMatchedQueries;t.parent&&Rt(t);){var i=t.parentNodeDef;t=t.parent;for(var n=i.nodeIndex+i.childCount,r=0;r<=n;r++){67108864&(o=t.def.nodes[r]).flags&&536870912&o.flags&&(o.query.filterId&e)===o.query.filterId&&dt(t,r).setDirty(),!(1&o.flags&&r+o.childCount<i.nodeIndex)&&67108864&o.childFlags&&536870912&o.childFlags||(r+=o.childCount)}}if(134217728&t.def.nodeFlags)for(r=0;r<t.def.nodes.length;r++){var o;134217728&(o=t.def.nodes[r]).flags&&536870912&o.flags&&dt(t,r).setDirty(),r+=o.childCount}}function Re(t,e){var i=dt(t,e.nodeIndex);if(i.dirty){var n,r=void 0;if(67108864&e.flags){var o=e.parent.parent;r=Le(t,o.nodeIndex,o.nodeIndex+o.childCount,e.query,[]),n=ct(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(r=Le(t,0,t.def.nodes.length-1,e.query,[]),n=t.component);i.reset(r);for(var s=e.query.bindings,a=!1,h=0;h<s.length;h++){var u=s[h],c=void 0;switch(u.bindingType){case 0:c=i.first;break;case 1:c=i,a=!0}n[u.propName]=c}a&&i.notifyOnChanges()}}function Le(t,e,i,n,r){for(var o=e;o<=i;o++){var s=t.def.nodes[o],a=s.matchedQueries[n.id];if(null!=a&&r.push(Oe(t,s,a)),1&s.flags&&s.element.template&&(s.element.template.nodeMatchedQueries&n.filterId)===n.filterId){var h=ut(t,o);if((s.childMatchedQueries&n.filterId)===n.filterId&&(Le(t,o+1,o+s.childCount,n,r),o+=s.childCount),16777216&s.flags)for(var u=h.viewContainer._embeddedViews,c=0;c<u.length;c++){var l=u[c],d=Et(l);d&&d===h&&Le(l,0,l.def.nodes.length-1,n,r)}var p=h.template._projectedViews;if(p)for(c=0;c<p.length;c++){var f=p[c];Le(f,0,f.def.nodes.length-1,n,r)}}(s.childMatchedQueries&n.filterId)!==n.filterId&&(o+=s.childCount)}return r}function Oe(t,e,i){if(null!=i)switch(i){case 1:return ut(t,e.nodeIndex).renderElement;case 0:return new Cr(ut(t,e.nodeIndex).renderElement);case 2:return ut(t,e.nodeIndex).template;case 3:return ut(t,e.nodeIndex).viewContainer;case 4:return ct(t,e.nodeIndex).instance}}function Ie(t,e){return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:8,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:t,childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:null,ngContent:{index:e}}}function Be(t,e,i){var n=Bt(t,e,i);if(n){Ut(t,i.ngContent.index,1,n,null,void 0)}}function ke(t,e){return Fe(128,t,new Array(e+1))}function De(t,e){for(var i=Object.keys(e),n=i.length,r=new Array(n),o=0;o<n;o++){var s=i[o];r[e[s]]=s}return Fe(64,t,r)}function Fe(t,e,i){for(var n=new Array(i.length),r=0;r<i.length;r++){var o=i[r];n[r]={flags:8,name:o,ns:null,nonMinifiedName:o,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:n,bindingFlags:Vt(n),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}function Ue(t,e,i){for(var n=new Array(i.length-1),r=1;r<i.length;r++)n[r-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:i[r]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:n,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:i[0]},query:null,ngContent:null}}function Ne(t,e,i){var n,r=t.renderer;n=r.createText(i.text.prefix);var o=Bt(t,e,i);return o&&r.appendChild(o,n),{renderText:n}}function Ge(t,e){return(null!=t?t.toString():"")+e.suffix}function je(t,e,i,n){for(var r=0,o=0,s=0,a=0,h=0,u=null,c=null,l=!1,d=!1,p=null,f=0;f<e.length;f++){var m=e[f];if(m.nodeIndex=f,m.parent=u,m.bindingIndex=r,m.outputIndex=o,m.renderParent=c,s|=m.flags,h|=m.matchedQueryIds,m.element){var g=m.element;g.publicProviders=u?u.element.publicProviders:Object.create(null),g.allProviders=g.publicProviders,l=!1,d=!1,m.element.template&&(h|=m.element.template.nodeMatchedQueries)}if(function(t,e,i){var n=e.element&&e.element.template;if(n){if(!n.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(n.lastRenderRootNode&&16777216&n.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index "+e.nodeIndex+"!")}if(20224&e.flags){var r=t?t.flags:0;if(0==(1&r))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index "+e.nodeIndex+"!")}if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index "+e.nodeIndex+"!");if(134217728&e.flags&&t)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index "+e.nodeIndex+"!")}if(e.childCount){var o=t?t.nodeIndex+t.childCount:i-1;if(e.nodeIndex<=o&&e.nodeIndex+e.childCount>o)throw new Error("Illegal State: childCount of node leads outside of parent, at index "+e.nodeIndex+"!")}}(u,m,e.length),r+=m.bindings.length,o+=m.outputs.length,!c&&3&m.flags&&(p=m),20224&m.flags){l||(l=!0,u.element.publicProviders=Object.create(u.element.publicProviders),u.element.allProviders=u.element.publicProviders);var y=0!=(8192&m.flags),v=0!=(32768&m.flags);!y||v?u.element.publicProviders[gt(m.provider.token)]=m:(d||(d=!0,u.element.allProviders=Object.create(u.element.publicProviders)),u.element.allProviders[gt(m.provider.token)]=m),v&&(u.element.componentProvider=m)}if(u?(u.childFlags|=m.flags,u.directChildFlags|=m.flags,u.childMatchedQueries|=m.matchedQueryIds,m.element&&m.element.template&&(u.childMatchedQueries|=m.element.template.nodeMatchedQueries)):a|=m.flags,m.childCount>0)u=m,Ve(m)||(c=m);else for(;u&&f===u.nodeIndex+u.childCount;){var b=u.parent;b&&(b.childFlags|=u.childFlags,b.childMatchedQueries|=u.childMatchedQueries),c=(u=b)&&Ve(u)?u.renderParent:u}}return{factory:null,nodeFlags:s,rootNodeFlags:a,nodeMatchedQueries:h,flags:t,nodes:e,updateDirectives:i||uo,updateRenderer:n||uo,handleEvent:function(t,i,n,r){return e[i].element.handleEvent(t,n,r)},bindingCount:r,outputCount:o,lastRenderRootNode:p}}function Ve(t){return 0!=(1&t.flags)&&null===t.element.name}function He(t,e,i,n){var r=Xe(t.root,t.renderer,t,e,i);return qe(r,t.component,n),Ye(r),r}function ze(t,e,i){var n=Xe(t,t.renderer,null,null,e);return qe(n,i,i),Ye(n),n}function We(t,e,i,n){var r,o=e.element.componentRendererType;return r=o?t.root.rendererFactory.createRenderer(n,o):t.root.renderer,Xe(t.root,r,t,e.element.componentProvider,i)}function Xe(t,e,i,n,r){var o=new Array(r.nodes.length),s=r.outputCount?new Array(r.outputCount):null;return{def:r,parent:i,viewContainerParent:null,parentNodeDef:n,context:null,component:null,nodes:o,state:13,root:t,renderer:e,oldValues:new Array(r.bindingCount),disposables:s}}function qe(t,e,i){t.component=e,t.context=i}function Ye(t){var e;if(At(t)){var i=t.parentNodeDef;e=ut(t.parent,i.parent.nodeIndex).renderElement}for(var n=t.def,r=t.nodes,o=0;o<n.nodes.length;o++){var s=n.nodes[o];ho.setCurrentNode(t,o);var a=void 0;switch(201347067&s.flags){case 1:var h=qt(t,e,s),u=void 0;if(33554432&s.flags){var c=kt(s.element.componentView);u=ho.createComponentView(t,s,c,h)}Yt(t,u,s,h),a={renderElement:h,componentView:u,viewContainer:null,template:s.element.template?ue(t,s):void 0},16777216&s.flags&&(a.viewContainer=ae(t,s,a));break;case 2:a=Ne(t,e,s);break;case 512:case 1024:case 2048:case 256:if(!((a=r[o])||4096&s.flags)){a={instance:ye(t,s)}}break;case 16:a={instance:ve(t,s)};break;case 16384:if(!(a=r[o])){a={instance:be(t,s)}}if(32768&s.flags){qe(ut(t,s.parent.nodeIndex).componentView,a.instance,a.instance)}break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=Me();break;case 8:Be(t,e,s),a=void 0}r[o]=a}ii(t,Fo.CreateViewNodes),si(t,201326592,268435456,0)}function Ke(t){Je(t),ho.updateDirectives(t,1),ni(t,Fo.CheckNoChanges),ho.updateRenderer(t,1),ii(t,Fo.CheckNoChanges),t.state&=-97}function Ze(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,Je(t),ho.updateDirectives(t,0),ni(t,Fo.CheckAndUpdate),si(t,67108864,536870912,0),Ee(t,2097152|(2&t.state?1048576:0)),ho.updateRenderer(t,0),ii(t,Fo.CheckAndUpdate),si(t,134217728,536870912,0),Ee(t,8388608|(2&t.state?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97}function Qe(t,e,i,n,r,o,s,a,h,u,c,l,d){return 0===i?function(t,e,i,n,r,o,s,a,h,u,c,l){switch(201347067&e.flags){case 1:return function(t,e,i,n,r,o,s,a,h,u,c,l){var d=e.bindings.length,p=!1;return d>0&&Kt(t,e,0,i)&&(p=!0),d>1&&Kt(t,e,1,n)&&(p=!0),d>2&&Kt(t,e,2,r)&&(p=!0),d>3&&Kt(t,e,3,o)&&(p=!0),d>4&&Kt(t,e,4,s)&&(p=!0),d>5&&Kt(t,e,5,a)&&(p=!0),d>6&&Kt(t,e,6,h)&&(p=!0),d>7&&Kt(t,e,7,u)&&(p=!0),d>8&&Kt(t,e,8,c)&&(p=!0),d>9&&Kt(t,e,9,l)&&(p=!0),p}(t,e,i,n,r,o,s,a,h,u,c,l);case 2:return function(t,e,i,n,r,o,s,a,h,u,c,l){var d=!1,p=e.bindings,f=p.length;if(f>0&&xt(t,e,0,i)&&(d=!0),f>1&&xt(t,e,1,n)&&(d=!0),f>2&&xt(t,e,2,r)&&(d=!0),f>3&&xt(t,e,3,o)&&(d=!0),f>4&&xt(t,e,4,s)&&(d=!0),f>5&&xt(t,e,5,a)&&(d=!0),f>6&&xt(t,e,6,h)&&(d=!0),f>7&&xt(t,e,7,u)&&(d=!0),f>8&&xt(t,e,8,c)&&(d=!0),f>9&&xt(t,e,9,l)&&(d=!0),d){var m=e.text.prefix;f>0&&(m+=Ge(i,p[0])),f>1&&(m+=Ge(n,p[1])),f>2&&(m+=Ge(r,p[2])),f>3&&(m+=Ge(o,p[3])),f>4&&(m+=Ge(s,p[4])),f>5&&(m+=Ge(a,p[5])),f>6&&(m+=Ge(h,p[6])),f>7&&(m+=Ge(u,p[7])),f>8&&(m+=Ge(c,p[8])),f>9&&(m+=Ge(l,p[9]));var g=ht(t,e.nodeIndex).renderText;t.renderer.setValue(g,m)}return d}(t,e,i,n,r,o,s,a,h,u,c,l);case 16384:return function(t,e,i,n,r,o,s,a,h,u,c,l){var d=ct(t,e.nodeIndex),p=d.instance,f=!1,m=void 0,g=e.bindings.length;return g>0&&bt(t,e,0,i)&&(f=!0,m=Se(t,d,e,0,i,m)),g>1&&bt(t,e,1,n)&&(f=!0,m=Se(t,d,e,1,n,m)),g>2&&bt(t,e,2,r)&&(f=!0,m=Se(t,d,e,2,r,m)),g>3&&bt(t,e,3,o)&&(f=!0,m=Se(t,d,e,3,o,m)),g>4&&bt(t,e,4,s)&&(f=!0,m=Se(t,d,e,4,s,m)),g>5&&bt(t,e,5,a)&&(f=!0,m=Se(t,d,e,5,a,m)),g>6&&bt(t,e,6,h)&&(f=!0,m=Se(t,d,e,6,h,m)),g>7&&bt(t,e,7,u)&&(f=!0,m=Se(t,d,e,7,u,m)),g>8&&bt(t,e,8,c)&&(f=!0,m=Se(t,d,e,8,c,m)),g>9&&bt(t,e,9,l)&&(f=!0,m=Se(t,d,e,9,l,m)),m&&p.ngOnChanges(m),2&t.state&&65536&e.flags&&p.ngOnInit(),262144&e.flags&&p.ngDoCheck(),f}(t,e,i,n,r,o,s,a,h,u,c,l);case 32:case 64:case 128:return function(t,e,i,n,r,o,s,a,h,u,c,l){var d=e.bindings,p=!1,f=d.length;if(f>0&&xt(t,e,0,i)&&(p=!0),f>1&&xt(t,e,1,n)&&(p=!0),f>2&&xt(t,e,2,r)&&(p=!0),f>3&&xt(t,e,3,o)&&(p=!0),f>4&&xt(t,e,4,s)&&(p=!0),f>5&&xt(t,e,5,a)&&(p=!0),f>6&&xt(t,e,6,h)&&(p=!0),f>7&&xt(t,e,7,u)&&(p=!0),f>8&&xt(t,e,8,c)&&(p=!0),f>9&&xt(t,e,9,l)&&(p=!0),p){var m=lt(t,e.nodeIndex),g=void 0;switch(201347067&e.flags){case 32:g=new Array(d.length),f>0&&(g[0]=i),f>1&&(g[1]=n),f>2&&(g[2]=r),f>3&&(g[3]=o),f>4&&(g[4]=s),f>5&&(g[5]=a),f>6&&(g[6]=h),f>7&&(g[7]=u),f>8&&(g[8]=c),f>9&&(g[9]=l);break;case 64:g={},f>0&&(g[d[0].name]=i),f>1&&(g[d[1].name]=n),f>2&&(g[d[2].name]=r),f>3&&(g[d[3].name]=o),f>4&&(g[d[4].name]=s),f>5&&(g[d[5].name]=a),f>6&&(g[d[6].name]=h),f>7&&(g[d[7].name]=u),f>8&&(g[d[8].name]=c),f>9&&(g[d[9].name]=l);break;case 128:var y=i;switch(f){case 1:g=y.transform(i);break;case 2:g=y.transform(n);break;case 3:g=y.transform(n,r);break;case 4:g=y.transform(n,r,o);break;case 5:g=y.transform(n,r,o,s);break;case 6:g=y.transform(n,r,o,s,a);break;case 7:g=y.transform(n,r,o,s,a,h);break;case 8:g=y.transform(n,r,o,s,a,h,u);break;case 9:g=y.transform(n,r,o,s,a,h,u,c);break;case 10:g=y.transform(n,r,o,s,a,h,u,c,l)}}m.value=g}return p}(t,e,i,n,r,o,s,a,h,u,c,l);default:throw"unreachable"}}(t,e,n,r,o,s,a,h,u,c,l,d):function(t,e,i){switch(201347067&e.flags){case 1:return function(t,e,i){for(var n=!1,r=0;r<i.length;r++)Kt(t,e,r,i[r])&&(n=!0);return n}(t,e,i);case 2:return function(t,e,i){for(var n=e.bindings,r=!1,o=0;o<i.length;o++)xt(t,e,o,i[o])&&(r=!0);if(r){var s="";for(o=0;o<i.length;o++)s+=Ge(i[o],n[o]);s=e.text.prefix+s;var a=ht(t,e.nodeIndex).renderText;t.renderer.setValue(a,s)}return r}(t,e,i);case 16384:return function(t,e,i){for(var n=ct(t,e.nodeIndex),r=n.instance,o=!1,s=void 0,a=0;a<i.length;a++)bt(t,e,a,i[a])&&(o=!0,s=Se(t,n,e,a,i[a],s));return s&&r.ngOnChanges(s),2&t.state&&65536&e.flags&&r.ngOnInit(),262144&e.flags&&r.ngDoCheck(),o}(t,e,i);case 32:case 64:case 128:return function(t,e,i){for(var n=e.bindings,r=!1,o=0;o<i.length;o++)xt(t,e,o,i[o])&&(r=!0);if(r){var s=lt(t,e.nodeIndex),a=void 0;switch(201347067&e.flags){case 32:a=i;break;case 64:for(a={},o=0;o<i.length;o++)a[n[o].name]=i[o];break;case 128:var h=i[0],u=i.slice(1);a=h.transform.apply(h,u)}s.value=a}return r}(t,e,i);default:throw"unreachable"}}(t,e,n)}function Je(t){var e=t.def;if(4&e.nodeFlags)for(var i=0;i<e.nodes.length;i++){var n=e.nodes[i];if(4&n.flags){var r=ut(t,i).template._projectedViews;if(r)for(var o=0;o<r.length;o++){var s=r[o];s.state|=32,Tt(s,t)}}else 0==(4&n.childFlags)&&(i+=n.childCount)}}function $e(t,e,i,n,r,o,s,a,h,u,c,l,d){return 0===i?function(t,e,i,n,r,o,s,a,h,u,c,l){var d=e.bindings.length;d>0&&_t(t,e,0,i);d>1&&_t(t,e,1,n);d>2&&_t(t,e,2,r);d>3&&_t(t,e,3,o);d>4&&_t(t,e,4,s);d>5&&_t(t,e,5,a);d>6&&_t(t,e,6,h);d>7&&_t(t,e,7,u);d>8&&_t(t,e,8,c);d>9&&_t(t,e,9,l)}(t,e,n,r,o,s,a,h,u,c,l,d):function(t,e,i){for(var n=0;n<i.length;n++)_t(t,e,n,i[n])}(t,e,n),!1}function ti(t,e){if(dt(t,e.nodeIndex).dirty)throw pt(ho.createDebugContext(t,e.nodeIndex),"Query "+e.query.id+" not dirty","Query "+e.query.id+" dirty",0!=(1&t.state))}function ei(t){if(!(128&t.state)){if(ni(t,Fo.Destroy),ii(t,Fo.Destroy),Ee(t,131072),t.disposables)for(var e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(16&t.state){var e=Et(t);if(e){var i=e.template._projectedViews;i&&(oe(i,i.indexOf(t)),ho.dirtyParentQueries(t))}}}(t),t.renderer.destroyNode&&function(t){for(var e=t.def.nodes.length,i=0;i<e;i++){var n=t.def.nodes[i];1&n.flags?t.renderer.destroyNode(ut(t,i).renderElement):2&n.flags?t.renderer.destroyNode(ht(t,i).renderText):(67108864&n.flags||134217728&n.flags)&&dt(t,i).destroy()}}(t),At(t)&&t.renderer.destroy(),t.state|=128}}function ii(t,e){var i=t.def;if(33554432&i.nodeFlags)for(var n=0;n<i.nodes.length;n++){var r=i.nodes[n];33554432&r.flags?ri(ut(t,n).componentView,e):0==(33554432&r.childFlags)&&(n+=r.childCount)}}function ni(t,e){var i=t.def;if(16777216&i.nodeFlags)for(var n=0;n<i.nodes.length;n++){var r=i.nodes[n];if(16777216&r.flags)for(var o=ut(t,n).viewContainer._embeddedViews,s=0;s<o.length;s++)ri(o[s],e);else 0==(16777216&r.childFlags)&&(n+=r.childCount)}}function ri(t,e){var i=t.state;switch(e){case Fo.CheckNoChanges:0==(128&i)&&(12==(12&i)?Ke(t):64&i&&oi(t,Fo.CheckNoChangesProjectedViews));break;case Fo.CheckNoChangesProjectedViews:0==(128&i)&&(32&i?Ke(t):64&i&&oi(t,e));break;case Fo.CheckAndUpdate:0==(128&i)&&(12==(12&i)?Ze(t):64&i&&oi(t,Fo.CheckAndUpdateProjectedViews));break;case Fo.CheckAndUpdateProjectedViews:0==(128&i)&&(32&i?Ze(t):64&i&&oi(t,e));break;case Fo.Destroy:ei(t);break;case Fo.CreateViewNodes:Ye(t)}}function oi(t,e){ni(t,e),ii(t,e)}function si(t,e,i,n){if(t.def.nodeFlags&e&&t.def.nodeFlags&i)for(var r=t.def.nodes.length,o=0;o<r;o++){var s=t.def.nodes[o];if(s.flags&e&&s.flags&i)switch(ho.setCurrentNode(t,s.nodeIndex),n){case 0:Re(t,s);break;case 1:ti(t,s)}s.childFlags&e&&s.childFlags&i||(o+=s.childCount)}}function ai(){if(!Uo){Uo=!0;var t=W()?{setCurrentNode:wi,createRootView:ui,createEmbeddedView:li,createComponentView:di,createNgModuleRef:pi,overrideProvider:fi,clearProviderOverrides:mi,checkAndUpdateView:bi,checkNoChangesView:xi,destroyView:_i,createDebugContext:function(t,e){return new Wo(t,e)},handleEvent:Ti,updateDirectives:Si,updateRenderer:Ei}:{setCurrentNode:function(){},createRootView:hi,createEmbeddedView:He,createComponentView:We,createNgModuleRef:pe,overrideProvider:uo,clearProviderOverrides:uo,checkAndUpdateView:Ze,checkNoChangesView:Ke,destroyView:ei,createDebugContext:function(t,e){return new Wo(t,e)},handleEvent:function(t,e,i,n){return t.def.handleEvent(t,e,i,n)},updateDirectives:function(t,e){return t.def.updateDirectives(0===e?yi:vi,t)},updateRenderer:function(t,e){return t.def.updateRenderer(0===e?yi:vi,t)}};ho.setCurrentNode=t.setCurrentNode,ho.createRootView=t.createRootView,ho.createEmbeddedView=t.createEmbeddedView,ho.createComponentView=t.createComponentView,ho.createNgModuleRef=t.createNgModuleRef,ho.overrideProvider=t.overrideProvider,ho.clearProviderOverrides=t.clearProviderOverrides,ho.checkAndUpdateView=t.checkAndUpdateView,ho.checkNoChangesView=t.checkNoChangesView,ho.destroyView=t.destroyView,ho.resolveDep=we,ho.createDebugContext=t.createDebugContext,ho.handleEvent=t.handleEvent,ho.updateDirectives=t.updateDirectives,ho.updateRenderer=t.updateRenderer,ho.dirtyParentQueries=Ae}}function hi(t,e,i,n,r,o){return ze(ci(t,r,r.injector.get(Tr),e,i),n,o)}function ui(t,e,i,n,r,o){var s=r.injector.get(Tr),a=ci(t,r,new Xo(s),e,i),h=gi(n);return Li(Go.create,ze,null,[a,h,o])}function ci(t,e,i,n,r){var o=e.injector.get(ao),s=e.injector.get(wn);return{ngModule:e,injector:t,projectableNodes:n,selectorOrNode:r,sanitizer:o,rendererFactory:i,renderer:i.createRenderer(null,null),errorHandler:s}}function li(t,e,i,n){var r=gi(i);return Li(Go.create,He,null,[t,e,r,n])}function di(t,e,i,n){var r=gi(i);return Li(Go.create,We,null,[t,e,r,n])}function pi(t,e,i,n){return pe(t,e,i,function(t){var e=function(t){var e=!1,i=!1;if(0===No.size)return{hasOverrides:e,hasDeprecatedOverrides:i};return t.providers.forEach(function(t){var n=No.get(t.token);3840&t.flags&&n&&(e=!0,i=i||n.deprecatedBehavior)}),{hasOverrides:e,hasDeprecatedOverrides:i}}(t),i=e.hasOverrides,n=e.hasDeprecatedOverrides;if(!i)return t;return t=t.factory(function(){return uo}),function(t){for(var e=0;e<t.providers.length;e++){var i=t.providers[e];n&&(i.flags|=4096);var r=No.get(i.token);r&&(i.flags=-3841&i.flags|r.flags,i.deps=It(r.deps),i.value=r.value)}}(t),t}(n))}function fi(t){No.set(t.token,t)}function mi(){No.clear()}function gi(t){if(0===No.size)return t;var e=function(t){for(var e=[],i=null,n=0;n<t.nodes.length;n++){var r=t.nodes[n];1&r.flags&&(i=r),i&&3840&r.flags&&No.has(r.provider.token)&&(e.push(i.nodeIndex),i=null)}return e}(t);if(0===e.length)return t;t=t.factory(function(){return uo});for(var i=0;i<e.length;i++)!function(t,e){for(var i=e+1;i<t.nodes.length;i++){var n=t.nodes[i];if(1&n.flags)return;if(3840&n.flags){var r=n.provider,o=No.get(r.token);o&&(n.flags=-3841&n.flags|o.flags,r.deps=It(o.deps),r.value=o.value)}}}(t,e[i]);return t}function yi(t,e,i,n,r,o,s,a,h,u,c,l,d){var p=t.def.nodes[e];return Qe(t,p,i,n,r,o,s,a,h,u,c,l,d),224&p.flags?lt(t,e).value:void 0}function vi(t,e,i,n,r,o,s,a,h,u,c,l,d){var p=t.def.nodes[e];return $e(t,p,i,n,r,o,s,a,h,u,c,l,d),224&p.flags?lt(t,e).value:void 0}function bi(t){return Li(Go.detectChanges,Ze,null,[t])}function xi(t){return Li(Go.checkNoChanges,Ke,null,[t])}function _i(t){return Li(Go.destroy,ei,null,[t])}function wi(t,e){Vo=t,Ho=e}function Ti(t,e,i,n){return wi(t,e),Li(Go.handleEvent,t.def.handleEvent,null,[t,e,i,n])}function Si(t,e){if(128&t.state)throw mt(Go[jo]);return wi(t,Mi(t,0)),t.def.updateDirectives(function(t,i,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var s=t.def.nodes[i];return 0===e?Ci(t,s,n,r):Pi(t,s,n,r),16384&s.flags&&wi(t,Mi(t,i)),224&s.flags?lt(t,s.nodeIndex).value:void 0},t)}function Ei(t,e){if(128&t.state)throw mt(Go[jo]);return wi(t,Ai(t,0)),t.def.updateRenderer(function(t,i,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var s=t.def.nodes[i];return 0===e?Ci(t,s,n,r):Pi(t,s,n,r),3&s.flags&&wi(t,Ai(t,i)),224&s.flags?lt(t,s.nodeIndex).value:void 0},t)}function Ci(t,e,i,n){if(Qe.apply(void 0,[t,e,i].concat(n))){var r=1===i?n[0]:n;if(16384&e.flags){for(var o={},s=0;s<e.bindings.length;s++){var a=e.bindings[s],h=r[s];8&a.flags&&(o[function(t){return"ng-reflect-"+(t=function(t){return t.replace(zo,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"-"+t[1].toLowerCase()})}(t.replace(/[$@]/g,"_")))}(a.nonMinifiedName)]=function(t){try{return null!=t?t.toString().slice(0,30):t}catch(t){return"[ERROR] Exception while trying to serialize the value"}}(h))}var u=e.parent,c=ut(t,u.nodeIndex).renderElement;if(u.element.name)for(var l in o){null!=(h=o[l])?t.renderer.setAttribute(c,l,h):t.renderer.removeAttribute(c,l)}else t.renderer.setValue(c,"bindings="+JSON.stringify(o,null,2))}}}function Pi(t,e,i,n){$e.apply(void 0,[t,e,i].concat(n))}function Mi(t,e){for(var i=e;i<t.def.nodes.length;i++){var n=t.def.nodes[i];if(16384&n.flags&&n.bindings&&n.bindings.length)return i}return null}function Ai(t,e){for(var i=e;i<t.def.nodes.length;i++){var n=t.def.nodes[i];if(3&n.flags&&n.bindings&&n.bindings.length)return i}return null}function Ri(t,e,i){for(var n in e.references)i[n]=Oe(t,e,e.references[n])}function Li(t,e,i,n){var r=jo,o=Vo,s=Ho;try{jo=t;var a=e.apply(i,n);return Vo=o,Ho=s,jo=r,a}catch(t){if(function(t){return!!g(t)}(t)||!Vo)throw t;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),ft(t,e),t}(t,Oi())}}function Oi(){return Vo?new Wo(Vo,Ho):null}function Ii(t,e,i){return new Yo(t,e,i)}i.d(e,"g",function(){return xr}),i.d(e,"_2",function(){return z}),i.d(e,"_5",function(){return W}),i.d(e,"_1",function(){return X}),i.d(e,"F",function(){return yr}),i.d(e,"c",function(){return Gn}),i.d(e,"K",function(){return Vn}),i.d(e,"J",function(){return Hn}),i.d(e,"b",function(){return zn}),i.d(e,"d",function(){return Un}),i.d(e,"e",function(){return Nn}),i.d(e,"_4",function(){return $}),i.d(e,"W",function(){return cr}),i.d(e,"_7",function(){return H}),i.d(e,"A",function(){return no}),i.d(e,"f",function(){return oo}),i.d(e,"p",function(){return hr}),i.d(e,"o",function(){return wn}),i.d(e,"Q",function(){return ao}),i.d(e,"R",function(){return so}),i.d(e,"a",function(){return Xi}),i.d(e,"h",function(){return qi}),i.d(e,"l",function(){return Ki}),i.d(e,"m",function(){return Ji}),i.d(e,"r",function(){return nn}),i.d(e,"s",function(){return rn}),i.d(e,"x",function(){return tn}),i.d(e,"I",function(){return en}),i.d(e,"L",function(){return $i}),i.d(e,"B",function(){return on}),i.d(e,"Z",function(){return sn}),i.d(e,"X",function(){return an}),i.d(e,"_3",function(){return f}),i.d(e,"w",function(){return vn}),i.d(e,"v",function(){return Ni}),i.d(e,"t",function(){return un}),i.d(e,"H",function(){return cn}),i.d(e,"u",function(){return ln}),i.d(e,"S",function(){return pn}),i.d(e,"q",function(){return fn}),i.d(e,"G",function(){return ur}),i.d(e,"M",function(){return wr}),i.d(e,"N",function(){return Er}),i.d(e,"O",function(){return Tr}),i.d(e,"P",function(){return Sr}),i.d(e,"j",function(){return Xn}),i.d(e,"k",function(){return Jn}),i.d(e,"n",function(){return Cr}),i.d(e,"C",function(){return rr}),i.d(e,"E",function(){return nr}),i.d(e,"D",function(){return Pr}),i.d(e,"T",function(){return Lr}),i.d(e,"U",function(){return Ar}),i.d(e,"V",function(){return Or}),i.d(e,"Y",function(){return Ir}),i.d(e,"i",function(){return Br}),i.d(e,"y",function(){return Zr}),i.d(e,"z",function(){return Qr}),i.d(e,"_0",function(){return Nr}),i.d(e,"_6",function(){return io}),i.d(e,"_20",function(){return it}),i.d(e,"_9",function(){return Wn}),i.d(e,"_8",function(){return er}),i.d(e,"_18",function(){return Vi}),i.d(e,"_34",function(){return s}),i.d(e,"_21",function(){return B}),i.d(e,"_22",function(){return I}),i.d(e,"_10",function(){return Wt}),i.d(e,"_11",function(){return se}),i.d(e,"_12",function(){return Ii}),i.d(e,"_13",function(){return vt}),i.d(e,"_14",function(){return fe}),i.d(e,"_16",function(){return Xt}),i.d(e,"_19",function(){return Ht}),i.d(e,"_26",function(){return Qt}),i.d(e,"_27",function(){return Zt}),i.d(e,"_28",function(){return Ie}),i.d(e,"_29",function(){return le}),i.d(e,"_30",function(){return me}),i.d(e,"_31",function(){return De}),i.d(e,"_32",function(){return ke}),i.d(e,"_33",function(){return Pe}),i.d(e,"_35",function(){return Ue}),i.d(e,"_36",function(){return yt}),i.d(e,"_37",function(){return je}),i.d(e,"_23",function(){return ot}),i.d(e,"_24",function(){return st}),i.d(e,"_25",function(){return at}),i.d(e,"_15",function(){return _r}),i.d(e,"_17",function(){return k});var Bi=i("6Xbx"),ki=i("AP4T"),Di=i("2kLc"),Fi=i("URbD"),Ui=i("TO51"),Ni=function(t){function e(e){return t.call(this,e)||this}return Bi.a(e,t),e.prototype.toString=function(){return"InjectionToken "+this._desc},e}(function(){function t(t){this._desc=t}return t.prototype.toString=function(){return"Token "+this._desc},t}()),Gi="undefined"!=typeof window&&window,ji="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Vi=Gi||"undefined"!=typeof t&&t||ji,Hi=null,zi=0,Wi=Vi.Reflect,Xi=new Ni("AnalyzeForEntryComponents"),qi=d("Attribute",function(t){return{attributeName:t}}),Yi=function(){return function(){}}(),Ki=p("ContentChildren",function(t,e){return void 0===e&&(e={}),Object.assign({selector:t,first:!1,isViewQuery:!1,descendants:!1},e)},Yi),Zi=(p("ContentChild",function(t,e){return void 0===e&&(e={}),Object.assign({selector:t,first:!0,isViewQuery:!1,descendants:!0},e)},Yi),p("ViewChildren",function(t,e){return void 0===e&&(e={}),Object.assign({selector:t,first:!1,isViewQuery:!0,descendants:!0},e)},Yi),p("ViewChild",function(t,e){return Object.assign({selector:t,first:!0,isViewQuery:!0,descendants:!0},e)},Yi),{});Zi.OnPush=0,Zi.Default=1,Zi[Zi.OnPush]="OnPush",Zi[Zi.Default]="Default";var Qi={};Qi.CheckOnce=0,Qi.Checked=1,Qi.CheckAlways=2,Qi.Detached=3,Qi.Errored=4,Qi.Destroyed=5,Qi[Qi.CheckOnce]="CheckOnce",Qi[Qi.Checked]="Checked",Qi[Qi.CheckAlways]="CheckAlways",Qi[Qi.Detached]="Detached",Qi[Qi.Errored]="Errored",Qi[Qi.Destroyed]="Destroyed";var Ji=c("Directive",function(t){return void 0===t&&(t={}),t}),$i=(c("Component",function(t){return void 0===t&&(t={}),Object.assign({changeDetection:Zi.Default},t)},Ji),c("Pipe",function(t){return Object.assign({pure:!0},t)})),tn=p("Input",function(t){return{bindingPropertyName:t}}),en=p("Output",function(t){return{bindingPropertyName:t}}),nn=p("HostBinding",function(t){return{hostPropertyName:t}}),rn=p("HostListener",function(t,e){return{eventName:t,args:e}}),on=c("NgModule",function(t){return t}),sn={};sn.Emulated=0,sn.Native=1,sn.None=2,sn[sn.Emulated]="Emulated",sn[sn.Native]="Native",sn[sn.None]="None";var an=function(){function t(t){this.full=t}return Object.defineProperty(t.prototype,"major",{get:function(){return this.full.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minor",{get:function(){return this.full.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"patch",{get:function(){return this.full.split(".").slice(2).join(".")},enumerable:!0,configurable:!0}),t}(),hn=new an("4.4.6"),un=d("Inject",function(t){return{token:t}}),cn=d("Optional"),ln=c("Injectable"),dn=d("Self"),pn=d("SkipSelf"),fn=d("Host"),mn=new Object,gn=mn,yn=function(){function t(){}return t.prototype.get=function(t,e){if(void 0===e&&(e=mn),e===mn)throw new Error("No provider for "+s(t)+"!");return e},t}(),vn=function(){function t(){}return t.prototype.get=function(t,e){},t.prototype.get=function(t,e){},t}();vn.THROW_IF_NOT_FOUND=mn,vn.NULL=new yn;var bn="ngDebugContext",xn="ngOriginalError",_n="ngErrorLogger",wn=function(){function t(t){this._console=console}return t.prototype.handleError=function(t){var e=this._findOriginalError(t),i=this._findContext(t),n=function(t){return t[_n]||function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];t.error.apply(t,e)}}(t);n(this._console,"ERROR",t),e&&n(this._console,"ORIGINAL ERROR",e),i&&n(this._console,"ERROR CONTEXT",i)},t.prototype._findContext=function(t){return t?g(t)?g(t):this._findContext(y(t)):null},t.prototype._findOriginalError=function(t){for(var e=y(t);e&&y(e);)e=y(e);return e},t}(),Tn=function(){function t(t,e){if(this.token=t,this.id=e,!t)throw new Error("Token must be defined!")}return Object.defineProperty(t.prototype,"displayName",{get:function(){return s(this.token)},enumerable:!0,configurable:!0}),t.get=function(t){return Sn.get(m(t))},Object.defineProperty(t,"numberOfKeys",{get:function(){return Sn.numberOfKeys},enumerable:!0,configurable:!0}),t}(),Sn=new(function(){function t(){this._allKeys=new Map}return t.prototype.get=function(t){if(t instanceof Tn)return t;if(this._allKeys.has(t))return this._allKeys.get(t);var e=new Tn(t,Tn.numberOfKeys);return this._allKeys.set(t,e),e},Object.defineProperty(t.prototype,"numberOfKeys",{get:function(){return this._allKeys.size},enumerable:!0,configurable:!0}),t}()),En=Function,Cn=/^function\s+\S+\(\)\s*{[\s\S]+\.apply\(this,\s*arguments\)/,Pn=function(){function t(t){this._reflect=t||Vi.Reflect}return t.prototype.isReflectionEnabled=function(){return!0},t.prototype.factory=function(t){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return new(t.bind.apply(t,[void 0].concat(e)))}},t.prototype._zipTypesAndAnnotations=function(t,e){var i;i="undefined"==typeof t?new Array(e.length):new Array(t.length);for(var n=0;n<i.length;n++)"undefined"==typeof t?i[n]=[]:t[n]!=Object?i[n]=[t[n]]:i[n]=[],e&&null!=e[n]&&(i[n]=i[n].concat(e[n]));return i},t.prototype._ownParameters=function(t,e){if(Cn.exec(t.toString()))return null;if(t.parameters&&t.parameters!==e.parameters)return t.parameters;var i=t.ctorParameters;if(i&&i!==e.ctorParameters){var n="function"==typeof i?i():i,r=n.map(function(t){return t&&t.type}),o=n.map(function(t){return t&&S(t.decorators)});return this._zipTypesAndAnnotations(r,o)}if(null!=this._reflect&&null!=this._reflect.getOwnMetadata){o=this._reflect.getOwnMetadata("parameters",t);if((r=this._reflect.getOwnMetadata("design:paramtypes",t))||o)return this._zipTypesAndAnnotations(r,o)}return new Array(t.length).fill(void 0)},t.prototype.parameters=function(t){if(!T(t))return[];var e=E(t),i=this._ownParameters(t,e);return i||e===Object||(i=this.parameters(e)),i||[]},t.prototype._ownAnnotations=function(t,e){if(t.annotations&&t.annotations!==e.annotations){var i=t.annotations;return"function"==typeof i&&i.annotations&&(i=i.annotations),i}return t.decorators&&t.decorators!==e.decorators?S(t.decorators):this._reflect&&this._reflect.getOwnMetadata?this._reflect.getOwnMetadata("annotations",t):null},t.prototype.annotations=function(t){if(!T(t))return[];var e=E(t),i=this._ownAnnotations(t,e)||[];return(e!==Object?this.annotations(e):[]).concat(i)},t.prototype._ownPropMetadata=function(t,e){if(t.propMetadata&&t.propMetadata!==e.propMetadata){var i=t.propMetadata;return"function"==typeof i&&i.propMetadata&&(i=i.propMetadata),i}if(t.propDecorators&&t.propDecorators!==e.propDecorators){var n=t.propDecorators,r={};return Object.keys(n).forEach(function(t){r[t]=S(n[t])}),r}return this._reflect&&this._reflect.getOwnMetadata?this._reflect.getOwnMetadata("propMetadata",t):null},t.prototype.propMetadata=function(t){if(!T(t))return{};var e=E(t),i={};if(e!==Object){var n=this.propMetadata(e);Object.keys(n).forEach(function(t){i[t]=n[t]})}var r=this._ownPropMetadata(t,e);return r&&Object.keys(r).forEach(function(t){var e=[];i.hasOwnProperty(t)&&e.push.apply(e,i[t]),e.push.apply(e,r[t]),i[t]=e}),i},t.prototype.hasLifecycleHook=function(t,e){return t instanceof En&&e in t.prototype},t.prototype.getter=function(t){return new Function("o","return o."+t+";")},t.prototype.setter=function(t){return new Function("o","v","return o."+t+" = v;")},t.prototype.method=function(t){var e="if (!o."+t+") throw new Error('\""+t+"\" is undefined');\n        return o."+t+".apply(o, args);";return new Function("o","args",e)},t.prototype.importUri=function(t){return"object"==typeof t&&t.filePath?t.filePath:"./"+s(t)},t.prototype.resourceUri=function(t){return"./"+s(t)},t.prototype.resolveIdentifier=function(t,e,i,n){return n},t.prototype.resolveEnum=function(t,e){return t[e]},t}(),Mn=function(){function t(t){this.reflectionCapabilities=t}return t.prototype.updateCapabilities=function(t){this.reflectionCapabilities=t},t.prototype.factory=function(t){return this.reflectionCapabilities.factory(t)},t.prototype.parameters=function(t){return this.reflectionCapabilities.parameters(t)},t.prototype.annotations=function(t){return this.reflectionCapabilities.annotations(t)},t.prototype.propMetadata=function(t){return this.reflectionCapabilities.propMetadata(t)},t.prototype.hasLifecycleHook=function(t,e){return this.reflectionCapabilities.hasLifecycleHook(t,e)},t.prototype.getter=function(t){return this.reflectionCapabilities.getter(t)},t.prototype.setter=function(t){return this.reflectionCapabilities.setter(t)},t.prototype.method=function(t){return this.reflectionCapabilities.method(t)},t.prototype.importUri=function(t){return this.reflectionCapabilities.importUri(t)},t.prototype.resourceUri=function(t){return this.reflectionCapabilities.resourceUri(t)},t.prototype.resolveIdentifier=function(t,e,i,n){return this.reflectionCapabilities.resolveIdentifier(t,e,i,n)},t.prototype.resolveEnum=function(t,e){return this.reflectionCapabilities.resolveEnum(t,e)},t}(),An=new Mn(new Pn),Rn=function(){function t(t,e,i){this.key=t,this.optional=e,this.visibility=i}return t.fromKey=function(e){return new t(e,!1,null)},t}(),Ln=[],On=function(){function t(t,e,i){this.key=t,this.resolvedFactories=e,this.multiProvider=i}return Object.defineProperty(t.prototype,"resolvedFactory",{get:function(){return this.resolvedFactories[0]},enumerable:!0,configurable:!0}),t}(),In=function(){return function(t,e){this.factory=t,this.dependencies=e}}(),Bn=new Object,kn=function(){function t(){}return t.resolve=function(t){return M(t)},t.resolveAndCreate=function(e,i){var n=t.resolve(e);return t.fromResolvedProviders(n,i)},t.fromResolvedProviders=function(t,e){return new Dn(t,e)},t.prototype.parent=function(){},t.prototype.resolveAndCreateChild=function(t){},t.prototype.createChildFromResolved=function(t){},t.prototype.resolveAndInstantiate=function(t){},t.prototype.instantiateResolved=function(t){},t.prototype.get=function(t,e){},t}(),Dn=function(){function t(t,e){this._constructionCounter=0,this._providers=t,this._parent=e||null;var i=t.length;this.keyIds=new Array(i),this.objs=new Array(i);for(var n=0;n<i;n++)this.keyIds[n]=t[n].key.id,this.objs[n]=Bn}return t.prototype.get=function(t,e){return void 0===e&&(e=gn),this._getByKey(Tn.get(t),null,e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),t.prototype.resolveAndCreateChild=function(t){var e=kn.resolve(t);return this.createChildFromResolved(e)},t.prototype.createChildFromResolved=function(e){var i=new t(e);return i._parent=this,i},t.prototype.resolveAndInstantiate=function(t){return this.instantiateResolved(kn.resolve([t])[0])},t.prototype.instantiateResolved=function(t){return this._instantiateProvider(t)},t.prototype.getProviderAtIndex=function(t){if(t<0||t>=this._providers.length)throw function(t){return Error("Index "+t+" is out-of-bounds.")}(t);return this._providers[t]},t.prototype._new=function(t){if(this._constructionCounter++>this._getMaxNumberOfObjects())throw function(t,e){return b(t,e,function(t){return"Cannot instantiate cyclic dependency!"+v(t)})}(this,t.key);return this._instantiateProvider(t)},t.prototype._getMaxNumberOfObjects=function(){return this.objs.length},t.prototype._instantiateProvider=function(t){if(t.multiProvider){for(var e=new Array(t.resolvedFactories.length),i=0;i<t.resolvedFactories.length;++i)e[i]=this._instantiate(t,t.resolvedFactories[i]);return e}return this._instantiate(t,t.resolvedFactories[0])},t.prototype._instantiate=function(t,e){var i,n=this,r=e.factory;try{i=e.dependencies.map(function(t){return n._getByReflectiveDependency(t)})}catch(e){throw e.addKey&&e.addKey(this,t.key),e}var o;try{o=r.apply(void 0,i)}catch(e){throw function(t,e,i,n){return b(t,n,function(t){var i=s(t[0].token);return e.message+": Error during instantiation of "+i+"!"+v(t)+"."},e)}(this,e,e.stack,t.key)}return o},t.prototype._getByReflectiveDependency=function(t){return this._getByKey(t.key,t.visibility,t.optional?null:gn)},t.prototype._getByKey=function(t,e,i){return t===Fn?this:e instanceof dn?this._getByKeySelf(t,i):this._getByKeyDefault(t,i,e)},t.prototype._getObjByKeyId=function(t){for(var e=0;e<this.keyIds.length;e++)if(this.keyIds[e]===t)return this.objs[e]===Bn&&(this.objs[e]=this._new(this._providers[e])),this.objs[e];return Bn},t.prototype._throwOrNull=function(t,e){if(e!==gn)return e;throw function(t,e){return b(t,e,function(t){return"No provider for "+s(t[0].token)+"!"+v(t)})}(this,t)},t.prototype._getByKeySelf=function(t,e){var i=this._getObjByKeyId(t.id);return i!==Bn?i:this._throwOrNull(t,e)},t.prototype._getByKeyDefault=function(e,i,n){var r;for(r=n instanceof pn?this._parent:this;r instanceof t;){var o=r,s=o._getObjByKeyId(e.id);if(s!==Bn)return s;r=o._parent}return null!==r?r.get(e.token,i):this._throwOrNull(e,i)},Object.defineProperty(t.prototype,"displayName",{get:function(){return"ReflectiveInjector(providers: ["+function(t,e){for(var i=new Array(t._providers.length),n=0;n<t._providers.length;++n)i[n]=e(t.getProviderAtIndex(n));return i}(this,function(t){return' "'+t.key.displayName+'" '}).join(", ")+"])"},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.displayName},t}(),Fn=Tn.get(vn),Un=new Ni("Application Initializer"),Nn=function(){function t(t){var e=this;this.appInits=t,this.initialized=!1,this._done=!1,this._donePromise=new Promise(function(t,i){e.resolve=t,e.reject=i})}return t.prototype.runInitializers=function(){var t=this;if(!this.initialized){var e=[],i=function(){t._done=!0,t.resolve()};if(this.appInits)for(var n=0;n<this.appInits.length;n++){var r=this.appInits[n]();I(r)&&e.push(r)}Promise.all(e).then(function(){i()}).catch(function(e){t.reject(e)}),0===e.length&&i(),this.initialized=!0}},Object.defineProperty(t.prototype,"done",{get:function(){return this._done},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"donePromise",{get:function(){return this._donePromise},enumerable:!0,configurable:!0}),t}();Nn.decorators=[{type:ln}],Nn.ctorParameters=function(){return[{type:Array,decorators:[{type:un,args:[Un]},{type:cn}]}]};var Gn=new Ni("AppId"),jn={provide:Gn,useFactory:k,deps:[]},Vn=new Ni("Platform Initializer"),Hn=new Ni("Platform ID"),zn=new Ni("appBootstrapListener"),Wn=(new Ni("Application Packages Root URL"),function(){function t(){}return t.prototype.log=function(t){console.log(t)},t.prototype.warn=function(t){console.warn(t)},t}());Wn.decorators=[{type:ln}],Wn.ctorParameters=function(){return[]};var Xn=function(){function t(){}return t.prototype.compileModuleSync=function(t){throw F()},t.prototype.compileModuleAsync=function(t){throw F()},t.prototype.compileModuleAndAllComponentsSync=function(t){throw F()},t.prototype.compileModuleAndAllComponentsAsync=function(t){throw F()},t.prototype.getNgContentSelectors=function(t){throw F()},t.prototype.clearCache=function(){},t.prototype.clearCacheFor=function(t){},t}();Xn.decorators=[{type:ln}],Xn.ctorParameters=function(){return[]};new Ni("compilerOptions");var qn=function(){function t(){}return t.prototype.createCompiler=function(t){},t}(),Yn=function(){function t(){}return t.prototype.location=function(){},t.prototype.injector=function(){},t.prototype.instance=function(){},t.prototype.hostView=function(){},t.prototype.changeDetectorRef=function(){},t.prototype.componentType=function(){},t.prototype.destroy=function(){},t.prototype.onDestroy=function(t){},t}(),Kn=function(){function t(){}return t.prototype.selector=function(){},t.prototype.componentType=function(){},t.prototype.ngContentSelectors=function(){},t.prototype.inputs=function(){},t.prototype.outputs=function(){},t.prototype.create=function(t,e,i,n){},t}(),Zn="ngComponent",Qn=function(){function t(){}return t.prototype.resolveComponentFactory=function(t){throw U(t)},t}(),Jn=function(){function t(){}return t.prototype.resolveComponentFactory=function(t){},t}();Jn.NULL=new Qn;var $n,tr,er=function(){function t(t,e,i){this._parent=e,this._ngModule=i,this._factories=new Map;for(var n=0;n<t.length;n++){var r=t[n];this._factories.set(r.componentType,r)}}return t.prototype.resolveComponentFactory=function(t){var e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw U(t);return new ir(e,this._ngModule)},t}(),ir=function(t){function e(e,i){var n=t.call(this)||this;return n.factory=e,n.ngModule=i,n}return Bi.a(e,t),Object.defineProperty(e.prototype,"selector",{get:function(){return this.factory.selector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentType",{get:function(){return this.factory.componentType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ngContentSelectors",{get:function(){return this.factory.ngContentSelectors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.factory.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.factory.outputs},enumerable:!0,configurable:!0}),e.prototype.create=function(t,e,i,n){return this.factory.create(t,e,i,n||this.ngModule)},e}(Kn),nr=function(){function t(){}return t.prototype.injector=function(){},t.prototype.componentFactoryResolver=function(){},t.prototype.instance=function(){},t.prototype.destroy=function(){},t.prototype.onDestroy=function(t){},t}(),rr=function(){function t(){}return t.prototype.moduleType=function(){},t.prototype.create=function(t){},t}(),or=function(){var t=Vi.wtf;return!(!t||!($n=t.trace)||(tr=$n.events,0))}(),sr=or?function(t,e){return void 0===e&&(e=null),tr.createScope(t,e)}:function(t,e){return N},ar=or?function(t,e){return $n.leaveScope(t,e),e}:function(t,e){return e},hr=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i.__isAsync=e,i}return Bi.a(e,t),e.prototype.emit=function(e){t.prototype.next.call(this,e)},e.prototype.subscribe=function(e,i,n){var r,o=function(t){return null},s=function(){return null};return e&&"object"==typeof e?(r=this.__isAsync?function(t){setTimeout(function(){return e.next(t)})}:function(t){e.next(t)},e.error&&(o=this.__isAsync?function(t){setTimeout(function(){return e.error(t)})}:function(t){e.error(t)}),e.complete&&(s=this.__isAsync?function(){setTimeout(function(){return e.complete()})}:function(){e.complete()})):(r=this.__isAsync?function(t){setTimeout(function(){return e(t)})}:function(t){e(t)},i&&(o=this.__isAsync?function(t){setTimeout(function(){return i(t)})}:function(t){i(t)}),n&&(s=this.__isAsync?function(){setTimeout(function(){return n()})}:function(){n()})),t.prototype.subscribe.call(this,r,o,s)},e}(Ui.a),ur=function(){function t(t){var e=t.enableLongStackTrace,i=void 0!==e&&e;if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new hr(!1),this.onMicrotaskEmpty=new hr(!1),this.onStable=new hr(!1),this.onError=new hr(!1),"undefined"==typeof Zone)throw new Error("Angular requires Zone.js prolyfill.");Zone.assertZonePatched();this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),function(t){t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(e,i,n,r,o,s){try{return j(t),e.invokeTask(n,r,o,s)}finally{V(t)}},onInvoke:function(e,i,n,r,o,s,a){try{return j(t),e.invoke(n,r,o,s,a)}finally{V(t)}},onHasTask:function(e,i,n,r){e.hasTask(n,r),i===n&&("microTask"==r.change?(t.hasPendingMicrotasks=r.microTask,G(t)):"macroTask"==r.change&&(t.hasPendingMacrotasks=r.macroTask))},onHandleError:function(e,i,n,r){return e.handleError(n,r),t.runOutsideAngular(function(){return t.onError.emit(r)}),!1}})}(this)}return t.isInAngularZone=function(){return!0===Zone.current.get("isAngularZone")},t.assertInAngularZone=function(){if(!t.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")},t.assertNotInAngularZone=function(){if(t.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")},t.prototype.run=function(t){return this._inner.run(t)},t.prototype.runGuarded=function(t){return this._inner.runGuarded(t)},t.prototype.runOutsideAngular=function(t){return this._outer.run(t)},t}(),cr=function(){function t(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this._watchAngularEvents()}return t.prototype._watchAngularEvents=function(){var t=this;this._ngZone.onUnstable.subscribe({next:function(){t._didWork=!0,t._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){t._ngZone.onStable.subscribe({next:function(){ur.assertNotInAngularZone(),r(function(){t._isZoneStable=!0,t._runCallbacksIfReady()})}})})},t.prototype.increasePendingRequestCount=function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount},t.prototype.decreasePendingRequestCount=function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount},t.prototype.isStable=function(){return this._isZoneStable&&0==this._pendingCount&&!this._ngZone.hasPendingMacrotasks},t.prototype._runCallbacksIfReady=function(){var t=this;this.isStable()?r(function(){for(;0!==t._callbacks.length;)t._callbacks.pop()(t._didWork);t._didWork=!1}):this._didWork=!0},t.prototype.whenStable=function(t){this._callbacks.push(t),this._runCallbacksIfReady()},t.prototype.getPendingRequestCount=function(){return this._pendingCount},t.prototype.findBindings=function(t,e,i){return[]},t.prototype.findProviders=function(t,e,i){return[]},t}();cr.decorators=[{type:ln}],cr.ctorParameters=function(){return[{type:ur}]};var lr=function(){function t(){this._applications=new Map,pr.addToWindow(this)}return t.prototype.registerApplication=function(t,e){this._applications.set(t,e)},t.prototype.getTestability=function(t){return this._applications.get(t)||null},t.prototype.getAllTestabilities=function(){return Array.from(this._applications.values())},t.prototype.getAllRootElements=function(){return Array.from(this._applications.keys())},t.prototype.findTestabilityInTree=function(t,e){return void 0===e&&(e=!0),pr.findTestabilityInTree(this,t,e)},t}();lr.decorators=[{type:ln}],lr.ctorParameters=function(){return[]};var dr,pr=new(function(){function t(){}return t.prototype.addToWindow=function(t){},t.prototype.findTestabilityInTree=function(t,e,i){return null},t}()),fr=!0,mr=!1,gr=new Ni("AllowMultipleToken"),yr=function(){return function(t,e){this.name=t,this.token=e}}(),vr=function(){function t(){}return t.prototype.bootstrapModuleFactory=function(t){},t.prototype.bootstrapModule=function(t,e){},t.prototype.onDestroy=function(t){},t.prototype.injector=function(){},t.prototype.destroy=function(){},t.prototype.destroyed=function(){},t}(),br=function(t){function e(e){var i=t.call(this)||this;return i._injector=e,i._modules=[],i._destroyListeners=[],i._destroyed=!1,i}return Bi.a(e,t),e.prototype.onDestroy=function(t){this._destroyListeners.push(t)},Object.defineProperty(e.prototype,"injector",{get:function(){return this._injector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(t){return t.destroy()}),this._destroyListeners.forEach(function(t){return t()}),this._destroyed=!0},e.prototype.bootstrapModuleFactory=function(t){return this._bootstrapModuleFactoryWithZone(t)},e.prototype._bootstrapModuleFactoryWithZone=function(t,e){var i=this;return e||(e=new ur({enableLongStackTrace:W()})),e.run(function(){var n=kn.resolveAndCreate([{provide:ur,useValue:e}],i.injector),r=t.create(n),o=r.injector.get(wn,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return r.onDestroy(function(){return Y(i._modules,r)}),e.runOutsideAngular(function(){return e.onError.subscribe({next:function(t){o.handleError(t)}})}),function(t,e,i){try{var n=i();return I(n)?n.catch(function(i){throw e.runOutsideAngular(function(){return t.handleError(i)}),i}):n}catch(i){throw e.runOutsideAngular(function(){return t.handleError(i)}),i}}(o,e,function(){var t=r.injector.get(Nn);return t.runInitializers(),t.donePromise.then(function(){return i._moduleDoBootstrap(r),r})})})},e.prototype.bootstrapModule=function(t,e){return void 0===e&&(e=[]),this._bootstrapModuleWithZone(t,e)},e.prototype._bootstrapModuleWithZone=function(t,e,i){var n=this;void 0===e&&(e=[]);return this.injector.get(qn).createCompiler(Array.isArray(e)?e:[e]).compileModuleAsync(t).then(function(t){return n._bootstrapModuleFactoryWithZone(t,i)})},e.prototype._moduleDoBootstrap=function(t){var e=t.injector.get(xr);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(function(t){return e.bootstrap(t)});else{if(!t.instance.ngDoBootstrap)throw new Error("The module "+s(t.instance.constructor)+' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.');t.instance.ngDoBootstrap(e)}this._modules.push(t)},e}(vr);br.decorators=[{type:ln}],br.ctorParameters=function(){return[{type:vn}]};var xr=function(){function t(){}return t.prototype.bootstrap=function(t,e){},t.prototype.tick=function(){},t.prototype.componentTypes=function(){},t.prototype.components=function(){},t.prototype.attachView=function(t){},t.prototype.detachView=function(t){},t.prototype.viewCount=function(){},t.prototype.isStable=function(){},t}(),_r=function(t){function e(e,i,n,o,s,a){var h=t.call(this)||this;h._zone=e,h._console=i,h._injector=n,h._exceptionHandler=o,h._componentFactoryResolver=s,h._initStatus=a,h._bootstrapListeners=[],h._rootComponents=[],h._rootComponentTypes=[],h._views=[],h._runningTick=!1,h._enforceNoNewChanges=!1,h._stable=!0,h._enforceNoNewChanges=W(),h._zone.onMicrotaskEmpty.subscribe({next:function(){h._zone.run(function(){h.tick()})}});var u=new ki.a(function(t){h._stable=h._zone.isStable&&!h._zone.hasPendingMacrotasks&&!h._zone.hasPendingMicrotasks,h._zone.runOutsideAngular(function(){t.next(h._stable),t.complete()})}),c=new ki.a(function(t){var e;h._zone.runOutsideAngular(function(){e=h._zone.onStable.subscribe(function(){ur.assertNotInAngularZone(),r(function(){h._stable||h._zone.hasPendingMacrotasks||h._zone.hasPendingMicrotasks||(h._stable=!0,t.next(!0))})})});var i=h._zone.onUnstable.subscribe(function(){ur.assertInAngularZone(),h._stable&&(h._stable=!1,h._zone.runOutsideAngular(function(){t.next(!1)}))});return function(){e.unsubscribe(),i.unsubscribe()}});return h._isStable=Object(Di.a)(u,Fi.a.call(c)),h}return Bi.a(e,t),e.prototype.attachView=function(t){var e=t;this._views.push(e),e.attachToAppRef(this)},e.prototype.detachView=function(t){var e=t;Y(this._views,e),e.detachFromAppRef()},e.prototype.bootstrap=function(t,e){var i=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");var n;n=t instanceof Kn?t:this._componentFactoryResolver.resolveComponentFactory(t),this._rootComponentTypes.push(n.componentType);var r=n instanceof ir?null:this._injector.get(nr),o=e||n.selector,s=n.create(vn.NULL,[],o,r);s.onDestroy(function(){i._unloadComponent(s)});var a=s.injector.get(cr,null);return a&&s.injector.get(lr).registerApplication(s.location.nativeElement,a),this._loadComponent(s),W()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),s},e.prototype._loadComponent=function(t){this.attachView(t.hostView),this.tick(),this._rootComponents.push(t);this._injector.get(zn,[]).concat(this._bootstrapListeners).forEach(function(e){return e(t)})},e.prototype._unloadComponent=function(t){this.detachView(t.hostView),Y(this._rootComponents,t)},e.prototype.tick=function(){var t=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var i=e._tickScope();try{this._runningTick=!0,this._views.forEach(function(t){return t.detectChanges()}),this._enforceNoNewChanges&&this._views.forEach(function(t){return t.checkNoChanges()})}catch(e){this._zone.runOutsideAngular(function(){return t._exceptionHandler.handleError(e)})}finally{this._runningTick=!1,ar(i)}},e.prototype.ngOnDestroy=function(){this._views.slice().forEach(function(t){return t.destroy()})},Object.defineProperty(e.prototype,"viewCount",{get:function(){return this._views.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentTypes",{get:function(){return this._rootComponentTypes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"components",{get:function(){return this._rootComponents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStable",{get:function(){return this._isStable},enumerable:!0,configurable:!0}),e}(xr);_r._tickScope=sr("ApplicationRef#tick()"),_r.decorators=[{type:ln}],_r.ctorParameters=function(){return[{type:ur},{type:Wn},{type:vn},{type:wn},{type:Jn},{type:Nn}]};(function(){function t(){}t.prototype.injector=function(){},t.prototype.component=function(){},t.prototype.providerTokens=function(){},t.prototype.references=function(){},t.prototype.context=function(){},t.prototype.source=function(){}})();var wr=function(){function t(){}return t.prototype.selectRootElement=function(t,e){},t.prototype.createElement=function(t,e,i){},t.prototype.createViewRoot=function(t){},t.prototype.createTemplateAnchor=function(t,e){},t.prototype.createText=function(t,e,i){},t.prototype.projectNodes=function(t,e){},t.prototype.attachViewAfter=function(t,e){},t.prototype.detachView=function(t){},t.prototype.destroyView=function(t,e){},t.prototype.listen=function(t,e,i){},t.prototype.listenGlobal=function(t,e,i){},t.prototype.setElementProperty=function(t,e,i){},t.prototype.setElementAttribute=function(t,e,i){},t.prototype.setBindingDebugInfo=function(t,e,i){},t.prototype.setElementClass=function(t,e,i){},t.prototype.setElementStyle=function(t,e,i){},t.prototype.invokeElementMethod=function(t,e,i){},t.prototype.setText=function(t,e){},t.prototype.animate=function(t,e,i,n,r,o,s){},t}(),Tr=(new Ni("Renderer2Interceptor"),function(){function t(){}t.prototype.renderComponent=function(t){}}(),function(){function t(){}return t.prototype.createRenderer=function(t,e){},t.prototype.begin=function(){},t.prototype.end=function(){},t.prototype.whenRenderingDone=function(){},t}()),Sr={};Sr.Important=1,Sr.DashCase=2,Sr[Sr.Important]="Important",Sr[Sr.DashCase]="DashCase";var Er=function(){function t(){}return t.prototype.data=function(){},t.prototype.destroy=function(){},t.prototype.createElement=function(t,e){},t.prototype.createComment=function(t){},t.prototype.createText=function(t){},t.prototype.appendChild=function(t,e){},t.prototype.insertBefore=function(t,e,i){},t.prototype.removeChild=function(t,e){},t.prototype.selectRootElement=function(t){},t.prototype.parentNode=function(t){},t.prototype.nextSibling=function(t){},t.prototype.setAttribute=function(t,e,i,n){},t.prototype.removeAttribute=function(t,e,i){},t.prototype.addClass=function(t,e){},t.prototype.removeClass=function(t,e){},t.prototype.setStyle=function(t,e,i,n){},t.prototype.removeStyle=function(t,e,i){},t.prototype.setProperty=function(t,e,i){},t.prototype.setValue=function(t,e){},t.prototype.listen=function(t,e,i){},t}(),Cr=function(){return function(t){this.nativeElement=t}}(),Pr=function(){function t(){}return t.prototype.load=function(t){},t}(),Mr=(new Map,function(){function t(){this._dirty=!0,this._results=[],this._emitter=new hr}return Object.defineProperty(t.prototype,"changes",{get:function(){return this._emitter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._results.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"first",{get:function(){return this._results[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this._results[this.length-1]},enumerable:!0,configurable:!0}),t.prototype.map=function(t){return this._results.map(t)},t.prototype.filter=function(t){return this._results.filter(t)},t.prototype.find=function(t){return this._results.find(t)},t.prototype.reduce=function(t,e){return this._results.reduce(t,e)},t.prototype.forEach=function(t){this._results.forEach(t)},t.prototype.some=function(t){return this._results.some(t)},t.prototype.toArray=function(){return this._results.slice()},t.prototype[n()]=function(){return this._results[n()]()},t.prototype.toString=function(){return this._results.toString()},t.prototype.reset=function(t){this._results=K(t),this._dirty=!1},t.prototype.notifyOnChanges=function(){this._emitter.emit(this)},t.prototype.setDirty=function(){this._dirty=!0},Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._emitter.complete(),this._emitter.unsubscribe()},t}()),Ar=function(){return function(){}}(),Rr={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Lr=function(){function t(t,e){this._compiler=t,this._config=e||Rr}return t.prototype.load=function(t){return this._compiler instanceof Xn?this.loadFactory(t):this.loadAndCompile(t)},t.prototype.loadAndCompile=function(t){var e=this,n=t.split("#"),r=n[0],o=n[1];return void 0===o&&(o="default"),i("gFIY")(r).then(function(t){return t[o]}).then(function(t){return Z(t,r,o)}).then(function(t){return e._compiler.compileModuleAsync(t)})},t.prototype.loadFactory=function(t){var e=t.split("#"),n=e[0],r=e[1],o="NgFactory";return void 0===r&&(r="default",o=""),i("gFIY")(this._config.factoryPathPrefix+n+this._config.factoryPathSuffix).then(function(t){return t[r+o]}).then(function(t){return Z(t,n,r)})},t}();Lr.decorators=[{type:ln}],Lr.ctorParameters=function(){return[{type:Xn},{type:Ar,decorators:[{type:cn}]}]};var Or=function(){function t(){}return t.prototype.elementRef=function(){},t.prototype.createEmbeddedView=function(t){},t}(),Ir=function(){function t(){}return t.prototype.element=function(){},t.prototype.injector=function(){},t.prototype.parentInjector=function(){},t.prototype.clear=function(){},t.prototype.get=function(t){},t.prototype.length=function(){},t.prototype.createEmbeddedView=function(t,e,i){},t.prototype.createComponent=function(t,e,i,n,r){},t.prototype.insert=function(t,e){},t.prototype.move=function(t,e){},t.prototype.indexOf=function(t){},t.prototype.remove=function(t){},t.prototype.detach=function(t){},t}(),Br=function(){function t(){}return t.prototype.markForCheck=function(){},t.prototype.detach=function(){},t.prototype.detectChanges=function(){},t.prototype.checkNoChanges=function(){},t.prototype.reattach=function(){},t}(),kr=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Bi.a(e,t),e.prototype.context=function(){},e.prototype.rootNodes=function(){}}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Bi.a(e,t),e.prototype.destroy=function(){},e.prototype.destroyed=function(){},e.prototype.onDestroy=function(t){},e}(Br)),function(){return function(t,e){this.name=t,this.callback=e}}()),Dr=function(){function t(t,e,i){this._debugContext=i,this.nativeNode=t,e&&e instanceof Fr?e.addChild(this):this.parent=null,this.listeners=[]}return Object.defineProperty(t.prototype,"injector",{get:function(){return this._debugContext.injector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentInstance",{get:function(){return this._debugContext.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._debugContext.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){return this._debugContext.references},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){return this._debugContext.providerTokens},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return"Deprecated since v4"},enumerable:!0,configurable:!0}),t}(),Fr=function(t){function e(e,i,n){var r=t.call(this,e,i,n)||this;return r.properties={},r.attributes={},r.classes={},r.styles={},r.childNodes=[],r.nativeElement=e,r}return Bi.a(e,t),e.prototype.addChild=function(t){t&&(this.childNodes.push(t),t.parent=this)},e.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))},e.prototype.insertChildrenAfter=function(t,e){var i=this,n=this.childNodes.indexOf(t);-1!==n&&((r=this.childNodes).splice.apply(r,[n+1,0].concat(e)),e.forEach(function(t){t.parent&&t.parent.removeChild(t),t.parent=i}));var r},e.prototype.insertBefore=function(t,e){var i=this.childNodes.indexOf(t);-1===i?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(i,0,e))},e.prototype.query=function(t){return this.queryAll(t)[0]||null},e.prototype.queryAll=function(t){var e=[];return Q(this,t,e),e},e.prototype.queryAllNodes=function(t){var e=[];return J(this,t,e),e},Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes.filter(function(t){return t instanceof e})},enumerable:!0,configurable:!0}),e.prototype.triggerEventHandler=function(t,e){this.listeners.forEach(function(i){i.name==t&&i.callback(e)})},e}(Dr),Ur=new Map,Nr=function(){function t(t){this.wrapped=t}return t.wrap=function(e){return new t(e)},t}(),Gr=(function(){function t(){this.hasWrappedValue=!1}t.prototype.unwrap=function(t){return t instanceof Nr?(this.hasWrappedValue=!0,t.wrapped):t},t.prototype.reset=function(){this.hasWrappedValue=!1}}(),function(){function t(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}return t.prototype.isFirstChange=function(){return this.firstChange},t}()),jr=function(){function t(){}return t.prototype.supports=function(t){return it(t)},t.prototype.create=function(t,e){return new Hr(e||t)},t}(),Vr=function(t,e){return e},Hr=function(){function t(t){this._length=0,this._collection=null,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Vr}return Object.defineProperty(t.prototype,"collection",{get:function(){return this._collection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),t.prototype.forEachItem=function(t){var e;for(e=this._itHead;null!==e;e=e._next)t(e)},t.prototype.forEachOperation=function(t){for(var e=this._itHead,i=this._removalsHead,n=0,r=null;e||i;){var o=!i||e&&e.currentIndex<rt(i,n,r)?e:i,s=rt(o,n,r),a=o.currentIndex;if(o===i)n--,i=i._nextRemoved;else if(e=e._next,null==o.previousIndex)n++;else{r||(r=[]);var h=s-n,u=a-n;if(h!=u){for(var c=0;c<h;c++){var l=c<r.length?r[c]:r[c]=0,d=l+c;u<=d&&d<h&&(r[c]=l+1)}r[o.previousIndex]=u-h}}s!==a&&t(o,s,a)}},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachMovedItem=function(t){var e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.forEachIdentityChange=function(t){var e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)},t.prototype.diff=function(t){if(null==t&&(t=[]),!it(t))throw new Error("Error trying to diff '"+s(t)+"'. Only arrays and iterables are allowed");return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var i,r,s,a=this._itHead,h=!1;if(Array.isArray(t)){this._length=t.length;for(var u=0;u<this._length;u++)r=t[u],s=this._trackByFn(u,r),null!==a&&o(a.trackById,s)?(h&&(a=this._verifyReinsertion(a,r,s,u)),o(a.item,r)||this._addIdentityChange(a,r)):(a=this._mismatch(a,r,s,u),h=!0),a=a._next}else i=0,function(t,e){if(Array.isArray(t))for(var i=0;i<t.length;i++)e(t[i]);else for(var r=t[n()](),o=void 0;!(o=r.next()).done;)e(o.value)}(t,function(t){s=e._trackByFn(i,t),null!==a&&o(a.trackById,s)?(h&&(a=e._verifyReinsertion(a,t,s,i)),o(a.item,t)||e._addIdentityChange(a,t)):(a=e._mismatch(a,t,s,i),h=!0),a=a._next,i++}),this._length=i;return this._truncate(a),this._collection=t,this.isDirty},Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead},enumerable:!0,configurable:!0}),t.prototype._reset=function(){if(this.isDirty){var t=void 0,e=void 0;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}},t.prototype._mismatch=function(t,e,i,n){var r;return null===t?r=this._itTail:(r=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,n))?(o(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,r,n)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(o(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,r,n)):t=this._addAfter(new zr(e,i),r,n),t},t.prototype._verifyReinsertion=function(t,e,i,n){var r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==r?t=this._reinsertAfter(r,t._prev,n):t.currentIndex!=n&&(t.currentIndex=n,this._addToMoves(t,n)),t},t.prototype._truncate=function(t){for(;null!==t;){var e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)},t.prototype._reinsertAfter=function(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);var n=t._prevRemoved,r=t._nextRemoved;return null===n?this._removalsHead=r:n._nextRemoved=r,null===r?this._removalsTail=n:r._prevRemoved=n,this._insertAfter(t,e,i),this._addToMoves(t,i),t},t.prototype._moveAfter=function(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t},t.prototype._addAfter=function(t,e,i){return this._insertAfter(t,e,i),null===this._additionsTail?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t},t.prototype._insertAfter=function(t,e,i){var n=null===e?this._itHead:e._next;return t._next=n,t._prev=e,null===n?this._itTail=t:n._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Xr),this._linkedRecords.put(t),t.currentIndex=i,t},t.prototype._remove=function(t){return this._addToRemovals(this._unlink(t))},t.prototype._unlink=function(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);var e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t},t.prototype._addToMoves=function(t,e){return t.previousIndex===e?t:(null===this._movesTail?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t,t)},t.prototype._addToRemovals=function(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Xr),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t},t.prototype._addIdentityChange=function(t,e){return t.item=e,null===this._identityChangesTail?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t},t.prototype.toString=function(){var t=[];this.forEachItem(function(e){return t.push(e)});var e=[];this.forEachPreviousItem(function(t){return e.push(t)});var i=[];this.forEachAddedItem(function(t){return i.push(t)});var n=[];this.forEachMovedItem(function(t){return n.push(t)});var r=[];this.forEachRemovedItem(function(t){return r.push(t)});var o=[];return this.forEachIdentityChange(function(t){return o.push(t)}),"collection: "+t.join(", ")+"\nprevious: "+e.join(", ")+"\nadditions: "+i.join(", ")+"\nmoves: "+n.join(", ")+"\nremovals: "+r.join(", ")+"\nidentityChanges: "+o.join(", ")+"\n"},t}(),zr=function(){function t(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}return t.prototype.toString=function(){return this.previousIndex===this.currentIndex?s(this.item):s(this.item)+"["+s(this.previousIndex)+"->"+s(this.currentIndex)+"]"},t}(),Wr=function(){function t(){this._head=null,this._tail=null}return t.prototype.add=function(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)},t.prototype.get=function(t,e){var i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&o(i.trackById,t))return i;return null},t.prototype.remove=function(t){var e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head},t}(),Xr=function(){function t(){this.map=new Map}return t.prototype.put=function(t){var e=t.trackById,i=this.map.get(e);i||(i=new Wr,this.map.set(e,i)),i.add(t)},t.prototype.get=function(t,e){var i=t,n=this.map.get(i);return n?n.get(t,e):null},t.prototype.remove=function(t){var e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.map.size},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.map.clear()},t.prototype.toString=function(){return"_DuplicateMap("+s(this.map)+")"},t}(),qr=function(){function t(){}return t.prototype.supports=function(t){return t instanceof Map||nt(t)},t.prototype.create=function(t){return new Yr},t}(),Yr=function(){function t(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead},enumerable:!0,configurable:!0}),t.prototype.forEachItem=function(t){var e;for(e=this._mapHead;null!==e;e=e._next)t(e)},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachChangedItem=function(t){var e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.diff=function(t){if(t){if(!(t instanceof Map||nt(t)))throw new Error("Error trying to diff '"+s(t)+"'. Only maps and objects are allowed")}else t=new Map;return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var i=this._mapHead;if(this._appendAfter=null,this._forEach(t,function(t,n){if(i&&i.key===n)e._maybeAddToChanges(i,t),e._appendAfter=i,i=i._next;else{var r=e._getOrCreateRecordForKey(n,t);i=e._insertBeforeOrAppend(i,r)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(var n=i;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty},t.prototype._insertBeforeOrAppend=function(t,e){if(t){var i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null},t.prototype._getOrCreateRecordForKey=function(t,e){if(this._records.has(t)){var i=this._records.get(t);this._maybeAddToChanges(i,e);var n=i._prev,r=i._next;return n&&(n._next=r),r&&(r._prev=n),i._next=null,i._prev=null,i}var o=new Kr(t);return this._records.set(t,o),o.currentValue=e,this._addToAdditions(o),o},t.prototype._reset=function(){if(this.isDirty){var t=void 0;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}},t.prototype._maybeAddToChanges=function(t,e){o(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))},t.prototype._addToAdditions=function(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)},t.prototype._addToChanges=function(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)},t.prototype._forEach=function(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(function(i){return e(t[i],i)})},t}(),Kr=function(){return function(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}(),Zr=function(){function t(t){this.factories=t}return t.create=function(e,i){if(null!=i){var n=i.factories.slice();return e=e.concat(n),new t(e)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(i){if(!i)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,i)},deps:[[t,new pn,new cn]]}},t.prototype.find=function(t){var e=this.factories.find(function(e){return e.supports(t)});if(null!=e)return e;throw new Error("Cannot find a differ supporting object '"+t+"' of type '"+function(t){return t.name||typeof t}(t)+"'")},t}(),Qr=function(){function t(t){this.factories=t}return t.create=function(e,i){if(i){var n=i.factories.slice();e=e.concat(n)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(i){if(!i)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,i)},deps:[[t,new pn,new cn]]}},t.prototype.find=function(t){var e=this.factories.find(function(e){return e.supports(t)});if(e)return e;throw new Error("Cannot find a differ supporting object '"+t+"'")},t}(),Jr=[new qr],$r=[new jr],to=new Zr($r),eo=new Qr(Jr),io=X(null,"core",[{provide:Hn,useValue:"unknown"},br,{provide:vr,useExisting:br},{provide:Mn,useFactory:function(){return An},deps:[]},lr,Wn]),no=new Ni("LocaleId"),ro=(new Ni("Translations"),new Ni("TranslationsFormat"),{});ro.Error=0,ro.Warning=1,ro.Ignore=2,ro[ro.Error]="Error",ro[ro.Warning]="Warning",ro[ro.Ignore]="Ignore";var oo=function(){return function(t){}}();oo.decorators=[{type:on,args:[{providers:[_r,{provide:xr,useExisting:_r},Nn,Xn,jn,{provide:Zr,useFactory:ot},{provide:Qr,useFactory:st},{provide:no,useFactory:at,deps:[[new un(no),new cn,new pn]]}]}]}],oo.ctorParameters=function(){return[{type:xr}]};var so={};so.NONE=0,so.HTML=1,so.STYLE=2,so.SCRIPT=3,so.URL=4,so.RESOURCE_URL=5,so[so.NONE]="NONE",so[so.HTML]="HTML",so[so.STYLE]="STYLE",so[so.SCRIPT]="SCRIPT",so[so.URL]="URL",so[so.RESOURCE_URL]="RESOURCE_URL";var ao=function(){function t(){}return t.prototype.sanitize=function(t,e){},t}(),ho=(function(){function t(){}t.prototype.view=function(){},t.prototype.nodeIndex=function(){},t.prototype.injector=function(){},t.prototype.component=function(){},t.prototype.providerTokens=function(){},t.prototype.references=function(){},t.prototype.context=function(){},t.prototype.componentRenderElement=function(){},t.prototype.renderNode=function(){},t.prototype.logError=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]}}(),{setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,clearProviderOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0}),uo=function(){},co=new Map,lo="$$undefined",po="$$empty",fo=0,mo=new WeakMap,go=/^:([^:]+):(.+)$/,yo=new Object,vo=gt(vn),bo=gt(nr),xo=new Object,_o=function(t){function e(e,i,n,r,o,s){var a=t.call(this)||this;return a.selector=e,a.componentType=i,a._inputs=r,a._outputs=o,a.ngContentSelectors=s,a.viewDefFactory=n,a}return Bi.a(e,t),Object.defineProperty(e.prototype,"inputs",{get:function(){var t=[],e=this._inputs;for(var i in e){var n=e[i];t.push({propName:i,templateName:n})}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){var t=[];for(var e in this._outputs){var i=this._outputs[e];t.push({propName:e,templateName:i})}return t},enumerable:!0,configurable:!0}),e.prototype.create=function(t,e,i,n){if(!n)throw new Error("ngModule should be provided");var r=kt(this.viewDefFactory),o=r.nodes[0].element.componentProvider.nodeIndex,s=ho.createRootView(t,e||[],i,r,n,xo),a=ct(s,o).instance;return i&&s.renderer.setAttribute(ut(s,0).renderElement,"ng-version",hn.full),new wo(s,new So(s),a)},e}(Kn),wo=function(t){function e(e,i,n){var r=t.call(this)||this;return r._view=e,r._viewRef=i,r._component=n,r._elDef=r._view.def.nodes[0],r}return Bi.a(e,t),Object.defineProperty(e.prototype,"location",{get:function(){return new Cr(ut(this._view,this._elDef.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return new Co(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instance",{get:function(){return this._component},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hostView",{get:function(){return this._viewRef},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeDetectorRef",{get:function(){return this._viewRef},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentType",{get:function(){return this._component.constructor},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._viewRef.destroy()},e.prototype.onDestroy=function(t){this._viewRef.onDestroy(t)},e}(Yn),To=function(){function t(t,e,i){this._view=t,this._elDef=e,this._data=i,this._embeddedViews=[]}return Object.defineProperty(t.prototype,"element",{get:function(){return new Cr(this._data.renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return new Co(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentInjector",{get:function(){for(var t=this._view,e=this._elDef.parent;!e&&t;)e=Ct(t),t=t.parent;return t?new Co(t,e):new Co(this._view,null)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var t=this._embeddedViews.length-1;t>=0;t--){var e=ee(this._data,t);ho.destroyView(e)}},t.prototype.get=function(t){var e=this._embeddedViews[t];if(e){var i=new So(e);return i.attachToViewContainerRef(this),i}return null},Object.defineProperty(t.prototype,"length",{get:function(){return this._embeddedViews.length},enumerable:!0,configurable:!0}),t.prototype.createEmbeddedView=function(t,e,i){var n=t.createEmbeddedView(e||{});return this.insert(n,i),n},t.prototype.createComponent=function(t,e,i,n,r){var o=i||this.parentInjector;r||t instanceof ir||(r=o.get(nr));var s=t.create(o,n,void 0,r);return this.insert(s.hostView,e),s},t.prototype.insert=function(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var i=t,n=i._view;return te(this._view,this._data,e,n),i.attachToViewContainerRef(this),t},t.prototype.move=function(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var i=this._embeddedViews.indexOf(t._view);return function(t,e,i){var n=t.viewContainer._embeddedViews,r=n[e];oe(n,e),null==i&&(i=n.length),re(n,i,r),ho.dirtyParentQueries(r),ne(r),ie(t,i>0?n[i-1]:null,r)}(this._data,i,e),t},t.prototype.indexOf=function(t){return this._embeddedViews.indexOf(t._view)},t.prototype.remove=function(t){var e=ee(this._data,t);e&&ho.destroyView(e)},t.prototype.detach=function(t){var e=ee(this._data,t);return e?new So(e):null},t}(),So=function(){function t(t){this._view=t,this._viewContainerRef=null,this._appRef=null}return Object.defineProperty(t.prototype,"rootNodes",{get:function(){return function(t){var e=[];return Dt(t,0,void 0,void 0,e),e}(this._view)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._view.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return 0!=(128&this._view.state)},enumerable:!0,configurable:!0}),t.prototype.markForCheck=function(){wt(this._view)},t.prototype.detach=function(){this._view.state&=-5},t.prototype.detectChanges=function(){var t=this._view.root.rendererFactory;t.begin&&t.begin(),ho.checkAndUpdateView(this._view),t.end&&t.end()},t.prototype.checkNoChanges=function(){ho.checkNoChangesView(this._view)},t.prototype.reattach=function(){this._view.state|=4},t.prototype.onDestroy=function(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)},t.prototype.destroy=function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),ho.destroyView(this._view)},t.prototype.detachFromAppRef=function(){this._appRef=null,ne(this._view),ho.dirtyParentQueries(this._view)},t.prototype.attachToAppRef=function(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t},t.prototype.attachToViewContainerRef=function(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t},t}(),Eo=function(t){function e(e,i){var n=t.call(this)||this;return n._parentView=e,n._def=i,n}return Bi.a(e,t),e.prototype.createEmbeddedView=function(t){return new So(ho.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))},Object.defineProperty(e.prototype,"elementRef",{get:function(){return new Cr(ut(this._parentView,this._def.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),e}(Or),Co=function(){function t(t,e){this.view=t,this.elDef=e}return t.prototype.get=function(t,e){void 0===e&&(e=vn.THROW_IF_NOT_FOUND);var i=!!this.elDef&&0!=(33554432&this.elDef.flags);return ho.resolveDep(this.view,this.elDef,i,{flags:0,token:t,tokenKey:gt(t)},e)},t}(),Po=function(){function t(t){this.delegate=t}return t.prototype.selectRootElement=function(t){return this.delegate.selectRootElement(t)},t.prototype.createElement=function(t,e){var i=jt(e),n=i[0],r=i[1],o=this.delegate.createElement(r,n);return t&&this.delegate.appendChild(t,o),o},t.prototype.createViewRoot=function(t){return t},t.prototype.createTemplateAnchor=function(t){var e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e},t.prototype.createText=function(t,e){var i=this.delegate.createText(e);return t&&this.delegate.appendChild(t,i),i},t.prototype.projectNodes=function(t,e){for(var i=0;i<e.length;i++)this.delegate.appendChild(t,e[i])},t.prototype.attachViewAfter=function(t,e){for(var i=this.delegate.parentNode(t),n=this.delegate.nextSibling(t),r=0;r<e.length;r++)this.delegate.insertBefore(i,e[r],n)},t.prototype.detachView=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=this.delegate.parentNode(i);this.delegate.removeChild(n,i)}},t.prototype.destroyView=function(t,e){for(var i=0;i<e.length;i++)this.delegate.destroyNode(e[i])},t.prototype.listen=function(t,e,i){return this.delegate.listen(t,e,i)},t.prototype.listenGlobal=function(t,e,i){return this.delegate.listen(t,e,i)},t.prototype.setElementProperty=function(t,e,i){this.delegate.setProperty(t,e,i)},t.prototype.setElementAttribute=function(t,e,i){var n=jt(e),r=n[0],o=n[1];null!=i?this.delegate.setAttribute(t,o,i,r):this.delegate.removeAttribute(t,o,r)},t.prototype.setBindingDebugInfo=function(t,e,i){},t.prototype.setElementClass=function(t,e,i){i?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)},t.prototype.setElementStyle=function(t,e,i){null!=i?this.delegate.setStyle(t,e,i):this.delegate.removeStyle(t,e)},t.prototype.invokeElementMethod=function(t,e,i){t[e].apply(t,i)},t.prototype.setText=function(t,e){this.delegate.setValue(t,e)},t.prototype.animate=function(){throw new Error("Renderer.animate is no longer supported!")},t}(),Mo=function(){function t(t,e,i,n){this._moduleType=t,this._parent=e,this._bootstrapComponents=i,this._def=n,this._destroyListeners=[],this._destroyed=!1,function(t){for(var e=t._def,i=t._providers=new Array(e.providers.length),n=0;n<e.providers.length;n++){var r=e.providers[n];4096&r.flags||(i[n]=$t(t,r))}}(this)}return t.prototype.get=function(t,e){return void 0===e&&(e=vn.THROW_IF_NOT_FOUND),Jt(this,{token:t,tokenKey:gt(t),flags:0},e)},Object.defineProperty(t.prototype,"instance",{get:function(){return this.get(this._moduleType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentFactoryResolver",{get:function(){return this.get(Jn)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return this},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The ng module "+s(this.instance.constructor)+" has already been destroyed.");this._destroyed=!0,function(t,e){for(var i=t._def,n=0;n<i.providers.length;n++)if(131072&i.providers[n].flags){var r=t._providers[n];r&&r!==yo&&r.ngOnDestroy()}}(this),this._destroyListeners.forEach(function(t){return t()})},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},t}(),Ao=gt(wr),Ro=gt(Er),Lo=gt(Cr),Oo=gt(Ir),Io=gt(Or),Bo=gt(Br),ko=gt(vn),Do={},Fo={};Fo.CreateViewNodes=0,Fo.CheckNoChanges=1,Fo.CheckNoChangesProjectedViews=2,Fo.CheckAndUpdate=3,Fo.CheckAndUpdateProjectedViews=4,Fo.Destroy=5,Fo[Fo.CreateViewNodes]="CreateViewNodes",Fo[Fo.CheckNoChanges]="CheckNoChanges",Fo[Fo.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",Fo[Fo.CheckAndUpdate]="CheckAndUpdate",Fo[Fo.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",Fo[Fo.Destroy]="Destroy";var Uo=!1,No=new Map,Go={};Go.create=0,Go.detectChanges=1,Go.checkNoChanges=2,Go.destroy=3,Go.handleEvent=4,Go[Go.create]="create",Go[Go.detectChanges]="detectChanges",Go[Go.checkNoChanges]="checkNoChanges",Go[Go.destroy]="destroy",Go[Go.handleEvent]="handleEvent";var jo,Vo,Ho,zo=/([A-Z])/g,Wo=function(){function t(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];for(var i=this.nodeDef,n=t;i&&0==(1&i.flags);)i=i.parent;if(!i)for(;!i&&n;)i=Ct(n),n=n.parent;this.elDef=i,this.elView=n}return Object.defineProperty(t.prototype,"elOrCompView",{get:function(){return ut(this.elView,this.elDef.nodeIndex).componentView||this.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return ce(this.elView,this.elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.elOrCompView.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.elOrCompView.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){var t=[];if(this.elDef)for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var i=this.elView.def.nodes[e];20224&i.flags&&t.push(i.provider.token),e+=i.childCount}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){var t={};if(this.elDef){Ri(this.elView,this.elDef,t);for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var i=this.elView.def.nodes[e];20224&i.flags&&Ri(this.elView,i,t),e+=i.childCount}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentRenderElement",{get:function(){var t=function(t){for(;t&&!At(t);)t=t.parent;return t.parent?ut(t.parent,Ct(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderNode",{get:function(){return 2&this.nodeDef.flags?Pt(this.view,this.nodeDef):Pt(this.elView,this.elDef)},enumerable:!0,configurable:!0}),t.prototype.logError=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n,r;2&this.nodeDef.flags?(n=this.view.def,r=this.nodeDef.nodeIndex):(n=this.elView.def,r=this.elDef.nodeIndex);var o=function(t,e){for(var i=-1,n=0;n<=e;n++)3&t.nodes[n].flags&&i++;return i}(n,r),s=-1;n.factory(function(){return++s===o?(i=t.error).bind.apply(i,[t].concat(e)):uo;var i}),s<o&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error.apply(t,e))},t}(),Xo=function(){function t(t){this.delegate=t}return t.prototype.createRenderer=function(t,e){return new qo(this.delegate.createRenderer(t,e))},t.prototype.begin=function(){this.delegate.begin&&this.delegate.begin()},t.prototype.end=function(){this.delegate.end&&this.delegate.end()},t.prototype.whenRenderingDone=function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)},t}(),qo=function(){function t(t){this.delegate=t}return Object.defineProperty(t.prototype,"data",{get:function(){return this.delegate.data},enumerable:!0,configurable:!0}),t.prototype.destroyNode=function(t){!function(t){Ur.delete(t.nativeNode)}($(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)},t.prototype.destroy=function(){this.delegate.destroy()},t.prototype.createElement=function(t,e){var i=this.delegate.createElement(t,e),n=Oi();if(n){var r=new Fr(i,null,n);r.name=t,tt(r)}return i},t.prototype.createComment=function(t){var e=this.delegate.createComment(t),i=Oi();return i&&tt(new Dr(e,null,i)),e},t.prototype.createText=function(t){var e=this.delegate.createText(t),i=Oi();return i&&tt(new Dr(e,null,i)),e},t.prototype.appendChild=function(t,e){var i=$(t),n=$(e);i&&n&&i instanceof Fr&&i.addChild(n),this.delegate.appendChild(t,e)},t.prototype.insertBefore=function(t,e,i){var n=$(t),r=$(e),o=$(i);n&&r&&n instanceof Fr&&n.insertBefore(o,r),this.delegate.insertBefore(t,e,i)},t.prototype.removeChild=function(t,e){var i=$(t),n=$(e);i&&n&&i instanceof Fr&&i.removeChild(n),this.delegate.removeChild(t,e)},t.prototype.selectRootElement=function(t){var e=this.delegate.selectRootElement(t),i=Oi();return i&&tt(new Fr(e,null,i)),e},t.prototype.setAttribute=function(t,e,i,n){var r=$(t);if(r&&r instanceof Fr){var o=n?n+":"+e:e;r.attributes[o]=i}this.delegate.setAttribute(t,e,i,n)},t.prototype.removeAttribute=function(t,e,i){var n=$(t);if(n&&n instanceof Fr){var r=i?i+":"+e:e;n.attributes[r]=null}this.delegate.removeAttribute(t,e,i)},t.prototype.addClass=function(t,e){var i=$(t);i&&i instanceof Fr&&(i.classes[e]=!0),this.delegate.addClass(t,e)},t.prototype.removeClass=function(t,e){var i=$(t);i&&i instanceof Fr&&(i.classes[e]=!1),this.delegate.removeClass(t,e)},t.prototype.setStyle=function(t,e,i,n){var r=$(t);r&&r instanceof Fr&&(r.styles[e]=i),this.delegate.setStyle(t,e,i,n)},t.prototype.removeStyle=function(t,e,i){var n=$(t);n&&n instanceof Fr&&(n.styles[e]=null),this.delegate.removeStyle(t,e,i)},t.prototype.setProperty=function(t,e,i){var n=$(t);n&&n instanceof Fr&&(n.properties[e]=i),this.delegate.setProperty(t,e,i)},t.prototype.listen=function(t,e,i){if("string"!=typeof t){var n=$(t);n&&n.listeners.push(new kr(e,i))}return this.delegate.listen(t,e,i)},t.prototype.parentNode=function(t){return this.delegate.parentNode(t)},t.prototype.nextSibling=function(t){return this.delegate.nextSibling(t)},t.prototype.setValue=function(t,e){return this.delegate.setValue(t,e)},t}(),Yo=function(t){function e(e,i,n){var r=t.call(this)||this;return r.moduleType=e,r._bootstrapComponents=i,r._ngModuleDefFactory=n,r}return Bi.a(e,t),e.prototype.create=function(t){ai();var e=kt(this._ngModuleDefFactory);return ho.createNgModuleRef(this.moduleType,t||vn.NULL,this._bootstrapComponents,e)},e}(rr)}).call(e,i("fRUx"))},"0ndw":function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e,i,n,r,o){var s=t.call(this,i,n)||this;return s.game=e,s.targetHeight=r,s.k=o,s.speed=0,s}return n(e,t),e.prototype.update=function(t,e){var i=this.targetHeight-this.y;this.speed+=e*i-this.speed*t,this.y+=this.speed},e.prototype.setHeight=function(t){this.targetHeight=t,this.y=t},e}(i("6nA8").Point);e.WaterPoint=r},"1WNV":function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(t){if(u===setTimeout)return setTimeout(t,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function o(){f&&d&&(f=!1,d.length?p=d.concat(p):m=-1,p.length&&s())}function s(){if(!f){var t=r(o);f=!0;for(var e=p.length;e;){for(d=p,p=[];++m<e;)d&&d[m].run();m=-1,e=p.length}d=null,f=!1,function(t){if(c===clearTimeout)return clearTimeout(t);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(t);try{c(t)}catch(e){try{return c.call(null,t)}catch(e){return c.call(this,t)}}}(t)}}function a(t,e){this.fun=t,this.array=e}function h(){}var u,c,l=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(t){u=i}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(t){c=n}}();var d,p=[],f=!1,m=-1;l.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new a(t,e)),1!==p.length||f||r(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=h,l.addListener=h,l.once=h,l.off=h,l.removeListener=h,l.removeAllListeners=h,l.emit=h,l.prependListener=h,l.prependOnceListener=h,l.listeners=function(t){return[]},l.binding=function(t){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(t){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},"1j/l":function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=Array.isArray||function(t){return t&&"number"==typeof t.length}},"1thS":function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("/oeL"),r=i("Knxt"),o=function(){function t(t){this._element=t,this.useImagesLoaded=!1,this.layoutComplete=new n.p,this.removeComplete=new n.p}return t.prototype.ngOnInit=function(){var t=this;this.options||(this.options={}),this.options.itemSelector||(this.options.itemSelector="[masonry-brick], masonry-brick"),"MASONRY"===this._element.nativeElement.tagName&&(this._element.nativeElement.style.display="block"),this._msnry=new r(this._element.nativeElement,this.options),this._msnry.on("layoutComplete",function(e){t.layoutComplete.emit(e)}),this._msnry.on("removeComplete",function(e){t.removeComplete.emit(e)})},t.prototype.ngOnDestroy=function(){this._msnry&&this._msnry.destroy()},t.prototype.layout=function(){var t=this;setTimeout(function(){t._msnry.layout()})},t.prototype.add=function(t){var e=this,i=!1;0===this._msnry.items.length&&(i=!0),this.useImagesLoaded?(imagesLoaded(t,function(n){e._element.nativeElement.appendChild(t),e._msnry.appended(t),i&&e.layout()}),this._element.nativeElement.removeChild(t)):(this._msnry.appended(t),i&&this.layout())},t.prototype.remove=function(t){this._msnry.remove(t),this.layout()},t.ctorParameters=function(){return[{type:n.n}]},t}()},"2kLc":function(t,e,i){"use strict";e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=Number.POSITIVE_INFINITY,a=null,h=t[t.length-1];return Object(o.a)(h)?(a=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(i=t.pop())):"number"==typeof h&&(i=t.pop()),null===a&&1===t.length&&t[0]instanceof n.a?t[0]:Object(s.a)(i)(new r.a(t,a))};var n=i("AP4T"),r=i("Oryw"),o=i("3iOE"),s=i("bywS")},"3iOE":function(t,e,i){"use strict";e.a=function(t){return t&&"function"==typeof t.schedule}},"6LN+":function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.load=function(t,e,i){this.image(t,e),this.onLoadComplete.addOnce(function(){i(t)}),this.start()},e}(i("6nA8").Loader);e.ProxyImageLoader=r},"6Xbx":function(t,e,i){"use strict";e.a=function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};Object.assign},"6YwD":function(t,e,i){"use strict";function n(t){return r._37(0,[r._28(null,0)],null,null)}i.d(e,"a",function(){return s}),e.b=n;var r=i("/oeL"),o=i("1thS"),s=r._13({encapsulation:2,styles:[],data:{}});r._11("[masonry], masonry",o.a,function(t){return r._37(0,[(t()(),r._16(0,0,null,null,1,"div",[["masonry",""]],null,null,null,n,s)),r._14(1,245760,null,0,o.a,[r.n],null,null)],function(t,e){t(e,1,0)},null)},{options:"options",useImagesLoaded:"useImagesLoaded"},{layoutComplete:"layoutComplete",removeComplete:"removeComplete"},["*"])},"6nA8":function(t,e,i){(function(i){var n;!function(e){t.exports=e()}(function(){return function t(e,i,r){function o(a,h){if(!i[a]){if(!e[a]){if(!h&&("function"==typeof n&&n))return n(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};e[a][0].call(u.exports,function(t){var i=e[a][1][t];return o(i||t)},u,u.exports,t,e,i,r)}return i[a].exports}for(var s="function"==typeof n&&n,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,i){function n(){}var r=t("./Scalar");e.exports=n,n.lineInt=function(t,e,i){i=i||0;var n,o,s,a,h,u,c,l=[0,0];return n=t[1][1]-t[0][1],o=t[0][0]-t[1][0],s=n*t[0][0]+o*t[0][1],a=e[1][1]-e[0][1],h=e[0][0]-e[1][0],u=a*e[0][0]+h*e[0][1],c=n*h-a*o,r.eq(c,0,i)||(l[0]=(h*s-o*u)/c,l[1]=(n*u-a*s)/c),l},n.segmentsIntersect=function(t,e,i,n){var r=e[0]-t[0],o=e[1]-t[1],s=n[0]-i[0],a=n[1]-i[1];if(s*o-a*r==0)return!1;var h=(r*(i[1]-t[1])+o*(t[0]-i[0]))/(s*o-a*r),u=(s*(t[1]-i[1])+a*(i[0]-t[0]))/(a*r-s*o);return h>=0&&h<=1&&u>=0&&u<=1}},{"./Scalar":4}],2:[function(t,e,i){function n(){}e.exports=n,n.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},n.left=function(t,e,i){return n.area(t,e,i)>0},n.leftOn=function(t,e,i){return n.area(t,e,i)>=0},n.right=function(t,e,i){return n.area(t,e,i)<0},n.rightOn=function(t,e,i){return n.area(t,e,i)<=0};var r=[],o=[];n.collinear=function(t,e,i,s){if(s){var a=r,h=o;a[0]=e[0]-t[0],a[1]=e[1]-t[1],h[0]=i[0]-e[0],h[1]=i[1]-e[1];var u=a[0]*h[0]+a[1]*h[1],c=Math.sqrt(a[0]*a[0]+a[1]*a[1]),l=Math.sqrt(h[0]*h[0]+h[1]*h[1]);return Math.acos(u/(c*l))<s}return 0==n.area(t,e,i)},n.sqdist=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}},{}],3:[function(t,e,i){function n(){this.vertices=[]}function r(t,e,i,n,r){r=r||0;var o=e[1]-t[1],s=t[0]-e[0],h=o*t[0]+s*t[1],u=n[1]-i[1],c=i[0]-n[0],l=u*i[0]+c*i[1],d=o*c-u*s;return a.eq(d,0,r)?[0,0]:[(c*h-s*l)/d,(o*l-u*h)/d]}var o=t("./Line"),s=t("./Point"),a=t("./Scalar");e.exports=n,n.prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},n.prototype.first=function(){return this.vertices[0]},n.prototype.last=function(){return this.vertices[this.vertices.length-1]},n.prototype.clear=function(){this.vertices.length=0},n.prototype.append=function(t,e,i){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var n=e;n<i;n++)this.vertices.push(t.vertices[n])},n.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);s.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},n.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},n.prototype.isReflex=function(t){return s.right(this.at(t-1),this.at(t),this.at(t+1))};var h=[],u=[];n.prototype.canSee=function(t,e){var i,n,r=h,a=u;if(s.leftOn(this.at(t+1),this.at(t),this.at(e))&&s.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;n=s.sqdist(this.at(t),this.at(e));for(var c=0;c!==this.vertices.length;++c)if((c+1)%this.vertices.length!==t&&c!==t&&s.leftOn(this.at(t),this.at(e),this.at(c+1))&&s.rightOn(this.at(t),this.at(e),this.at(c))&&(r[0]=this.at(t),r[1]=this.at(e),a[0]=this.at(c),a[1]=this.at(c+1),i=o.lineInt(r,a),s.sqdist(this.at(t),i)<n))return!1;return!0},n.prototype.copy=function(t,e,i){var r=i||new n;if(r.clear(),t<e)for(var o=t;o<=e;o++)r.vertices.push(this.vertices[o]);else{for(o=0;o<=e;o++)r.vertices.push(this.vertices[o]);for(o=t;o<this.vertices.length;o++)r.vertices.push(this.vertices[o])}return r},n.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],r=new n,o=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var a=0;a<this.vertices.length;++a)if(this.canSee(s,a)){e=this.copy(s,a,r).getCutEdges(),i=this.copy(a,s,r).getCutEdges();for(var h=0;h<i.length;h++)e.push(i[h]);e.length<o&&(t=e,o=e.length,t.push([this.at(s),this.at(a)]))}return t},n.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},n.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var n=t[i],r=0;r<e.length;r++){var o=e[r].slice(n);if(o){e.splice(r,1),e.push(o[0],o[1]);break}}return e}n=t,i=this.vertices.indexOf(n[0]),r=this.vertices.indexOf(n[1]);return-1!=i&&-1!=r&&[this.copy(i,r),this.copy(r,i)]},n.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(o.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(e=1;e<t.length-2;e++)if(o.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},n.prototype.quickDecomp=function(t,e,i,o,a,h){a=a||100,h=h||0,o=o||25,t="undefined"!=typeof t?t:[],e=e||[],i=i||[];var u=[0,0],c=[0,0],l=[0,0],d=0,p=0,f=0,m=0,g=0,y=0,v=0,b=new n,x=new n,_=this.vertices;if(_.length<3)return t;if(++h>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var w=0;w<this.vertices.length;++w)if(this.isReflex(w)){e.push(this.vertices[w]),d=p=Number.MAX_VALUE;for(var T=0;T<this.vertices.length;++T)s.left(this.at(w-1),this.at(w),this.at(T))&&s.rightOn(this.at(w-1),this.at(w),this.at(T-1))&&(l=r(this.at(w-1),this.at(w),this.at(T),this.at(T-1)),s.right(this.at(w+1),this.at(w),l)&&(f=s.sqdist(this.vertices[w],l))<p&&(p=f,c=l,y=T)),s.left(this.at(w+1),this.at(w),this.at(T+1))&&s.rightOn(this.at(w+1),this.at(w),this.at(T))&&(l=r(this.at(w+1),this.at(w),this.at(T),this.at(T+1)),s.left(this.at(w-1),this.at(w),l)&&(f=s.sqdist(this.vertices[w],l))<d&&(d=f,u=l,g=T));if(y==(g+1)%this.vertices.length)l[0]=(c[0]+u[0])/2,l[1]=(c[1]+u[1])/2,i.push(l),w<g?(b.append(this,w,g+1),b.vertices.push(l),x.vertices.push(l),0!=y&&x.append(this,y,this.vertices.length),x.append(this,0,w+1)):(0!=w&&b.append(this,w,this.vertices.length),b.append(this,0,g+1),b.vertices.push(l),x.vertices.push(l),x.append(this,y,w+1));else{if(y>g&&(g+=this.vertices.length),m=Number.MAX_VALUE,g<y)return t;for(T=y;T<=g;++T)s.leftOn(this.at(w-1),this.at(w),this.at(T))&&s.rightOn(this.at(w+1),this.at(w),this.at(T))&&(f=s.sqdist(this.at(w),this.at(T)))<m&&(m=f,v=T%this.vertices.length);w<v?(b.append(this,w,v+1),0!=v&&x.append(this,v,_.length),x.append(this,0,w+1)):(0!=w&&b.append(this,w,_.length),b.append(this,0,v+1),x.append(this,v,w+1))}return b.vertices.length<x.vertices.length?(b.quickDecomp(t,e,i,o,a,h),x.quickDecomp(t,e,i,o,a,h)):(x.quickDecomp(t,e,i,o,a,h),b.quickDecomp(t,e,i,o,a,h)),t}return t.push(this),t},n.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)s.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){function n(){}e.exports=n,n.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(t,e,i){function n(t){this.lowerBound=r.create(),t&&t.lowerBound&&r.copy(this.lowerBound,t.lowerBound),this.upperBound=r.create(),t&&t.upperBound&&r.copy(this.upperBound,t.upperBound)}var r=t("../math/vec2");t("../utils/Utils");e.exports=n;var o=r.create();n.prototype.setFromPoints=function(t,e,i,n){var s=this.lowerBound,a=this.upperBound;"number"!=typeof i&&(i=0),0!==i?r.rotate(s,t[0],i):r.copy(s,t[0]),r.copy(a,s);for(var h=Math.cos(i),u=Math.sin(i),c=1;c<t.length;c++){var l=t[c];if(0!==i){var d=l[0],p=l[1];o[0]=h*d-u*p,o[1]=u*d+h*p,l=o}for(var f=0;f<2;f++)l[f]>a[f]&&(a[f]=l[f]),l[f]<s[f]&&(s[f]=l[f])}e&&(r.add(this.lowerBound,this.lowerBound,e),r.add(this.upperBound,this.upperBound,e)),n&&(this.lowerBound[0]-=n,this.lowerBound[1]-=n,this.upperBound[0]+=n,this.upperBound[1]+=n)},n.prototype.copy=function(t){r.copy(this.lowerBound,t.lowerBound),r.copy(this.upperBound,t.upperBound)},n.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var n=t.upperBound[e];this.upperBound[e]<n&&(this.upperBound[e]=n)}},n.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,n=t.lowerBound,r=t.upperBound;return(n[0]<=i[0]&&i[0]<=r[0]||e[0]<=r[0]&&r[0]<=i[0])&&(n[1]<=i[1]&&i[1]<=r[1]||e[1]<=r[1]&&r[1]<=i[1])},n.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},n.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],n=(this.lowerBound[0]-t.from[0])*e,r=(this.upperBound[0]-t.from[0])*e,o=(this.lowerBound[1]-t.from[1])*i,s=(this.upperBound[1]-t.from[1])*i,a=Math.max(Math.max(Math.min(n,r),Math.min(o,s))),h=Math.min(Math.min(Math.max(n,r),Math.max(o,s)));return h<0?-1:a>h?-1:a}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){function n(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=n.AABB}var r=t("../math/vec2"),o=t("../objects/Body");e.exports=n,n.AABB=1,n.BOUNDING_CIRCLE=2,n.prototype.setWorld=function(t){this.world=t},n.prototype.getCollisionPairs=function(t){};var s=r.create();n.boundingRadiusCheck=function(t,e){r.sub(s,t.position,e.position);var i=r.squaredLength(s),n=t.boundingRadius+e.boundingRadius;return i<=n*n},n.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},n.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:i=n.boundingRadiusCheck(t,e);break;case n.AABB:i=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},n.canCollide=function(t,e){var i=o.KINEMATIC,n=o.STATIC;return(t.type!==n||e.type!==n)&&(!(t.type===i&&e.type===n||t.type===n&&e.type===i)&&((t.type!==i||e.type!==i)&&((t.sleepState!==o.SLEEPING||e.sleepState!==o.SLEEPING)&&!(t.sleepState===o.SLEEPING&&e.type===n||e.sleepState===o.SLEEPING&&t.type===n))))},n.NAIVE=1,n.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){function n(){r.call(this,r.NAIVE)}t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle");var r=t("../collision/Broadphase");t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var n=0,o=e.length;n!==o;n++)for(var s=e[n],a=0;a<n;a++){var h=e[a];r.canCollide(s,h)&&this.boundingVolumeCheck(s,h)&&i.push(s,h)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[];for(var n=t.bodies,r=0;r<n.length;r++){var o=n[r];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&i.push(o)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){function n(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new c({size:32}),this.frictionEquationPool=new l({size:64}),this.restitution=0,this.stiffness=p.DEFAULT_STIFFNESS,this.relaxation=p.DEFAULT_RELAXATION,this.frictionStiffness=p.DEFAULT_STIFFNESS,this.frictionRelaxation=p.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new d,this.contactSkinSize=.01}function r(t,e){s.set(t.vertices[0],.5*-e.length,-e.radius),s.set(t.vertices[1],.5*e.length,-e.radius),s.set(t.vertices[2],.5*e.length,e.radius),s.set(t.vertices[3],.5*-e.length,e.radius)}function o(t,e,i,n){for(var r=W,o=X,u=q,c=Y,l=t,d=e.vertices,p=null,f=0;f!==d.length+1;f++){var m=d[f%d.length],g=d[(f+1)%d.length];s.rotate(r,m,n),s.rotate(o,g,n),h(r,r,i),h(o,o,i),a(u,r,l),a(c,o,l);var y=s.crossLength(u,c);if(null===p&&(p=y),y*p<=0)return!1;p=y}return!0}var s=t("../math/vec2"),a=s.sub,h=s.add,u=s.dot,c=(t("../utils/Utils"),t("../utils/ContactEquationPool")),l=t("../utils/FrictionEquationPool"),d=t("../utils/TupleDictionary"),p=t("../equations/Equation"),f=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),m=t("../shapes/Convex"),g=t("../shapes/Shape"),y=(t("../objects/Body"),t("../shapes/Box"));e.exports=n;var v=s.fromValues(0,1),b=s.fromValues(0,0),x=s.fromValues(0,0),_=s.fromValues(0,0),w=s.fromValues(0,0),T=s.fromValues(0,0),S=s.fromValues(0,0),E=s.fromValues(0,0),C=s.fromValues(0,0),P=s.fromValues(0,0),M=s.fromValues(0,0),A=s.fromValues(0,0),R=s.fromValues(0,0),L=s.fromValues(0,0),O=s.fromValues(0,0),I=s.fromValues(0,0),B=s.fromValues(0,0),k=s.fromValues(0,0),D=s.fromValues(0,0),F=[],U=s.create(),N=s.create();n.prototype.bodiesOverlap=function(t,e){for(var i=U,n=N,r=0,o=t.shapes.length;r!==o;r++){var s=t.shapes[r];t.toWorldFrame(i,s.position);for(var a=0,h=e.shapes.length;a!==h;a++){var u=e.shapes[a];if(e.toWorldFrame(n,u.position),this[s.type|u.type](t,s,i,s.angle+t.angle,e,u,n,u.angle+e.angle,!0))return!0}}return!1},n.prototype.collidedLastStep=function(t,e){var i=0|t.id,n=0|e.id;return!!this.collidingBodiesLastStep.get(i,n)},n.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],n=i.bodyA.id,r=i.bodyB.id;this.collidingBodiesLastStep.set(n,r,!0)}for(var o=this.contactEquations,s=this.frictionEquations,a=0;a<o.length;a++)this.contactEquationPool.release(o[a]);for(a=0;a<s.length;a++)this.frictionEquationPool.release(s[a]);this.contactEquations.length=this.frictionEquations.length=0},n.prototype.createContactEquation=function(t,e,i,n){var r=this.contactEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.restitution=this.restitution,r.firstImpact=!this.collidedLastStep(t,e),r.stiffness=this.stiffness,r.relaxation=this.relaxation,r.needsUpdate=!0,r.enabled=this.enabledEquations,r.offset=this.contactSkinSize,r},n.prototype.createFrictionEquation=function(t,e,i,n){var r=this.frictionEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.setSlipForce(this.slipForce),r.frictionCoefficient=this.frictionCoefficient,r.relativeVelocity=this.surfaceVelocity,r.enabled=this.enabledEquations,r.needsUpdate=!0,r.stiffness=this.frictionStiffness,r.relaxation=this.frictionRelaxation,r.contactEquations.length=0,r},n.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return s.copy(e.contactPointA,t.contactPointA),s.copy(e.contactPointB,t.contactPointB),s.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},n.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),n=e.bodyA;e.bodyB;s.set(i.contactPointA,0,0),s.set(i.contactPointB,0,0),s.set(i.t,0,0);for(var r=0;r!==t;r++)(e=this.contactEquations[this.contactEquations.length-1-r]).bodyA===n?(s.add(i.t,i.t,e.normalA),s.add(i.contactPointA,i.contactPointA,e.contactPointA),s.add(i.contactPointB,i.contactPointB,e.contactPointB)):(s.sub(i.t,i.t,e.normalA),s.add(i.contactPointA,i.contactPointA,e.contactPointB),s.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var o=1/t;return s.scale(i.contactPointA,i.contactPointA,o),s.scale(i.contactPointB,i.contactPointB,o),s.normalize(i.t,i.t),s.rotate90cw(i.t,i.t),i},n.prototype[g.LINE|g.CONVEX]=n.prototype.convexLine=function(t,e,i,n,r,o,s,a,h){return!h&&0},n.prototype[g.LINE|g.BOX]=n.prototype.lineBox=function(t,e,i,n,r,o,s,a,h){return!h&&0};var G=new y({width:1,height:1}),j=s.create();n.prototype[g.CAPSULE|g.CONVEX]=n.prototype[g.CAPSULE|g.BOX]=n.prototype.convexCapsule=function(t,e,i,n,o,a,h,u,c){var l=j;s.set(l,a.length/2,0),s.rotate(l,l,u),s.add(l,l,h);var d=this.circleConvex(o,a,l,u,t,e,i,n,c,a.radius);s.set(l,-a.length/2,0),s.rotate(l,l,u),s.add(l,l,h);var p=this.circleConvex(o,a,l,u,t,e,i,n,c,a.radius);if(c&&(d||p))return!0;var f=G;r(f,a);return this.convexConvex(t,e,i,n,o,f,h,u,c)+d+p},n.prototype[g.CAPSULE|g.LINE]=n.prototype.lineCapsule=function(t,e,i,n,r,o,s,a,h){return!h&&0};var V=s.create(),H=s.create(),z=new y({width:1,height:1});n.prototype[g.CAPSULE|g.CAPSULE]=n.prototype.capsuleCapsule=function(t,e,i,n,o,a,h,u,c){for(var l=V,d=H,p=0,f=0;f<2;f++){s.set(l,(0===f?-1:1)*e.length/2,0),s.rotate(l,l,n),s.add(l,l,i);for(var m=0;m<2;m++){s.set(d,(0===m?-1:1)*a.length/2,0),s.rotate(d,d,u),s.add(d,d,h),this.enableFrictionReduction&&(b=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,l,n,o,a,d,u,c,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=b),c&&g)return!0;p+=g}}this.enableFrictionReduction&&(b=this.enableFriction,this.enableFriction=!1);var y=z;r(y,e);var v=this.convexCapsule(t,y,i,n,o,a,h,u,c);if(this.enableFrictionReduction&&(this.enableFriction=b),c&&v)return!0;if(p+=v,this.enableFrictionReduction){var b=this.enableFriction;this.enableFriction=!1}r(y,a);var x=this.convexCapsule(o,y,h,u,t,e,i,n,c);return this.enableFrictionReduction&&(this.enableFriction=b),!(!c||!x)||(p+=x,this.enableFrictionReduction&&p&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(p)),p)},n.prototype[g.LINE|g.LINE]=n.prototype.lineLine=function(t,e,i,n,r,o,s,a,h){return!h&&0},n.prototype[g.PLANE|g.LINE]=n.prototype.planeLine=function(t,e,i,n,r,o,c,l,d){var p=b,f=x,m=_,g=w,y=T,M=S,A=E,R=C,L=P,O=F,I=0;s.set(p,-o.length/2,0),s.set(f,o.length/2,0),s.rotate(m,p,l),s.rotate(g,f,l),h(m,m,c),h(g,g,c),s.copy(p,m),s.copy(f,g),a(y,f,p),s.normalize(M,y),s.rotate90cw(L,M),s.rotate(R,v,n),O[0]=p,O[1]=f;for(var B=0;B<O.length;B++){var k=O[B];a(A,k,i);var D=u(A,R);if(D<0){if(d)return!0;var U=this.createContactEquation(t,r,e,o);I++,s.copy(U.normalA,R),s.normalize(U.normalA,U.normalA),s.scale(A,R,D),a(U.contactPointA,k,A),a(U.contactPointA,U.contactPointA,t.position),a(U.contactPointB,k,c),h(U.contactPointB,U.contactPointB,c),a(U.contactPointB,U.contactPointB,r.position),this.contactEquations.push(U),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(U))}}return!d&&(this.enableFrictionReduction||I&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(I)),I)},n.prototype[g.PARTICLE|g.CAPSULE]=n.prototype.particleCapsule=function(t,e,i,n,r,o,s,a,h){return this.circleLine(t,e,i,n,r,o,s,a,h,o.radius,0)},n.prototype[g.CIRCLE|g.LINE]=n.prototype.circleLine=function(t,e,i,n,r,o,c,l,d,p,f){p=p||0,f="undefined"!=typeof f?f:e.radius;var m=b,g=x,y=_,v=w,I=T,B=S,k=E,D=C,U=P,N=M,G=A,j=R,V=L,H=O,z=F;s.set(D,-o.length/2,0),s.set(U,o.length/2,0),s.rotate(N,D,l),s.rotate(G,U,l),h(N,N,c),h(G,G,c),s.copy(D,N),s.copy(U,G),a(B,U,D),s.normalize(k,B),s.rotate90cw(I,k),a(j,i,D);var W=u(j,I);a(v,D,c),a(V,i,c);var X=f+p;if(Math.abs(W)<X){s.scale(m,I,W),a(y,i,m),s.scale(g,I,u(I,V)),s.normalize(g,g),s.scale(g,g,p),h(y,y,g);var q=u(k,y),Y=u(k,D),K=u(k,U);if(q>Y&&q<K){if(d)return!0;var Z=this.createContactEquation(t,r,e,o);return s.scale(Z.normalA,m,-1),s.normalize(Z.normalA,Z.normalA),s.scale(Z.contactPointA,Z.normalA,f),h(Z.contactPointA,Z.contactPointA,i),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,y,c),h(Z.contactPointB,Z.contactPointB,c),a(Z.contactPointB,Z.contactPointB,r.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}z[0]=D,z[1]=U;for(var Q=0;Q<z.length;Q++){var J=z[Q];if(a(j,J,i),s.squaredLength(j)<Math.pow(X,2)){if(d)return!0;Z=this.createContactEquation(t,r,e,o);return s.copy(Z.normalA,j),s.normalize(Z.normalA,Z.normalA),s.scale(Z.contactPointA,Z.normalA,f),h(Z.contactPointA,Z.contactPointA,i),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,J,c),s.scale(H,Z.normalA,-p),h(Z.contactPointB,Z.contactPointB,H),h(Z.contactPointB,Z.contactPointB,c),a(Z.contactPointB,Z.contactPointB,r.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}return 0},n.prototype[g.CIRCLE|g.CAPSULE]=n.prototype.circleCapsule=function(t,e,i,n,r,o,s,a,h){return this.circleLine(t,e,i,n,r,o,s,a,h,o.radius)},n.prototype[g.CIRCLE|g.CONVEX]=n.prototype[g.CIRCLE|g.BOX]=n.prototype.circleConvex=function(t,e,i,n,r,u,c,l,d,p){p="number"==typeof p?p:e.radius;for(var f=b,m=x,g=_,y=w,v=T,S=M,E=A,C=L,P=O,R=I,k=B,D=!1,F=Number.MAX_VALUE,U=u.vertices,N=0;N!==U.length+1;N++){var G=U[N%U.length],j=U[(N+1)%U.length];if(s.rotate(f,G,l),s.rotate(m,j,l),h(f,f,c),h(m,m,c),a(g,m,f),s.normalize(y,g),s.rotate90cw(v,y),s.scale(P,v,-e.radius),h(P,P,i),o(P,u,c,l)){s.sub(R,f,P);var V=Math.abs(s.dot(R,v));V<F&&(s.copy(k,P),F=V,s.scale(C,v,V),s.add(C,C,P),D=!0)}}if(D){if(d)return!0;var H=this.createContactEquation(t,r,e,u);return s.sub(H.normalA,k,i),s.normalize(H.normalA,H.normalA),s.scale(H.contactPointA,H.normalA,p),h(H.contactPointA,H.contactPointA,i),a(H.contactPointA,H.contactPointA,t.position),a(H.contactPointB,C,c),h(H.contactPointB,H.contactPointB,c),a(H.contactPointB,H.contactPointB,r.position),this.contactEquations.push(H),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(H)),1}if(p>0)for(N=0;N<U.length;N++){var z=U[N];if(s.rotate(E,z,l),h(E,E,c),a(S,E,i),s.squaredLength(S)<Math.pow(p,2)){if(d)return!0;H=this.createContactEquation(t,r,e,u);return s.copy(H.normalA,S),s.normalize(H.normalA,H.normalA),s.scale(H.contactPointA,H.normalA,p),h(H.contactPointA,H.contactPointA,i),a(H.contactPointA,H.contactPointA,t.position),a(H.contactPointB,E,c),h(H.contactPointB,H.contactPointB,c),a(H.contactPointB,H.contactPointB,r.position),this.contactEquations.push(H),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(H)),1}}return 0};var W=s.create(),X=s.create(),q=s.create(),Y=s.create();n.prototype[g.PARTICLE|g.CONVEX]=n.prototype[g.PARTICLE|g.BOX]=n.prototype.particleConvex=function(t,e,i,n,r,c,l,d,p){var f=b,m=x,g=_,y=w,v=T,C=S,P=E,A=M,R=L,O=k,I=D,B=Number.MAX_VALUE,F=!1,U=c.vertices;if(!o(i,c,l,d))return 0;if(p)return!0;for(var N=0;N!==U.length+1;N++){var G=U[N%U.length],j=U[(N+1)%U.length];s.rotate(f,G,d),s.rotate(m,j,d),h(f,f,l),h(m,m,l),a(g,m,f),s.normalize(y,g),s.rotate90cw(v,y),a(A,i,f);u(A,v);a(C,f,l),a(P,i,l),s.sub(O,f,i);var V=Math.abs(s.dot(O,v));V<B&&(B=V,s.scale(R,v,V),s.add(R,R,i),s.copy(I,v),F=!0)}if(F){var H=this.createContactEquation(t,r,e,c);return s.scale(H.normalA,I,-1),s.normalize(H.normalA,H.normalA),s.set(H.contactPointA,0,0),h(H.contactPointA,H.contactPointA,i),a(H.contactPointA,H.contactPointA,t.position),a(H.contactPointB,R,l),h(H.contactPointB,H.contactPointB,l),a(H.contactPointB,H.contactPointB,r.position),this.contactEquations.push(H),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(H)),1}return 0},n.prototype[g.CIRCLE]=n.prototype.circleCircle=function(t,e,i,n,r,o,u,c,l,d,p){var f=b;d=d||e.radius,p=p||o.radius;a(f,i,u);var m=d+p;if(s.squaredLength(f)>Math.pow(m,2))return 0;if(l)return!0;var g=this.createContactEquation(t,r,e,o);return a(g.normalA,u,i),s.normalize(g.normalA,g.normalA),s.scale(g.contactPointA,g.normalA,d),s.scale(g.contactPointB,g.normalA,-p),h(g.contactPointA,g.contactPointA,i),a(g.contactPointA,g.contactPointA,t.position),h(g.contactPointB,g.contactPointB,u),a(g.contactPointB,g.contactPointB,r.position),this.contactEquations.push(g),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(g)),1},n.prototype[g.PLANE|g.CONVEX]=n.prototype[g.PLANE|g.BOX]=n.prototype.planeConvex=function(t,e,i,n,r,o,c,l,d){var p=b,f=x,m=_,g=0;s.rotate(f,v,n);for(var y=0;y!==o.vertices.length;y++){var w=o.vertices[y];if(s.rotate(p,w,l),h(p,p,c),a(m,p,i),u(m,f)<=0){if(d)return!0;g++;var T=this.createContactEquation(t,r,e,o);a(m,p,i),s.copy(T.normalA,f);var S=u(m,T.normalA);s.scale(m,T.normalA,S),a(T.contactPointB,p,r.position),a(T.contactPointA,p,m),a(T.contactPointA,T.contactPointA,t.position),this.contactEquations.push(T),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T))}}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},n.prototype[g.PARTICLE|g.PLANE]=n.prototype.particlePlane=function(t,e,i,n,r,o,h,c,l){var d=b,p=x;c=c||0,a(d,i,h),s.rotate(p,v,c);var f=u(d,p);if(f>0)return 0;if(l)return!0;var m=this.createContactEquation(r,t,o,e);return s.copy(m.normalA,p),s.scale(d,m.normalA,f),a(m.contactPointA,i,d),a(m.contactPointA,m.contactPointA,r.position),a(m.contactPointB,i,t.position),this.contactEquations.push(m),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m)),1},n.prototype[g.CIRCLE|g.PARTICLE]=n.prototype.circleParticle=function(t,e,i,n,r,o,u,c,l){var d=b;if(a(d,u,i),s.squaredLength(d)>Math.pow(e.radius,2))return 0;if(l)return!0;var p=this.createContactEquation(t,r,e,o);return s.copy(p.normalA,d),s.normalize(p.normalA,p.normalA),s.scale(p.contactPointA,p.normalA,e.radius),h(p.contactPointA,p.contactPointA,i),a(p.contactPointA,p.contactPointA,t.position),a(p.contactPointB,u,r.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1};var K=new f({radius:1}),Z=s.create(),Q=s.create();s.create();n.prototype[g.PLANE|g.CAPSULE]=n.prototype.planeCapsule=function(t,e,i,n,r,o,a,u,c){var l=Z,d=Q,p=K;s.set(l,-o.length/2,0),s.rotate(l,l,u),h(l,l,a),s.set(d,o.length/2,0),s.rotate(d,d,u),h(d,d,a),p.radius=o.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var m=this.circlePlane(r,p,l,0,t,e,i,n,c),g=this.circlePlane(r,p,d,0,t,e,i,n,c);if(this.enableFrictionReduction&&(this.enableFriction=f),c)return m||g;var y=m+g;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},n.prototype[g.CIRCLE|g.PLANE]=n.prototype.circlePlane=function(t,e,i,n,r,o,c,l,d){var p=t,f=e,m=i,g=r,y=c,w=l;w=w||0;var T=b,S=x,E=_;a(T,m,y),s.rotate(S,v,w);var C=u(S,T);if(C>f.radius)return 0;if(d)return!0;var P=this.createContactEquation(g,p,o,e);return s.copy(P.normalA,S),s.scale(P.contactPointB,P.normalA,-f.radius),h(P.contactPointB,P.contactPointB,m),a(P.contactPointB,P.contactPointB,p.position),s.scale(E,P.normalA,C),a(P.contactPointA,T,E),h(P.contactPointA,P.contactPointA,y),a(P.contactPointA,P.contactPointA,g.position),this.contactEquations.push(P),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P)),1},n.prototype[g.CONVEX]=n.prototype[g.CONVEX|g.BOX]=n.prototype[g.BOX]=n.prototype.convexConvex=function(t,e,i,r,o,c,l,d,p,f){var m=b,g=x,y=_,v=w,S=T,M=E,A=C,R=P,L=0;f="number"==typeof f?f:0;if(!n.findSeparatingAxis(e,i,r,c,l,d,m))return 0;a(A,l,i),u(m,A)>0&&s.scale(m,m,-1);var O=n.getClosestEdge(e,r,m,!0),I=n.getClosestEdge(c,d,m);if(-1===O||-1===I)return 0;for(var B=0;B<2;B++){var k=O,D=I,F=e,U=c,N=i,G=l,j=r,V=d,H=t,z=o;if(0===B){var W;W=k,k=D,D=W,W=F,F=U,U=W,W=N,N=G,G=W,W=j,j=V,V=W,W=H,H=z,z=W}for(var X=D;X<D+2;X++){var q=U.vertices[(X+U.vertices.length)%U.vertices.length];s.rotate(g,q,V),h(g,g,G);for(var Y=0,K=k-1;K<k+2;K++){var Z=F.vertices[(K+F.vertices.length)%F.vertices.length],Q=F.vertices[(K+1+F.vertices.length)%F.vertices.length];s.rotate(y,Z,j),s.rotate(v,Q,j),h(y,y,N),h(v,v,N),a(S,v,y),s.rotate90cw(R,S),s.normalize(R,R),a(A,g,y);var J=u(R,A);(K===k&&J<=f||K!==k&&J<=0)&&Y++}if(Y>=3){if(p)return!0;var $=this.createContactEquation(H,z,F,U);L++;Z=F.vertices[k%F.vertices.length],Q=F.vertices[(k+1)%F.vertices.length];s.rotate(y,Z,j),s.rotate(v,Q,j),h(y,y,N),h(v,v,N),a(S,v,y),s.rotate90cw($.normalA,S),s.normalize($.normalA,$.normalA),a(A,g,y);J=u($.normalA,A);s.scale(M,$.normalA,J),a($.contactPointA,g,N),a($.contactPointA,$.contactPointA,M),h($.contactPointA,$.contactPointA,N),a($.contactPointA,$.contactPointA,H.position),a($.contactPointB,g,G),h($.contactPointB,$.contactPointB,G),a($.contactPointB,$.contactPointB,z.position),this.contactEquations.push($),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact($))}}}return this.enableFrictionReduction&&this.enableFriction&&L&&this.frictionEquations.push(this.createFrictionFromAverage(L)),L};var J=s.fromValues(0,0);n.projectConvexOntoAxis=function(t,e,i,n,r){var o,a,h=null,c=null,l=J;s.rotate(l,n,-i);for(var d=0;d<t.vertices.length;d++)o=t.vertices[d],a=u(o,l),(null===h||a>h)&&(h=a),(null===c||a<c)&&(c=a);if(c>h){var p=c;c=h,h=p}var f=u(e,n);s.set(r,c+f,h+f)};var $=s.fromValues(0,0),tt=s.fromValues(0,0),et=s.fromValues(0,0),it=s.fromValues(0,0),nt=s.fromValues(0,0),rt=s.fromValues(0,0);n.findSeparatingAxis=function(t,e,i,r,o,h,u){var c=null,l=!1,d=!1,p=$,f=tt,m=et,g=it,v=nt,b=rt;if(t instanceof y&&r instanceof y)for(var x=0;2!==x;x++){var _=t,w=i;1===x&&(_=r,w=h);for(var T=0;2!==T;T++){0===T?s.set(g,0,1):1===T&&s.set(g,1,0),0!==w&&s.rotate(g,g,w),n.projectConvexOntoAxis(t,e,i,g,v),n.projectConvexOntoAxis(r,o,h,g,b);var S=v,E=b;v[0]>b[0]&&(E=v,S=b,!0);l=(C=E[0]-S[1])<=0,(null===c||C>c)&&(s.copy(u,g),c=C,d=l)}}else for(x=0;2!==x;x++){_=t,w=i;1===x&&(_=r,w=h);for(T=0;T!==_.vertices.length;T++){s.rotate(f,_.vertices[T],w),s.rotate(m,_.vertices[(T+1)%_.vertices.length],w),a(p,m,f),s.rotate90cw(g,p),s.normalize(g,g),n.projectConvexOntoAxis(t,e,i,g,v),n.projectConvexOntoAxis(r,o,h,g,b);S=v,E=b;v[0]>b[0]&&(E=v,S=b,!0);var C;l=(C=E[0]-S[1])<=0,(null===c||C>c)&&(s.copy(u,g),c=C,d=l)}}return d};var ot=s.fromValues(0,0),st=s.fromValues(0,0),at=s.fromValues(0,0);n.getClosestEdge=function(t,e,i,n){var r=ot,o=st,h=at;s.rotate(r,i,-e),n&&s.scale(r,r,-1);for(var c=-1,l=t.vertices.length,d=-1,p=0;p!==l;p++){a(o,t.vertices[(p+1)%l],t.vertices[p%l]),s.rotate90cw(h,o),s.normalize(h,h);var f=u(h,r);(-1===c||f>d)&&(c=p%l,d=f)}return c};var ht=s.create(),ut=s.create(),ct=s.create(),lt=s.create(),dt=s.create(),pt=s.create(),ft=s.create();n.prototype[g.CIRCLE|g.HEIGHTFIELD]=n.prototype.circleHeightfield=function(t,e,i,n,r,o,u,c,l,d){var p=o.heights,f=(d=d||e.radius,o.elementWidth),m=ut,g=ht,y=dt,v=ft,b=pt,x=ct,_=lt,w=Math.floor((i[0]-d-u[0])/f),T=Math.ceil((i[0]+d-u[0])/f);w<0&&(w=0),T>=p.length&&(T=p.length-1);for(var S=p[w],E=p[T],C=w;C<T;C++)p[C]<E&&(E=p[C]),p[C]>S&&(S=p[C]);if(i[1]-d>S)return!l&&0;var P=!1;for(C=w;C<T;C++){s.set(x,C*f,p[C]),s.set(_,(C+1)*f,p[C+1]),s.add(x,x,u),s.add(_,_,u),s.sub(b,_,x),s.rotate(b,b,Math.PI/2),s.normalize(b,b),s.scale(g,b,-d),s.add(g,g,i),s.sub(m,g,x);var M=s.dot(m,b);if(g[0]>=x[0]&&g[0]<_[0]&&M<=0){if(l)return!0;P=!0,s.scale(m,b,-M),s.add(y,g,m),s.copy(v,b);var A=this.createContactEquation(r,t,o,e);s.copy(A.normalA,v),s.scale(A.contactPointB,A.normalA,-d),h(A.contactPointB,A.contactPointB,i),a(A.contactPointB,A.contactPointB,t.position),s.copy(A.contactPointA,y),s.sub(A.contactPointA,A.contactPointA,r.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}if(P=!1,d>0)for(C=w;C<=T;C++)if(s.set(x,C*f,p[C]),s.add(x,x,u),s.sub(m,i,x),s.squaredLength(m)<Math.pow(d,2)){if(l)return!0;P=!0;A=this.createContactEquation(r,t,o,e);s.copy(A.normalA,m),s.normalize(A.normalA,A.normalA),s.scale(A.contactPointB,A.normalA,-d),h(A.contactPointB,A.contactPointB,i),a(A.contactPointB,A.contactPointB,t.position),a(A.contactPointA,x,u),h(A.contactPointA,A.contactPointA,u),a(A.contactPointA,A.contactPointA,r.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}return P?1:0};var mt=s.create(),gt=s.create(),yt=s.create(),vt=new m({vertices:[s.create(),s.create(),s.create(),s.create()]});n.prototype[g.BOX|g.HEIGHTFIELD]=n.prototype[g.CONVEX|g.HEIGHTFIELD]=n.prototype.convexHeightfield=function(t,e,i,n,r,o,a,h,u){var c=o.heights,l=o.elementWidth,d=mt,p=gt,f=yt,m=vt,g=Math.floor((t.aabb.lowerBound[0]-a[0])/l),y=Math.ceil((t.aabb.upperBound[0]-a[0])/l);g<0&&(g=0),y>=c.length&&(y=c.length-1);for(var v=c[g],b=c[y],x=g;x<y;x++)c[x]<b&&(b=c[x]),c[x]>v&&(v=c[x]);if(t.aabb.lowerBound[1]>v)return!u&&0;var _=0;for(x=g;x<y;x++){s.set(d,x*l,c[x]),s.set(p,(x+1)*l,c[x+1]),s.add(d,d,a),s.add(p,p,a);s.set(f,.5*(p[0]+d[0]),.5*(p[1]+d[1]-100)),s.sub(m.vertices[0],p,f),s.sub(m.vertices[1],d,f),s.copy(m.vertices[2],m.vertices[1]),s.copy(m.vertices[3],m.vertices[0]),m.vertices[2][1]-=100,m.vertices[3][1]-=100,_+=this.convexConvex(t,e,i,n,r,m,f,0,u)}return _}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){function n(t){t=t||{},this.from=t.from?r.fromValues(t.from[0],t.from[1]):r.create(),this.to=t.to?r.fromValues(t.to[0],t.to[1]):r.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:n.ANY,this.callback=t.callback||function(t){},this.direction=r.create(),this.length=1,this.update()}e.exports=n;var r=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4,n.prototype.update=function(){var t=this.direction;r.sub(t,this.to,this.from),this.length=r.length(t),r.normalize(t,t)},n.prototype.intersectBodies=function(t,e){for(var i=0,n=e.length;!t.shouldStop(this)&&i<n;i++){var r=e[i],o=r.getAABB();(o.overlapsRay(this)>=0||o.containsPoint(this.from))&&this.intersectBody(t,r)}};var o=r.create();n.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var n=o,s=0,a=e.shapes.length;s<a;s++){var h=e.shapes[s];if((!i||h.collisionResponse)&&(0!=(this.collisionGroup&h.collisionMask)&&0!=(h.collisionGroup&this.collisionMask))){r.rotate(n,h.position,e.angle),r.add(n,n,e.position);var u=h.angle+e.angle;if(this.intersectShape(t,h,u,n,e),t.shouldStop(this))break}}},n.prototype.intersectShape=function(t,e,i,n,o){(function(t,e,i){r.sub(s,i,t);var n=r.dot(s,e);return r.scale(a,e,n),r.add(a,a,t),r.squaredDistance(i,a)})(this.from,this.direction,n)>e.boundingRadius*e.boundingRadius||(this._currentBody=o,this._currentShape=e,e.raycast(t,this,n,i),this._currentBody=this._currentShape=null)},n.prototype.getAABB=function(t){var e=this.to,i=this.from;r.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),r.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};r.create();n.prototype.reportIntersection=function(t,e,i,o){this.from,this.to;var s=this._currentShape,a=this._currentBody;if(!(this.skipBackfaces&&r.dot(i,this.direction)>0))switch(this.mode){case n.ALL:t.set(i,s,a,e,o),this.callback(t);break;case n.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,s,a,e,o);break;case n.ANY:t.set(i,s,a,e,o)}};var s=r.create(),a=r.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){function n(){this.normal=r.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var r=t("../math/vec2"),o=t("../collision/Ray");e.exports=n,n.prototype.reset=function(){r.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},n.prototype.getHitDistance=function(t){return r.distance(t.from,t.to)*this.fraction},n.prototype.hasHit=function(){return-1!==this.fraction},n.prototype.getHitPoint=function(t,e){r.lerp(t,e.from,e.to,this.fraction)},n.prototype.stop=function(){this.isStopped=!0},n.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===o.ANY},n.prototype.set=function(t,e,i,n,o){r.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=n,this.faceIndex=o}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){function n(){o.call(this,o.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);-1!==i&&t.axisList.splice(i,1)}}var r=t("../utils/Utils"),o=t("../collision/Broadphase");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},n.sortAxisList=function(t,e){e|=0;for(var i=1,n=t.length;i<n;i++){for(var r=t[i],o=i-1;o>=0&&!(t[o].aabb.lowerBound[e]<=r.aabb.lowerBound[e]);o--)t[o+1]=t[o];t[o+1]=r}return t},n.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n.sortAxisList(t,e)},n.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,n=this.axisIndex;i.length=0;for(var r=e.length;r--;){var s=e[r];s.aabbNeedsUpdate&&s.updateAABB()}this.sortList();for(var a=0,h=0|e.length;a!==h;a++)for(var u=e[a],c=a+1;c<h;c++){var l=e[c];if(!(l.aabb.lowerBound[n]<=u.aabb.upperBound[n]))break;o.canCollide(u,l)&&this.boundingVolumeCheck(u,l)&&i.push(u,l)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var n=this.axisIndex,r="x";1===n&&(r="y"),2===n&&(r="z");for(var o=this.axisList,s=(e.lowerBound[r],e.upperBound[r],0);s<o.length;s++){var a=o[s];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&i.push(a)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){function n(t,e,i,n){this.type=i,n=r.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=n;var r=t("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.DISTANCE=1,n.GEAR=2,n.LOCK=3,n.PRISMATIC=4,n.REVOLUTE=5,n.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.stiffness=t,n.needsUpdate=!0}},n.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.relaxation=t,n.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e,i){function n(t,e,i){i=a.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),r.call(this,t,e,r.DISTANCE,i),this.localAnchorA=s.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=s.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var n=this.localAnchorA,h=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var u=s.create(),c=s.create(),l=s.create();s.rotate(u,n,t.angle),s.rotate(c,h,e.angle),s.add(l,e.position,c),s.sub(l,l,u),s.sub(l,l,t.position),this.distance=s.length(l)}var d;d="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce;var p=new o(t,e,-d,d);this.equations=[p],this.maxForce=d;l=s.create();var f=s.create(),m=s.create(),g=this;p.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,r=e.position;return s.rotate(f,n,t.angle),s.rotate(m,h,e.angle),s.add(l,r,m),s.sub(l,l,f),s.sub(l,l,i),s.length(l)-g.distance},this.setMaxForce(d),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var r=t("./Constraint"),o=t("../equations/Equation"),s=t("../math/vec2"),a=t("../utils/Utils");e.exports=n,(n.prototype=new r).constructor=n;var h=s.create(),u=s.create(),c=s.create();n.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,n=(this.distance,e.position),r=i.position,o=this.equations[0],a=t.G;s.rotate(u,this.localAnchorA,e.angle),s.rotate(c,this.localAnchorB,i.angle),s.add(h,r,c),s.sub(h,h,u),s.sub(h,h,n),this.position=s.length(h);var l=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(o.maxForce=0,o.minForce=-this.maxForce,this.distance=this.upperLimit,l=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(o.maxForce=this.maxForce,o.minForce=0,this.distance=this.lowerLimit,l=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||l){o.enabled=!0,s.normalize(h,h);var d=s.crossLength(u,h),p=s.crossLength(c,h);a[0]=-h[0],a[1]=-h[1],a[2]=-d,a[3]=h[0],a[4]=h[1],a[5]=p}else o.enabled=!1},n.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new o(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var r=t("./Constraint"),o=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},n.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},n.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.LOCK,i);var n="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce,a=(i.localAngleB,new s(t,e,-n,n)),h=new s(t,e,-n,n),u=new s(t,e,-n,n),c=o.create(),l=o.create(),d=this;a.computeGq=function(){return o.rotate(c,d.localOffsetB,t.angle),o.sub(l,e.position,t.position),o.sub(l,l,c),l[0]},h.computeGq=function(){return o.rotate(c,d.localOffsetB,t.angle),o.sub(l,e.position,t.position),o.sub(l,l,c),l[1]};var p=o.create(),f=o.create();u.computeGq=function(){return o.rotate(p,d.localOffsetB,e.angle-d.localAngleB),o.scale(p,p,-1),o.sub(l,t.position,e.position),o.add(l,l,p),o.rotate(f,p,-Math.PI/2),o.normalize(f,f),o.dot(l,f)},this.localOffsetB=o.create(),i.localOffsetB?o.copy(this.localOffsetB,i.localOffsetB):(o.sub(this.localOffsetB,e.position,t.position),o.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(a,h,u),this.setMaxForce(n)}var r=t("./Constraint"),o=t("../math/vec2"),s=t("../equations/Equation");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=o.create(),h=o.create(),u=o.create(),c=o.fromValues(1,0),l=o.fromValues(0,1);n.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],n=this.bodyA,r=this.bodyB;o.rotate(a,this.localOffsetB,n.angle),o.rotate(h,this.localOffsetB,r.angle-this.localAngleB),o.scale(h,h,-1),o.rotate(u,h,Math.PI/2),o.normalize(u,u),t.G[0]=-1,t.G[1]=0,t.G[2]=-o.crossLength(a,c),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-o.crossLength(a,l),e.G[4]=1,i.G[0]=-u[0],i.G[1]=-u[1],i.G[3]=u[0],i.G[4]=u[1],i.G[5]=o.crossLength(h,u)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.PRISMATIC,i);var n=a.fromValues(0,0),u=a.fromValues(1,0),c=a.fromValues(0,0);i.localAnchorA&&a.copy(n,i.localAnchorA),i.localAxisA&&a.copy(u,i.localAxisA),i.localAnchorB&&a.copy(c,i.localAnchorB),this.localAnchorA=n,this.localAnchorB=c,this.localAxisA=u;var l=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE,d=new s(t,e,-l,l),p=new a.create,f=new a.create,m=new a.create,g=new a.create;if(d.computeGq=function(){return a.dot(m,g)},d.updateJacobian=function(){var i=this.G,r=t.position,o=e.position;a.rotate(p,n,t.angle),a.rotate(f,c,e.angle),a.add(m,o,f),a.sub(m,m,r),a.sub(m,m,p),a.rotate(g,u,t.angle+Math.PI/2),i[0]=-g[0],i[1]=-g[1],i[2]=-a.crossLength(p,g)+a.crossLength(g,m),i[3]=g[0],i[4]=g[1],i[5]=a.crossLength(f,g)},this.equations.push(d),!i.disableRotationalLock){var y=new h(t,e,-l,l);this.equations.push(y)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof i.lowerLimit,this.upperLimitEnabled="undefined"!=typeof i.upperLimit,this.lowerLimit="undefined"!=typeof i.lowerLimit?i.lowerLimit:0,this.upperLimit="undefined"!=typeof i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new o(t,e),this.lowerLimitEquation=new o(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=l,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.motorSpeed=0;var v=this,b=this.motorEquation;b.computeGW;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,o=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,n,o,r,s)+v.motorSpeed}}var r=t("./Constraint"),o=t("../equations/ContactEquation"),s=t("../equations/Equation"),a=t("../math/vec2"),h=t("../equations/RotationalLockEquation");e.exports=n,(n.prototype=new r).constructor=n;var u=a.create(),c=a.create(),l=a.create(),d=a.create(),p=a.create(),f=a.create();n.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,n=this.lowerLimit,r=this.upperLimitEquation,o=this.lowerLimitEquation,s=this.bodyA,h=this.bodyB,m=this.localAxisA,g=this.localAnchorA,y=this.localAnchorB;e.updateJacobian(),a.rotate(u,m,s.angle),a.rotate(d,g,s.angle),a.add(c,d,s.position),a.rotate(p,y,h.angle),a.add(l,p,h.position);var v=this.position=a.dot(l,u)-a.dot(c,u);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=u[0],b[1]=u[1],b[2]=a.crossLength(u,p),b[3]=-u[0],b[4]=-u[1],b[5]=-a.crossLength(u,d)}if(this.upperLimitEnabled&&v>i)a.scale(r.normalA,u,-1),a.sub(r.contactPointA,c,s.position),a.sub(r.contactPointB,l,h.position),a.scale(f,u,i),a.add(r.contactPointA,r.contactPointA,f),-1===t.indexOf(r)&&t.push(r);else{-1!==(x=t.indexOf(r))&&t.splice(x,1)}if(this.lowerLimitEnabled&&v<n)a.scale(o.normalA,u,1),a.sub(o.contactPointA,c,s.position),a.sub(o.contactPointB,l,h.position),a.scale(f,u,n),a.sub(o.contactPointB,o.contactPointB,f),-1===t.indexOf(o)&&t.push(o);else{var x;-1!==(x=t.indexOf(o))&&t.splice(x,1)}},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.REVOLUTE,i);var n=this.maxForce="undefined"!=typeof i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=h.create(),this.pivotB=h.create(),i.worldPivot?(h.sub(this.pivotA,i.worldPivot,t.position),h.sub(this.pivotB,i.worldPivot,e.position),h.rotate(this.pivotA,this.pivotA,-t.angle),h.rotate(this.pivotB,this.pivotB,-e.angle)):(h.copy(this.pivotA,i.localPivotA),h.copy(this.pivotB,i.localPivotB));var f=this.equations=[new o(t,e,-n,n),new o(t,e,-n,n)],m=f[0],g=f[1],y=this;m.computeGq=function(){return h.rotate(u,y.pivotA,t.angle),h.rotate(c,y.pivotB,e.angle),h.add(p,e.position,c),h.sub(p,p,t.position),h.sub(p,p,u),h.dot(p,l)},g.computeGq=function(){return h.rotate(u,y.pivotA,t.angle),h.rotate(c,y.pivotB,e.angle),h.add(p,e.position,c),h.sub(p,p,t.position),h.sub(p,p,u),h.dot(p,d)},g.minForce=m.minForce=-n,g.maxForce=m.maxForce=n,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(t,e),this.lowerLimitEquation=new a(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var r=t("./Constraint"),o=t("../equations/Equation"),s=t("../equations/RotationalVelocityEquation"),a=t("../equations/RotationalLockEquation"),h=t("../math/vec2");e.exports=n;var u=h.create(),c=h.create(),l=h.fromValues(1,0),d=h.fromValues(0,1),p=h.create();(n.prototype=new r).constructor=n,n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},n.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,n=this.pivotB,r=this.equations,o=(r[0],r[1],r[0]),s=r[1],a=this.upperLimit,p=this.lowerLimit,f=this.upperLimitEquation,m=this.lowerLimitEquation,g=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&g>a)f.angle=a,-1===r.indexOf(f)&&r.push(f);else{-1!==(y=r.indexOf(f))&&r.splice(y,1)}if(this.lowerLimitEnabled&&g<p)m.angle=p,-1===r.indexOf(m)&&r.push(m);else{var y;-1!==(y=r.indexOf(m))&&r.splice(y,1)}h.rotate(u,i,t.angle),h.rotate(c,n,e.angle),o.G[0]=-1,o.G[1]=0,o.G[2]=-h.crossLength(u,l),o.G[3]=1,o.G[4]=0,o.G[5]=h.crossLength(c,l),s.G[0]=0,s.G[1]=-1,s.G[2]=-h.crossLength(u,d),s.G[3]=0,s.G[4]=1,s.G[5]=h.crossLength(c,d)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.motorIsEnabled=function(){return!!this.motorEnabled},n.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},n.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var r=t("./Equation");t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},n.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},n.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){function n(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=o.create(),this.penetrationVec=o.create(),this.contactPointB=o.create(),this.normalA=o.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var r=t("./Equation"),o=t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeB=function(t,e,i){var n=this.bodyA,r=this.bodyB,s=this.contactPointA,a=this.contactPointB,h=n.position,u=r.position,c=this.penetrationVec,l=this.normalA,d=this.G,p=o.crossLength(s,l),f=o.crossLength(a,l);d[0]=-l[0],d[1]=-l[1],d[2]=-p,d[3]=l[0],d[4]=l[1],d[5]=f,o.add(c,u,a),o.sub(c,c,h),o.sub(c,c,s);var m,g;this.firstImpact&&0!==this.restitution?(g=0,m=1/e*(1+this.restitution)*this.computeGW()):(g=o.dot(l,c)+this.offset,m=this.computeGW());return-g*t-m*e-i*this.computeGiMf()};var s=o.create(),a=o.create(),h=o.create();n.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(s,this.contactPointA),this.bodyB.getVelocityAtPoint(a,this.contactPointB),o.subtract(h,s,a),o.dot(this.normalA,h)}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){function n(t,e,i,r){this.minForce="undefined"==typeof i?-Number.MAX_VALUE:i,this.maxForce="undefined"==typeof r?Number.MAX_VALUE:r,this.bodyA=t,this.bodyB=e,this.stiffness=n.DEFAULT_STIFFNESS,this.relaxation=n.DEFAULT_RELAXATION,this.G=new o.ARRAY_TYPE(6);for(var s=0;s<6;s++)this.G[s]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=n;var r=t("../math/vec2"),o=t("../utils/Utils");t("../objects/Body");n.prototype.constructor=n,n.DEFAULT_STIFFNESS=1e6,n.DEFAULT_RELAXATION=4,n.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},n.prototype.gmult=function(t,e,i,n,r){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*n[0]+t[4]*n[1]+t[5]*r},n.prototype.computeB=function(t,e,i){var n=this.computeGW();return-this.computeGq()*t-n*e-this.computeGiMf()*i};var s=r.create(),a=r.create();n.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=(e.position,i.position,e.angle),r=i.angle;return this.gmult(t,s,n,a,r)+this.offset},n.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,o=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,n,o,r,s)+this.relativeVelocity},n.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.vlambda,r=i.vlambda,o=e.wlambda,s=i.wlambda;return this.gmult(t,n,o,r,s)};var h=r.create(),u=r.create();n.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,n=t.angularForce,o=e.force,s=e.angularForce,a=t.invMassSolve,c=e.invMassSolve,l=t.invInertiaSolve,d=e.invInertiaSolve,p=this.G;return r.scale(h,i,a),r.multiply(h,t.massMultiplier,h),r.scale(u,o,c),r.multiply(u,e.massMultiplier,u),this.gmult(p,h,n*l,u,s*d)},n.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,n=e.invMassSolve,r=t.invInertiaSolve,o=e.invInertiaSolve,s=this.G;return s[0]*s[0]*i*t.massMultiplier[0]+s[1]*s[1]*i*t.massMultiplier[1]+s[2]*s[2]*r+s[3]*s[3]*n*e.massMultiplier[0]+s[4]*s[4]*n*e.massMultiplier[1]+s[5]*s[5]*o};var c=r.create(),l=r.create(),d=r.create();r.create(),r.create(),r.create();n.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,n=c,o=l,s=d,a=e.invMassSolve,h=i.invMassSolve,u=e.invInertiaSolve,p=i.invInertiaSolve,f=this.G;o[0]=f[0],o[1]=f[1],s[0]=f[3],s[1]=f[4],r.scale(n,o,a*t),r.multiply(n,n,e.massMultiplier),r.add(e.vlambda,e.vlambda,n),e.wlambda+=u*f[2]*t,r.scale(n,s,h*t),r.multiply(n,n,i.massMultiplier),r.add(i.vlambda,i.vlambda,n),i.wlambda+=p*f[5]*t},n.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){function n(t,e,i){o.call(this,t,e,-i,i),this.contactPointA=r.create(),this.contactPointB=r.create(),this.t=r.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var r=t("../math/vec2"),o=t("./Equation");t("../utils/Utils");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},n.prototype.getSlipForce=function(){return this.maxForce},n.prototype.computeB=function(t,e,i){this.bodyA,this.bodyB;var n=this.contactPointA,o=this.contactPointB,s=this.t,a=this.G;a[0]=-s[0],a[1]=-s[1],a[2]=-r.crossLength(n,s),a[3]=s[0],a[4]=s[1],a[5]=r.crossLength(o,s);return-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var n=this.G;n[2]=1,n[5]=-1}var r=t("./Equation"),o=t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n;var s=o.create(),a=o.create(),h=o.fromValues(1,0),u=o.fromValues(0,1);n.prototype.computeGq=function(){return o.rotate(s,h,this.bodyA.angle+this.angle),o.rotate(a,u,this.bodyB.angle),o.dot(s,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){function n(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var r=t("./Equation");t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeB=function(t,e,i){var n=this.G;n[2]=-1,n[5]=this.ratio;var r=this.computeGiMf();return-this.computeGW()*e-i*r}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){var n=function(){};e.exports=n,n.prototype={constructor:n,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,n=i[t].indexOf(e);return-1!==n&&i[t].splice(n,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,n=e.length;i<n;i++){var r=e[i];r.call(r.context,t)}}return this}}},{}],27:[function(t,e,i){function n(t,e,i){if(i=i||{},!(t instanceof r&&e instanceof r))throw new Error("First two arguments must be Material instances.");this.id=n.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof i.friction?Number(i.friction):.3,this.restitution="undefined"!=typeof i.restitution?Number(i.restitution):0,this.stiffness="undefined"!=typeof i.stiffness?Number(i.stiffness):o.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof i.relaxation?Number(i.relaxation):o.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof i.frictionStiffness?Number(i.frictionStiffness):o.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof i.frictionRelaxation?Number(i.frictionRelaxation):o.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}var r=t("./Material"),o=t("../equations/Equation");e.exports=n,n.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){function n(t){this.id=t||n.idCounter++}e.exports=n,n.idCounter=0},{}],29:[function(t,e,i){var n={};n.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,n=0;n<e;n+=2)i+=(t[n+2]-t[n])*(t[n+1]+t[n+3]);return.5*-(i+=(t[0]-t[e])*(t[e+1]+t[1]))},n.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],r=[],o=0;o<e;o++)r.push(o);o=0;for(var s=e;s>3;){var a=r[(o+0)%s],h=r[(o+1)%s],u=r[(o+2)%s],c=t[2*a],l=t[2*a+1],d=t[2*h],p=t[2*h+1],f=t[2*u],m=t[2*u+1],g=!1;if(n._convex(c,l,d,p,f,m)){g=!0;for(var y=0;y<s;y++){var v=r[y];if(v!=a&&v!=h&&v!=u&&n._PointInTriangle(t[2*v],t[2*v+1],c,l,d,p,f,m)){g=!1;break}}}if(g)i.push(a,h,u),r.splice((o+1)%s,1),s--,o=0;else if(o++>3*s)break}return i.push(r[0],r[1],r[2]),i},n._PointInTriangle=function(t,e,i,n,r,o,s,a){var h=s-i,u=a-n,c=r-i,l=o-n,d=t-i,p=e-n,f=h*h+u*u,m=h*c+u*l,g=h*d+u*p,y=c*c+l*l,v=c*d+l*p,b=1/(f*y-m*m),x=(y*g-m*v)*b,_=(f*v-m*g)*b;return x>=0&&_>=0&&x+_<1},n._convex=function(t,e,i,n,r,o){return(e-n)*(r-i)+(i-t)*(o-n)>=0},e.exports=n},{}],30:[function(t,e,i){var n=e.exports={},r=t("../utils/Utils");n.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},n.crossVZ=function(t,e,i){return n.rotate(t,e,-Math.PI/2),n.scale(t,t,i),t},n.crossZV=function(t,e,i){return n.rotate(t,i,Math.PI/2),n.scale(t,t,e),t},n.rotate=function(t,e,i){if(0!==i){var n=Math.cos(i),r=Math.sin(i),o=e[0],s=e[1];t[0]=n*o-r*s,t[1]=r*o+n*s}else t[0]=e[0],t[1]=e[1]},n.rotate90cw=function(t,e){var i=e[0],n=e[1];t[0]=n,t[1]=-i},n.toLocalFrame=function(t,e,i,r){n.copy(t,e),n.sub(t,t,i),n.rotate(t,t,-r)},n.toGlobalFrame=function(t,e,i,r){n.copy(t,e),n.rotate(t,t,r),n.add(t,t,i)},n.vectorToLocalFrame=function(t,e,i){n.rotate(t,e,-i)},n.vectorToGlobalFrame=function(t,e,i){n.rotate(t,e,i)},n.centroid=function(t,e,i,r){return n.add(t,e,i),n.add(t,t,r),n.scale(t,t,1/3),t},n.create=function(){var t=new r.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var i=new r.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,i){return t[0]=e,t[1]=i,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},n.div=n.divide,n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.normalize=function(t,e){var i=e[0],n=e[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},n.lerp=function(t,e,i,n){var r=e[0],o=e[1];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t},n.reflect=function(t,e,i){var n=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*n,t[1]=e[1]-2*i[1]*n},n.getLineSegmentsIntersection=function(t,e,i,r,o){var s=n.getLineSegmentsIntersectionFraction(e,i,r,o);return!(s<0)&&(t[0]=e[0]+s*(i[0]-e[0]),t[1]=e[1]+s*(i[1]-e[1]),!0)},n.getLineSegmentsIntersectionFraction=function(t,e,i,n){var r,o,s=e[0]-t[0],a=e[1]-t[1],h=n[0]-i[0],u=n[1]-i[1];return r=(-a*(t[0]-i[0])+s*(t[1]-i[1]))/(-h*a+s*u),o=(h*(t[1]-i[1])-u*(t[0]-i[0]))/(-h*a+s*u),r>=0&&r<=1&&o>=0&&o<=1?o:-1}},{"../utils/Utils":57}],31:[function(t,e,i){function n(t){t=t||{},c.call(this),this.id=t.id||++n._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=r.create(),this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.interpolatedPosition=r.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=r.fromValues(0,0),this.previousAngle=0,this.velocity=r.fromValues(0,0),t.velocity&&r.copy(this.velocity,t.velocity),this.vlambda=r.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=r.create(),t.force&&r.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=n.STATIC,"undefined"!=typeof t.type?this.type=t.type:t.mass?this.type=n.DYNAMIC:this.type=n.STATIC,this.boundingRadius=0,this.aabb=new u,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=n.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var r=t("../math/vec2"),o=t("poly-decomp"),s=t("../shapes/Convex"),a=t("../collision/RaycastResult"),h=t("../collision/Ray"),u=t("../collision/AABB"),c=t("../events/EventEmitter");e.exports=n,(n.prototype=new c).constructor=n,n._idCounter=0,n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},n.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},n.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},n.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new u,d=r.create();n.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=d,n=this.angle,o=0;o!==e;o++){var s=t[o],a=s.angle+n;r.rotate(i,s.position,n),r.add(i,i,this.position),s.computeAABB(l,i,a),0===o?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},n.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,n=0;n!==e;n++){var o=t[n],s=r.length(o.position),a=o.boundingRadius;s+a>i&&(i=s+a)}this.boundingRadius=i},n.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?r.copy(t.position,e):r.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},n.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},n.prototype.updateMassProperties=function(){if(this.type===n.STATIC||this.type===n.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,o=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var s=0;s<e;s++){var a=t[s],h=r.squaredLength(a.position);o+=a.computeMomentOfInertia(i)+i*h}this.inertia=o,this.invInertia=o>0?1/o:0}this.invMass=1/this.mass,r.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};r.create();n.prototype.applyForce=function(t,e){if(r.add(this.force,this.force,t),e){var i=r.crossLength(e,t);this.angularForce+=i}};var p=r.create(),f=r.create(),m=r.create();n.prototype.applyForceLocal=function(t,e){e=e||m;var i=p,n=f;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyForce(i,n)};var g=r.create();n.prototype.applyImpulse=function(t,e){if(this.type===n.DYNAMIC){var i=g;if(r.scale(i,t,this.invMass),r.multiply(i,this.massMultiplier,i),r.add(this.velocity,i,this.velocity),e){var o=r.crossLength(e,t);o*=this.invInertia,this.angularVelocity+=o}}};var y=r.create(),v=r.create(),b=r.create();n.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=y,n=v;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyImpulse(i,n)},n.prototype.toLocalFrame=function(t,e){r.toLocalFrame(t,e,this.position,this.angle)},n.prototype.toWorldFrame=function(t,e){r.toGlobalFrame(t,e,this.position,this.angle)},n.prototype.vectorToLocalFrame=function(t,e){r.vectorToLocalFrame(t,e,this.angle)},n.prototype.vectorToWorldFrame=function(t,e){r.vectorToGlobalFrame(t,e,this.angle)},n.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var n=new o.Polygon;if(n.vertices=t,n.makeCCW(),"number"==typeof e.removeCollinearPoints&&n.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!n.isSimple())return!1;this.concavePath=n.vertices.slice(0);for(i=0;i<this.concavePath.length;i++){var a=[0,0];r.copy(a,this.concavePath[i]),this.concavePath[i]=a}var h;h=e.optimalDecomp?n.decomp():n.quickDecomp();var u=r.create();for(i=0;i!==h.length;i++){for(var c=new s({vertices:h[i].vertices}),l=0;l!==c.vertices.length;l++){a=c.vertices[l];r.sub(a,a,c.centerOfMass)}r.scale(u,c.centerOfMass,1),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),this.addShape(c,u)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};r.fromValues(0,0);var x=r.fromValues(0,0),_=r.fromValues(0,0),w=r.fromValues(0,0);n.prototype.adjustCenterOfMass=function(){var t=x,e=_,i=w,n=0;r.set(e,0,0);for(var o=0;o!==this.shapes.length;o++){var s=this.shapes[o];r.scale(t,s.position,s.area),r.add(e,e,t),n+=s.area}r.scale(i,e,1/n);for(o=0;o!==this.shapes.length;o++){s=this.shapes[o];r.sub(s.position,s.position,i)}r.add(this.position,this.position,i);for(o=0;this.concavePath&&o<this.concavePath.length;o++)r.sub(this.concavePath[o],this.concavePath[o],i);this.updateMassProperties(),this.updateBoundingRadius()},n.prototype.setZeroForce=function(){r.set(this.force,0,0),this.angularForce=0},n.prototype.resetConstraintVelocity=function(){var t=this.vlambda;r.set(t,0,0),this.wlambda=0},n.prototype.addConstraintVelocity=function(){var t=this.velocity;r.add(t,t,this.vlambda),this.angularVelocity+=this.wlambda},n.prototype.applyDamping=function(t){if(this.type===n.DYNAMIC){var e=this.velocity;r.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},n.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=n.AWAKE,this.idleTime=0,t!==n.AWAKE&&this.emit(n.wakeUpEvent)},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.angularVelocity=0,this.angularForce=0,r.set(this.velocity,0,0),r.set(this.force,0,0),this.emit(n.sleepEvent)},n.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==n.SLEEPING){this.wantsToSleep=!1;this.sleepState;r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=n.AWAKE):(this.idleTime+=i,this.sleepState=n.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},n.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var T=r.create(),S=r.create();n.prototype.integrate=function(t){var e=this.invMass,i=this.force,n=this.position,o=this.velocity;r.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),r.scale(T,i,t*e),r.multiply(T,this.massMultiplier,T),r.add(o,T,o),this.integrateToTimeOfImpact(t)||(r.scale(S,o,t),r.add(n,n,S),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var E=new a,C=new h({mode:h.ALL}),P=r.create(),M=r.create(),A=r.create(),R=r.create();n.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||r.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;r.normalize(P,this.velocity),r.scale(M,this.velocity,t),r.add(M,M,this.position),r.sub(A,M,this.position);var e,i=this.angularVelocity*t,n=r.length(A),o=1,s=this;if(E.reset(),C.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(M,C),r.sub(A,M,s.position),o=r.length(A)/n,t.stop())},r.copy(C.from,this.position),r.copy(C.to,M),C.update(),this.world.raycast(E,C),!e)return!1;var a=this.angle;r.copy(R,this.position);for(var h=0,u=0,c=0,l=o;l>=u&&h<this.ccdIterations;){h++,c=(l-u)/2,r.scale(S,A,o),r.add(this.position,R,S),this.angle=a+i*o,this.updateAABB();this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?u=c:l=c}return o=c,r.copy(this.position,R),this.angle=a,r.scale(S,A,o),r.add(this.position,this.position,S),this.fixedRotation||(this.angle+=i*o),!0},n.prototype.getVelocityAtPoint=function(t,e){return r.crossVZ(t,e,this.angularVelocity),r.subtract(t,this.velocity,t),t},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.wakeUpEvent={type:"wakeup"},n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){function n(t,e,i){i=i||{},o.call(this,t,e,i),this.localAnchorA=r.fromValues(0,0),this.localAnchorB=r.fromValues(0,0),i.localAnchorA&&r.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&r.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var n=r.create(),s=r.create();this.getWorldAnchorA(n),this.getWorldAnchorB(s);var a=r.distance(n,s);this.restLength="number"==typeof i.restLength?i.restLength:a}var r=t("../math/vec2"),o=t("./Spring");t("../utils/Utils");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},n.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},n.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},n.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=r.create(),a=r.create(),h=r.create(),u=r.create(),c=r.create(),l=r.create(),d=r.create(),p=r.create(),f=r.create();n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,n=this.bodyA,o=this.bodyB,m=s,g=a,y=h,v=u,b=f,x=c,_=l,w=d,T=p;this.getWorldAnchorA(x),this.getWorldAnchorB(_),r.sub(w,x,n.position),r.sub(T,_,o.position),r.sub(m,_,x);var S=r.len(m);r.normalize(g,m),r.sub(y,o.velocity,n.velocity),r.crossZV(b,o.angularVelocity,T),r.add(y,y,b),r.crossZV(b,n.angularVelocity,w),r.sub(y,y,b),r.scale(v,g,-t*(S-i)-e*r.dot(y,g)),r.sub(n.force,n.force,v),r.add(o.force,o.force,v);var E=r.crossLength(w,v),C=r.crossLength(T,v);n.angularForce-=E,o.angularForce+=C}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}t("../math/vec2");var r=t("./Spring");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,n=this.bodyA,r=this.bodyB,o=-t*(r.angle-n.angle-i)-e*(r.angularVelocity-n.angularVelocity)*0;n.angularForce-=o,r.angularForce+=o}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){function n(t,e,i){i=r.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}t("../math/vec2");var r=t("../utils/Utils");e.exports=n,n.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){function n(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new h({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function r(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=o.fromValues(0,1),e.localForwardVector&&o.copy(this.localForwardVector,e.localForwardVector),this.localPosition=o.fromValues(0,0),e.localPosition&&o.copy(this.localPosition,e.localPosition),s.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var o=t("../math/vec2"),s=(t("../utils/Utils"),t("../constraints/Constraint")),a=t("../equations/FrictionEquation"),h=t("../objects/Body");e.exports=n,n.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},n.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},n.prototype.addWheel=function(t){var e=new r(this,t);return this.wheels.push(e),e},n.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(r.prototype=new s).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},r.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var u=o.create(),c=o.create();r.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(c,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(u,c),o.dot(u,c)};var l=o.create();r.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),o.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),o.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),o.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),o.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),o.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),o.normalize(l,this.forwardEquation.t),o.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){var n=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(n,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,n=[r.fromValues(-e/2,-i/2),r.fromValues(e/2,-i/2),r.fromValues(e/2,i/2),r.fromValues(-e/2,i/2)],a=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=n,t.axes=a,t.type=o.BOX,s.call(this,t)}var r=t("../math/vec2"),o=t("./Shape"),s=t("./Convex");e.exports=n,(n.prototype=new s).constructor=n,n.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},n.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};r.create(),r.create(),r.create(),r.create();n.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},n.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=r.CAPSULE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,n=2*e;return t*(n*n+i*i)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=o.create();n.prototype.computeAABB=function(t,e,i){var n=this.radius;o.set(s,this.length/2,0),0!==i&&o.rotate(s,s,i),o.set(t.upperBound,Math.max(s[0]+n,-s[0]+n),Math.max(s[1]+n,-s[1]+n)),o.set(t.lowerBound,Math.min(s[0]-n,-s[0]-n),Math.min(s[1]-n,-s[1]-n)),o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e)};var a=o.create(),h=o.create(),u=o.create(),c=o.create(),l=o.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){for(var r=e.from,s=e.to,d=(e.direction,a),p=h,f=u,m=c,g=this.length/2,y=0;y<2;y++){var v=this.radius*(2*y-1);o.set(f,-g,v),o.set(m,g,v),o.toGlobalFrame(f,f,i,n),o.toGlobalFrame(m,m,i,n);if((x=o.getLineSegmentsIntersectionFraction(r,s,f,m))>=0&&(o.rotate(p,l,n),o.scale(p,p,2*y-1),e.reportIntersection(t,x,p,-1),t.shouldStop(e)))return}var b=Math.pow(this.radius,2)+Math.pow(g,2);for(y=0;y<2;y++){o.set(f,g*(2*y-1),0),o.toGlobalFrame(f,f,i,n);var x,_=Math.pow(s[0]-r[0],2)+Math.pow(s[1]-r[1],2),w=2*((s[0]-r[0])*(r[0]-f[0])+(s[1]-r[1])*(r[1]-f[1])),T=Math.pow(r[0]-f[0],2)+Math.pow(r[1]-f[1],2)-Math.pow(this.radius,2);if(!((x=Math.pow(w,2)-4*_*T)<0))if(0===x){if(o.lerp(d,r,s,x),o.squaredDistance(d,i)>b&&(o.sub(p,d,f),o.normalize(p,p),e.reportIntersection(t,x,p,-1),t.shouldStop(e)))return}else{var S=Math.sqrt(x),E=1/(2*_),C=(-w-S)*E,P=(-w+S)*E;if(C>=0&&C<=1&&(o.lerp(d,r,s,C),o.squaredDistance(d,i)>b&&(o.sub(p,d,f),o.normalize(p,p),e.reportIntersection(t,C,p,-1),t.shouldStop(e))))return;if(P>=0&&P<=1&&(o.lerp(d,r,s,P),o.squaredDistance(d,i)>b&&(o.sub(p,d,f),o.normalize(p,p),e.reportIntersection(t,P,p,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=r.CIRCLE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},n.prototype.computeAABB=function(t,e,i){var n=this.radius;o.set(t.upperBound,n,n),o.set(t.lowerBound,-n,-n),e&&(o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e))};var s=o.create(),a=o.create();n.prototype.raycast=function(t,e,i,n){var r=e.from,h=e.to,u=this.radius,c=Math.pow(h[0]-r[0],2)+Math.pow(h[1]-r[1],2),l=2*((h[0]-r[0])*(r[0]-i[0])+(h[1]-r[1])*(r[1]-i[1])),d=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)-Math.pow(u,2),p=Math.pow(l,2)-4*c*d,f=s,m=a;if(!(p<0))if(0===p)o.lerp(f,r,h,p),o.sub(m,f,i),o.normalize(m,m),e.reportIntersection(t,p,m,-1);else{var g=Math.sqrt(p),y=1/(2*c),v=(-l-g)*y,b=(-l+g)*y;if(v>=0&&v<=1&&(o.lerp(f,r,h,v),o.sub(m,f,i),o.normalize(m,m),e.reportIntersection(t,v,m,-1),t.shouldStop(e)))return;b>=0&&b<=1&&(o.lerp(f,r,h,b),o.sub(m,f,i),o.normalize(m,m),e.reportIntersection(t,b,m,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){function n(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var n=o.create();o.copy(n,e[i]),this.vertices.push(n)}if(this.axes=[],t.axes)for(i=0;i<t.axes.length;i++){var s=o.create();o.copy(s,t.axes[i]),this.axes.push(s)}else for(i=0;i<this.vertices.length;i++){var a=this.vertices[i],h=this.vertices[(i+1)%this.vertices.length],u=o.create();o.sub(u,h,a),o.rotate90cw(u,u),o.normalize(u,u),this.axes.push(u)}if(this.centerOfMass=o.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=r.CONVEX,r.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var r=t("./Shape"),o=t("../math/vec2"),s=t("../math/polyk");t("poly-decomp");e.exports=n,(n.prototype=new r).constructor=n;var a=o.create(),h=o.create();n.prototype.projectOntoLocalAxis=function(t,e){for(var i,n,r=null,s=null,h=(t=a,0);h<this.vertices.length;h++)i=this.vertices[h],n=o.dot(i,t),(null===r||n>r)&&(r=n),(null===s||n<s)&&(s=n);if(s>r){var u=s;s=r,r=u}o.set(e,s,r)},n.prototype.projectOntoWorldAxis=function(t,e,i,n){var r=h;this.projectOntoLocalAxis(t,n),0!==i?o.rotate(r,t,i):r=t;var s=o.dot(e,r);o.set(n,n[0]+s,n[1]+s)},n.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}var n=s.Triangulate(t);for(e=0;e<n.length;e+=3){var r=n[e],o=n[e+1],a=n[e+2];this.triangles.push([r,o,a])}};var u=o.create(),c=o.create(),l=o.create(),d=o.create(),p=o.create();o.create(),o.create(),o.create(),o.create();n.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,r=u,s=l,a=d,h=p,f=c;o.set(i,0,0);for(var m=0,g=0;g!==t.length;g++){var y=t[g];s=e[y[0]],a=e[y[1]],h=e[y[2]];o.centroid(r,s,a,h);var v=n.triangleArea(s,a,h);m+=v,o.scale(f,r,v),o.add(i,i,f)}o.scale(i,i,1/m)},n.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,n=this.vertices.length,r=n-1,s=0;s<n;r=s,s++){var a=this.vertices[r],h=this.vertices[s],u=Math.abs(o.crossLength(a,h));e+=u*(o.dot(h,h)+o.dot(h,a)+o.dot(a,a)),i+=u}return t/6*(e/i)},n.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var n=o.squaredLength(t[i]);n>e&&(e=n)}this.boundingRadius=Math.sqrt(e)},n.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},n.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var r=t[i],o=e[r[0]],s=e[r[1]],a=e[r[2]],h=n.triangleArea(o,s,a);this.area+=h}},n.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var f=o.create(),m=o.create(),g=o.create();n.prototype.raycast=function(t,e,i,n){var r=f,s=m,a=g,h=this.vertices;o.toLocalFrame(r,e.from,i,n),o.toLocalFrame(s,e.to,i,n);for(var u=h.length,c=0;c<u&&!t.shouldStop(e);c++){var l=h[c],d=h[(c+1)%u],p=o.getLineSegmentsIntersectionFraction(r,s,l,d);p>=0&&(o.sub(a,d,l),o.rotate(a,a,-Math.PI/2+n),o.normalize(a,a),e.reportIntersection(t,p,a,c))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){function n(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=r.HEIGHTFIELD,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");t("../utils/Utils");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],n=0;n!==t.length;n++){var r=t[n];r>e&&(e=r),r<i&&(i=r)}this.maxValue=e,this.minValue=i},n.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var s=[o.create(),o.create(),o.create(),o.create()];n.prototype.computeAABB=function(t,e,i){o.set(s[0],0,this.maxValue),o.set(s[1],this.elementWidth*this.heights.length,this.maxValue),o.set(s[2],this.elementWidth*this.heights.length,this.minValue),o.set(s[3],0,this.minValue),t.setFromPoints(s,e,i)},n.prototype.getLineSegment=function(t,e,i){var n=this.heights,r=this.elementWidth;o.set(t,i*r,n[i]),o.set(e,(i+1)*r,n[i+1])},n.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},n.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};o.create();var a=o.create(),h=o.create(),u=o.create(),c=o.create(),l=o.create();o.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,d=(e.direction,a),p=h,f=u,m=c,g=l;o.toLocalFrame(m,r,i,n),o.toLocalFrame(g,s,i,n);var y=this.getClampedSegmentIndex(m),v=this.getClampedSegmentIndex(g);if(y>v){var b=y;y=v,v=b}for(var x=0;x<this.heights.length-1;x++){this.getLineSegment(p,f,x);var _=o.getLineSegmentsIntersectionFraction(m,g,p,f);if(_>=0&&(o.sub(d,f,p),o.rotate(d,d,n+Math.PI/2),o.normalize(d,d),e.reportIntersection(t,_,d,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=r.LINE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[o.create(),o.create()];n.prototype.computeAABB=function(t,e,i){var n=this.length/2;o.set(s[0],-n,0),o.set(s[1],n,0),t.setFromPoints(s,e,i,0)};o.create();var a=o.create(),h=o.create(),u=o.create(),c=o.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,l=h,d=u,p=this.length/2;o.set(l,-p,0),o.set(d,p,0),o.toGlobalFrame(l,l,i,n),o.toGlobalFrame(d,d,i,n);var f=o.getLineSegmentsIntersectionFraction(l,d,r,s);if(f>=0){var m=a;o.rotate(m,c,n),e.reportIntersection(t,f,m,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){function n(t){(t=t||{}).type=r.PARTICLE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=0},n.prototype.computeAABB=function(t,e,i){o.copy(t.lowerBound,e),o.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){function n(t){(t=t||{}).type=r.PLANE,r.call(this,t)}var r=t("./Shape"),o=t("../math/vec2");t("../utils/Utils");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.computeAABB=function(t,e,i){var n=i%(2*Math.PI),r=o.set,s=t.lowerBound,a=t.upperBound;r(s,-1e7,-1e7),r(a,1e7,1e7),0===n?a[1]=0:n===Math.PI/2?s[0]=0:n===Math.PI?s[1]=0:n===3*Math.PI/2&&(a[0]=0)},n.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var s=o.create(),a=(o.create(),o.create(),o.create()),h=o.create();n.prototype.raycast=function(t,e,i,n){var r=e.from,u=e.to,c=e.direction,l=s,d=a,p=h;o.set(d,0,1),o.rotate(d,d,n),o.sub(p,r,i);var f=o.dot(p,d);o.sub(p,u,i);if(!(f*o.dot(p,d)>0||o.squaredDistance(r,u)<f*f)){var m=o.dot(d,c);o.sub(l,r,i);var g=-o.dot(d,l)/m/e.length;e.reportIntersection(t,g,d,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){function n(t){t=t||{},this.body=null,this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=n.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=n;var r=t("../math/vec2");n.idCounter=0,n.CIRCLE=1,n.PARTICLE=2,n.PLANE=4,n.CONVEX=8,n.LINE=16,n.BOX=32,Object.defineProperty(n,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),n.BOX}}),n.CAPSULE=64,n.HEIGHTFIELD=128,n.prototype.computeMomentOfInertia=function(t){},n.prototype.updateBoundingRadius=function(){},n.prototype.updateArea=function(){},n.prototype.computeAABB=function(t,e,i){},n.prototype.raycast=function(t,e,i,n){}},{"../math/vec2":30}],46:[function(t,e,i){function n(t){o.call(this,t,o.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new s.ARRAY_TYPE(this.arrayStep),this.Bs=new s.ARRAY_TYPE(this.arrayStep),this.invCs=new s.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}var r=t("../math/vec2"),o=t("./Solver"),s=t("../utils/Utils"),a=t("../equations/FrictionEquation");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.solve=function(t,e){this.sortEquations();var i=0,o=this.iterations,h=this.frictionIterations,u=this.equations,c=u.length,l=Math.pow(this.tolerance*c,2),d=e.bodies,p=e.bodies.length,f=(r.add,r.set,this.useZeroRHS),m=this.lambda;if(this.usedIterations=0,c)for(var g=0;g!==p;g++){d[g].updateSolveMassProperties()}m.length<c&&(m=this.lambda=new s.ARRAY_TYPE(c+this.arrayStep),this.Bs=new s.ARRAY_TYPE(c+this.arrayStep),this.invCs=new s.ARRAY_TYPE(c+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(m);var y=this.invCs,v=this.Bs;for(m=this.lambda,g=0;g!==u.length;g++){((b=u[g]).timeStep!==t||b.needsUpdate)&&(b.timeStep=t,b.update()),v[g]=b.computeB(b.a,b.b,t),y[g]=b.computeInvC(b.epsilon)}var b,x,_;if(0!==c){for(g=0;g!==p;g++){d[g].resetConstraintVelocity()}if(h){for(i=0;i!==h;i++){for(x=0,_=0;_!==c;_++){b=u[_];var w=n.iterateEquation(_,b,b.epsilon,v,y,m,f,t,i);x+=Math.abs(w)}if(this.usedIterations++,x*x<=l)break}for(n.updateMultipliers(u,m,1/t),_=0;_!==c;_++){var T=u[_];if(T instanceof a){for(var S=0,E=0;E!==T.contactEquations.length;E++)S+=T.contactEquations[E].multiplier;S*=T.frictionCoefficient/T.contactEquations.length,T.maxForce=S,T.minForce=-S}}}for(i=0;i!==o;i++){for(x=0,_=0;_!==c;_++){b=u[_];w=n.iterateEquation(_,b,b.epsilon,v,y,m,f,t,i);x+=Math.abs(w)}if(this.usedIterations++,x*x<=l)break}for(g=0;g!==p;g++)d[g].addConstraintVelocity();n.updateMultipliers(u,m,1/t)}},n.updateMultipliers=function(t,e,i){for(var n=t.length;n--;)t[n].multiplier=e[n]*i},n.iterateEquation=function(t,e,i,n,r,o,s,a,h){var u=n[t],c=r[t],l=o[t],d=e.computeGWlambda(),p=e.maxForce,f=e.minForce;s&&(u=0);var m=c*(u-d-i*l),g=l+m;return g<f*a?m=f*a-l:g>p*a&&(m=p*a-l),o[t]+=m,e.addToWlambda(m),m}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){function n(t,e){t=t||{},r.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}t("../utils/Utils");var r=t("../events/EventEmitter");e.exports=n,(n.prototype=new r).constructor=n,n.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),o.bodies.length=0,e.getBodies(o.bodies),o.bodies.length&&this.solve(t,o))},n.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},n.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},n.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var n=t[e];n.enabled&&this.equations.push(n)}},n.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},n.prototype.removeAllEquations=function(){this.equations.length=0},n.GS=1,n.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../equations/ContactEquation"),o=t("./Pool");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../equations/FrictionEquation"),o=t("./Pool");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../world/IslandNode"),o=t("./Pool");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("../world/Island"),o=t("./Pool");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){function n(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new o({size:16}),this.tmpDict=new r,this.tmpArray1=[]}var r=t("./TupleDictionary"),o=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");e.exports=n,n.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var n=t.keys[i],r=t.getByKey(n);e.getByKey(n);r&&this.recordPool.release(r)}t.reset(),t.copy(e),e.reset()},n.prototype.setOverlapping=function(t,e,i,n){this.overlappingShapesLastState;var r=this.overlappingShapesCurrentState;if(!r.get(e.id,n.id)){var o=this.recordPool.get();o.set(t,e,i,n),r.set(e.id,n.id,o)}},n.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},n.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},n.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,n=i.keys.length;n--;){var r=i.keys[n],o=i.data[r];if(o.bodyA===t&&o.bodyB===e||o.bodyA===e&&o.bodyB===t)return!0}return!1},n.prototype.getDiff=function(t,e,i){var n=t,r=e;(i=i||[]).length=0;for(var o=r.keys.length;o--;){var s=r.keys[o],a=r.data[s];if(!a)throw new Error("Key "+s+" had no data!");n.data[s]||i.push(a)}return i},n.prototype.isNewOverlap=function(t,e){var i=0|t.id,n=0|e.id,r=this.overlappingShapesLastState,o=this.overlappingShapesCurrentState;return!r.get(i,n)&&!!o.get(i,n)},n.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,n=t.length;n--;){var r=t[n];i.set(0|r.bodyA.id,0|r.bodyB.id,r)}for(n=i.keys.length;n--;){(r=i.getByKey(i.keys[n]))&&e.push(r.bodyA,r.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){function n(t,e,i,n){this.shapeA=e,this.shapeB=n,this.bodyA=t,this.bodyB=i}e.exports=n,n.prototype.set=function(t,e,i,r){n.call(this,t,e,i,r)}},{}],54:[function(t,e,i){function n(){o.apply(this,arguments)}var r=t("./OverlapKeeperRecord"),o=t("./Pool");e.exports=n,(n.prototype=new o).constructor=n,n.prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){function n(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=n,n.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},n.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},n.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e,i){function n(){this.data={},this.keys=[]}var r=t("./Utils");e.exports=n,n.prototype.getKey=function(t,e){return t|=0,e|=0,(0|t)==(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},n.prototype.getByKey=function(t){return t|=0,this.data[t]},n.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},n.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var n=this.getKey(t,e);return this.data[n]||this.keys.push(n),this.data[n]=i,n},n.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},n.prototype.copy=function(t){this.reset(),r.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){function n(){}e.exports=n,n.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,n=e.length;i!==n;++i)t.push(e[i])},n.splice=function(t,e,i){i=i||1;for(var n=e,r=t.length-i;n<r;n++)t[n]=t[n+i];t.length=r},n.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,n.extend=function(t,e){for(var i in e)t[i]=e[i]},n.defaults=function(t,e){t=t||{};for(var i in e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e,i){function n(){this.equations=[],this.bodies=[]}var r=t("../objects/Body");e.exports=n,n.prototype.reset=function(){this.equations.length=this.bodies.length=0};var o=[];n.prototype.getBodies=function(t){var e=t||[],i=this.equations;o.length=0;for(var n=0;n!==i.length;n++){var r=i[n];-1===o.indexOf(r.bodyA.id)&&(e.push(r.bodyA),o.push(r.bodyA.id)),-1===o.indexOf(r.bodyB.id)&&(e.push(r.bodyB),o.push(r.bodyB.id))}return e},n.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===r.DYNAMIC&&!e.wantsToSleep)return!1}return!0},n.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){this.bodies[t].sleep()}return!0}},{"../objects/Body":31}],59:[function(t,e,i){function n(t){this.nodePool=new r({size:16}),this.islandPool=new o({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}t("../math/vec2"),t("./Island"),t("./IslandNode");var r=t("./../utils/IslandNodePool"),o=t("./../utils/IslandPool"),s=t("../objects/Body");e.exports=n,n.getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var n=t[i];if(!n.visited&&n.body.type===s.DYNAMIC)return n}return!1},n.prototype.visit=function(t,e,i){e.push(t.body);for(var n=t.equations.length,r=0;r!==n;r++){var o=t.equations[r];-1===i.indexOf(o)&&i.push(o)}},n.prototype.bfs=function(t,e,i){var r=this.queue;for(r.length=0,r.push(t),t.visited=!0,this.visit(t,e,i);r.length;)for(var o,a=r.pop();o=n.getUnvisitedNode(a.neighbors);)o.visited=!0,this.visit(o,e,i),o.body.type===s.DYNAMIC&&r.push(o)},n.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,r=this.equations;i.length;)this.nodePool.release(i.pop());for(var o=0;o!==e.length;o++){var s=this.nodePool.get();s.body=e[o],i.push(s)}for(var a=0;a!==r.length;a++){var h=r[a],u=(o=e.indexOf(h.bodyA),e.indexOf(h.bodyB)),c=i[o],l=i[u];c.neighbors.push(l),l.neighbors.push(c),c.equations.push(h),l.equations.push(h)}var d=this.islands;for(o=0;o<d.length;o++)this.islandPool.release(d[o]);d.length=0;for(var p;p=n.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(p,f.bodies,f.equations),d.push(f)}return d}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){function n(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=n,n.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e,i){function n(t){l.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new r,this.narrowphase=new y(this),this.islandManager=new x,this.gravity=o.fromValues(0,-9.78),t.gravity&&o.copy(this.gravity,t.gravity),this.frictionGravity=o.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new g,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new p,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"==typeof t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=n.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new b}var r=t("../solver/GSSolver"),o=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),s=t("../shapes/Circle"),a=t("../shapes/Convex"),h=(t("../shapes/Line"),t("../shapes/Plane")),u=t("../shapes/Capsule"),c=t("../shapes/Particle"),l=t("../events/EventEmitter"),d=t("../objects/Body"),p=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),f=t("../material/ContactMaterial"),m=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),g=t("../collision/SAPBroadphase"),y=t("../collision/Narrowphase"),v=t("../utils/Utils"),b=t("../utils/OverlapKeeper"),x=t("./IslandManager");t("../objects/RotationalSpring");e.exports=n,(n.prototype=new Object(l.prototype)).constructor=n,n.NO_SLEEPING=1,n.BODY_SLEEPING=2,n.ISLAND_SLEEPING=4,n.prototype.addConstraint=function(t){this.constraints.push(t)},n.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},n.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&v.splice(this.contactMaterials,e,1)},n.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,n=0,r=i.length;n!==r;n++){var o=i[n];if(o.materialA.id===t.id&&o.materialB.id===e.id||o.materialA.id===e.id&&o.materialB.id===t.id)return o}return!1},n.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&v.splice(this.constraints,e,1)};o.create(),o.create(),o.create(),o.create(),o.create(),o.create();var _=o.create(),w=o.fromValues(0,0),T=o.fromValues(0,0);o.fromValues(0,0),o.fromValues(0,0);n.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var n=0;this.accumulator>=t&&n<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,n++;for(var r=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var a=this.bodies[s];o.lerp(a.interpolatedPosition,a.previousPosition,a.position,r),a.interpolatedAngle=a.previousAngle+r*(a.angle-a.previousAngle)}}};var S=[];n.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,r=this.bodies,s=this.gravity,a=this.solver,h=this.bodies.length,u=this.broadphase,c=this.narrowphase,l=this.constraints,p=_,f=(o.scale,o.add),m=(o.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var g=o.length(this.gravity);0===g&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=g)}if(this.applyGravity)for(var y=0;y!==h;y++){var b=(x=r[y]).force;x.type===d.DYNAMIC&&x.sleepState!==d.SLEEPING&&(o.scale(p,s,x.mass*x.gravityScale),f(b,b,p))}if(this.applySpringForces)for(y=0;y!==e;y++){i[y].applyForce()}if(this.applyDamping)for(y=0;y!==h;y++){var x;(x=r[y]).type===d.DYNAMIC&&x.applyDamping(t)}var w=u.getCollisionPairs(this),T=this.disabledBodyCollisionPairs;for(y=T.length-2;y>=0;y-=2)for(var E=w.length-2;E>=0;E-=2)(T[y]===w[E]&&T[y+1]===w[E+1]||T[y+1]===w[E]&&T[y]===w[E+1])&&w.splice(E,2);var C=l.length;for(y=0;y!==C;y++){var P=l[y];if(!P.collideConnected)for(E=w.length-2;E>=0;E-=2)(P.bodyA===w[E]&&P.bodyB===w[E+1]||P.bodyB===w[E]&&P.bodyA===w[E+1])&&w.splice(E,2)}this.postBroadphaseEvent.pairs=w,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,c.reset(this);y=0;for(var M=w.length;y!==M;y+=2)for(var A=w[y],R=w[y+1],L=0,O=A.shapes.length;L!==O;L++)for(var I=A.shapes[L],B=I.position,k=I.angle,D=0,F=R.shapes.length;D!==F;D++){var U=R.shapes[D],N=U.position,G=U.angle,j=this.defaultContactMaterial;if(I.material&&U.material){var V=this.getContactMaterial(I.material,U.material);V&&(j=V)}this.runNarrowphase(c,A,I,B,k,R,U,N,G,j,this.frictionGravity)}for(y=0;y!==h;y++){(X=r[y])._wakeUpAfterNarrowphase&&(X.wakeUp(),X._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(S);var H=this.endContactEvent;for(D=S.length;D--;){var z=S[D];H.shapeA=z.shapeA,H.shapeB=z.shapeB,H.bodyA=z.bodyA,H.bodyB=z.bodyB,this.emit(H)}S.length=0}var W=this.preSolveEvent;W.contactEquations=c.contactEquations,W.frictionEquations=c.frictionEquations,this.emit(W),W.contactEquations=W.frictionEquations=null;C=l.length;for(y=0;y!==C;y++)l[y].update();if(c.contactEquations.length||c.frictionEquations.length||C)if(this.islandSplit){for(m.equations.length=0,v.appendArray(m.equations,c.contactEquations),v.appendArray(m.equations,c.frictionEquations),y=0;y!==C;y++)v.appendArray(m.equations,l[y].equations);m.split(this);for(y=0;y!==m.islands.length;y++){(K=m.islands[y]).equations.length&&a.solveIsland(t,K)}}else{for(a.addEquations(c.contactEquations),a.addEquations(c.frictionEquations),y=0;y!==C;y++)a.addEquations(l[y].equations);this.solveConstraints&&a.solve(t,this),a.removeAllEquations()}for(y=0;y!==h;y++){var X;(X=r[y]).integrate(t)}for(y=0;y!==h;y++)r[y].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var q=this.impactEvent;for(y=0;y!==c.contactEquations.length;y++){var Y=c.contactEquations[y];Y.firstImpact&&(q.bodyA=Y.bodyA,q.bodyB=Y.bodyB,q.shapeA=Y.shapeA,q.shapeB=Y.shapeB,q.contactEquation=Y,this.emit(q))}}if(this.sleepMode===n.BODY_SLEEPING)for(y=0;y!==h;y++)r[y].sleepTick(this.time,!1,t);else if(this.sleepMode===n.ISLAND_SLEEPING&&this.islandSplit){for(y=0;y!==h;y++)r[y].sleepTick(this.time,!0,t);for(y=0;y<this.islandManager.islands.length;y++){var K;(K=this.islandManager.islands[y]).wantsToSleep()&&K.sleep()}}this.stepping=!1;var Z=this.bodiesToBeRemoved;for(y=0;y!==Z.length;y++)this.removeBody(Z[y]);Z.length=0,this.emit(this.postStepEvent)},n.prototype.runNarrowphase=function(t,e,i,n,r,s,a,h,u,c,l){if(0!=(i.collisionGroup&a.collisionMask)&&0!=(a.collisionGroup&i.collisionMask)){o.rotate(w,n,e.angle),o.rotate(T,h,s.angle),o.add(w,w,e.position),o.add(T,T,s.position);var p=r+e.angle,f=u+s.angle;t.enableFriction=c.friction>0,t.frictionCoefficient=c.friction;var m;m=e.type===d.STATIC||e.type===d.KINEMATIC?s.mass:s.type===d.STATIC||s.type===d.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass),t.slipForce=c.friction*l*m,t.restitution=c.restitution,t.surfaceVelocity=c.surfaceVelocity,t.frictionStiffness=c.frictionStiffness,t.frictionRelaxation=c.frictionRelaxation,t.stiffness=c.stiffness,t.relaxation=c.relaxation,t.contactSkinSize=c.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&i.collisionResponse&&a.collisionResponse;var g=t[i.type|a.type],y=0;if(g){var v=i.sensor||a.sensor,b=t.frictionEquations.length;y=i.type<a.type?g.call(t,e,i,w,p,s,a,T,f,v):g.call(t,s,a,T,f,e,i,w,p,v);var x=t.frictionEquations.length-b;if(y){if(e.allowSleep&&e.type===d.DYNAMIC&&e.sleepState===d.SLEEPING&&s.sleepState===d.AWAKE&&s.type!==d.STATIC){o.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2)>=2*Math.pow(s.sleepSpeedLimit,2)&&(e._wakeUpAfterNarrowphase=!0)}if(s.allowSleep&&s.type===d.DYNAMIC&&s.sleepState===d.SLEEPING&&e.sleepState===d.AWAKE&&e.type!==d.STATIC){o.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2)>=2*Math.pow(e.sleepSpeedLimit,2)&&(s._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,i,s,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,a)){var _=this.beginContactEvent;if(_.shapeA=i,_.shapeB=a,_.bodyA=e,_.bodyB=s,_.contactEquations.length=0,"number"==typeof y)for(var S=t.contactEquations.length-y;S<t.contactEquations.length;S++)_.contactEquations.push(t.contactEquations[S]);this.emit(_)}if("number"==typeof y&&x>1)for(S=t.frictionEquations.length-x;S<t.frictionEquations.length;S++){var E=t.frictionEquations[S];E.setSlipForce(E.getSlipForce()/x)}}}}},n.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},n.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&v.splice(this.springs,e,1)},n.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},n.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(v.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},n.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}return!1},n.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},n.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,n=0;n<i.length;n+=2)if(i[n]===t&&i[n+1]===e||i[n+1]===t&&i[n]===e)return void i.splice(n,2)},n.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);var i=this.bodies;for(e=i.length-1;e>=0;e--)this.removeBody(i[e]);var r=this.springs;for(e=r.length-1;e>=0;e--)this.removeSpring(r[e]);var o=this.contactMaterials;for(e=o.length-1;e>=0;e--)this.removeContactMaterial(o[e]);n.apply(this)};var E=o.create(),C=(o.fromValues(0,0),o.fromValues(0,0));n.prototype.hitTest=function(t,e,i){i=i||0;var n=new d({position:t}),r=new c,l=t,p=E,f=C;n.addShape(r);for(var m=this.narrowphase,g=[],y=0,v=e.length;y!==v;y++)for(var b=e[y],x=0,_=b.shapes.length;x!==_;x++){var w=b.shapes[x];o.rotate(p,w.position,b.angle),o.add(p,p,b.position);var T=w.angle+b.angle;(w instanceof s&&m.circleParticle(b,w,p,T,n,r,l,0,!0)||w instanceof a&&m.particleConvex(n,r,l,0,b,w,p,T,!0)||w instanceof h&&m.particlePlane(n,r,l,0,b,w,p,T,!0)||w instanceof u&&m.particleCapsule(n,r,l,0,b,w,p,T,!0)||w instanceof c&&o.squaredLength(o.sub(f,p,t))<i*i)&&g.push(b)}return g},n.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var n=e[i],r=0;r!==n.equations.length;r++){var o=n.equations[r];o.stiffness=t,o.needsUpdate=!0}var s=this.contactMaterials;for(i=0;i!==s.length;i++){(n=s[i]).stiffness=n.frictionStiffness=t}(n=this.defaultContactMaterial).stiffness=n.frictionStiffness=t},n.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.relaxation=t,r.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++){(i=this.contactMaterials[e]).relaxation=i.frictionRelaxation=t}(i=this.defaultContactMaterial).relaxation=i.frictionRelaxation=t};var P=new m,M=[];n.prototype.raycast=function(t,e){return e.getAABB(P),this.broadphase.aabbQuery(this,P,M),e.intersectBodies(t,M),M.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)}),(function(){function i(t,e,i,o,s){var a=t.createFramebuffer(),h=t.createRenderbuffer(),u=null,c=0;return t.activeTexture(t.TEXTURE0+s),t.bindFramebuffer(t.FRAMEBUFFER,a),t.bindRenderbuffer(t.RENDERBUFFER,h),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),u=function(t,e,i,r){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),o}(t,e,i,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,u,0),(c=t.checkFramebufferStatus(t.FRAMEBUFFER))!==t.FRAMEBUFFER_COMPLETE&&console.error("Incomplete GL framebuffer. ",r[c]),a.width=e,a.height=i,a.targetTexture=u,a.renderBuffer=h,a}var n=n||{};n.DisplayObject=function(){this.position=new n.Point(0,0),this.scale=new n.Point(1,1),this.pivot=new n.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new Phaser.Matrix,this.worldPosition=new n.Point(0,0),this.worldScale=new n.Point(1,1),this.worldRotation=0,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new n.Rectangle(0,0,0,0),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},n.DisplayObject.prototype={constructor:n.DisplayObject,destroy:function(){if(this.children){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.worldTransform=null,this.filterArea=null,this.renderable=!1,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite()},updateTransform:function(t){if(!t&&!this.parent&&!this.game)return this;var e=this.parent;t?e=t:this.parent||(e=this.game.world);var i,n,r,o,s,a,h=e.worldTransform,u=this.worldTransform;this.rotation%Phaser.Math.PI2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),i=this._cr*this.scale.x,n=this._sr*this.scale.x,r=-this._sr*this.scale.y,o=this._cr*this.scale.y,s=this.position.x,a=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*i+this.pivot.y*r,a-=this.pivot.x*n+this.pivot.y*o),u.a=i*h.a+n*h.c,u.b=i*h.b+n*h.d,u.c=r*h.a+o*h.c,u.d=r*h.b+o*h.d,u.tx=s*h.a+a*h.c+h.tx,u.ty=s*h.b+a*h.d+h.ty):(i=this.scale.x,n=0,r=0,o=this.scale.y,s=this.position.x-this.pivot.x*i,a=this.position.y-this.pivot.y*o,u.a=i*h.a,u.b=i*h.b,u.c=o*h.c,u.d=o*h.d,u.tx=s*h.a+a*h.c+h.tx,u.ty=s*h.b+a*h.d+h.ty),i=u.a,n=u.b,r=u.c;var c=i*(o=u.d)-n*r;if(i||n){var l=Math.sqrt(i*i+n*n);this.worldRotation=n>0?Math.acos(i/l):-Math.acos(i/l),this.worldScale.x=l,this.worldScale.y=c/l}else if(r||o){var d=Math.sqrt(r*r+o*o);this.worldRotation=Phaser.Math.HALF_PI-(o>0?Math.acos(-r/d):-Math.acos(r/d)),this.worldScale.x=c/d,this.worldScale.y=d}else this.worldScale.x=0,this.worldScale.y=0;return this.worldAlpha=this.alpha*e.worldAlpha,this.worldPosition.x=u.tx,this.worldPosition.y=u.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,u,h),this},preUpdate:function(){},generateTexture:function(t,e,i){var r=this.getLocalBounds(),o=new Phaser.RenderTexture(this.game,0|r.width,0|r.height,i,e,t);return n.DisplayObject._tempMatrix.tx=-r.x,n.DisplayObject._tempMatrix.ty=-r.y,o.render(this,n.DisplayObject._tempMatrix),o},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(t){return this.updateTransform(),this.worldTransform.apply(t)},toLocal:function(t,e){return e&&(t=e.toGlobal(t)),this.updateTransform(),this.worldTransform.applyInverse(t)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(t.width=Math.max(1,Math.ceil(t.width)),t.height=Math.max(1,Math.ceil(t.height)),this.updateTransform(),this._cachedSprite)this._cachedSprite.texture.resize(t.width,t.height);else{var e=0;this.texture&&this.texture.baseTexture&&n._enableMultiTextureToggle&&(e=this.texture.baseTexture.textureIndex);var i=new Phaser.RenderTexture(this.game,t.width,t.height,void 0,void 0,void 0,void 0,e);this._cachedSprite=new n.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var r=this._filters;this._filters=null,this._cachedSprite.filters=r,n.DisplayObject._tempMatrix.tx=-t.x,n.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,n.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._filters=r,this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}},n.DisplayObject.prototype.displayObjectUpdateTransform=n.DisplayObject.prototype.updateTransform,Object.defineProperties(n.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(this.visible){var t=this.parent;if(!t)return this.visible;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}return!1}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,t&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)for(var r=t[i].passes,o=0;o<r.length;o++)e.push(r[o]);this._filterBlock={target:this,filterPasses:e}}this._filters=t,this.blendMode&&this.blendMode===n.blendModes.MULTIPLY&&(this.blendMode=n.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}}),n.DisplayObjectContainer=function(){n.DisplayObject.call(this),this.children=[],this.ignoreChildInput=!1},n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype),n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer,n.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},n.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},n.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(i<0||n<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[n]=t}},n.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},n.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},n.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},n.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},n.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(e.parent=void 0,this.children.splice(t,1)),e},n.DisplayObjectContainer.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var i=e-t;if(i>0&&i<=e){for(var n=this.children.splice(t,i),r=0;r<n.length;r++){n[r].parent=void 0}return n}if(0===i&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},n.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=n.DisplayObjectContainer.prototype.updateTransform,n.DisplayObjectContainer.prototype.getBounds=function(t){var e=t&&t instanceof n.DisplayObject,i=!0;e?i=t instanceof n.DisplayObjectContainer&&t.contains(this):t=this;var r;if(e){var o=t.worldTransform;for(t.worldTransform=Phaser.identityMatrix,r=0;r<t.children.length;r++)t.children[r].updateTransform()}var s,a,h,u=1/0,c=1/0,l=-1/0,d=-1/0,p=!1;for(r=0;r<this.children.length;r++){this.children[r].visible&&(p=!0,u=u<(s=this.children[r].getBounds()).x?u:s.x,c=c<s.y?c:s.y,a=s.width+s.x,h=s.height+s.y,l=l>a?l:a,d=d>h?d:h)}var f=this._bounds;if(!p){var m=(f=new n.Rectangle).x,g=f.width+f.x,y=f.y,v=f.height+f.y,b=this.worldTransform,x=b.a,_=b.b,w=b.c,T=b.d,S=b.tx,E=b.ty,C=x*g+w*v+S,P=T*v+_*g+E,M=x*m+w*v+S,A=T*v+_*m+E,R=x*m+w*y+S,L=T*y+_*m+E,O=x*g+w*y+S,I=T*y+_*g+E;l=C,d=P,c=P,u=O<(u=R<(u=M<(u=C)?M:u)?R:u)?O:u,c=I<(c=L<(c=A<c?A:c)?L:c)?I:c,l=O>(l=R>(l=M>l?M:l)?R:l)?O:l,d=I>(d=L>(d=A>d?A:d)?L:d)?I:d}if(f.x=u,f.y=c,f.width=l-u,f.height=d-c,e)for(t.worldTransform=o,r=0;r<t.children.length;r++)t.children[r].updateTransform();if(!i){var B=t.getBounds();f.x-=B.x,f.y-=B.y}return f},n.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},n.DisplayObjectContainer.prototype.contains=function(t){return!!t&&(t===this||this.contains(t.parent))},n.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else{var e;if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t)}},n.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0;e<this.children.length;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Object.defineProperty(n.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(n.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),n.Sprite=function(t){n.DisplayObjectContainer.call(this),this.anchor=new n.Point(n.Sprite.defaultAnchor.x,n.Sprite.defaultAnchor.y),this.texture=t||n.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=n.blendModes.NORMAL,this.shader=null,this.exists=!0,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},n.Sprite.defaultAnchor={x:0,y:0},n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Sprite.prototype.constructor=n.Sprite,Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),n.Sprite.prototype.setTexture=function(t,e){e&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=t,this.texture.valid=!0,this.cachedTint=-1},n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},n.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,o=i*(1-this.anchor.y),s=i*-this.anchor.y,a=t||this.worldTransform,h=a.a,u=a.b,c=a.c,l=a.d,d=a.tx,p=a.ty,f=-1/0,m=-1/0,g=1/0,y=1/0;if(0===u&&0===c){if(h<0){h*=-1;var v=n;n=-r,r=-v}if(l<0){l*=-1;v=o;o=-s,s=-v}g=h*r+d,f=h*n+d,y=l*s+p,m=l*o+p}else{var b=h*r+c*s+d,x=l*s+u*r+p,_=h*n+c*s+d,w=l*s+u*n+p,T=h*n+c*o+d,S=l*o+u*n+p,E=h*r+c*o+d,C=l*o+u*r+p;g=E<(g=T<(g=_<(g=b<g?b:g)?_:g)?T:g)?E:g,y=C<(y=S<(y=w<(y=x<y?x:y)?w:y)?S:y)?C:y,f=E>(f=T>(f=_>(f=b>f?b:f)?_:f)?T:f)?E:f,m=C>(m=S>(m=w>(m=x>m?x:m)?w:m)?S:m)?C:m}var P=this._bounds;return P.x=g,P.width=f-g,P.y=y,P.height=m-y,this._currentBounds=P,P},n.Sprite.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=Phaser.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var i=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return i},n.Sprite.prototype._renderWebGL=function(t,e){if(this.visible&&!(this.alpha<=0)&&this.renderable){var i=this.worldTransform;if(e&&(i=e),this._mask||this._filters){var n=t.spriteBatch;this._filters&&(n.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.stop(),t.maskManager.pushMask(this.mask,t),n.start()),n.render(this);for(var r=0;r<this.children.length;r++)this.children[r]._renderWebGL(t);n.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),n.start()}else{t.spriteBatch.render(this);for(r=0;r<this.children.length;r++)this.children[r]._renderWebGL(t,i)}}},n.Sprite.prototype._renderCanvas=function(t,e){if(!(!this.visible||0===this.alpha||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){var i=this.worldTransform;if(e&&(i=e),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var r=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===n.scaleModes.LINEAR);var o=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,s=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,a=i.tx*t.resolution+t.shakeX,h=i.ty*t.resolution+t.shakeY,u=this.texture.crop.width,c=this.texture.crop.height;if(this.texture.rotated){var l=i.a,d=i.b,p=i.c,f=i.d,m=u;a=i.c*c+a,h=i.d*c+h,i.a=6.123233995736766e-17*l-p,i.b=6.123233995736766e-17*d-f,i.c=l+6.123233995736766e-17*p,i.d=d+6.123233995736766e-17*f,u=c,c=m}if(t.roundPixels?(t.context.setTransform(i.a,i.b,i.c,i.d,0|a,0|h),o|=0,s|=0):t.context.setTransform(i.a,i.b,i.c,i.d,a,h),o/=r,s/=r,16777215!==this.tint)(this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),t.context.drawImage(this.tintedTexture,0,0,u,c,o,s,u/r,c/r);else{var g=this.texture.crop.x,y=this.texture.crop.y;u=Math.floor(u),c=Math.floor(c),t.context.drawImage(this.texture.baseTexture.source,g,y,u,c,o,s,u/r,c/r)}for(v=0;v<this.children.length;v++)this.children[v]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}else{for(var v=0;v<this.children.length;v++)this.children[v]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}}},n.initDefaultShaders=function(){},n.CompileVertexShader=function(t,e){return n._CompileShader(t,e,t.VERTEX_SHADER)},n.CompileFragmentShader=function(t,e){return n._CompileShader(t,e,t.FRAGMENT_SHADER)},n._CompileShader=function(t,e,i){var n=e;Array.isArray(e)&&(n=e.join("\n"));var r=t.createShader(i);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(window.console.log(t.getShaderInfoLog(r)),null)},n.compileProgram=function(t,e,i){var r=n.CompileFragmentShader(t,i),o=n.CompileVertexShader(t,e),s=t.createProgram();return t.attachShader(s,o),t.attachShader(s,r),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||(window.console.log(t.getProgramInfoLog(s)),window.console.log("Could not initialise shaders")),s},n.PixiShader=function(t){this._UID=Phaser._UID++,this.gl=t,this.program=null,this.fragmentSrc=null,this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},n.PixiShader.prototype.constructor=n.PixiShader,n.PixiShader.prototype.initMultitexShader=function(){var t=this.gl;this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(var e="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",i=1;i<this.MAX_TEXTURES;++i)e+="\tif (vTextureIndex == "+i+".0) {gl_FragColor = texture2D(uSamplerArray["+i+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=["// PixiShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",e,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) { gl_FragColor = RED;return;}","}"];var r=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(r),this.uSamplerArray=t.getUniformLocation(r,"uSamplerArray[0]"),this.projectionVector=t.getUniformLocation(r,"projectionVector"),this.offsetVector=t.getUniformLocation(r,"offsetVector"),this.dimensions=t.getUniformLocation(r,"dimensions"),this.aVertexPosition=t.getAttribLocation(r,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(r,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(r,"aColor"),this.aTextureIndex=t.getAttribLocation(r,"aTextureIndex");var o=[],s=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,null);for(var a=0;a<this.MAX_TEXTURES;++a)t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_2D,s),o.push(a);t.activeTexture(t.TEXTURE0),t.uniform1iv(this.uSamplerArray,o),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(var h in this.uniforms)this.uniforms[h].uniformLocation=t.getUniformLocation(r,h);this.initUniforms(),this.program=r},n.PixiShader.prototype.initDefaultShader=function(){null===this.fragmentSrc&&(this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"]);var t=this.gl,e=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aTextureIndex=t.getAttribLocation(e,"aTextureIndex"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(var i in this.uniforms)this.uniforms[i].uniformLocation=t.getUniformLocation(e,i);this.initUniforms(),this.program=e},n.PixiShader.prototype.init=function(t){n._enableMultiTextureToggle&&!t?this.initMultitexShader():this.initDefaultShader()},n.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){var n=(t=this.uniforms[i]).type;"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=e.uniformMatrix2fv:"mat3"===n?t.glFunc=e.uniformMatrix3fv:"mat4"===n&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)}},n.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e.TEXTURE0+this.textureCount),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,n=i.magFilter?i.magFilter:e.LINEAR,r=i.minFilter?i.minFilter:e.LINEAR,o=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,s=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,a=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(o=e.REPEAT,s=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var h=i.width?i.width:512,u=i.height?i.height:2,c=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,a,h,u,c,a,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},n.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms)1===(t=this.uniforms[i]).glValueLength?!0===t.glMatrix?t.glFunc.call(e,t.uniformLocation,t.transpose,t.value):t.glFunc.call(e,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(e.activeTexture(e["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[e.id]?n.instances[e.id].updateTexture(t.value.baseTexture):e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),e.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},n.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.PixiShader.defaultVertexSrc=["// PixiShader Vertex Shader","// With multi-texture rendering","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   if (aTextureIndex > 0.0) gl_Position = vec4(0.0);","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vTextureIndex = aTextureIndex;","}"],n.PixiFastShader=function(t){if(this._UID=Phaser._UID++,this.gl=t,this.program=null,n._enableMultiTextureToggle){t=this.gl;this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(var e="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",i=1;i<this.MAX_TEXTURES;++i)e+="\tif (vTextureIndex == "+i+".0) { gl_FragColor = texture2D(uSamplerArray["+i+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",e,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"];this.vertexSrc=["// PixiFastShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","   vColor = aColor;","}"],this.textureCount=0,this.init()},n.PixiFastShader.prototype.constructor=n.PixiFastShader,n.PixiFastShader.prototype.init=function(){var t=this.gl,e=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);if(t.useProgram(e),this.uSampler=n._enableMultiTextureToggle?t.getUniformLocation(e,"uSamplerArray[0]"):t.getUniformLocation(e,"uSampler"),n._enableMultiTextureToggle){var i=[],r=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,null);for(var o=0;o<this.MAX_TEXTURES;++o)t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,r),i.push(o);t.activeTexture(t.TEXTURE0),t.uniform1iv(this.uSampler,i)}this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.uMatrix=t.getUniformLocation(e,"uMatrix"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(e,"aPositionCoord"),this.aScale=t.getAttribLocation(e,"aScale"),this.aRotation=t.getAttribLocation(e,"aRotation"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aTextureIndex=t.getAttribLocation(e,"aTextureIndex"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.program=e},n.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.StripShader=function(t){if(this._UID=Phaser._UID++,this.gl=t,this.program=null,n._enableMultiTextureToggle){t=this.gl;this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(var e="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord);return;}\n",i=1;i<this.MAX_TEXTURES;++i)e+="\tif (vTextureIndex == "+i+".0) { gl_FragColor = texture2D(uSamplerArray["+i+"], vTextureCoord) ;return;}\n";this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",e,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"];this.vertexSrc=["//StripShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aTextureIndex;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vTextureIndex;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","}"],this.init()},n.StripShader.prototype.constructor=n.StripShader,n.StripShader.prototype.init=function(){var t=this.gl,e=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);if(t.useProgram(e),this.uSampler=n._enableMultiTextureToggle?t.getUniformLocation(e,"uSamplerArray[0]"):t.getUniformLocation(e,"uSampler"),n._enableMultiTextureToggle){var i=[],r=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGB,1,1,0,t.RGB,t.UNSIGNED_BYTE,null);for(var o=0;o<this.MAX_TEXTURES;++o)t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,r),i.push(o);t.activeTexture(t.TEXTURE0),t.uniform1iv(this.uSampler,i)}this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aTextureIndex=t.getAttribLocation(e,"aTextureIndex"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.aTextureIndex],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},n.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},n.PrimitiveShader=function(t){this._UID=Phaser._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},n.PrimitiveShader.prototype.constructor=n.PrimitiveShader,n.PrimitiveShader.prototype.init=function(){var t=this.gl,e=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},n.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.ComplexPrimitiveShader=function(t){this._UID=Phaser._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},n.ComplexPrimitiveShader.prototype.constructor=n.ComplexPrimitiveShader,n.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,e=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.color=t.getUniformLocation(e,"color"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},n.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},n.glContexts=[],n.instances=[],n._enableMultiTextureToggle=!1,n.WebGLRenderer=function(t){this.game=t,n.defaultRenderer||(n.defaultRenderer=this),this.extensions={},this.type=Phaser.WEBGL,this.resolution=t.resolution,this.transparent=t.transparent,this.autoResize=!1,this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.clearBeforeRender=t.clearBeforeRender,this.width=t.width,this.height=t.height,this.view=t.canvas,this._contextOptions={alpha:this.transparent,antialias:t.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new n.Point,this.offset=new n.Point,this.shaderManager=new n.WebGLShaderManager,this.spriteBatch=new n.WebGLSpriteBatch(t),this.maskManager=new n.WebGLMaskManager,this.filterManager=new n.WebGLFilterManager,this.stencilManager=new n.WebGLStencilManager,this.blendModeManager=new n.WebGLBlendModeManager,this.renderSession={},this.currentBatchedTextures=[],this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.renderSession.roundPixels=!1,this.renderSession.maxTextureAvailableSpace=null,this.initContext(),this.mapBlendModes()},n.WebGLRenderer.prototype.constructor=n.WebGLRenderer,n.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=this.gl.getParameter(t.MAX_TEXTURE_SIZE),this.glContextId=t.id=n.WebGLRenderer.glContextId++,n.glContexts[this.glContextId]=t,n.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height),this.extensions.compression={};var e=t.getExtension("WEBGL_compressed_texture_etc1")||t.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");e&&(this.extensions.compression.ETC1=e),i&&(this.extensions.compression.PVRTC=i),r&&(this.extensions.compression.S3TC=r)},n.WebGLRenderer.prototype.setTexturePriority=function(t){if(n._enableMultiTextureToggle){for(var e=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},i=this.gl,r=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),o=i.getParameter(i.MAX_TEXTURE_SIZE),s=this.game.cache._cache.image,a=null,h=0;h<this.currentBatchedTextures.length;h++)(a=this.currentBatchedTextures[h])in s?s[a].base.textureIndex=0:console.warn('setTexturePriority: There is no image "%s" in the image cache.',a);var u=o-e(Math.max(this.width,this.height));this.currentBatchedTextures.length=0;for(var c=0;c<t.length;++c)if((a=t[c])in s){var l=s[a].base;(u-=e(Math.max(l.width,l.height)))<=0?(l.textureIndex=0,console.warn('setTexturePriority: Image "%s" was given textureIndex=0 because there is no available texture space (%s).',a,u)):l.textureIndex=1+c%(r-1),this.currentBatchedTextures.push(a)}else console.warn('setTexturePriority: There is no image "%s" in the image cache.',a);return this.renderSession.maxTextureAvailableSpace=u,this.currentBatchedTextures}console.warn("setTexturePriority error: Multi Texture support hasn't been enabled in the Phaser Game Config.")},n.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){var e=this.gl;e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.game.clearBeforeRender&&(e.clearColor(t._bgColor.r,t._bgColor.g,t._bgColor.b,t._bgColor.a),e.clear(e.COLOR_BUFFER_BIT)),this.offset.x=this.game.camera._shake.x,this.offset.y=this.game.camera._shake.y,this.renderDisplayObject(t,this.projection)}},n.WebGLRenderer.prototype.renderDisplayObject=function(t,e,i,r){this.renderSession.blendModeManager.setBlendMode(n.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=i?-1:1,this.renderSession.projection=e,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,i),t._renderWebGL(this.renderSession,r),this.spriteBatch.end()},n.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},n.WebGLRenderer.prototype.updateCompressedTexture=function(t){if(!t.hasLoaded)return!1;var e=this.gl,i=t.source;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture()),e.activeTexture(e.TEXTURE0+t.textureIndex),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.compressedTexImage2D(e.TEXTURE_2D,0,i.glExtensionFormat,i.width,i.height,0,i.textureData),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&Phaser.Math.isPowerOfTwo(t.width,t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t._dirty[e.id]=!1,!0},n.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded)return!1;if(t.source.compressionAlgorithm)return this.updateCompressedTexture(t);var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture()),e.activeTexture(e.TEXTURE0+t.textureIndex),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&Phaser.Math.isPowerOfTwo(t.width,t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t._dirty[e.id]=!1,!0},n.WebGLRenderer.prototype.destroy=function(){n.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,Phaser.CanvasPool.remove(this),n.instances[this.glContextId]=null,n.WebGLRenderer.glContextId--},n.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;if(!n.blendModesWebGL){var e=[],i=n.blendModes;e[i.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],e[i.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e[i.SCREEN]=[t.SRC_ALPHA,t.ONE],e[i.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[i.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL=e}},n.WebGLRenderer.prototype.getMaxTextureUnit=function(){var t=this.gl;return t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)},n.enableMultiTexture=function(){n._enableMultiTextureToggle=!0},n.WebGLRenderer.glContextId=0,n.WebGLRenderer.textureArray=[],n.WebGLBlendModeManager=function(){this.currentBlendMode=99999},n.WebGLBlendModeManager.prototype.constructor=n.WebGLBlendModeManager,n.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},n.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var e=n.blendModesWebGL[this.currentBlendMode];return e&&this.gl.blendFunc(e[0],e[1]),!0},n.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},n.WebGLMaskManager=function(){},n.WebGLMaskManager.prototype.constructor=n.WebGLMaskManager,n.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},n.WebGLMaskManager.prototype.pushMask=function(t,e){var i=e.gl;t.dirty&&n.WebGLGraphics.updateGraphics(t,i),void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.pushStencil(t,t._webGL[i.id].data[0],e)},n.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},n.WebGLMaskManager.prototype.destroy=function(){this.gl=null},n.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},n.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},n.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var n=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var r=this.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===e.mode?(n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?n.stencilFunc(n.EQUAL,255-(r+1),255):n.stencilFunc(n.EQUAL,r+1,255),this.reverse=!this.reverse):(this.reverse?(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r+1,255):n.stencilFunc(n.EQUAL,255-(r+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),this.count++},n.WebGLStencilManager.prototype.bindGraphics=function(t,e,i){this._currentGraphics=t;var n,r=this.gl,o=i.projection,s=i.offset;1===e.mode?(n=i.shaderManager.complexPrimitiveShader,i.shaderManager.setShader(n),r.uniform1f(n.flipY,i.flipY),r.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform2f(n.projectionVector,o.x,-o.y),r.uniform2f(n.offsetVector,-s.x,-s.y),r.uniform3fv(n.tintColor,Phaser.Color.hexToRGBArray(t.tint)),r.uniform3fv(n.color,e.color),r.uniform1f(n.alpha,t.worldAlpha*e.alpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(n.aVertexPosition,2,r.FLOAT,!1,8,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer)):(n=i.shaderManager.primitiveShader,i.shaderManager.setShader(n),r.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(n.flipY,i.flipY),r.uniform2f(n.projectionVector,o.x,-o.y),r.uniform2f(n.offsetVector,-s.x,-s.y),r.uniform3fv(n.tintColor,Phaser.Color.hexToRGBArray(t.tint)),r.uniform1f(n.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(n.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(n.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer))},n.WebGLStencilManager.prototype.popStencil=function(t,e,i){var n=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)n.disable(n.STENCIL_TEST);else{var r=this.count;this.bindGraphics(t,e,i),n.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)):(this.reverse?(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},n.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},n.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},n.WebGLShaderManager.prototype.constructor=n.WebGLShaderManager,n.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new n.PrimitiveShader(t),this.complexPrimitiveShader=new n.ComplexPrimitiveShader(t),this.defaultShader=new n.PixiShader(t),this.fastShader=new n.PixiFastShader(t),this.stripShader=new n.StripShader(t),this.creatureShader=n.CreatureShader?new n.CreatureShader(t):null,this.setShader(this.defaultShader)},n.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var n=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},n.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},n.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.creatureShader&&this.creatureShader.destroy(),this.gl=null},n.WebGLSpriteBatch=function(t){this.game=t,this.vertSize=5,this.size=2e3,this.vertexSize=24;var e=this.vertexSize*this.size*4,i=6*this.size;this.vertices=new ArrayBuffer(e),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(i),this.lastIndexCount=0;for(var n=0,r=0;n<i;n+=6,r+=4)this.indices[n+0]=r+0,this.indices[n+1]=r+1,this.indices[n+2]=r+2,this.indices[n+3]=r+0,this.indices[n+4]=r+2,this.indices[n+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=null},n.WebGLSpriteBatch.prototype.setContext=function(t){if(this.MAX_TEXTURES=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.gl=t,n._enableMultiTextureToggle){for(var e="\tif (vTextureIndex == 0.0) {gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",i=1;i<this.MAX_TEXTURES;++i)e+="\tif (vTextureIndex == "+i+".0) {gl_FragColor = texture2D(uSamplerArray["+i+"], vTextureCoord) * vColor;return;}\n";this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","void main(void) {",e,"\tgl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;","}"])}else this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]);this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var r=new n.PixiShader(t);r.fragmentSrc=this.defaultShader.fragmentSrc,r.uniforms={},r.init(),this.defaultShader.shaders[t.id]=r},n.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},n.WebGLSpriteBatch.prototype.end=function(){this.flush()},n.WebGLSpriteBatch.prototype.render=function(t,e){var i=t.texture,r=i.baseTexture,o=this.gl;n.WebGLRenderer.textureArray[r.textureIndex]!=r&&(this.flush(),o.activeTexture(o.TEXTURE0+r.textureIndex),o.bindTexture(o.TEXTURE_2D,r._glTextures[o.id]),n.WebGLRenderer.textureArray[r.textureIndex]=r);var s=t.worldTransform;e&&(s=e),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture);var a=i._uvs;if(a){var h,u,c,l,d=t.anchor.x,p=t.anchor.y;if(i.trim){var f=i.trim;h=(u=f.x-d*f.width)+i.crop.width,c=(l=f.y-p*f.height)+i.crop.height}else h=i.frame.width*(1-d),u=i.frame.width*-d,c=i.frame.height*(1-p),l=i.frame.height*-p;var m=this.currentBatchSize*this.vertexSize,g=(this.currentBatchSize,i.baseTexture.resolution),y=i.baseTexture.textureIndex,v=s.a/g,b=s.b/g,x=s.c/g,_=s.d/g,w=s.tx,T=s.ty,S=(i.crop.width,i.crop.height);if(i.rotated){var E=s.a,C=s.b,P=s.c,M=s.d,A=u,R=h;w=s.c*S+w,T=s.d*S+T,v=6.123233995736766e-17*E-P,b=6.123233995736766e-17*C-M,x=E+6.123233995736766e-17*P,_=C+6.123233995736766e-17*M,i._updateUvsInverted(),h=c,u=l,c=R,l=A}var L=this.colors,O=this.positions,I=t.tint,B=(I>>16)+(65280&I)+((255&I)<<16)+(255*t.worldAlpha<<24);this.renderSession.roundPixels?(O[m++]=v*u+x*l+w|0,O[m++]=_*l+b*u+T|0,O[m++]=a.x0,O[m++]=a.y0,L[m++]=B,O[m++]=y,O[m++]=v*h+x*l+w|0,O[m++]=_*l+b*h+T|0,O[m++]=a.x1,O[m++]=a.y1,L[m++]=B,O[m++]=y,O[m++]=v*h+x*c+w|0,O[m++]=_*c+b*h+T|0,O[m++]=a.x2,O[m++]=a.y2,L[m++]=B,O[m++]=y,O[m++]=v*u+x*c+w|0,O[m++]=_*c+b*u+T|0,O[m++]=a.x3,O[m++]=a.y3,L[m++]=B,O[m++]=y):(O[m++]=v*u+x*l+w,O[m++]=_*l+b*u+T,O[m++]=a.x0,O[m++]=a.y0,L[m++]=B,O[m++]=y,O[m++]=v*h+x*l+w,O[m++]=_*l+b*h+T,O[m++]=a.x1,O[m++]=a.y1,L[m++]=B,O[m++]=y,O[m++]=v*h+x*c+w,O[m++]=_*c+b*h+T,O[m++]=a.x2,O[m++]=a.y2,L[m++]=B,O[m++]=y,O[m++]=v*u+x*c+w,O[m++]=_*c+b*u+T,O[m++]=a.x3,O[m++]=a.y3,L[m++]=B,O[m++]=y),this.sprites[this.currentBatchSize++]=t}},n.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture,i=e.baseTexture,r=this.gl,o=t.texture.baseTexture.textureIndex;n.WebGLRenderer.textureArray[o]!=i&&(this.flush(),r.activeTexture(r.TEXTURE0+o),r.bindTexture(r.TEXTURE_2D,i._glTextures[r.id]),n.WebGLRenderer.textureArray[o]=i),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture),t._uvs||(t._uvs=new n.TextureUvs);var s=t._uvs,a=e.baseTexture.width,h=e.baseTexture.height;t.tilePosition.x%=a*t.tileScaleOffset.x,t.tilePosition.y%=h*t.tileScaleOffset.y;var u=t.tilePosition.x/(a*t.tileScaleOffset.x),c=t.tilePosition.y/(h*t.tileScaleOffset.y),l=t.width/a/(t.tileScale.x*t.tileScaleOffset.x),d=t.height/h/(t.tileScale.y*t.tileScaleOffset.y);s.x0=0-u,s.y0=0-c,s.x1=1*l-u,s.y1=0-c,s.x2=1*l-u,s.y2=1*d-c,s.x3=0-u,s.y3=1*d-c;var p=t.tint,f=(p>>16)+(65280&p)+((255&p)<<16)+(255*t.worldAlpha<<24),m=this.positions,g=this.colors,y=t.width,v=t.height,b=t.anchor.x,x=t.anchor.y,_=y*(1-b),w=y*-b,T=v*(1-x),S=v*-x,E=this.currentBatchSize*this.vertexSize,C=e.baseTexture.resolution,P=t.worldTransform,M=P.a/C,A=P.b/C,R=P.c/C,L=P.d/C,O=P.tx,I=P.ty;m[E++]=M*w+R*S+O,m[E++]=L*S+A*w+I,m[E++]=s.x0,m[E++]=s.y0,g[E++]=f,m[E++]=o,m[E++]=M*_+R*S+O,m[E++]=L*S+A*_+I,m[E++]=s.x1,m[E++]=s.y1,g[E++]=f,m[E++]=o,m[E++]=M*_+R*T+O,m[E++]=L*T+A*_+I,m[E++]=s.x2,m[E++]=s.y2,g[E++]=f,m[E++]=o,m[E++]=M*w+R*T+O,m[E++]=L*T+A*w+I,m[E++]=s.x3,m[E++]=s.y3,g[E++]=f,m[E++]=o,this.sprites[this.currentBatchSize++]=t},n.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e=this.gl;if(this.dirty){this.dirty=!1,t=this.defaultShader.shaders[e.id],e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=this.vertexSize;e.vertexAttribPointer(t.aVertexPosition,2,e.FLOAT,!1,i,0),e.vertexAttribPointer(t.aTextureCoord,2,e.FLOAT,!1,i,8),e.vertexAttribPointer(t.colorAttribute,4,e.UNSIGNED_BYTE,!0,i,16),e.vertexAttribPointer(t.aTextureIndex,1,e.FLOAT,!1,i,20)}if(this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);var r=this.positions.subarray(0,this.currentBatchSize*this.vertexSize);e.bufferSubData(e.ARRAY_BUFFER,0,r)}for(var o,s,a,h,u=0,c=0,l=null,d=this.renderSession.blendModeManager.currentBlendMode,p=null,f=!1,m=!1,g=0,y=this.currentBatchSize;g<y;g++){o=(h=this.sprites[g]).tilingTexture?h.tilingTexture.baseTexture:h.texture.baseTexture,f=d!==(s=h.blendMode),m=p!==(a=h.shader||this.defaultShader);var v=o.skipRender;if(v&&h.children.length>0&&(v=!1),(f||m)&&(this.renderBatch(l,u,c),c=g,u=0,l=o,f&&(d=s,this.renderSession.blendModeManager.setBlendMode(d)),m)){(t=(p=a).shaders[e.id])||((t=new n.PixiShader(e)).fragmentSrc=p.fragmentSrc,t.uniforms=p.uniforms,t.init(),p.shaders[e.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var b=this.renderSession.projection;e.uniform2f(t.projectionVector,b.x,b.y);var x=this.renderSession.offset;e.uniform2f(t.offsetVector,x.x,x.y)}u++}this.renderBatch(l,u,c),this.currentBatchSize=0}},n.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.gl;if(t._dirty[n.id]){if(!this.renderSession.renderer.updateTexture(t))return}else n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]);n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},n.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},n.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},n.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},n.WebGLFastSpriteBatch=function(t){this.vertSize=11,this.maxSize=6e3,this.size=this.maxSize;var e=4*this.size*this.vertSize,i=6*this.maxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(i),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var n=0,r=0;n<i;n+=6,r+=4)this.indices[n+0]=r+0,this.indices[n+1]=r+1,this.indices[n+2]=r+2,this.indices[n+3]=r+0,this.indices[n+4]=r+2,this.indices[n+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},n.WebGLFastSpriteBatch.prototype.constructor=n.WebGLFastSpriteBatch,n.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},n.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},n.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var n=0,r=e.length;n<r;n++)this.renderSprite(e[n]);this.flush()}},n.WebGLFastSpriteBatch.prototype.renderSprite=function(t){var e=t.texture.baseTexture,i=this.gl,r=t.texture.baseTexture.textureIndex;if((n.WebGLRenderer.textureArray[r]==e||!e._glTextures[i.id]||t.texture.baseTexture.skipRender||(this.flush(),i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,e._glTextures[i.id]),n.WebGLRenderer.textureArray[r]=e,t.texture._uvs))&&t.visible){var o,s,a,h,u,c,l=this.vertices;if(o=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim){var d=t.texture.trim;s=(a=d.x-t.anchor.x*d.width)+t.texture.crop.width,h=(u=d.y-t.anchor.y*d.height)+t.texture.crop.height}else s=t.texture.frame.width*(1-t.anchor.x),a=t.texture.frame.width*-t.anchor.x,h=t.texture.frame.height*(1-t.anchor.y),u=t.texture.frame.height*-t.anchor.y;c=4*this.currentBatchSize*this.vertSize,l[c++]=a,l[c++]=u,l[c++]=t.position.x,l[c++]=t.position.y,l[c++]=t.scale.x,l[c++]=t.scale.y,l[c++]=t.rotation,l[c++]=o.x0,l[c++]=o.y1,l[c++]=t.alpha,l[c++]=r,l[c++]=s,l[c++]=u,l[c++]=t.position.x,l[c++]=t.position.y,l[c++]=t.scale.x,l[c++]=t.scale.y,l[c++]=t.rotation,l[c++]=o.x1,l[c++]=o.y1,l[c++]=t.alpha,l[c++]=r,l[c++]=s,l[c++]=h,l[c++]=t.position.x,l[c++]=t.position.y,l[c++]=t.scale.x,l[c++]=t.scale.y,l[c++]=t.rotation,l[c++]=o.x2,l[c++]=o.y2,l[c++]=t.alpha,l[c++]=r,l[c++]=a,l[c++]=h,l[c++]=t.position.x,l[c++]=t.position.y,l[c++]=t.scale.x,l[c++]=t.scale.y,l[c++]=t.rotation,l[c++]=o.x3,l[c++]=o.y3,l[c++]=t.alpha,l[c++]=r,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},n.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]){if(this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}else this.renderSession.renderer.updateTexture(this.currentBaseTexture,t)}},n.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36),t.vertexAttribPointer(this.shader.aTextureIndex,1,t.FLOAT,!1,i,40)},n.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},n.WebGLFilterManager.prototype.constructor=n.WebGLFilterManager,n.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},n.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},n.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl,i=this.renderSession.projection,r=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new n.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(t);var o=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var s=this.texturePool.pop();s?s.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):s=new n.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),e.bindTexture(e.TEXTURE_2D,s.texture);var a=t._filterArea,h=o.padding;a.x-=h,a.y-=h,a.width+=2*h,a.height+=2*h,a.x<0&&(a.x=0),a.width>this.width&&(a.width=this.width),a.y<0&&(a.y=0),a.height>this.height&&(a.height=this.height),e.bindFramebuffer(e.FRAMEBUFFER,s.frameBuffer),e.viewport(0,0,a.width*this.renderSession.resolution,a.height*this.renderSession.resolution),i.x=a.width/2,i.y=-a.height/2,r.x=-a.x,r.y=-a.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=s},n.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),i=e._filterArea,r=e._glFilterTexture,o=this.renderSession.projection,s=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width*this.renderSession.resolution,i.height*this.renderSession.resolution),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=r,h=this.texturePool.pop();h||(h=new n.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)),h.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var u=0;u<e.filterPasses.length-1;u++){var c=e.filterPasses[u];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a.texture),this.applyFilterPass(c,i,i.width,i.height);var l=a;a=h,h=l}t.enable(t.BLEND),r=a,this.texturePool.push(h)}var d=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x,this.offsetY-=i.y;var p=this.width,f=this.height,m=0,g=0,y=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var v=this.filterStack[this.filterStack.length-1];p=(i=v._filterArea).width,f=i.height,m=i.x,g=i.y,y=v._glFilterTexture.frameBuffer}o.x=p/2,o.y=-f/2,s.x=m,s.y=g;var b=(i=e._filterArea).x-m,x=i.y-g;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=b,this.vertexArray[1]=x+i.height,this.vertexArray[2]=b+i.width,this.vertexArray[3]=x+i.height,this.vertexArray[4]=b,this.vertexArray[5]=x,this.vertexArray[6]=b+i.width,this.vertexArray[7]=x,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,p*this.renderSession.resolution,f*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,y),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(d,i,p,f),this.texturePool.push(r),e._glFilterTexture=null},n.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,r){var o=this.gl,s=t.shaders[o.id];s||((s=new n.PixiShader(o)).fragmentSrc=t.fragmentSrc,s.uniforms=t.uniforms,s.init(!0),t.shaders[o.id]=s),this.renderSession.shaderManager.setShader(s),o.uniform2f(s.projectionVector,i/2,-r/2),o.uniform2f(s.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),s.syncUniforms(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),o.vertexAttribPointer(s.aVertexPosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.uvBuffer),o.vertexAttribPointer(s.aTextureCoord,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.vertexAttribPointer(s.colorAttribute,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0),this.renderSession.drawCount++},n.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},n.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)};var r={36054:"Incomplete attachment",36055:"Missing attachment",36057:"Incomplete dimensions",36061:"Framebuffer unsupported"};return n.FilterTexture=function(t,e,r,o,s){s="number"==typeof s?s:0,this.gl=t,this.frameBuffer=i(t,e,r,o||n.scaleModes.DEFAULT,s),this.texture=this.frameBuffer.targetTexture,this.width=e,this.height=r,this.renderBuffer=this.frameBuffer.renderBuffer},n.FilterTexture.prototype.constructor=n.FilterTexture,n.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},n.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},n.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},n.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=Phaser.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},n.CanvasBuffer.prototype.constructor=n.CanvasBuffer,n.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},n.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},n.CanvasBuffer.prototype.destroy=function(){Phaser.CanvasPool.remove(this)},n.CanvasMaskManager=function(){},n.CanvasMaskManager.prototype.constructor=n.CanvasMaskManager,n.CanvasMaskManager.prototype.pushMask=function(t,e){var i=e.context;i.save();var r=t.alpha,o=t.worldTransform,s=e.resolution;i.setTransform(o.a*s,o.b*s,o.c*s,o.d*s,o.tx*s,o.ty*s),n.CanvasGraphics.renderGraphicsMask(t,i),i.clip(),t.worldAlpha=r},n.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},n.CanvasTinter=function(){},n.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||Phaser.CanvasPool.create(this);return n.CanvasTinter.tintMethod(t.texture,e,i),i},n.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.crop,o=r.width,s=r.height;t.rotated&&(o=s,s=r.width),i.width===o&&i.height===s||(i.width=o,i.height=s),n.clearRect(0,0,o,s),n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,o,s),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,r.x,r.y,o,s,0,0,o,s),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,o,s,0,0,o,s)},n.CanvasTinter.tintWithPerPixel=function(t,e,i){var r=i.getContext("2d"),o=t.crop,s=o.width,a=o.height;t.rotated&&(s=a,a=o.width),i.width===s&&i.height===a||(i.width=s,i.height=a),r.globalCompositeOperation="copy",r.drawImage(t.baseTexture.source,o.x,o.y,s,a,0,0,s,a);for(var h=Phaser.Color.hexToRGBArray(e),u=h[0],c=h[1],l=h[2],d=r.getImageData(0,0,s,a),p=d.data,f=0;f<p.length;f+=4)if(p[f+0]*=u,p[f+1]*=c,p[f+2]*=l,!n.CanvasTinter.canHandleAlpha){var m=p[f+3];p[f+0]/=255/m,p[f+1]/=255/m,p[f+2]/=255/m}r.putImageData(d,0,0)},n.CanvasRenderer=function(t){this.game=t,n.defaultRenderer||(n.defaultRenderer=this),this.type=Phaser.CANVAS,this.resolution=t.resolution,this.clearBeforeRender=t.clearBeforeRender,this.transparent=t.transparent,this.autoResize=!1,this.width=t.width*this.resolution,this.height=t.height*this.resolution,this.view=t.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.count=0,this.maskManager=new n.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1},this.mapBlendModes(),this.resize(this.width,this.height)},n.CanvasRenderer.prototype.constructor=n.CanvasRenderer,n.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.renderSession.shakeX=this.game.camera._shake.x,this.renderSession.shakeY=this.game.camera._shake.y,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):t._bgColor&&(this.context.fillStyle=t._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t)},n.CanvasRenderer.prototype.setTexturePriority=function(t){},n.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},n.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===n.scaleModes.LINEAR)},n.CanvasRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession,i)},n.CanvasRenderer.prototype.mapBlendModes=function(){if(!n.blendModesCanvas){var t=[],e=n.blendModes,i=this.game.device.canUseMultiply;t[e.NORMAL]="source-over",t[e.ADD]="lighter",t[e.MULTIPLY]=i?"multiply":"source-over",t[e.SCREEN]=i?"screen":"source-over",t[e.OVERLAY]=i?"overlay":"source-over",t[e.DARKEN]=i?"darken":"source-over",t[e.LIGHTEN]=i?"lighten":"source-over",t[e.COLOR_DODGE]=i?"color-dodge":"source-over",t[e.COLOR_BURN]=i?"color-burn":"source-over",t[e.HARD_LIGHT]=i?"hard-light":"source-over",t[e.SOFT_LIGHT]=i?"soft-light":"source-over",t[e.DIFFERENCE]=i?"difference":"source-over",t[e.EXCLUSION]=i?"exclusion":"source-over",t[e.HUE]=i?"hue":"source-over",t[e.SATURATION]=i?"saturation":"source-over",t[e.COLOR]=i?"color":"source-over",t[e.LUMINOSITY]=i?"luminosity":"source-over",n.blendModesCanvas=t}},n.BaseTexture=function(t,e,i){this.resolution=i||1,this.width=100,this.height=100,this.scaleMode=e||n.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this.textureIndex=0,this._dirty=[!0,!0,!0,!0],t&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},n.BaseTexture.prototype.constructor=n.BaseTexture,n.BaseTexture.prototype.forceLoaded=function(t,e){this.hasLoaded=!0,this.width=t,this.height=e,this.dirty()},n.BaseTexture.prototype.destroy=function(){this.source&&Phaser.CanvasPool.removeByCanvas(this.source),this.source=null,this.unloadFromGPU()},n.BaseTexture.prototype.updateSourceImage=function(t){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")},n.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},n.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var e=this._glTextures[t],i=n.glContexts[t];i&&e&&i.deleteTexture(e)}this._glTextures.length=0,this.dirty()},n.BaseTexture.fromCanvas=function(t,e,i){return 0===t.width&&(t.width=1),0===t.height&&(t.height=1),i=i||1,new n.BaseTexture(t,e,i)},n.TextureSilentFail=!1,n.Texture=function(t,e,i,r){this.noFrame=!1,e||(this.noFrame=!0,e=new n.Rectangle(0,0,1,1)),t instanceof n.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.trim=r,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||new n.Rectangle(0,0,1,1),this.rotated=!1,t.hasLoaded&&(this.noFrame&&(e=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(e))},n.Texture.prototype.constructor=n.Texture,n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame)},n.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},n.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs();else{if(!n.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1}},n.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,e=this.baseTexture.width,i=this.baseTexture.height;this._uvs.x0=t.x/e,this._uvs.y0=t.y/i,this._uvs.x1=(t.x+t.width)/e,this._uvs.y1=t.y/i,this._uvs.x2=(t.x+t.width)/e,this._uvs.y2=(t.y+t.height)/i,this._uvs.x3=t.x/e,this._uvs.y3=(t.y+t.height)/i},n.Texture.prototype._updateUvsInverted=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,e=this.baseTexture.width,i=this.baseTexture.height;this._uvs.x0=t.x/e,this._uvs.y0=t.y/i,this._uvs.x1=(t.x+t.height)/e,this._uvs.y1=t.y/i,this._uvs.x2=(t.x+t.height)/e,this._uvs.y2=(t.y+t.width)/i,this._uvs.x3=t.x/e,this._uvs.y3=(t.y+t.width)/i},n.Texture.fromCanvas=function(t,e){var i=n.BaseTexture.fromCanvas(t,e);return new n.Texture(i)},n.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},"undefined"!=typeof t&&t.exports&&(e=t.exports=n),e.PIXI=n,n}).call(this),(function(){function n(t,e){this._scaleFactor=t,this._deltaMode=e,this.originalEvent=null}var r=r||{VERSION:"2.9.3",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGL_MULTI:4,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{},_UID:0};if(Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Function.prototype.bind||(Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){function i(){var o=r.concat(t.call(arguments));n.apply(this instanceof i?this:e,o)}var n=this,r=t.call(arguments,1);if("function"!=typeof n)throw new TypeError;return i.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(n.prototype),i}}()),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments.length>=2?arguments[1]:void 0,r=0;r<i;r++)r in e&&t.call(n,e[r],r,e)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var o=function(t){var e=new Array;window[t]=function(t){if("number"==typeof t){Array.call(this,t),this.length=t;for(var e=0;e<this.length;e++)this[e]=0}else{Array.call(this,t.length),this.length=t.length;for(e=0;e<this.length;e++)this[e]=t[e]}},window[t].prototype=e,window[t].constructor=window[t]};o("Float32Array"),o("Uint32Array"),o("Uint16Array"),o("Int16Array"),o("ArrayBuffer")}window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),Object.assign||(Object.assign=function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=Object.prototype.hasOwnProperty,r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var s in o)n.call(o,s)&&(i[s]=o[s])}return i}),r.Utils={reverseString:function(t){return t.split("").reverse().join("")},getProperty:function(t,e){var i=e.split(".");switch(i.length){case 1:return t[e];case 2:return t[i[0]][i[1]];case 3:return t[i[0]][i[1]][i[2]];case 4:return t[i[0]][i[1]][i[2]][i[3]];default:return this._getProperty(t,e)}},setProperties:function(t,e){for(var i in e)this.setProperty(t,i,e[i]);return t},setProperty:function(t,e,i){var n=e.split(".");switch(n.length){case 1:t[e]=i;break;case 2:t[n[0]][n[1]]=i;break;case 3:t[n[0]][n[1]][n[2]]=i;break;case 4:t[n[0]][n[1]][n[2]][n[3]]=i;break;default:this._setProperty(t,e,i)}},_getProperty:function(t,e){for(var i=e.split("."),n=i.length,r=0,o=t;r<n;){var s=i[r];if(null==o)return;o=o[s],r++}return o},_setProperty:function(t,e,i){var n=e.split("."),r=n.length,o=0,s=t,a=n[0];if(1===r)t[e]=i;else{for(;o<r-1;)s=s[a],a=n[++o];s[a]=i}return t},chanceRoll:function(t){return void 0===t&&(t=50),t>0&&100*Math.random()<=t},randomChoice:function(t,e){return Math.random()<.5?t:e},parseDimension:function(t,e){var i=0,n=0;return"string"==typeof t?"%"===t.substr(-1)?(i=parseInt(t,10)/100,n=0===e?window.innerWidth*i:window.innerHeight*i):n=parseInt(t,10):n=t,n},pad:function(t,e,i,n){if(void 0===e)e=0;if(void 0===i)i=" ";if(void 0===n)n=3;var r=0;if(e+1>=(t=t.toString()).length)switch(n){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var o=Math.ceil((r=e-t.length)/2),s=r-o;t=new Array(s+1).join(i)+t+new Array(o+1).join(i);break;default:t+=new Array(e+1-t.length).join(i)}return t},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var t,e,i,n,o,s,a=arguments[0]||{},h=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},h=2),u===h&&(a=this,--h);h<u;h++)if(null!=(t=arguments[h]))for(e in t)i=a[e],a!==(n=t[e])&&(c&&n&&(r.Utils.isPlainObject(n)||(o=Array.isArray(n)))?(o?(o=!1,s=i&&Array.isArray(i)?i:[]):s=i&&r.Utils.isPlainObject(i)?i:{},a[e]=r.Utils.extend(c,s,n)):void 0!==n&&(a[e]=n));return a},mixinPrototype:function(t,e,i){void 0===i&&(i=!1);for(var n=Object.keys(e),r=0;r<n.length;r++){var o=n[r],s=e[o];!i&&o in t||(!s||"function"!=typeof s.get&&"function"!=typeof s.set?t[o]=s:"function"==typeof s.clone?t[o]=s.clone():Object.defineProperty(t,o,s))}},mixin:function(t,e){if(!t||"object"!=typeof t)return e;for(var i in t){var n=t[i];if(!n.childNodes&&!n.cloneNode){var o=typeof t[i];t[i]&&"object"===o?typeof e[i]===o?e[i]=r.Utils.mixin(t[i],e[i]):e[i]=r.Utils.mixin(t[i],new n.constructor):e[i]=t[i]}}return e}},r.Circle=function(t,e,i){t=t||0,e=e||0,i=i||0,this.x=t,this.y=e,this._diameter=i,this._radius=0,i>0&&(this._radius=.5*i),this.type=r.CIRCLE},r.Circle.prototype={circumference:function(){return Math.PI*this._radius*2},random:function(t){void 0===t&&(t=new r.Point);var e=2*Math.PI*Math.random(),i=Math.random()+Math.random(),n=i>1?2-i:i,o=n*Math.cos(e),s=n*Math.sin(e);return t.x=this.x+o*this.radius,t.y=this.y+s*this.radius,t},getBounds:function(){return new r.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){return this.x=t,this.y=e,this._diameter=i,this._radius=.5*i,this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.diameter=this._diameter,t},distance:function(t,e){var i=r.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(i):i},clone:function(t){return void 0===t||null===t?t=new r.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,e){return r.Circle.contains(this,t,e)},circumferencePoint:function(t,e,i){return r.Circle.circumferencePoint(this,t,e,i)},sample:function(t,e,i,n,o){t||(t=60),null==e&&(e=0),null==i&&(i=r.Math.PI2),o||(o=[]);for(var s=0;s<t;)this.circumferencePoint(r.Math.linear(e,i,s/t),n,o[s]||(o[s]=new r.Point)),s+=1;return o},offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},r.Circle.prototype.constructor=r.Circle,Object.defineProperty(r.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){t>0&&(this._diameter=t,this._radius=.5*t)}}),Object.defineProperty(r.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){t>0&&(this._radius=t,this._diameter=2*t)}}),Object.defineProperty(r.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){t>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-t}}),Object.defineProperty(r.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){t<this.x?(this._radius=0,this._diameter=0):this.radius=t-this.x}}),Object.defineProperty(r.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){t>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-t}}),Object.defineProperty(r.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){t<this.y?(this._radius=0,this._diameter=0):this.radius=t-this.y}}),Object.defineProperty(r.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(r.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(t){!0===t&&this.setTo(0,0,0)}}),r.Circle.contains=function(t,e,i){if(t.radius>0&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom){return(t.x-e)*(t.x-e)+(t.y-i)*(t.y-i)<=t.radius*t.radius}return!1},r.Circle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.diameter===e.diameter},r.Circle.intersects=function(t,e){return r.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius},r.Circle.circumferencePoint=function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=new r.Point),!0===i&&(e=r.Math.degToRad(e)),n.x=t.x+t.radius*Math.cos(e),n.y=t.y+t.radius*Math.sin(e),n},r.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);if(i>e.halfWidth+t.radius)return!1;var n=Math.abs(t.y-e.y-e.halfHeight);if(n>e.halfHeight+t.radius)return!1;if(i<=e.halfWidth||n<=e.halfHeight)return!0;var r=i-e.halfWidth,o=n-e.halfHeight;return r*r+o*o<=t.radius*t.radius},r.Circle.intersectsLine=function(t,e,i){var n=t.x,o=t.y,s=(e.end.y-e.start.y)/(e.end.x-e.start.x),a=e.end.y-s*e.end.x,h=t.radius,u=t.radius,c=a+s*n,l=(n*(u*u)-s*(h*h)*(a-o)+h*u*Math.sqrt(h*h*(s*s)+u*u-c*c-o*o+2*c*o))/(h*h*(s*s)+u*u),d=(n*(u*u)-s*(h*h)*(a-o)-h*u*Math.sqrt(h*h*(s*s)+u*u-c*c-o*o+2*c*o))/(h*h*(s*s)+u*u),p=s*l+a,f=s*d+a,m=new r.Point(l,p),g=new r.Point(d,f),y=e.pointOnSegment(m.x,m.y,.01),v=e.pointOnSegment(g.x,g.y,.01);return y&&v?!i||[m,g]:y?!i||[m]:v?!i||[g]:!!i&&[]},PIXI.Circle=r.Circle,r.Ellipse=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.x=t,this.y=e,this.width=i,this.height=n,this.type=r.ELLIPSE},r.Ellipse.prototype={setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},getBounds:function(){return new r.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},clone:function(t){return void 0===t||null===t?t=new r.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,e){return r.Ellipse.contains(this,t,e)},random:function(t){void 0===t&&(t=new r.Point);var e=Math.random()*Math.PI*2,i=Math.random();return t.x=Math.sqrt(i)*Math.cos(e),t.y=Math.sqrt(i)*Math.sin(e),t.x=this.x+t.x*this.width/2,t.y=this.y+t.y*this.height/2,t},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},r.Ellipse.prototype.constructor=r.Ellipse,Object.defineProperty(r.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}}),Object.defineProperty(r.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(r.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}}),Object.defineProperty(r.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(r.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),r.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0)return!1;var n=(e-t.x)/t.width-.5,r=(i-t.y)/t.height-.5;return n*=n,r*=r,n+r<.25},r.Ellipse.intersectsLine=function(t,e,i){var n=t.x,o=t.y,s=(e.end.y-e.start.y)/(e.end.x-e.start.x),a=e.end.y-s*e.end.x,h=t.width/2,u=t.height/2,c=a+s*n,l=(n*(u*u)-s*(h*h)*(a-o)+h*u*Math.sqrt(h*h*(s*s)+u*u-c*c-o*o+2*c*o))/(h*h*(s*s)+u*u),d=(n*(u*u)-s*(h*h)*(a-o)-h*u*Math.sqrt(h*h*(s*s)+u*u-c*c-o*o+2*c*o))/(h*h*(s*s)+u*u),p=s*l+a,f=s*d+a,m=new r.Point(l,p),g=new r.Point(d,f),y=e.pointOnSegment(m.x,m.y,.01),v=e.pointOnSegment(g.x,g.y,.01);return y&&v?!i||[m,g]:y?!i||[m]:v?!i||[g]:!!i&&[]},PIXI.Ellipse=r.Ellipse,r.Line=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.start=new r.Point(t,e),this.end=new r.Point(i,n),this.type=r.LINE},r.Line.prototype={setTo:function(t,e,i,n){return this.start.setTo(t,e),this.end.setTo(i,n),this},fromPoints:function(t,e){return this.setTo(t.x,t.y,e.x,e.y),this},fromSprite:function(t,e,i){return void 0===i&&(i=!1),i?this.setTo(t.centerX,t.centerY,e.centerX,e.centerY):this.fromPoints(t,e)},fromAngle:function(t,e,i,n){return this.start.setTo(t,e),this.end.setTo(t+Math.cos(i)*n,e+Math.sin(i)*n),this},rotate:function(t,e){var i=(this.start.x+this.end.x)/2,n=(this.start.y+this.end.y)/2;return this.start.rotate(i,n,t,e),this.end.rotate(i,n,t,e),this},rotateAround:function(t,e,i,n){return this.start.rotate(t,e,i,n),this.end.rotate(t,e,i,n),this},intersects:function(t,e,i){return r.Line.intersectsPoints(this.start,this.end,t.start,t.end,e,i)},reflect:function(t){return r.Line.reflect(this,t)},midPoint:function(t){return void 0===t&&(t=new r.Point),t.x=(this.start.x+this.end.x)/2,t.y=(this.start.y+this.end.y)/2,t},centerOn:function(t,e){var i=t-(this.start.x+this.end.x)/2,n=e-(this.start.y+this.end.y)/2;this.start.add(i,n),this.end.add(i,n)},pointOnLine:function(t,e,i){return r.Math.fuzzyEqual((t-this.start.x)*(this.end.y-this.start.y),(this.end.x-this.start.x)*(e-this.start.y),i||0)},pointOnSegment:function(t,e,i){var n=Math.min(this.start.x,this.end.x),r=Math.max(this.start.x,this.end.x),o=Math.min(this.start.y,this.end.y),s=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e,i)&&t>=n&&t<=r&&e>=o&&e<=s},random:function(t){void 0===t&&(t=new r.Point);var e=Math.random();return t.x=this.start.x+e*(this.end.x-this.start.x),t.y=this.start.y+e*(this.end.y-this.start.y),t},coordinatesOnLine:function(t,e){void 0===t&&(t=1),void 0===e&&(e=[]);var i=Math.round(this.start.x),n=Math.round(this.start.y),r=Math.round(this.end.x),o=Math.round(this.end.y),s=Math.abs(r-i),a=Math.abs(o-n),h=i<r?1:-1,u=n<o?1:-1,c=s-a;e.push([i,n]);for(var l=1;i!==r||n!==o;){var d=c<<1;d>-a&&(c-=a,i+=h),d<s&&(c+=s,n+=u),l%t==0&&e.push([i,n]),l++}return e},clone:function(t){return void 0===t||null===t?t=new r.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}},Object.defineProperty(r.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(r.Line.prototype,"angle",{get:function(){return r.Point.angle(this.end,this.start)}}),Object.defineProperty(r.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(r.Line.prototype,"perpSlope",{get:function(){return-(this.end.x-this.start.x)/(this.end.y-this.start.y)}}),Object.defineProperty(r.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(r.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(r.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(r.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(r.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(r.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(r.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(r.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(r.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(r.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(r.Line.prototype,"normalAngle",{get:function(){return r.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),r.Line.intersectsPoints=function(t,e,i,n,o,s){void 0===o&&(o=!0),void 0===s&&(s=new r.Point);var a=e.y-t.y,h=n.y-i.y,u=t.x-e.x,c=i.x-n.x,l=e.x*t.y-t.x*e.y,d=n.x*i.y-i.x*n.y,p=a*c-h*u;if(0===p)return null;if(s.x=(u*d-c*l)/p,s.y=(h*l-a*d)/p,o){var f=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y),m=((n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x))/f,g=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/f;return m>=0&&m<=1&&g>=0&&g<=1?s:null}return s},r.Line.intersects=function(t,e,i,n){return r.Line.intersectsPoints(t.start,t.end,e.start,e.end,i,n)},r.Line.intersectsRectangle=function(t,e){if(0===t.length||e.empty)return!1;var i=t.start.x,n=t.start.y,r=t.end.x,o=t.end.y,s=e.x,a=e.y,h=e.right,u=e.bottom,c=0;if(i>=s&&i<=h&&n>=a&&n<=u||r>=s&&r<=h&&o>=a&&o<=u)return!0;if(i<s&&r>=s){if((c=n+(o-n)*(s-i)/(r-i))>a&&c<=u)return!0}else if(i>h&&r<=h&&(c=n+(o-n)*(h-i)/(r-i))>=a&&c<=u)return!0;if(n<a&&o>=a){if((c=i+(r-i)*(a-n)/(o-n))>=s&&c<=h)return!0}else if(n>u&&o<=u&&(c=i+(r-i)*(u-n)/(o-n))>=s&&c<=h)return!0;return!1},r.Line.intersectionWithRectangle=function(t,e,i){var n=r.Line.intersectionWithRectangle;i||(i=new r.Point),n.edges||(n.edges=[new r.Line,new r.Line,new r.Line,new r.Line]),n.edgeIntersection||(n.edgeIntersection=new r.Point);var o=n.edges,s=n.edgeIntersection.set(0),a=e.x,h=e.y,u=e.right,c=e.bottom,l=1/0;o[0].setTo(a,h,u,h),o[1].setTo(a,c,u,c),o[2].setTo(a,h,a,c),o[3].setTo(u,h,u,c);for(var d,p=0;d=o[p];p++)if(t.intersects(d,!0,s)){var f=t.start.distance(s);f<l&&(l=f,i.copyFrom(s))}return null!=f?i:null},r.Line.reflect=function(t,e){return 2*e.normalAngle-3.141592653589793-t.angle},r.Matrix=function(t,e,i,n,o,s){void 0!==t&&null!==t||(t=1),void 0!==e&&null!==e||(e=0),void 0!==i&&null!==i||(i=0),void 0!==n&&null!==n||(n=1),void 0!==o&&null!==o||(o=0),void 0!==s&&null!==s||(s=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=o,this.ty=s,this.type=r.MATRIX},r.Matrix.prototype={fromArray:function(t){return this.setTo(t[0],t[1],t[3],t[4],t[2],t[5])},setTo:function(t,e,i,n,r,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o,this},clone:function(t){return void 0===t||null===t?t=new r.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty),t},copyTo:function(t){return t.copyFrom(this),t},copyFrom:function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},toArray:function(t,e){return void 0===e&&(e=new Float32Array(9)),t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},apply:function(t,e){return void 0===e&&(e=new r.Point),e.x=this.a*t.x+this.c*t.y+this.tx,e.y=this.b*t.x+this.d*t.y+this.ty,e},applyInverse:function(t,e){void 0===e&&(e=new r.Point);var i=1/(this.a*this.d+this.c*-this.b),n=t.x,o=t.y;return e.x=this.d*i*n+-this.c*i*o+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*o+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},translate:function(t,e){return this.tx+=t,this.ty+=e,this},scale:function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},append:function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},r.identityMatrix=new r.Matrix,r.Point=function(t,e){t=t||0,e=e||0,this.x=t,this.y=e,this.type=r.POINT},r.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){return r.Point.set(this,t,e)},set:function(t,e){return r.Point.set(this,t,e)},setToPolar:function(t,e,i){return null==e&&(e=1),i&&(t=r.Math.degToRad(t)),this.setTo(Math.cos(t)*e,Math.sin(t)*e)},add:function(t,e){return this.x+=t,this.y+=e,this},subtract:function(t,e){return this.x-=t,this.y-=e,this},multiply:function(t,e){return this.x*=t,this.y*=e,this},divide:function(t,e){return this.x/=t,this.y/=e,this},clampX:function(t,e){return this.x=r.Math.clamp(this.x,t,e),this},clampY:function(t,e){return this.y=r.Math.clamp(this.y,t,e),this},clamp:function(t,e){return this.x=r.Math.clamp(this.x,t,e),this.y=r.Math.clamp(this.y,t,e),this},clip:function(t){var e=t.left,i=t.top,n=t.right,r=t.bottom;return this.x<e?this.x=e:this.x>n&&(this.x=n),this.y<i?this.y=i:this.y>r&&(this.y=r),this},clone:function(t){return void 0===t||null===t?t=new r.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(t){return t.x=this.x,t.y=this.y,t},distance:function(t,e){return r.Point.distance(this,t,e)},equals:function(t){return t.x===this.x&&t.y===this.y},equalsXY:function(t,e){return this.x===t&&this.y===e},fuzzyEquals:function(t,e){return r.Point.fuzzyEquals(this,t,e)},fuzzyEqualsXY:function(t,e,i){return r.Point.fuzzyEqualsXY(this,t,e,i)},angle:function(t,e){return this.angleXY(t.x,t.y,e)},angleXY:function(t,e,i){var n=Math.atan2(e-this.y,t-this.x);return i?r.Math.radToDeg(n):n},atan:function(t){var e=Math.atan2(this.y,this.x);return t?r.Math.radToDeg(e):e},rotate:function(t,e,i,n,o){return r.Point.rotate(this,t,e,i,n,o)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){if(!this.isZero()){var t=this.getMagnitude();this.x/=t,this.y/=t}return this},limit:function(t){return this.getMagnitudeSq()>t*t&&this.setMagnitude(t),this},expand:function(t){return this.getMagnitudeSq()<t*t&&this.setMagnitude(t),this},isZero:function(){return 0===this.x&&0===this.y},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},r.Point.prototype.constructor=r.Point,r.Point.add=function(t,e,i){return void 0===i&&(i=new r.Point),i.x=t.x+e.x,i.y=t.y+e.y,i},r.Point.subtract=function(t,e,i){return void 0===i&&(i=new r.Point),i.x=t.x-e.x,i.y=t.y-e.y,i},r.Point.multiply=function(t,e,i){return void 0===i&&(i=new r.Point),i.x=t.x*e.x,i.y=t.y*e.y,i},r.Point.divide=function(t,e,i){return void 0===i&&(i=new r.Point),i.x=t.x/e.x,i.y=t.y/e.y,i},r.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y},r.Point.equalsXY=function(t,e,i){return t.x===e&&t.y===i},r.Point.fuzzyEquals=function(t,e,i){return r.Math.fuzzyEquals(t.x,e.x,i)&&r.Math.fuzzyEquals(t.y,e.y,i)},r.Point.fuzzyEqualsXY=function(t,e,i,n){return r.Math.fuzzyEquals(t.x,e,n)&&r.Math.fuzzyEquals(t.y,i,n)},r.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},r.Point.negative=function(t,e){return void 0===e&&(e=new r.Point),e.setTo(-t.x,-t.y)},r.Point.multiplyAdd=function(t,e,i,n){return void 0===n&&(n=new r.Point),n.setTo(t.x+e.x*i,t.y+e.y*i)},r.Point.interpolate=function(t,e,i,n){return void 0===n&&(n=new r.Point),n.setTo(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},r.Point.perp=function(t,e){return void 0===e&&(e=new r.Point),e.setTo(-t.y,t.x)},r.Point.rperp=function(t,e){return void 0===e&&(e=new r.Point),e.setTo(t.y,-t.x)},r.Point.distance=function(t,e,i){var n=r.Math.distance(t.x,t.y,e.x,e.y);return i?Math.round(n):n},r.Point.project=function(t,e,i){void 0===i&&(i=new r.Point);var n=t.dot(e)/e.getMagnitudeSq();return 0!==n&&i.setTo(n*e.x,n*e.y),i},r.Point.projectUnit=function(t,e,i){void 0===i&&(i=new r.Point);var n=t.dot(e);return 0!==n&&i.setTo(n*e.x,n*e.y),i},r.Point.normalRightHand=function(t,e){return void 0===e&&(e=new r.Point),e.setTo(-1*t.y,t.x)},r.Point.normalize=function(t,e){void 0===e&&(e=new r.Point);var i=t.getMagnitude();return 0!==i&&e.setTo(t.x/i,t.y/i),e},r.Point.rotate=function(t,e,i,n,o,s){if(o&&(n=r.Math.degToRad(n)),void 0===s){t.subtract(e,i);var a=Math.sin(n),h=Math.cos(n),u=h*t.x-a*t.y,c=a*t.x+h*t.y;t.x=u+e,t.y=c+i}else{var l=n+Math.atan2(t.y-i,t.x-e);t.x=e+s*Math.cos(l),t.y=i+s*Math.sin(l)}return t},r.Point.centroid=function(t,e){if(void 0===e&&(e=new r.Point),"[object Array]"!==Object.prototype.toString.call(t))throw new Error("Phaser.Point. Parameter 'points' must be an array");var i=t.length;if(i<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===i)return e.copyFrom(t[0]),e;for(var n=0;n<i;n++)r.Point.add(e,t[n],e);return e.divide(i,i),e},r.Point.parse=function(t,e,i){e=e||"x",i=i||"y";var n=new r.Point;return t[e]&&(n.x=parseInt(t[e],10)),t[i]&&(n.y=parseInt(t[i],10)),n},r.Point.isPoint=function(t){return null!=t&&"number"==typeof t.x&&"number"==typeof t.y},r.Point.set=function(t,e,i){return t.x=e||0,t.y=i||(0!==i?t.x:0),t},r.Point.sortClockwise=function(t,e){e||(e=this.centroid(t));var i=e.x,n=e.y;return t.sort(function(t,e){if(t.x-i>=0&&e.x-i<0)return-1;if(t.x-i<0&&e.x-i>=0)return 1;if(t.x-i==0&&e.x-i==0)return t.y-n>=0||e.y-n>=0?t.y>e.y?1:-1:e.y>t.y?1:-1;var r=(t.x-i)*-(e.y-n)-(e.x-i)*-(t.y-n);if(r<0)return-1;if(r>0)return 1;return(t.x-i)*(t.x-i)+(t.y-n)*(t.y-n)>(e.x-i)*(e.x-i)+(e.y-n)*(e.y-n)?-1:1})},PIXI.Point=r.Point,r.Polygon=function(){this.area=0,this._points=[],arguments.length>0&&this.setTo.apply(this,arguments),this.closed=!0,this.flattened=!1,this.type=r.POLYGON},r.Polygon.prototype={toNumberArray:function(t){void 0===t&&(t=[]);for(var e=0;e<this._points.length;e++)"number"==typeof this._points[e]?(t.push(this._points[e]),t.push(this._points[e+1]),e++):(t.push(this._points[e].x),t.push(this._points[e].y));return t},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(t){var e=this._points.slice();return void 0===t||null===t?t=new r.Polygon(e):t.setTo(e),t},contains:function(t,e){var i=!1;if(this.flattened)for(var n=-2,r=this._points.length-2;(n+=2)<this._points.length;r=n){var o=this._points[n],s=this._points[n+1],a=this._points[r],h=this._points[r+1];(s<=e&&e<h||h<=e&&e<s)&&t<(a-o)*(e-s)/(h-s)+o&&(i=!i)}else for(n=-1,r=this._points.length-1;++n<this._points.length;r=n){o=this._points[n].x,s=this._points[n].y,a=this._points[r].x,h=this._points[r].y;(s<=e&&e<h||h<=e&&e<s)&&t<(a-o)*(e-s)/(h-s)+o&&(i=!i)}return i},setTo:function(t){if(this.area=0,this._points=[],arguments.length>0){Array.isArray(t)||(t=Array.prototype.slice.call(arguments));for(var e=Number.MAX_VALUE,i=0,n=t.length;i<n;i++){if("number"==typeof t[i]){var r=new PIXI.Point(t[i],t[i+1]);i++}else if(Array.isArray(t[i]))r=new PIXI.Point(t[i][0],t[i][1]);else r=new PIXI.Point(t[i].x,t[i].y);this._points.push(r),r.y<e&&(e=r.y)}this.calculateArea(e)}return this},calculateArea:function(t){for(var e,i,n,r,o=0,s=this._points.length;o<s;o++)e=this._points[o],i=o===s-1?this._points[0]:this._points[o+1],n=(e.y-t+(i.y-t))/2,r=e.x-i.x,this.area+=n*r;return this.area}},r.Polygon.prototype.constructor=r.Polygon,Object.defineProperty(r.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){null!=t?this.setTo(t):this.setTo()}}),PIXI.Polygon=r.Polygon,r.Rectangle=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.x=t,this.y=e,this.width=i,this.height=n,this.type=r.RECTANGLE},r.Rectangle.prototype={offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},scale:function(t,e){return void 0===e&&(e=t),this.width*=t,this.height*=e,this},centerOn:function(t,e){return this.centerX=t,this.centerY=e,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyFromBounds:function(t){return this.setTo(t.left,t.top,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},inflate:function(t,e){return r.Rectangle.inflate(this,t,e)},size:function(t){return r.Rectangle.size(this,t)},resize:function(t,e){return this.width=t,this.height=e,this},clone:function(t){return r.Rectangle.clone(this,t)},contains:function(t,e){return r.Rectangle.contains(this,t,e)},containsRect:function(t){return r.Rectangle.containsRect(t,this)},equals:function(t){return r.Rectangle.equals(this,t)},intersection:function(t,e){return r.Rectangle.intersection(this,t,e)},intersects:function(t){return r.Rectangle.intersects(this,t)},intersectsRaw:function(t,e,i,n,o){return r.Rectangle.intersectsRaw(this,t,e,i,n,o)},union:function(t,e){return r.Rectangle.union(this,t,e)},random:function(t){return void 0===t&&(t=new r.Point),t.x=this.randomX,t.y=this.randomY,t},getPoint:function(t,e){switch(void 0===e&&(e=new r.Point),t){default:case r.TOP_LEFT:return e.set(this.x,this.y);case r.TOP_CENTER:return e.set(this.centerX,this.y);case r.TOP_RIGHT:return e.set(this.right,this.y);case r.LEFT_CENTER:return e.set(this.x,this.centerY);case r.CENTER:return e.set(this.centerX,this.centerY);case r.RIGHT_CENTER:return e.set(this.right,this.centerY);case r.BOTTOM_LEFT:return e.set(this.x,this.bottom);case r.BOTTOM_CENTER:return e.set(this.centerX,this.bottom);case r.BOTTOM_RIGHT:return e.set(this.right,this.bottom)}},sides:function(t,e,i,n){arguments.length||(t=new r.Line,e=new r.Line,i=new r.Line,n=new r.Line);var o=this.x,s=this.y,a=this.right,h=this.bottom;return t.setTo(o,s,a,s),e.setTo(a,s,a,h),i.setTo(o,h,a,h),n.setTo(o,s,o,h),arguments.length?null:[t,e,i,n]},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(r.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(r.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(r.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<=this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(r.Rectangle.prototype,"bottomLeft",{get:function(){return new r.Point(this.x,this.bottom)},set:function(t){this.x=t.x,this.bottom=t.y}}),Object.defineProperty(r.Rectangle.prototype,"bottomRight",{get:function(){return new r.Point(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y}}),Object.defineProperty(r.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){t>=this.right?this.width=0:this.width=this.right-t,this.x=t}}),Object.defineProperty(r.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<=this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(r.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(r.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(r.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}}),Object.defineProperty(r.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}}),Object.defineProperty(r.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(r.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(r.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){t>=this.bottom?(this.height=0,this.y=t):this.height=this.bottom-t}}),Object.defineProperty(r.Rectangle.prototype,"topLeft",{get:function(){return new r.Point(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}}),Object.defineProperty(r.Rectangle.prototype,"topRight",{get:function(){return new r.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x,this.y=t.y}}),Object.defineProperty(r.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),r.Rectangle.prototype.constructor=r.Rectangle,r.Rectangle.inflate=function(t,e,i){return t.x-=e,t.width+=2*e,t.y-=i,t.height+=2*i,t},r.Rectangle.inflatePoint=function(t,e){return r.Rectangle.inflate(t,e.x,e.y)},r.Rectangle.size=function(t,e){return void 0===e||null===e?e=new r.Point(t.width,t.height):e.setTo(t.width,t.height),e},r.Rectangle.clone=function(t,e){return void 0===e||null===e?e=new r.Rectangle(t.x,t.y,t.width,t.height):e.setTo(t.x,t.y,t.width,t.height),e},r.Rectangle.createFromBounds=function(t,e){return void 0!==e&&null!==e||(e=new r.Rectangle(t.x,t.y,t.width,t.height)),e.copyFromBounds(t)},r.Rectangle.contains=function(t,e,i){return!(t.width<=0||t.height<=0)&&(e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom)},r.Rectangle.containsRaw=function(t,e,i,n,r,o){return r>=t&&r<t+i&&o>=e&&o<e+n},r.Rectangle.containsPoint=function(t,e){return r.Rectangle.contains(t,e.x,e.y)},r.Rectangle.containsRect=function(t,e){return!(t.volume>e.volume)&&(t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom)},r.Rectangle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},r.Rectangle.sameDimensions=function(t,e){return t.width===e.width&&t.height===e.height},r.Rectangle.intersection=function(t,e,i){return void 0===i&&(i=new r.Rectangle),r.Rectangle.intersects(t,e)&&(i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.width=Math.min(t.right,e.right)-i.x,i.height=Math.min(t.bottom,e.bottom)-i.y),i},r.Rectangle.intersects=function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0)&&!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)},r.Rectangle.intersectsRaw=function(t,e,i,n,r,o){return void 0===o&&(o=0),!(e>t.right+o||i<t.left-o||n>t.bottom+o||r<t.top-o)},r.Rectangle.union=function(t,e,i){return void 0===i&&(i=new r.Rectangle),i.setTo(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.right,e.right)-Math.min(t.left,e.left),Math.max(t.bottom,e.bottom)-Math.min(t.top,e.top))},r.Rectangle.aabb=function(t,e){void 0===e&&(e=new r.Rectangle);var i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;return t.forEach(function(t){t.x>i&&(i=t.x),t.x<n&&(n=t.x),t.y>o&&(o=t.y),t.y<s&&(s=t.y)}),e.setTo(n,s,i-n,o-s),e},PIXI.Rectangle=r.Rectangle,PIXI.EmptyRectangle=new r.Rectangle(0,0,0,0),r.RoundedRectangle=function(t,e,i,n,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=20),this.x=t,this.y=e,this.width=i,this.height=n,this.radius=o||20,this.type=r.ROUNDEDRECTANGLE},r.RoundedRectangle.prototype={clone:function(){return new r.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var n=this.y;if(e>=n&&e<=n+this.height)return!0}return!1}},r.RoundedRectangle.prototype.constructor=r.RoundedRectangle,PIXI.RoundedRectangle=r.RoundedRectangle,r.Camera=function(t,e,i,n,o,s){this.game=t,this.world=t.world,this.id=0,this.view=new r.Rectangle(i,n,o,s),this.bounds=new r.Rectangle(i,n,o,s),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this.lerp=new r.Point(1,1),this.onShakeComplete=new r.Signal,this.onFlashComplete=new r.Signal,this.onFadeComplete=new r.Signal,this.fx=null,this._targetPosition=new r.Point,this._edge=0,this._position=new r.Point,this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0},this._fxDuration=0,this._fxType=0,this._fixedView=new r.Rectangle},r.Camera.FOLLOW_LOCKON=0,r.Camera.FOLLOW_PLATFORMER=1,r.Camera.FOLLOW_TOPDOWN=2,r.Camera.FOLLOW_TOPDOWN_TIGHT=3,r.Camera.SHAKE_BOTH=4,r.Camera.SHAKE_HORIZONTAL=5,r.Camera.SHAKE_VERTICAL=6,r.Camera.ENABLE_FX=!0,r.Camera.prototype={boot:function(){this.displayObject=this.game.world,this.scale=this.game.world.scale,this.game.camera=this,r.Graphics&&r.Camera.ENABLE_FX&&(this.fx=new r.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(t,e,i,n){void 0===e&&(e=r.Camera.FOLLOW_LOCKON),void 0===i&&(i=1),void 0===n&&(n=1),this.target=t,this.lerp.set(i,n);var o;switch(e){case r.Camera.FOLLOW_PLATFORMER:var s=this.width/8,a=this.height/3;this.deadzone=new r.Rectangle((this.width-s)/2,(this.height-a)/2-.25*a,s,a);break;case r.Camera.FOLLOW_TOPDOWN:o=Math.max(this.width,this.height)/4,this.deadzone=new r.Rectangle((this.width-o)/2,(this.height-o)/2,o,o);break;case r.Camera.FOLLOW_TOPDOWN_TIGHT:o=Math.max(this.width,this.height)/8,this.deadzone=new r.Rectangle((this.width-o)/2,(this.height-o)/2,o,o);break;case r.Camera.FOLLOW_LOCKON:default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},shake:function(t,e,i,n,o){return void 0===t&&(t=.05),void 0===e&&(e=500),void 0===i&&(i=!0),void 0===n&&(n=r.Camera.SHAKE_BOTH),void 0===o&&(o=!0),!(!i&&this._shake.duration>0)&&(this._shake.intensity=t,this._shake.duration=e,this._shake.shakeBounds=o,this._shake.x=0,this._shake.y=0,this._shake.horizontal=n===r.Camera.SHAKE_BOTH||n===r.Camera.SHAKE_HORIZONTAL,this._shake.vertical=n===r.Camera.SHAKE_BOTH||n===r.Camera.SHAKE_VERTICAL,!0)},flash:function(t,e,i,n){return void 0===t&&(t=16777215),void 0===e&&(e=500),void 0===i&&(i=!1),void 0===n&&(n=1),!(!this.fx||!i&&this._fxDuration>0)&&(this.fx.clear(),this.fx.beginFill(t,n),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=e,this._fxType=0,!0)},fade:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=500),void 0===i&&(i=!1),void 0===n&&(n=1),!(!this.fx||!i&&this._fxDuration>0)&&(this.fx.clear(),this.fx.beginFill(t,n),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=0,this._fxDuration=e,this._fxType=1,!0)},update:function(){this._fxDuration>0&&this.updateFX(),this._shake.duration>0&&this.updateShake(),this.bounds&&this.checkBounds(),this.roundPx&&(this.view.floor(),this._shake.x=Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y)),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateFX:function(){0===this._fxType?(this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha<=0&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha>=1&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS,this._shake.duration<=0?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x,this._targetPosition.y=this.view.y+this.target.worldPosition.y,this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1;var t=this.view.x+this._shake.x,e=this.view.right+this._shake.x,i=this.view.y+this._shake.y,n=this.view.bottom+this._shake.y;t<=this.bounds.x*this.scale.x?(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0)):e>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0)),i<=this.bounds.top*this.scale.y?(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0)):n>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||(this._shake.y=0))},setPosition:function(t,e){this.view.x=t,this.view.y=e,this.bounds&&this.checkBounds()},setSize:function(t,e){this.view.width=t,this.view.height=e},reset:function(){this.target=null,this.view.x=0,this.view.y=0,this._shake.duration=0,this._shake.x=0,this._shake.y=0,this.resetFX()},resetFX:function(){this.fx&&(this.fx.clear(),this.fx.alpha=0),this._fxDuration=0}},r.Camera.prototype.constructor=r.Camera,Object.defineProperty(r.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(r.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(r.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(t){"undefined"!=typeof t.x&&(this.view.x=t.x),"undefined"!=typeof t.y&&(this.view.y=t.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(r.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}}),Object.defineProperty(r.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}}),Object.defineProperty(r.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(t){this._shake.intensity=t}}),Object.defineProperty(r.Camera.prototype,"fixedView",{get:function(){return this._fixedView.setTo(0,0,this.view.width,this.view.height),this._fixedView}}),r.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.state=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},r.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},r.State.prototype.constructor=r.State,r.StateManager=function(t,e){this.game=t,this.states={},this._pendingState=null,"undefined"!=typeof e&&null!==e&&(this._pendingState=e),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onStateChange=new r.Signal,this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},r.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(t,e,i){void 0===i&&(i=!1);var n;return e instanceof r.State?n=e:"object"==typeof e?(n=e).game=this.game:"function"==typeof e&&(n=new e(this.game)),this.states[t]=n,i&&(this.game.isBooted?this.start(t):this._pendingState=t),n},remove:function(t){this.current===t&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[t]},start:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.checkState(t)&&(this._pendingState=t,this._clearWorld=e,this._clearCache=i,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this._pendingState=this.current,this._clearWorld=t,this._clearCache=e,arguments.length>2&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var t=this.current;if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,t),this.current!==this._pendingState)return;this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(t){var e=this.states[t];return e?!!(e.preload||e.create||e.update||e.render)||(console.warn("Invalid Phaser State object given. Must contain at least one of the required functions: preload, create, update or render"),!1):(console.warn("Phaser.StateManager - No state found with the key: "+t),!1)},link:function(t){this.states[t].game=this.game,this.states[t].add=this.game.add,this.states[t].make=this.game.make,this.states[t].camera=this.game.camera,this.states[t].cache=this.game.cache,this.states[t].input=this.game.input,this.states[t].load=this.game.load,this.states[t].math=this.game.math,this.states[t].sound=this.game.sound,this.states[t].scale=this.game.scale,this.states[t].state=this,this.states[t].stage=this.game.stage,this.states[t].time=this.game.time,this.states[t].tweens=this.game.tweens,this.states[t].world=this.game.world,this.states[t].particles=this.game.particles,this.states[t].rnd=this.game.rnd,this.states[t].physics=this.game.physics,this.states[t].key=t},unlink:function(t){this.states[t]&&(this.states[t].game=null,this.states[t].add=null,this.states[t].make=null,this.states[t].camera=null,this.states[t].cache=null,this.states[t].input=null,this.states[t].load=null,this.states[t].math=null,this.states[t].sound=null,this.states[t].scale=null,this.states[t].state=null,this.states[t].stage=null,this.states[t].time=null,this.states[t].tweens=null,this.states[t].world=null,this.states[t].particles=null,this.states[t].rnd=null,this.states[t].physics=null)},setCurrentState:function(t){this.callbackContext=this.states[t],this.link(t),this.onInitCallback=this.states[t].init||this.dummy,this.onPreloadCallback=this.states[t].preload||null,this.onLoadRenderCallback=this.states[t].loadRender||null,this.onLoadUpdateCallback=this.states[t].loadUpdate||null,this.onCreateCallback=this.states[t].create||null,this.onUpdateCallback=this.states[t].update||null,this.onPreRenderCallback=this.states[t].preRender||null,this.onRenderCallback=this.states[t].render||null,this.onResizeCallback=this.states[t].resize||null,this.onPausedCallback=this.states[t].paused||null,this.onResumedCallback=this.states[t].resumed||null,this.onPauseUpdateCallback=this.states[t].pauseUpdate||null,this.onShutDownCallback=this.states[t].shutdown||this.dummy,""!==this.current&&this.game.physics.reset(),this.current=t,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),t===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game),!1===this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(t){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,t)},resize:function(t,e){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,t,e)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===r.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0,this._clearCache=!0,this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},r.StateManager.prototype.constructor=r.StateManager,Object.defineProperty(r.StateManager.prototype,"created",{get:function(){return this._created}}),r.Signal=function(){},r.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,e,i,n,o){var s,a=this._indexOfListener(t,i);if(-1!==a){if((s=this._bindings[a]).isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else s=new r.SignalBinding(this,t,e,i,n,o),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(t){this._bindings||(this._bindings=[]);var e=this._bindings.length;do{e--}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings)return-1;void 0===e&&(e=null);for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===t&&i.context===e)return n;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){this.validateListener(t,"add");var n=[];if(arguments.length>3)for(var r=3;r<arguments.length;r++)n.push(arguments[r]);return this._registerListener(t,!1,e,i,n)},addOnce:function(t,e,i){this.validateListener(t,"addOnce");var n=[];if(arguments.length>3)for(var r=3;r<arguments.length;r++)n.push(arguments[r]);return this._registerListener(t,!0,e,i,n)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},removeAll:function(t){if(void 0===t&&(t=null),this._bindings){for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(e))}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(r.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}}),r.Signal.prototype.constructor=r.Signal,r.SignalBinding=function(t,e,i,n,r,o){this._listener=e,i&&(this._isOnce=!0),null!=n&&(this.context=n),this._signal=t,r&&(this._priority=r),o&&o.length&&(this._args=o)},r.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,this._args&&(i=i.concat(this._args)),e=this._listener.apply(this.context,i),this.callCount++,this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.SignalBinding.prototype.constructor=r.SignalBinding,r.Filter=function(t,e,i){this.game=t,this.type=r.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new r.Point;var n=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[n.getFullYear(),n.getMonth(),n.getDate(),60*n.getHours()*60+60*n.getMinutes()+n.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},e)for(var o in e)this.uniforms[o]=e[o];"string"==typeof i&&(i=i.split("\n")),this.fragmentSrc=i||[]},r.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t,this.uniforms.resolution.value.y=e},update:function(t){if(t){var e=t.x/this.game.width,i=1-t.y/this.game.height;e===this.prevPoint.x&&i===this.prevPoint.y||(this.uniforms.mouse.value.x=e.toFixed(2),this.uniforms.mouse.value.y=i.toFixed(2),this.prevPoint.set(e,i))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(t,e,i,n,o,s){void 0===o&&(o=0),void 0===s&&(s=0),void 0!==i&&null!==i?this.width=i:i=this.width,void 0!==n&&null!==n?this.height=n:n=this.height;var a=this.game.add.image(t,e,r.Cache.DEFAULT);return a.width=i,a.height=n,a.anchor.set(o,s),a.filters=[this],a},syncUniforms:function(){for(var t=0;t<this.shaders.length;t++)this.shaders[t].dirty=!0},destroy:function(){this.passes.length=0,this.shaders.length=0,this.fragmentSrc.length=0,this.game=null,this.uniforms=null,this.prevPoint=null}},r.Filter.prototype.constructor=r.Filter,Object.defineProperty(r.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}}),Object.defineProperty(r.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}}),r.Plugin=function(t,e){void 0===e&&(e=null),this.game=t,this.parent=e,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},r.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},r.Plugin.prototype.constructor=r.Plugin,r.PluginManager=function(t){this.game=t,this.plugins=[],this._len=0,this._i=0},r.PluginManager.prototype={add:function(t){var e=Array.prototype.slice.call(arguments,1),i=!1;return"function"==typeof t?t=new t(this.game,this):(t.game=this.game,t.parent=this),"function"==typeof t.preUpdate&&(t.hasPreUpdate=!0,i=!0),"function"==typeof t.update&&(t.hasUpdate=!0,i=!0),"function"==typeof t.postUpdate&&(t.hasPostUpdate=!0,i=!0),"function"==typeof t.render&&(t.hasRender=!0,i=!0),"function"==typeof t.postRender&&(t.hasPostRender=!0,i=!0),i?((t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate)&&(t.active=!0),(t.hasRender||t.hasPostRender)&&(t.visible=!0),this._len=this.plugins.push(t),"function"==typeof t.init&&t.init.apply(t,e),t):null},remove:function(t,e){for(void 0===e&&(e=!0),this._i=this._len;this._i--;)if(this.plugins[this._i]===t)return e&&t.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},r.PluginManager.prototype.constructor=r.PluginManager,r.Stage=function(t){this.game=t,PIXI.DisplayObjectContainer.call(this),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.worldTransform=new r.Matrix,this.stage=this,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"},this.game.transparent||(this._bgColor.a=1),t.config&&this.parseConfig(t.config)},r.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),r.Stage.prototype.constructor=r.Stage,r.Stage.prototype.parseConfig=function(t){t.disableVisibilityChange&&(this.disableVisibilityChange=t.disableVisibilityChange),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor)},r.Stage.prototype.boot=function(){r.DOM.getOffset(this.game.canvas,this.offset),r.Canvas.setUserSelect(this.game.canvas,"none"),r.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},r.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var t=0;t<this.children.length;){var e=this.children[t];e.preUpdate(),this===e.parent&&t++}},r.Stage.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},r.Stage.prototype.postUpdate=function(){this.game.camera.update(),this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var t=0;t<this.children.length;t++)this.children[t].postUpdate();this.updateTransform()},r.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},r.Stage.prototype.checkVisibility=function(){void 0!==document.hidden?this._hiddenVar="visibilitychange":void 0!==document.webkitHidden?this._hiddenVar="webkitvisibilitychange":void 0!==document.mozHidden?this._hiddenVar="mozvisibilitychange":void 0!==document.msHidden?this._hiddenVar="msvisibilitychange":this._hiddenVar=null;var t=this;this._onChange=function(e){return t.visibilityChange(e)},this._onClick=function(e){void 0===document.hasFocus||document.hasFocus()||t.visibilityChange(e)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,window.addEventListener("click",this._onClick),this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){r.Stage.prototype.visibilityChange.call(t,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){r.Stage.prototype.visibilityChange.call(t,{type:"resume"})}))},r.Stage.prototype.visibilityChange=function(t){switch(t.type){case"blur":case"pagehide":return void this.game.focusLoss(t);case"click":case"focus":case"pageshow":return void this.game.focusGain(t)}this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===t.type?this.game.gamePaused(t):this.game.gameResumed(t))},r.Stage.prototype.setBackgroundColor=function(t){this.game.transparent||(r.Color.valueToColor(t,this._bgColor),r.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)},r.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null,window.removeEventListener("click",this._onClick)},Object.defineProperty(r.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(t){this.setBackgroundColor(t)}}),Object.defineProperty(r.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(t){PIXI.scaleModes.DEFAULT=t?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),r.Group=function(t,e,i,n,o,s){void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===s&&(s=r.Physics.ARCADE),this.game=t,void 0===e&&(e=t.world),this.name=i||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),n?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):e&&(e.addChild(this),this.z=e.children.length),this.type=r.GROUP,this.physicsType=r.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.pendingDestroy=!1,this.classType=r.Sprite,this.cursor=null,this.inputEnableChildren=!1,this.updateOnlyExistingChildren=!1,this.onChildInputDown=new r.Signal,this.onChildInputUp=new r.Signal,this.onChildInputOver=new r.Signal,this.onChildInputOut=new r.Signal,this.enableBody=o,this.enableBodyDebug=!1,this.physicsBodyType=s,this.physicsSortDirection=null,this.onDestroy=new r.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new r.Point,this.hash=[],this._sortProperty="z"},r.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),r.Group.prototype.constructor=r.Group,r.Group.RETURN_NONE=0,r.Group.RETURN_TOTAL=1,r.Group.RETURN_CHILD=2,r.Group.RETURN_ALL=3,r.Group.SORT_ASCENDING=-1,r.Group.SORT_DESCENDING=1,r.Group.prototype.add=function(t,e,i){return void 0===e&&(e=!1),t.parent===this?t:(t.body&&t.parent&&t.parent.hash&&t.parent.removeFromHash(t),void 0===i?(t.z=this.children.length,this.addChild(t)):(this.addChildAt(t,i),this.updateZ()),this.enableBody&&t.hasOwnProperty("body")&&null===t.body?this.game.physics.enable(t,this.physicsBodyType):t.body&&this.addToHash(t),!this.inputEnableChildren||t.input&&!t.inputEnabled||(t.inputEnabled=!0),!e&&t.events&&t.events.onAddedToGroup$dispatch(t,this),null===this.cursor&&(this.cursor=t),t)},r.Group.prototype.addAt=function(t,e,i){return this.add(t,i,e)},r.Group.prototype.addToHash=function(t){if(t.parent===this){if(-1===this.hash.indexOf(t))return this.hash.push(t),!0}return!1},r.Group.prototype.removeFromHash=function(t){if(t){var e=this.hash.indexOf(t);if(-1!==e)return this.hash.splice(e,1),!0}return!1},r.Group.prototype.addMultiple=function(t,e){if(t instanceof r.Group)t.moveAll(this,e);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this.add(t[i],e);return t},r.Group.prototype.getAt=function(t){return t<0||t>=this.children.length?-1:this.getChildAt(t)},r.Group.prototype.create=function(t,e,i,n,r,o){void 0===r&&(r=!0);var s=new this.classType(this.game,t,e,i,n);return s.exists=r,s.visible=r,s.alive=r,this.add(s,!1,o)},r.Group.prototype.createMultiple=function(t,e,i,n,r,o){void 0===i&&(i=0),void 0===n&&(n=!1),Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]);var s=this,a=[];return e.forEach(function(e){i.forEach(function(i){for(var h=0;h<t;h++){var u=s.create(0,0,e,i,n);r&&r.call(o||u,u,h),a.push(u)}})}),a},r.Group.prototype.updateZ=function(){for(var t=this.children.length;t--;)this.children[t].z=t},r.Group.prototype.align=function(t,e,i,n,o,s){if(void 0===o&&(o=r.TOP_LEFT),void 0===s&&(s=0),0===this.children.length||s>this.children.length||-1===t&&-1===e)return!1;for(var a=new r.Rectangle(0,0,i,n),h=t*i,u=e*n,c=s;c<this.children.length;c++){var l=this.children[c];if(l.alignIn)if(l.alignIn(a,o),-1===t)a.y+=n,a.y===u&&(a.x+=i,a.y=0);else if(-1===e)a.x+=i,a.x===h&&(a.x=0,a.y+=n);else if(a.x+=i,a.x===h&&(a.x=0,a.y+=n,a.y===u))return!0}return!0},r.Group.prototype.resetCursor=function(t){if(void 0===t&&(t=0),t>this.children.length-1&&(t=0),this.cursor)return this.cursorIndex=t,this.cursor=this.children[this.cursorIndex],this.cursor},r.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},r.Group.prototype.previous=function(){if(this.cursor)return 0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor},r.Group.prototype.swap=function(t,e){this.swapChildren(t,e),this.updateZ()},r.Group.prototype.bringToTop=function(t){return t.parent===this&&this.getIndex(t)<this.children.length&&(this.remove(t,!1,!0),this.add(t,!0)),t},r.Group.prototype.sendToBack=function(t){return t.parent===this&&this.getIndex(t)>0&&(this.remove(t,!1,!0),this.addAt(t,0,!0)),t},r.Group.prototype.moveUp=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length-1){var e=this.getIndex(t),i=this.getAt(e+1);i&&this.swap(t,i)}return t},r.Group.prototype.moveDown=function(t){if(t.parent===this&&this.getIndex(t)>0){var e=this.getIndex(t),i=this.getAt(e-1);i&&this.swap(t,i)}return t},r.Group.prototype.xy=function(t,e,i){if(t<0||t>this.children.length)return-1;this.getChildAt(t).x=e,this.getChildAt(t).y=i},r.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},r.Group.prototype.getIndex=function(t){return this.children.indexOf(t)},r.Group.prototype.getByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},r.Group.prototype.replace=function(t,e){var i=this.getIndex(t);if(-1!==i)return e.parent&&(e.parent instanceof r.Group?e.parent.remove(e):e.parent.removeChild(e)),this.remove(t),this.addAt(e,i),t},r.Group.prototype.hasProperty=function(t,e){var i=e.length;return 1===i&&e[0]in t||(2===i&&e[0]in t&&e[1]in t[e[0]]||(3===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]||4===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]))},r.Group.prototype.setProperty=function(t,e,i,n,r){if(void 0===r&&(r=!1),n=n||0,!this.hasProperty(t,e)&&(!r||n>0))return!1;var o=e.length;return 1===o?0===n?t[e[0]]=i:1===n?t[e[0]]+=i:2===n?t[e[0]]-=i:3===n?t[e[0]]*=i:4===n&&(t[e[0]]/=i):2===o?0===n?t[e[0]][e[1]]=i:1===n?t[e[0]][e[1]]+=i:2===n?t[e[0]][e[1]]-=i:3===n?t[e[0]][e[1]]*=i:4===n&&(t[e[0]][e[1]]/=i):3===o?0===n?t[e[0]][e[1]][e[2]]=i:1===n?t[e[0]][e[1]][e[2]]+=i:2===n?t[e[0]][e[1]][e[2]]-=i:3===n?t[e[0]][e[1]][e[2]]*=i:4===n&&(t[e[0]][e[1]][e[2]]/=i):4===o&&(0===n?t[e[0]][e[1]][e[2]][e[3]]=i:1===n?t[e[0]][e[1]][e[2]][e[3]]+=i:2===n?t[e[0]][e[1]][e[2]][e[3]]-=i:3===n?t[e[0]][e[1]][e[2]][e[3]]*=i:4===n&&(t[e[0]][e[1]][e[2]][e[3]]/=i)),!0},r.Group.prototype.checkProperty=function(t,e,i,n){if(void 0===n&&(n=!1),this!==t.parent)return!1;var o=r.Utils.getProperty(t,e);return!(void 0===o&&n||o!==i)},r.Group.prototype.set=function(t,e,i,n,r,o,s){if(void 0===s&&(s=!1),e=e.split("."),void 0===n&&(n=!1),void 0===r&&(r=!1),(!1===n||n&&t.alive)&&(!1===r||r&&t.visible))return this.setProperty(t,e,i,o,s)},r.Group.prototype.setAll=function(t,e,i,n,r,o){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===o&&(o=!1),t=t.split("."),r=r||0;for(var s=0;s<this.children.length;s++)(!i||i&&this.children[s].alive)&&(!n||n&&this.children[s].visible)&&this.setProperty(this.children[s],t,e,r,o)},r.Group.prototype.setAllChildren=function(t,e,i,n,o,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),o=o||0;for(var a=0;a<this.children.length;a++)(!i||i&&this.children[a].alive)&&(!n||n&&this.children[a].visible)&&(this.children[a]instanceof r.Group?this.children[a].setAllChildren(t,e,i,n,o,s):this.setProperty(this.children[a],t.split("."),e,o,s))},r.Group.prototype.checkAll=function(t,e,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!1);for(var o=0;o<this.children.length;o++){var s=this.children[o];if((!i||i&&s.alive)&&(!n||n&&s.visible)&&!this.checkProperty(s,t,e,r))return!1}return!0},r.Group.prototype.checkAny=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);for(var r=0;r<this.children.length;r++){var o=this.children[r];if((!i||i&&o.alive)&&(!n||n&&o.visible)&&this.checkProperty(o,t,e))return!0}return!1},r.Group.prototype.addAll=function(t,e,i,n){this.setAll(t,e,i,n,1)},r.Group.prototype.subAll=function(t,e,i,n){this.setAll(t,e,i,n,2)},r.Group.prototype.multiplyAll=function(t,e,i,n){this.setAll(t,e,i,n,3)},r.Group.prototype.divideAll=function(t,e,i,n){this.setAll(t,e,i,n,4)},r.Group.prototype.kill=function(){this.alive=!1,this.exists=!1,this.visible=!1},r.Group.prototype.killAll=function(){this.callAllExists("kill",!0)},r.Group.prototype.revive=function(){this.alive=!0,this.exists=!0,this.visible=!0},r.Group.prototype.reviveAll=function(){this.callAllExists("revive",!1)},r.Group.prototype.resetAll=function(t,e,i,n,r){this.forEach(this.resetChild,this,r,t,e,i,n)},r.Group.prototype.callAllExists=function(t,e){var i;if(arguments.length>2){i=[];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}for(n=0;n<this.children.length;n++)this.children[n].exists===e&&this.children[n][t]&&this.children[n][t].apply(this.children[n],i)},r.Group.prototype.callbackFromArray=function(t,e,i){if(1===i){if(t[e[0]])return t[e[0]]}else if(2===i){if(t[e[0]][e[1]])return t[e[0]][e[1]]}else if(3===i){if(t[e[0]][e[1]][e[2]])return t[e[0]][e[1]][e[2]]}else if(4===i){if(t[e[0]][e[1]][e[2]][e[3]])return t[e[0]][e[1]][e[2]][e[3]]}else if(t[e])return t[e];return!1},r.Group.prototype.callAll=function(t,e){if(void 0!==t){var i=(t=t.split(".")).length;if(void 0===e||null===e||""===e)e=null;else if("string"==typeof e)var n=(e=e.split(".")).length;var r;if(arguments.length>2){r=[];for(var o=2;o<arguments.length;o++)r.push(arguments[o])}var s=null,a=null;for(o=0;o<this.children.length;o++)s=this.callbackFromArray(this.children[o],t,i),e&&s?(a=this.callbackFromArray(this.children[o],e,n),s&&s.apply(a,r)):s&&s.apply(this.children[o],r)}},r.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var t=0;t<this.children.length;){var e=this.children[t];e.preUpdate(),this===e.parent&&t++}return!0},r.Group.prototype.update=function(){for(var t=this.children.length;t--;){var e=this.children.length;t>=e&&(t=e-1);var i=this.children[t];this.updateOnlyExistingChildren&&!i.exists||i.update()}},r.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},r.Group.prototype.filter=function(t,e){for(var i=-1,n=this.children.length,o=[];++i<n;){var s=this.children[i];(!e||e&&s.exists)&&t(s,i,this.children)&&o.push(s)}return new r.ArraySet(o)},r.Group.prototype.forEach=function(t,e,i){if(void 0===i&&(i=!1),arguments.length<=3)for(var n=0;n<this.children.length;n++)(!i||i&&this.children[n].exists)&&t.call(e,this.children[n]);else{var r=[null];for(n=3;n<arguments.length;n++)r.push(arguments[n]);for(n=0;n<this.children.length;n++)(!i||i&&this.children[n].exists)&&(r[0]=this.children[n],t.apply(e,r))}},r.Group.prototype.forEachExists=function(t,e){var i;if(arguments.length>2){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("exists",!0,r.Group.RETURN_TOTAL,t,e,i)},r.Group.prototype.forEachAlive=function(t,e){var i;if(arguments.length>2){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("alive",!0,r.Group.RETURN_TOTAL,t,e,i)},r.Group.prototype.forEachDead=function(t,e){var i;if(arguments.length>2){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("alive",!1,r.Group.RETURN_TOTAL,t,e,i)},r.Group.prototype.sort=function(t,e){this.children.length<2||(void 0===t&&(t="z"),void 0===e&&(e=r.Group.SORT_ASCENDING),this._sortProperty=t,e===r.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},r.Group.prototype.customSort=function(t,e){this.children.length<2||(this.children.sort(t.bind(e)),this.updateZ())},r.Group.prototype.ascendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?-1:t[this._sortProperty]>e[this._sortProperty]?1:t.z<e.z?-1:1},r.Group.prototype.descendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?1:t[this._sortProperty]>e[this._sortProperty]?-1:0},r.Group.prototype.iterate=function(t,e,i,n,o,s){if(0===this.children.length){if(i===r.Group.RETURN_TOTAL)return 0;if(i===r.Group.RETURN_ALL)return[]}var a=0;if(i===r.Group.RETURN_ALL)var h=[];for(var u=0;u<this.children.length;u++)if(this.children[u][t]===e){if(a++,n&&(s?(s[0]=this.children[u],n.apply(o,s)):n.call(o,this.children[u])),i===r.Group.RETURN_CHILD)return this.children[u];i===r.Group.RETURN_ALL&&h.push(this.children[u])}return i===r.Group.RETURN_TOTAL?a:i===r.Group.RETURN_ALL?h:null},r.Group.prototype.getFirst=function(t,e){return this.iterate(t,e,r.Group.RETURN_CHILD)},r.Group.prototype.getFirstExists=function(t,e,i,n,r,o){void 0===e&&(e=!1),"boolean"!=typeof t&&(t=!0);var s=this.getFirst("exists",t);return null===s&&e?this.create(i,n,r,o):this.resetChild(s,i,n,r,o)},r.Group.prototype.getFirstAlive=function(t,e,i,n,r){void 0===t&&(t=!1);var o=this.getFirst("alive",!0);return null===o&&t?this.create(e,i,n,r):this.resetChild(o,e,i,n,r)},r.Group.prototype.getFirstDead=function(t,e,i,n,r){void 0===t&&(t=!1);var o=this.getFirst("alive",!1);return null===o&&t?this.create(e,i,n,r):this.resetChild(o,e,i,n,r)},r.Group.prototype.resetChild=function(t,e,i,n,r){return null===t?null:(void 0===e&&(e=null),void 0===i&&(i=null),null!==e&&null!==i&&t.reset(e,i),void 0!==n&&t.loadTexture(n,r),t)},r.Group.prototype.getTop=function(){if(this.children.length>0)return this.children[this.children.length-1]},r.Group.prototype.getBottom=function(){if(this.children.length>0)return this.children[0]},r.Group.prototype.getClosestTo=function(t,e,i){for(var n=Number.MAX_VALUE,o=0,s=null,a=0;a<this.children.length;a++){var h=this.children[a];h.exists&&(o=Math.abs(r.Point.distance(t,h)))<n&&(!e||e.call(i,h,o))&&(n=o,s=h)}return s},r.Group.prototype.getFurthestFrom=function(t,e,i){for(var n=0,o=0,s=null,a=0;a<this.children.length;a++){var h=this.children[a];h.exists&&(o=Math.abs(r.Point.distance(t,h)))>n&&(!e||e.call(i,h,o))&&(n=o,s=h)}return s},r.Group.prototype.count=function(t,e){return this.iterate(t,e,r.Group.RETURN_TOTAL)},r.Group.prototype.countLiving=function(){return this.count("alive",!0)},r.Group.prototype.countDead=function(){return this.count("alive",!1)},r.Group.prototype.getRandom=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.children.length),0===e?null:r.ArrayUtils.getRandomItem(this.children,t,e)},r.Group.prototype.getRandomExists=function(t,e){var i=this.getAll("exists",!0,t,e);return this.game.rnd.pick(i)},r.Group.prototype.getAll=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=this.children.length);for(var r=[],o=i;o<n;o++){var s=this.children[o];t?s[t]===e&&r.push(s):r.push(s)}return r},r.Group.prototype.remove=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),0===this.children.length||-1===this.children.indexOf(t))return!1;i||!t.events||t.destroyPhase||t.events.onRemovedFromGroup$dispatch(t,this);var n=this.removeChild(t);return this.removeFromHash(t),this.updateZ(),this.cursor===t&&this.next(),e&&n&&n.destroy(!0),!0},r.Group.prototype.moveAll=function(t,e){if(void 0===e&&(e=!1),this.children.length>0&&t instanceof r.Group){do{t.add(this.children[0],e)}while(this.children.length>0);this.hash=[],this.cursor=null}return t},r.Group.prototype.removeAll=function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),0!==this.children.length){do{!e&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var n=this.removeChild(this.children[0]);this.removeFromHash(n),t&&n&&n.destroy(!0,i)}while(this.children.length>0);this.hash=[],this.cursor=null}},r.Group.prototype.removeBetween=function(t,e,i,n){if(void 0===e&&(e=this.children.length-1),void 0===i&&(i=!1),void 0===n&&(n=!1),0!==this.children.length){if(t>e||t<0||e>this.children.length)return!1;for(var r=e;r>=t;){!n&&this.children[r].events&&this.children[r].events.onRemovedFromGroup$dispatch(this.children[r],this);var o=this.removeChild(this.children[r]);this.removeFromHash(o),i&&o&&o.destroy(!0),this.cursor===this.children[r]&&(this.cursor=null),r--}this.updateZ()}},r.Group.prototype.scatter=function(t,e){null==t&&(t=this.game.world.bounds),this.forEach(function(e){e.position.set(t.randomX,t.randomY)},null,e)},r.Group.prototype.shuffle=function(){r.ArrayUtils.shuffle(this.children),this.updateZ()},r.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||(void 0===t&&(t=!0),void 0===e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,this.pendingDestroy=!1,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(r.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,r.Group.RETURN_TOTAL)}}),Object.defineProperty(r.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(r.Group.prototype,"angle",{get:function(){return r.Math.radToDeg(this.rotation)},set:function(t){this.rotation=r.Math.degToRad(t)}}),Object.defineProperty(r.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.halfWidth}}),Object.defineProperty(r.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.halfHeight}}),Object.defineProperty(r.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i}}),Object.defineProperty(r.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.width}}),Object.defineProperty(r.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i}}),Object.defineProperty(r.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.height}}),r.World=function(t){r.Group.call(this,t,null,"__world",!1),this.bounds=new r.Rectangle(0,0,t.width,t.height),this.camera=null,this._definedSize=!1,this._width=t.width,this._height=t.height,this.game.state.onStateChange.add(this.stateChange,this)},r.World.prototype=Object.create(r.Group.prototype),r.World.prototype.constructor=r.World,r.World.prototype.boot=function(){this.camera=new r.Camera(this.game,0,0,0,this.game.width,this.game.height),this.game.stage.addChild(this),this.camera.boot()},r.World.prototype.stateChange=function(){this.x=0,this.y=0,this.camera.reset()},r.World.prototype.setBounds=function(t,e,i,n){this._definedSize=!0,this._width=i,this._height=n,this.bounds.setTo(t,e,i,n),this.x=t,this.y=e,this.camera.bounds&&this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(n,this.game.height)),this.game.physics.setBoundsToWorld()},r.World.prototype.resize=function(t,e){this._definedSize&&(t<this._width&&(t=this._width),e<this._height&&(e=this._height)),this.bounds.width=t,this.bounds.height=e,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},r.World.prototype.shutdown=function(){this.destroy(!0,!0)},r.World.prototype.wrap=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===r&&(r=!0),i?(t.getBounds(),n&&(t.x+t._currentBounds.width<this.bounds.x?t.x=this.bounds.right:t.x>this.bounds.right&&(t.x=this.bounds.left)),r&&(t.y+t._currentBounds.height<this.bounds.top?t.y=this.bounds.bottom:t.y>this.bounds.bottom&&(t.y=this.bounds.top))):(n&&t.x+e<this.bounds.x?t.x=this.bounds.right+e:n&&t.x-e>this.bounds.right&&(t.x=this.bounds.left-e),r&&t.y+e<this.bounds.top?t.y=this.bounds.bottom+e:r&&t.y-e>this.bounds.bottom&&(t.y=this.bounds.top-e))},r.World.prototype.wrapAll=function(t,e,i,n,r,o){t.forEach(this.wrap,this,e,i,n,r,o)},Object.defineProperty(r.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){t<this.game.width&&(t=this.game.width),this.bounds.width=t,this._width=t,this._definedSize=!0}}),Object.defineProperty(r.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){t<this.game.height&&(t=this.game.height),this.bounds.height=t,this._height=t,this._definedSize=!0}}),Object.defineProperty(r.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}}),Object.defineProperty(r.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}}),Object.defineProperty(r.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(r.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}}),r.Game=function(t,e,i,n,o,s,a,h){return this.id=r.GAMES.push(this)-1,this.config=null,this.physicsConfig=h,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.multiTexture=!1,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=r.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=r.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new r.Signal,this.forceSingleUpdate=!0,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof t&&(this._width=t),"undefined"!=typeof e&&(this._height=e),"undefined"!=typeof i&&(this.renderType=i),"undefined"!=typeof n&&(this.parent=n),"undefined"!=typeof s&&(this.transparent=s),"undefined"!=typeof a&&(this.antialias=a),this.rnd=new r.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new r.StateManager(this,o)),this.device.whenReady(this.boot,this),this},r.Game.prototype={parseConfig:function(t){this.config=t,void 0===t.enableDebug&&(this.config.enableDebug=!0),t.width&&(this._width=t.width),t.height&&(this._height=t.height),t.renderer&&(this.renderType=t.renderer),t.parent&&(this.parent=t.parent),void 0!==t.transparent&&(this.transparent=t.transparent),void 0!==t.antialias&&(this.antialias=t.antialias),void 0!==t.multiTexture&&(this.multiTexture=t.multiTexture),t.resolution&&(this.resolution=t.resolution),void 0!==t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer),t.physicsConfig&&(this.physicsConfig=t.physicsConfig);var e=[(Date.now()*Math.random()).toString()];t.seed&&(e=t.seed),this.rnd=new r.RandomDataGenerator(e);var i=null;t.state&&(i=t.state),this.state=new r.StateManager(this,i)},boot:function(){this.isBooted||(this.onPause=new r.Signal,this.onResume=new r.Signal,this.onBlur=new r.Signal,this.onFocus=new r.Signal,this.isBooted=!0,PIXI.game=this,this.math=r.Math,this.scale=new r.ScaleManager(this,this._width,this._height),this.stage=new r.Stage(this),this.setUpRenderer(),this.world=new r.World(this),this.add=new r.GameObjectFactory(this),this.make=new r.GameObjectCreator(this),this.cache=new r.Cache(this),this.load=new r.Loader(this),this.time=new r.Time(this),this.tweens=new r.TweenManager(this),this.input=new r.Input(this),this.sound=new r.SoundManager(this),this.physics=new r.Physics(this,this.physicsConfig),this.particles=new r.Particles(this),this.create=new r.Create(this),this.plugins=new r.PluginManager(this),this.net=new r.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new r.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){},isDisabled:!0},this.showDebugHeader(),this.isRunning=!0,this.config&&this.config.forceSetTimeOut?this.raf=new r.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new r.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.cache.isReady?this.raf.start():this.cache.onReady.addOnce(function(){this.raf.start()},this))},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var t=r.VERSION,e="Canvas",i="HTML Audio",n=1;if(this.renderType===r.WEBGL?(e="WebGL",n++):this.renderType===r.HEADLESS&&(e="Headless"),this.device.webAudio&&(i="WebAudio",n++),this.device.ie)window.console&&console.log("Phaser v"+t+" | Pixi.js | "+e+" | "+i+" | http://phaser.io");else{for(var o=["%c %c %c Phaser CE v"+t+" | Pixi.js | "+e+" | "+i+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"],s=0;s<3;s++)s<n?o.push("color: #ff2424; background: #fff"):o.push("color: #959595; background: #fff");console.log.apply(console,o)}}},setUpRenderer:function(){if(this.config.canvas?this.canvas=this.config.canvas:this.canvas=r.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.renderType===r.HEADLESS||this.renderType===r.CANVAS||this.renderType===r.AUTO&&!this.device.webGL){if(!this.device.canvas)throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.");this.renderer=new PIXI.CanvasRenderer(this),this.context=this.renderer.context,this.renderType===r.AUTO&&(this.renderType=r.CANVAS)}else(this.multiTexture||this.renderType===r.WEBGL_MULTI)&&(PIXI.enableMultiTexture(),this.multiTexture=!0),this.renderType=r.WEBGL,this.renderer=new PIXI.WebGLRenderer(this),this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===r.CANVAS),this.renderType!==r.HEADLESS&&(this.stage.smoothed=this.antialias,r.Canvas.addToDOM(this.canvas,this.parent,!1),r.Canvas.setTouchAction(this.canvas))},contextLost:function(t){t.preventDefault(),this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext(),this.cache.clearGLTextures(),this.renderer.contextLost=!1},update:function(t){if(this.time.update(t),this._kickstart)return this.updateLogic(this.time.desiredFpsMult),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=!1);if(this._spiraling>1&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{var e=1e3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*e,this.time.elapsed),0);var i=0;for(this.updatesThisFrame=Math.floor(this._deltaTime/e),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));this._deltaTime>=e&&(this._deltaTime-=e,this.currentUpdateID=i,this.updateLogic(this.time.desiredFpsMult),i++,!this.forceSingleUpdate||1!==i);)this.time.refresh();i>this._lastCount?this._spiraling++:i<this._lastCount&&(this._spiraling=0),this._lastCount=i,this.updateRender(this._deltaTime/e)}},updateLogic:function(t){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(t),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(t),this.plugins.preUpdate(t),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.stage.updateTransform()},updateRender:function(t){this.lockRender||(this.state.preRender(t),this.renderType!==r.HEADLESS&&(this.renderer.render(this.stage),this.plugins.render(t),this.state.render(t)),this.plugins.postRender(t))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.debug.destroy&&this.debug.destroy(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.plugins.destroy(),this.debug=null,this.state=null,this.sound=null,this.scale=null,this.stage=null,this.input=null,this.physics=null,this.plugins=null,this.cache=null,this.load=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),r.Canvas.removeFromDOM(this.canvas),PIXI.defaultRenderer=null,r.GAMES[this.id]=null},gamePaused:function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(t){this.onBlur.dispatch(t),this.stage.disableVisibilityChange||this.gamePaused(t)},focusGain:function(t){this.onFocus.dispatch(t),this.stage.disableVisibilityChange||this.gameResumed(t)}},r.Game.prototype.constructor=r.Game,Object.defineProperty(r.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){!0===t?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),r.Input=function(t){this.game=t,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.customCandidateHandler=null,this.customCandidateHandlerContext=null,this.pollRate=0,this.enabled=!0,this.multiInputOverride=r.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.touchLockCallbacks=[],this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new r.ArraySet,this._localPoint=new r.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},r.Input.MOUSE_OVERRIDES_TOUCH=0,r.Input.TOUCH_OVERRIDES_MOUSE=1,r.Input.MOUSE_TOUCH_COMBINE=2,r.Input.MAX_POINTERS=10,r.Input.prototype={boot:function(){this.mousePointer=new r.Pointer(this.game,0,r.PointerMode.CURSOR),this.addPointer(),this.addPointer(),this.mouse=new r.Mouse(this.game),this.touch=new r.Touch(this.game),this.mspointer=new r.MSPointer(this.game),r.Keyboard&&(this.keyboard=new r.Keyboard(this.game)),r.Gamepad&&(this.gamepad=new r.Gamepad(this.game)),this.onDown=new r.Signal,this.onUp=new r.Signal,this.onTap=new r.Signal,this.onHold=new r.Signal,this.scale=new r.Point(1,1),this.speed=new r.Point,this.position=new r.Point,this._oldPosition=new r.Point,this.circle=new r.Circle(0,0,44),this.activePointer=this.mousePointer,this.hitCanvas=r.CanvasPool.create(this,1,1),this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.game.device.mspointer||this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var t=this;this._onClickTrampoline=function(e){t.onClickTrampoline(e)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],r.CanvasPool.remove(this),this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(t,e){this.customCandidateHandler=t,this.customCandidateHandlerContext=e},addMoveCallback:function(t,e){this.moveCallbacks.push({callback:t,context:e})},addTouchLockCallback:function(t,e,i){void 0===i&&(i=!1),this.touchLockCallbacks.push({callback:t,context:e,onEnd:i})},removeTouchLockCallback:function(t,e){for(var i=this.touchLockCallbacks.length;i--;)if(this.touchLockCallbacks[i].callback===t&&this.touchLockCallbacks[i].context===e)return this.touchLockCallbacks.splice(i,1),!0;return!1},executeTouchLockCallbacks:function(t,e){for(var i=this.touchLockCallbacks.length;i--;){var n=this.touchLockCallbacks[i];n.onEnd===t&&n.callback.call(n.context,this,e)&&this.touchLockCallbacks.splice(i,1)}},deleteMoveCallback:function(t,e){for(var i=this.moveCallbacks.length;i--;)if(this.moveCallbacks[i].callback===t&&this.moveCallbacks[i].context===e)return void this.moveCallbacks.splice(i,1)},addPointer:function(){if(this.pointers.length>=r.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+r.Input.MAX_POINTERS+" pointers reached."),null;var t=this.pointers.length+1,e=new r.Pointer(this.game,t,r.PointerMode.CONTACT);return this.pointers.push(e),this["pointer"+t]=e,e},update:function(){if(this.keyboard&&this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate)this._pollCounter++;else{this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var t=0;t<this.pointers.length;t++)this.pointers[t].update();this._pollCounter=0}},reset:function(t){if(this.game.isBooted&&!this.resetLocked){void 0===t&&(t=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(t),this.gamepad&&this.gamepad.reset();for(var e=0;e<this.pointers.length;e++)this.pointers[e].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor=""),t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new r.Signal,this.onUp=new r.Signal,this.onTap=new r.Signal,this.onHold=new r.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(t,e){this._oldPosition.setTo(t,e),this.speed.setTo(0,0)},startPointer:function(t){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(t);if(!this.pointer2.active)return this.pointer2.start(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(!i.active)return i.start(t)}return null},updatePointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.move(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.move(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.move(t)}return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.stop(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.stop(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.stop(t)}return null},countActivePointers:function(t){void 0===t&&(t=this.pointers.length);for(var e=t,i=0;i<this.pointers.length&&e>0;i++){this.pointers[i].active&&e--}return t-e},getPointer:function(t){void 0===t&&(t=!1);for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active===t)return i}return null},getPointerFromIdentifier:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.identifier===t)return i}return null},getPointerFromId:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.pointerId===t)return i}return null},getLocalPosition:function(t,e,i){void 0===i&&(i=new r.Point);var n=t.worldTransform,o=1/(n.a*n.d+n.c*-n.b);return i.setTo(n.d*o*e.x+-n.c*o*e.y+(n.ty*n.c-n.tx*n.d)*o,n.a*o*e.y+-n.b*o*e.x+(-n.ty*n.a+n.tx*n.b)*o)},hitTest:function(t,e,i){if(!t.worldVisible)return!1;if(this.getLocalPosition(t,e,this._localPoint),i.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y);if(r.Creature&&t instanceof r.Creature){var n=Math.abs(t.width),o=Math.abs(t.height),s=t.x-n*t.anchorX;if(this.game.camera.x+e.x>=s&&this.game.camera.x+e.x<s+n){var a=t.y-o*t.anchorY;if(this.game.camera.y+e.y>=a&&this.game.camera.y+e.y<a+o)return!0}}else if(t instanceof r.TileSprite){n=t.width,o=t.height,s=-n*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+n){a=-o*t.anchor.y;if(this._localPoint.y>=a&&this._localPoint.y<a+o)return!0}}else if(t instanceof PIXI.Sprite){n=t.texture.frame.width/t.texture.baseTexture.resolution,o=t.texture.frame.height/t.texture.baseTexture.resolution,s=-n*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+n){a=-o*t.anchor.y;if(this._localPoint.y>=a&&this._localPoint.y<a+o)return!0}}else if(t instanceof r.Graphics)for(var h=0;h<t.graphicsData.length;h++){var u=t.graphicsData[h];if(u.fill&&(u.shape&&u.shape.contains(this._localPoint.x,this._localPoint.y)))return!0}for(h=0;h<t.children.length;h++)if(this.hitTest(t.children[h],e,i))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},r.Input.prototype.constructor=r.Input,Object.defineProperty(r.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}}),Object.defineProperty(r.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}}),Object.defineProperty(r.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(r.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(r.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(r.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(r.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),r.Mouse=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new r.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},r.Mouse.NO_BUTTON=-1,r.Mouse.LEFT_BUTTON=0,r.Mouse.MIDDLE_BUTTON=1,r.Mouse.RIGHT_BUTTON=2,r.Mouse.BACK_BUTTON=3,r.Mouse.FORWARD_BUTTON=4,r.Mouse.WHEEL_UP=1,r.Mouse.WHEEL_DOWN=-1,r.Mouse.prototype={start:function(){if((!this.game.device.android||!1!==this.game.device.chrome)&&null===this._onMouseDown){var t=this;this._onMouseDown=function(e){return t.onMouseDown(e)},this._onMouseMove=function(e){return t.onMouseMove(e)},this._onMouseUp=function(e){return t.onMouseUp(e)},this._onMouseUpGlobal=function(e){return t.onMouseUpGlobal(e)},this._onMouseOutGlobal=function(e){return t.onMouseOutGlobal(e)},this._onMouseOut=function(e){return t.onMouseOut(e)},this._onMouseOver=function(e){return t.onMouseOver(e)},this._onMouseWheel=function(e){return t.onMouseWheel(e)};var e=this.game.canvas;e.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("mousemove",this._onMouseMove,!0),e.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),e.addEventListener("mouseover",this._onMouseOver,!0),e.addEventListener("mouseout",this._onMouseOut,!0));var i=this.game.device.wheelEvent;i&&(e.addEventListener(i,this._onMouseWheel,!0),"mousewheel"===i?this._wheelEvent=new n(-.025,1):"DOMMouseScroll"===i&&(this._wheelEvent=new n(1,1)))}},onMouseDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.start(t))},onMouseMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.move(t))},onMouseUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseUpGlobal:function(t){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),t.identifier=0,this.input.mousePointer.stop(t))},onMouseOutGlobal:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(t),this.input.mousePointer.resetButtons())},onMouseOut:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&this.stopOnGameOut&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseOver:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,t)},onMouseWheel:function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t)),this.event=t,this.capture&&t.preventDefault(),this.wheelDelta=r.Math.clamp(-t.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,t)},requestPointerLock:function(){if(this.game.device.pointerLock){var t=this.game.canvas;t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock();var e=this;this._pointerLockChange=function(t){return e.pointerLockChange(t)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(t){var e=this.game.canvas;document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(this.locked=!0,this.pointerLock.dispatch(!0,t)):(this.locked=!1,this.pointerLock.dispatch(!1,t))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var t=this.game.canvas;t.removeEventListener("mousedown",this._onMouseDown,!0),t.removeEventListener("mousemove",this._onMouseMove,!0),t.removeEventListener("mouseup",this._onMouseUp,!0),t.removeEventListener("mouseover",this._onMouseOver,!0),t.removeEventListener("mouseout",this._onMouseOut,!0);var e=this.game.device.wheelEvent;e&&t.removeEventListener(e,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),window.removeEventListener("mouseout",this._onMouseOutGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},r.Mouse.prototype.constructor=r.Mouse,(n.prototype={}).constructor=n,n.prototype.bindEvent=function(t){if(!n._stubsGenerated&&t){var e=function(t){return function(){var e=this.originalEvent[t];return"function"!=typeof e?e:e.bind(this.originalEvent)}};for(var i in t)i in n.prototype||Object.defineProperty(n.prototype,i,{get:e(i)});n._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(n.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),r.MSPointer=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null,this._onMSPointerUpGlobal=null,this._onMSPointerOut=null,this._onMSPointerOver=null},r.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var t=this;if(this.game.device.mspointer){this._onMSPointerDown=function(e){return t.onPointerDown(e)},this._onMSPointerMove=function(e){return t.onPointerMove(e)},this._onMSPointerUp=function(e){return t.onPointerUp(e)},this._onMSPointerUpGlobal=function(e){return t.onPointerUpGlobal(e)},this._onMSPointerOut=function(e){return t.onPointerOut(e)},this._onMSPointerOver=function(e){return t.onPointerOver(e)};var e=this.game.canvas;e.addEventListener("MSPointerDown",this._onMSPointerDown,!1),e.addEventListener("MSPointerMove",this._onMSPointerMove,!1),e.addEventListener("MSPointerUp",this._onMSPointerUp,!1),e.addEventListener("pointerdown",this._onMSPointerDown,!1),e.addEventListener("pointermove",this._onMSPointerMove,!1),e.addEventListener("pointerup",this._onMSPointerUp,!1),e.style["-ms-content-zooming"]="none",e.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),e.addEventListener("MSPointerOver",this._onMSPointerOver,!0),e.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),e.addEventListener("pointerover",this._onMSPointerOver,!0),e.addEventListener("pointerout",this._onMSPointerOut,!0))}}},onPointerDown:function(t){this.game.input.executeTouchLockCallbacks(!1,t),this.event=t,this.capture&&t.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.start(t):this.input.startPointer(t))},onPointerMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.move(t):this.input.updatePointer(t))},onPointerUp:function(t){this.game.input.executeTouchLockCallbacks(!0,t),this.event=t,this.capture&&t.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.stop(t):this.input.stopPointer(t))},onPointerUpGlobal:function(t){if("mouse"!==t.pointerType&&4!==t.pointerType||this.input.mousePointer.withinGame){var e=this.input.getPointerFromIdentifier(t.identifier);e&&e.withinGame&&this.onPointerUp(t)}else this.onPointerUp(t)},onPointerOut:function(t){if(this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType)this.input.mousePointer.withinGame=!1;else{var e=this.input.getPointerFromIdentifier(t.identifier);e&&(e.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,t),this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(t.identifier=0,e?e.stop(t):this.input.mousePointer.stop(t))},onPointerOver:function(t){if(this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType)this.input.mousePointer.withinGame=!0;else{var e=this.input.getPointerFromIdentifier(t.identifier);e&&(e.withinGame=!0)}this.input.mouse.mouseOverCallback&&this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,t)},stop:function(){var t=this.game.canvas;t.removeEventListener("MSPointerDown",this._onMSPointerDown,!1),t.removeEventListener("MSPointerMove",this._onMSPointerMove,!1),t.removeEventListener("MSPointerUp",this._onMSPointerUp,!1),t.removeEventListener("pointerdown",this._onMSPointerDown,!1),t.removeEventListener("pointermove",this._onMSPointerMove,!1),t.removeEventListener("pointerup",this._onMSPointerUp,!1),window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.removeEventListener("MSPointerOver",this._onMSPointerOver,!0),t.removeEventListener("MSPointerOut",this._onMSPointerOut,!0),window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.removeEventListener("pointerover",this._onMSPointerOver,!0),t.removeEventListener("pointerout",this._onMSPointerOut,!0)}},r.MSPointer.prototype.constructor=r.MSPointer,r.DeviceButton=function(t,e){this.parent=t,this.game=t.game,this.event=null,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.value=0,this.buttonCode=e,this.onDown=new r.Signal,this.onUp=new r.Signal,this.onFloat=new r.Signal},r.DeviceButton.prototype={start:function(t,e){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onDown.dispatch(this,e))},stop:function(t,e){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onUp.dispatch(this,e))},startStop:function(t,e,i){t?this.start(e,i):this.stop(e,i)},padFloat:function(t){this.isDown=!1,this.isUp=!1,this.value=t,this.onFloat.dispatch(this,t)},justPressed:function(t){return t=t||250,this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||250,this.isUp&&this.timeUp+t>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.parent=null,this.game=null}},r.DeviceButton.prototype.constructor=r.DeviceButton,Object.defineProperty(r.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),r.Pointer=function(t,e,i){this.game=t,this.id=e,this.type=r.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.pointerMode=i||r.PointerMode.CURSOR|r.PointerMode.CONTACT,this.target=null,this.button=null,this.leftButton=new r.DeviceButton(this,r.Pointer.LEFT_BUTTON),this.middleButton=new r.DeviceButton(this,r.Pointer.MIDDLE_BUTTON),this.rightButton=new r.DeviceButton(this,r.Pointer.RIGHT_BUTTON),this.backButton=new r.DeviceButton(this,r.Pointer.BACK_BUTTON),this.forwardButton=new r.DeviceButton(this,r.Pointer.FORWARD_BUTTON),this.eraserButton=new r.DeviceButton(this,r.Pointer.ERASER_BUTTON),this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=0===e,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.interactiveCandidates=[],this.active=!1,this.dirty=!1,this.position=new r.Point,this.positionDown=new r.Point,this.positionUp=new r.Point,this.circle=new r.Circle(0,0,44),this._clickTrampolines=null,this._trampolineTargetObject=null},r.Pointer.NO_BUTTON=0,r.Pointer.LEFT_BUTTON=1,r.Pointer.RIGHT_BUTTON=2,r.Pointer.MIDDLE_BUTTON=4,r.Pointer.BACK_BUTTON=8,r.Pointer.FORWARD_BUTTON=16,r.Pointer.ERASER_BUTTON=32,r.Pointer.prototype={resetButtons:function(){this.isDown=!1,this.isUp=!0,this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(t,e){t===r.Mouse.LEFT_BUTTON&&this.leftButton.start(e),t===r.Mouse.RIGHT_BUTTON&&this.rightButton.start(e),t===r.Mouse.MIDDLE_BUTTON&&this.middleButton.start(e),t===r.Mouse.BACK_BUTTON&&this.backButton.start(e),t===r.Mouse.FORWARD_BUTTON&&this.forwardButton.start(e)},processButtonsUp:function(t,e){t===r.Mouse.LEFT_BUTTON&&this.leftButton.stop(e),t===r.Mouse.RIGHT_BUTTON&&this.rightButton.stop(e),t===r.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(e),t===r.Mouse.BACK_BUTTON&&this.backButton.stop(e),t===r.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(e)},processButtonsUpDown:function(t,e){var i="down"===e.type.toLowerCase().substr(-4),n="move"===e.type.toLowerCase().substr(-4);void 0!==t?(i&&1===t&&e.ctrlKey&&(t=2),this.leftButton.startStop(r.Pointer.LEFT_BUTTON&t,e),this.rightButton.startStop(r.Pointer.RIGHT_BUTTON&t,e),this.middleButton.startStop(r.Pointer.MIDDLE_BUTTON&t,e),this.backButton.startStop(r.Pointer.BACK_BUTTON&t,e),this.forwardButton.startStop(r.Pointer.FORWARD_BUTTON&t,e),this.eraserButton.startStop(r.Pointer.ERASER_BUTTON&t,e)):void 0!==e.button?i&&e.ctrlKey&&0===e.button?this.rightButton.start(e):i?this.processButtonsDown(e.button,e):n||this.processButtonsUp(e.button,e):i?e.ctrlKey?this.rightButton.start(e):this.leftButton.start(e):(this.leftButton.stop(e),this.rightButton.stop(e))},updateButtons:function(t){this.button=t.button,this.processButtonsUpDown(t.buttons,t),this.isUp=!0,this.isDown=!1,(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(t){var e=this.game.input;return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,this.isMouse?this.updateButtons(t):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(e.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.x=this.x,e.y=this.y,e.position.setTo(this.x,this.y),e.onDown.dispatch(this,t),e.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){var t=this.game.input;this.active&&(this.dirty&&(t.interactiveItems.total>0&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=t.holdRate&&((t.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&0===t.totalActivePointers)&&t.onHold.dispatch(this),this._holdSent=!0),t.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+t.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>t.recordLimit&&this._history.shift()))},move:function(t,e){var i=this.game.input;if(!i.pollLocked){void 0===e&&(e=!1),void 0!==t.button&&(this.button=t.button),this.isMouse&&this.updateButtons(t),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&i.mouse.locked&&!e&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*i.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*i.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(i.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&0===i.totalActivePointers)&&(i.activePointer=this,i.x=this.x,i.y=this.y,i.position.setTo(i.x,i.y),i.circle.x=i.x,i.circle.y=i.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);for(var n=i.moveCallbacks.length;n--;)i.moveCallbacks[n].callback.call(i.moveCallbacks[n].context,this,this.x,this.y,e);return null===this.targetObject||this.game.paused&&!this.targetObject.noPause||!0!==this.targetObject.isDragged?i.interactiveItems.total>0&&this.processInteractiveObjects(e):!1===this.targetObject.update(this)&&(this.targetObject=null),this}},processInteractiveObjects:function(t){var e=0,i=-1,n=null,r=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];r;)r.checked=!1,!r.validForInput(i,e,!1)||this.game.paused&&!r.sprite.noPause||(r.checked=!0,(t&&r.checkPointerDown(this,!0)||!t&&r.checkPointerOver(this,!0))&&(e=r.sprite.renderOrderID,i=r.priorityID,n=r,this.interactiveCandidates.push(r))),r=this.game.input.interactiveItems.next;for(r=this.game.input.interactiveItems.first;r;)!r.checked&&r.validForInput(i,e,!0)&&(t&&r.checkPointerDown(this,!1)||!t&&r.checkPointerOver(this,!1))&&(e=r.sprite.renderOrderID,i=r.priorityID,n=r,this.interactiveCandidates.push(r)),r=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(n=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,n)),this.swapTarget(n,!1),null!==this.targetObject},swapTarget:function(t,e){void 0===e&&(e=!1),null===t?this.targetObject&&(this.targetObject._pointerOutHandler(this,e),this.targetObject=null):null===this.targetObject?(this.targetObject=t,t._pointerOverHandler(this,e)):this.targetObject===t?!1===t.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,e),this.targetObject=t,this.targetObject._pointerOverHandler(this,e))},leave:function(t){this.withinGame=!1,this.move(t,!1)},stop:function(t){var e=this.game.input;if(!this._stateReset||!this.withinGame)return this.timeUp=this.game.time.time,(e.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.onUp.dispatch(this,t),this.duration>=0&&this.duration<=e.tapRate&&(this.timeUp-this.previousTapTime<e.doubleTapRate?e.onTap.dispatch(this,!0):e.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.isMouse?this.updateButtons(t):(this.isDown=!1,this.isUp=!0),this.id>0&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(t.pageX,t.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===this.isMouse&&e.currentPointers--,e.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this;t.preventDefault()},justPressed:function(t){return t=t||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||this.game.input.justReleasedRate,this.isUp&&this.timeUp+t>this.game.time.time},addClickTrampoline:function(t,e,i,n){if(this.isDown){for(var r=this._clickTrampolines=this._clickTrampolines||[],o=0;o<r.length;o++)if(r[o].name===t){r.splice(o,1);break}r.push({name:t,targetObject:this.targetObject,callback:e,callbackContext:i,callbackArgs:n})}},processClickTrampolines:function(){var t=this._clickTrampolines;if(t){for(var e=0;e<t.length;e++){var i=t[e];i.targetObject===this._trampolineTargetObject&&i.callback.apply(i.callbackContext,i.callbackArgs)}this._clickTrampolines=null,this._trampolineTargetObject=null}},reset:function(){!1===this.isMouse&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.resetButtons(),this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},r.Pointer.prototype.constructor=r.Pointer,Object.defineProperty(r.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(r.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(r.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),r.PointerMode={CURSOR:1,CONTACT:2},r.Touch=function(t){this.game=t,this.enabled=!0,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},r.Touch.prototype={start:function(){if(null===this._onTouchStart){var t=this;this.game.device.touch&&(this._onTouchStart=function(e){return t.onTouchStart(e)},this._onTouchMove=function(e){return t.onTouchMove(e)},this._onTouchEnd=function(e){return t.onTouchEnd(e)},this._onTouchEnter=function(e){return t.onTouchEnter(e)},this._onTouchLeave=function(e){return t.onTouchLeave(e)},this._onTouchCancel=function(e){return t.onTouchCancel(e)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1))),this.addTouchLockCallback=this.game.input.addTouchLockCallback.bind(this.game.input),this.removeTouchLockCallback=this.game.input.removeTouchLockCallback.bind(this.game.input)}},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(t){if(this.game.input.executeTouchLockCallbacks(!1,t),this.event=t,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){if(this.event=t,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled){this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled&&this.preventDefault&&t.preventDefault()},onTouchLeave:function(t){this.event=t,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault()},onTouchMove:function(t){this.event=t,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.updatePointer(t.changedTouches[e])},onTouchEnd:function(t){this.game.input.executeTouchLockCallbacks(!0,t),this.event=t,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},r.Touch.prototype.constructor=r.Touch,r.InputHandler=function(t){this.sprite=t,this.game=t.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.scaleLayer=!1,this.dragOffset=new r.Point,this.dragFromCenter=!1,this.dragStopBlocksInputUp=!1,this.dragStartPoint=new r.Point,this.dragDistanceThreshold=0,this.dragTimeThreshold=0,this.downPoint=new r.Point,this.snapPoint=new r.Point,this._dragPoint=new r.Point,this._dragPhase=!1,this._pendingDrag=!1,this._dragTimePass=!1,this._dragDistancePass=!1,this._wasEnabled=!1,this._tempPoint=new r.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},r.InputHandler.prototype={start:function(t,e){if(t=t||0,void 0===e&&(e=!1),!1===this.enabled){this.game.input.interactiveItems.add(this),this.useHandCursor=e,this.priorityID=t;for(var i=0;i<10;i++)this._pointerData[i]={id:i,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new r.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var t=0;t<10;t++)this._pointerData[t]={id:t,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(t,e,i){return void 0===i&&(i=!0),!(!this.enabled||0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput)&&(!(!i&&(this.pixelPerfectClick||this.pixelPerfectOver))&&(this.priorityID>t||this.priorityID===t&&this.sprite.renderOrderID>e))},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){return t=t||0,this._pointerData[t].x},pointerY:function(t){return t=t||0,this._pointerData[t].y},pointerDown:function(t){return t=t||0,this._pointerData[t].isDown},pointerUp:function(t){return t=t||0,this._pointerData[t].isUp},pointerTimeDown:function(t){return t=t||0,this._pointerData[t].timeDown},pointerTimeUp:function(t){return t=t||0,this._pointerData[t].timeUp},pointerOver:function(t){if(!this.enabled)return!1;if(void 0===t){for(var e=0;e<10;e++)if(this._pointerData[e].isOver)return!0;return!1}return this._pointerData[t].isOver},pointerOut:function(t){if(!this.enabled)return!1;if(void 0!==t)return this._pointerData[t].isOut;for(var e=0;e<10;e++)if(this._pointerData[e].isOut)return!0},pointerTimeOver:function(t){return t=t||0,this._pointerData[t].timeOver},pointerTimeOut:function(t){return t=t||0,this._pointerData[t].timeOut},pointerDragged:function(t){return t=t||0,this._pointerData[t].isDragged},checkPointerDown:function(t,e){return!!(t.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&(!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectClick)||this.checkPixel(this._tempPoint.x,this._tempPoint.y)))},checkPointerOver:function(t,e){return!!(this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&(!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectOver)||this.checkPixel(this._tempPoint.x,this._tempPoint.y)))},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(null===t&&null===e){this.game.input.getLocalPosition(this.sprite,i,this._tempPoint);t=this._tempPoint.x,e=this._tempPoint.y}if(0!==this.sprite.anchor.x&&(t-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(e-=-this.sprite.texture.frame.height*this.sprite.anchor.y),t+=this.sprite.texture.frame.x,e+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(t-=this.sprite.texture.trim.x,e-=this.sprite.texture.trim.y,t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom))return this._dx=t,this._dy=e,!1;this._dx=t,this._dy=e,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1);if(this.game.input.hitContext.getImageData(0,0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(t){if(null!==this.sprite&&void 0!==this.sprite.parent)return this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=r.Math.distance(t.x,t.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(t),!0):this.draggable&&this._draggedPointerID===t.id?this.updateDrag(t,!1):this._pointerData[t.id].isOver?this.checkPointerOver(t)?(this._pointerData[t.id].x=t.x-this.sprite.x,this._pointerData[t.id].y=t.y-this.sprite.y,!0):(this._pointerOutHandler(t),!1):void 0:(this._pointerOutHandler(t),!1)},_pointerOverHandler:function(t,e){if(null!==this.sprite){var i=this._pointerData[t.id];if(!1===i.isOver||t.dirty){var n=!1===i.isOver;i.isOver=!0,i.isOut=!1,i.timeOver=this.game.time.time,i.x=t.x-this.sprite.x,i.y=t.y-this.sprite.y,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),!e&&n&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,t),this.sprite.parent&&this.sprite.parent.onChildInputOver&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,t)}}},_pointerOutHandler:function(t,e){if(null!==this.sprite){var i=this._pointerData[t.id];i.isOver=!1,i.isOut=!0,i.timeOut=this.game.time.time,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),!e&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputOut&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,t))}},_touchedHandler:function(t){if(null!==this.sprite){var e=this._pointerData[t.id];if(!e.isDown&&e.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,t))return;if(e.isDown=!0,e.isUp=!1,e.timeDown=this.game.time.time,this.downPoint.set(t.x,t.y),t.dirty=!0,this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputDown&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,t),null===this.sprite))return;this.draggable&&!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(t):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,this.dragTimeThreshold>0?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,t)):this._dragTimePass=!0)),this.bringToTop&&this.sprite.bringToTop()}}},dragTimeElapsed:function(t){this._dragTimePass=!0,this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(t)},_releasedHandler:function(t){if(null!==this.sprite){var e=this._pointerData[t.id];if(e.isDown&&t.isUp){e.isDown=!1,e.isUp=!0,e.timeUp=this.game.time.time,e.downDuration=e.timeUp-e.timeDown;var i=this.checkPointerOver(t);this.sprite&&this.sprite.events&&(this.dragStopBlocksInputUp&&(!this.dragStopBlocksInputUp||this.draggable&&this.isDragged&&this._draggedPointerID===t.id)||this.sprite.events.onInputUp$dispatch(this.sprite,t,i),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputUp&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,t,i),i&&(i=this.checkPointerOver(t))),e.isOver=i,!i&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),t.dirty=!0,this._pendingDrag=!1,this.draggable&&this.isDragged&&this._draggedPointerID===t.id&&this.stopDrag(t)}}},updateDrag:function(t,e){if(void 0===e&&(e=!1),t.isUp)return this.stopDrag(t),!1;var i=this.globalToLocal(t);if(this.sprite.fixedToCamera)var n=this.game.camera.scale.x*i.x+this._dragPoint.x+this.dragOffset.x,r=this.game.camera.scale.y*i.y+this._dragPoint.y+this.dragOffset.y;else n=i.x+this._dragPoint.x+this.dragOffset.x,r=i.y+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera)this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=n-this.game.camera.x),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=r-this.game.camera.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y));else{var o=this.game.camera.x-this._pointerData[t.id].camX,s=this.game.camera.y-this._pointerData[t.id].camY;this.allowHorizontalDrag&&(this.sprite.x=n+o),this.allowVerticalDrag&&(this.sprite.y=r+s),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))}return this.sprite.events.onDragUpdate.dispatch(this.sprite,t,n,r,this.snapPoint,e),!0},justOver:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOut&&this.game.time.time-this._pointerData[t].timeOut<e},justPressed:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isUp&&this.game.time.time-this._pointerData[t].timeUp<e},overDuration:function(t){return t=t||0,this._pointerData[t].isOver?this.game.time.time-this._pointerData[t].timeOver:-1},downDuration:function(t){return t=t||0,this._pointerData[t].isDown?this.game.time.time-this._pointerData[t].timeDown:-1},enableDrag:function(t,e,i,n,o,s){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=255),void 0===o&&(o=null),void 0===s&&(s=null),this._dragPoint=new r.Point,this.draggable=!0,this.bringToTop=e,this.dragOffset=new r.Point,this.dragFromCenter=t,this.pixelPerfectClick=i,this.pixelPerfectAlpha=n,o&&(this.boundsRect=o),s&&(this.boundsSprite=s)},disableDrag:function(){if(this._pointerData)for(var t=0;t<10;t++)this._pointerData[t].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1,this._pendingDrag=!1},startDrag:function(t){var e=this.sprite.x,i=this.sprite.y,n=this.globalToLocal(t);if(this.isDragged=!0,this._draggedPointerID=t.id,this._pointerData[t.id].camX=this.game.camera.x,this._pointerData[t.id].camY=this.game.camera.y,this._pointerData[t.id].isDragged=!0,this.sprite.fixedToCamera){if(this.dragFromCenter){var o=this.sprite.getBounds(),s=this.globalToLocal(new r.Point(o.centerX,o.centerY));this.sprite.cameraOffset.x=n.x+(this.sprite.cameraOffset.x-s.x),this.sprite.cameraOffset.y=n.y+(this.sprite.cameraOffset.y-s.y)}this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)}else{if(this.dragFromCenter){o=this.sprite.getBounds(),s=this.globalToLocal(new r.Point(o.centerX,o.centerY));this.sprite.x=n.x+(this.sprite.x-s.x),this.sprite.y=n.y+(this.sprite.y-s.y)}this._dragPoint.setTo(this.sprite.x-n.x,this.sprite.y-n.y)}this.updateDrag(t,!0),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(e,i),this.sprite.events.onDragStart$dispatch(this.sprite,t,e,i),this._pendingDrag=!1},globalToLocalX:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.x,t*=this.game.scale.grid.scaleFluidInversed.x),t},globalToLocalY:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.y,t*=this.game.scale.grid.scaleFluidInversed.y),t},globalToLocal:function(t){return this.sprite.parent?this.game.input.getLocalPosition(this.sprite.parent,{x:t.x,y:t.y}):t},stopDrag:function(t){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[t.id].isDragged=!1,this._dragPhase=!1,this._pendingDrag=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,t),!1===this.checkPointerOver(t)&&this._pointerOutHandler(t)},setDragLock:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.allowHorizontalDrag=t,this.allowVerticalDrag=e},enableSnap:function(t,e,i,n,r,o){void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===o&&(o=0),this.snapX=t,this.snapY=e,this.snapOffsetX=r,this.snapOffsetY=o,this.snapOnDrag=i,this.snapOnRelease=n},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},r.InputHandler.prototype.constructor=r.InputHandler,r.Gamepad=function(t){this.game=t,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new r.SinglePad(t,this),new r.SinglePad(t,this),new r.SinglePad(t,this),new r.SinglePad(t,this)]},r.Gamepad.prototype={addCallbacks:function(t,e){"undefined"!=typeof e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},start:function(){if(!this._active){this._active=!0;var t=this;this._onGamepadConnected=function(e){return t.onGamepadConnected(e)},this._onGamepadDisconnected=function(e){return t.onGamepadDisconnected(e)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(t){var e=t.gamepad;this._rawPads.push(e),this._gamepads[e.index].connect(e)},onGamepadDisconnected:function(t){var e=t.gamepad;for(var i in this._rawPads)this._rawPads[i].index===e.index&&this._rawPads.splice(i,1);this._gamepads[e.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(this._active){if(navigator.getGamepads)var t=navigator.getGamepads();else if(navigator.webkitGetGamepads)t=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)t=navigator.webkitGamepads();if(t){this._rawPads=[];for(var e=!1,i=0;i<t.length&&(typeof t[i]!==this._prevRawGamepadTypes[i]&&(e=!0,this._prevRawGamepadTypes[i]=typeof t[i]),t[i]&&this._rawPads.push(t[i]),3!==i);i++);for(var n=0;n<this._gamepads.length;n++)this._gamepads[n]._rawPad=this._rawPads[n];if(e){for(var r,o={rawIndices:{},padIndices:{}},s=0;s<this._gamepads.length;s++)if((r=this._gamepads[s]).connected)for(var a=0;a<this._rawPads.length;a++)this._rawPads[a].index===r.index&&(o.rawIndices[r.index]=!0,o.padIndices[s]=!0);for(var h=0;h<this._gamepads.length;h++)if(r=this._gamepads[h],!o.padIndices[h]){this._rawPads.length<1&&r.disconnect();for(var u=0;u<this._rawPads.length&&!o.padIndices[h];u++){var c=this._rawPads[u];if(c){if(o.rawIndices[c.index]){r.disconnect();continue}r.connect(c),o.rawIndices[c.index]=!0,o.padIndices[h]=!0}else r.disconnect()}}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].deadZone=t},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].reset()},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justPressed(t,e))return!0;return!1},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justReleased(t,e))return!0;return!1},isDown:function(t){for(var e=0;e<this._gamepads.length;e++)if(!0===this._gamepads[e].isDown(t))return!0;return!1},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].destroy()}},r.Gamepad.prototype.constructor=r.Gamepad,Object.defineProperty(r.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(r.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(r.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(r.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(r.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(r.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(r.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),r.Gamepad.BUTTON_0=0,r.Gamepad.BUTTON_1=1,r.Gamepad.BUTTON_2=2,r.Gamepad.BUTTON_3=3,r.Gamepad.BUTTON_4=4,r.Gamepad.BUTTON_5=5,r.Gamepad.BUTTON_6=6,r.Gamepad.BUTTON_7=7,r.Gamepad.BUTTON_8=8,r.Gamepad.BUTTON_9=9,r.Gamepad.BUTTON_10=10,r.Gamepad.BUTTON_11=11,r.Gamepad.BUTTON_12=12,r.Gamepad.BUTTON_13=13,r.Gamepad.BUTTON_14=14,r.Gamepad.BUTTON_15=15,r.Gamepad.AXIS_0=0,r.Gamepad.AXIS_1=1,r.Gamepad.AXIS_2=2,r.Gamepad.AXIS_3=3,r.Gamepad.AXIS_4=4,r.Gamepad.AXIS_5=5,r.Gamepad.AXIS_6=6,r.Gamepad.AXIS_7=7,r.Gamepad.AXIS_8=8,r.Gamepad.AXIS_9=9,r.Gamepad.XBOX360_A=0,r.Gamepad.XBOX360_B=1,r.Gamepad.XBOX360_X=2,r.Gamepad.XBOX360_Y=3,r.Gamepad.XBOX360_LEFT_BUMPER=4,r.Gamepad.XBOX360_RIGHT_BUMPER=5,r.Gamepad.XBOX360_LEFT_TRIGGER=6,r.Gamepad.XBOX360_RIGHT_TRIGGER=7,r.Gamepad.XBOX360_BACK=8,r.Gamepad.XBOX360_START=9,r.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,r.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,r.Gamepad.XBOX360_DPAD_LEFT=14,r.Gamepad.XBOX360_DPAD_RIGHT=15,r.Gamepad.XBOX360_DPAD_UP=12,r.Gamepad.XBOX360_DPAD_DOWN=13,r.Gamepad.XBOX360_STICK_LEFT_X=0,r.Gamepad.XBOX360_STICK_LEFT_Y=1,r.Gamepad.XBOX360_STICK_RIGHT_X=2,r.Gamepad.XBOX360_STICK_RIGHT_Y=3,r.Gamepad.PS3XC_X=0,r.Gamepad.PS3XC_CIRCLE=1,r.Gamepad.PS3XC_SQUARE=2,r.Gamepad.PS3XC_TRIANGLE=3,r.Gamepad.PS3XC_L1=4,r.Gamepad.PS3XC_R1=5,r.Gamepad.PS3XC_L2=6,r.Gamepad.PS3XC_R2=7,r.Gamepad.PS3XC_SELECT=8,r.Gamepad.PS3XC_START=9,r.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,r.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,r.Gamepad.PS3XC_DPAD_UP=12,r.Gamepad.PS3XC_DPAD_DOWN=13,r.Gamepad.PS3XC_DPAD_LEFT=14,r.Gamepad.PS3XC_DPAD_RIGHT=15,r.Gamepad.PS3XC_STICK_LEFT_X=0,r.Gamepad.PS3XC_STICK_LEFT_Y=1,r.Gamepad.PS3XC_STICK_RIGHT_X=2,r.Gamepad.PS3XC_STICK_RIGHT_Y=3,r.SinglePad=function(t,e){this.game=t,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=e,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},r.SinglePad.prototype={addCallbacks:function(t,e){"undefined"!=typeof e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},getButton:function(t){return this._buttons[t]?this._buttons[t]:null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];e!==this._buttons[t].value&&(1===e?this.processButtonDown(t,e):0===e?this.processButtonUp(t,e):this.processButtonFloat(t,e))}for(var i=0;i<this._axesLen;i++){var n=this._rawPad.axes[i];n>0&&n>this.deadZone||n<0&&n<-this.deadZone?this.processAxisChange(i,n):this.processAxisChange(i,0)}this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var e=!this.connected;this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length;for(var i=0;i<this._axesLen;i++)this._axes[i]=t.axes[i];for(var n in t.buttons)n=parseInt(n,10),this._buttons[n]=new r.DeviceButton(this,n);e&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),e&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,e=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var i=0;i<this._buttonsLen;i++)this._buttons[i].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e),t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var t=0;t<this._buttonsLen;t++)this._buttons[t].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(t,e){this._axes[t]!==e&&(this._axes[t]=e,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,t,e))},processButtonDown:function(t,e){this._buttons[t]&&this._buttons[t].start(null,e),this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t,e)},processButtonUp:function(t,e){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].stop(null,e)},processButtonFloat:function(t,e){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].padFloat(e)},axis:function(t){return!!this._axes[t]&&this._axes[t]},isDown:function(t){return!!this._buttons[t]&&this._buttons[t].isDown},isUp:function(t){return!!this._buttons[t]&&this._buttons[t].isUp},justReleased:function(t,e){if(this._buttons[t])return this._buttons[t].justReleased(e)},justPressed:function(t,e){if(this._buttons[t])return this._buttons[t].justPressed(e)},buttonValue:function(t){return this._buttons[t]?this._buttons[t].value:null},reset:function(){for(var t=0;t<this._axes.length;t++)this._axes[t]=0}},r.SinglePad.prototype.constructor=r.SinglePad,r.Key=function(t,e){this.game=t,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.durationUp=-2500,this.repeats=0,this.keyCode=e,this.onDown=new r.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new r.Signal,this._justDown=!1,this._justUp=!1},r.Key.prototype={update:function(){this._enabled&&(this.isDown?(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this)):this.durationUp=this.game.time.time-this.timeUp)},processKeyDown:function(t){this._enabled&&(this.event=t,this.isDown||(this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.durationUp=this.game.time.time-this.timeUp,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(t){this._enabled&&(this.event=t,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this.durationUp=0,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(t){void 0===t&&(t=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this.durationUp=-2500,this._enabled=!0,this._justDown=!1,this._justUp=!1,t&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(t){return void 0===t&&(t=50),this.isDown&&this.duration<t},upDuration:function(t){return void 0===t&&(t=50),!this.isDown&&this.game.time.time-this.timeUp<t},justPressed:function(){return this.isDown&&0===this.duration},justReleased:function(){return!this.isDown&&0===this.durationUp}},Object.defineProperty(r.Key.prototype,"justDown",{get:function(){var t=this._justDown;return this._justDown=!1,t}}),Object.defineProperty(r.Key.prototype,"justUp",{get:function(){var t=this._justUp;return this._justUp=!1,t}}),Object.defineProperty(r.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(t){(t=!!t)!==this._enabled&&(t||this.reset(!1),this._enabled=t)}}),r.Key.prototype.constructor=r.Key,r.Keyboard=function(t){this.game=t,this.enabled=!0,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},r.Keyboard.prototype={addCallbacks:function(t,e,i,n){this.callbackContext=t,void 0!==e&&null!==e&&(this.onDownCallback=e),void 0!==i&&null!==i&&(this.onUpCallback=i),void 0!==n&&null!==n&&(this.onPressCallback=n)},removeCallbacks:function(){this.callbackContext=this,this.onDownCallback=null,this.onUpCallback=null,this.onPressCallback=null},addKey:function(t){return this._keys[t]||(this._keys[t]=new r.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},addKeys:function(t){var e={};for(var i in t)e[i]=this.addKey(t[i]);return e},removeKey:function(t){this._keys[t]&&(this._keys[t]=null,this.removeKeyCapture(t))},createCursorKeys:function(){return this.addKeys({up:r.KeyCode.UP,down:r.KeyCode.DOWN,left:r.KeyCode.LEFT,right:r.KeyCode.RIGHT})},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var t=this;this._onKeyDown=function(e){return t.processKeyDown(e)},this._onKeyUp=function(e){return t.processKeyUp(e)},this._onKeyPress=function(e){return t.processKeyPress(e)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){if(this.event=t,this.game.input.enabled&&this.enabled){var e=t.keyCode;this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new r.Key(this.game,e)),this._keys[e].processKeyDown(t),this._k=e,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t)}},processKeyPress:function(t){this.pressEvent=t,this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)},processKeyUp:function(t){if(this.event=t,this.game.input.enabled&&this.enabled){var e=t.keyCode;this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new r.Key(this.game,e)),this._keys[e].processKeyUp(t),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t)}},reset:function(t){void 0===t&&(t=!0),this.event=null;for(var e=this._keys.length;e--;)this._keys[e]&&this._keys[e].reset(t)},downDuration:function(t,e){return this._keys[t]?this._keys[t].downDuration(e):null},upDuration:function(t,e){return this._keys[t]?this._keys[t].upDuration(e):null},justPressed:function(t){return this._keys[t]?this._keys[t].justPressed():null},justReleased:function(t){return this._keys[t]?this._keys[t].justReleased():null},isDown:function(t){return this._keys[t]?this._keys[t].isDown:null}},Object.defineProperty(r.Keyboard.prototype,"lastChar",{get:function(){return this.event&&32===this.event.charCode?"":this.pressEvent?String.fromCharCode(this.pressEvent.charCode):null}}),Object.defineProperty(r.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),r.Keyboard.prototype.constructor=r.Keyboard,r.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var s in r.KeyCode)r.KeyCode.hasOwnProperty(s)&&!s.match(/[a-z]/)&&(r.Keyboard[s]=r.KeyCode[s]);r.Component=function(){},r.Component.Angle=function(){},r.Component.Angle.prototype={angle:{get:function(){return r.Math.wrapAngle(r.Math.radToDeg(this.rotation))},set:function(t){this.rotation=r.Math.degToRad(r.Math.wrapAngle(t))}}},r.Component.Animation=function(){},r.Component.Animation.prototype={play:function(t,e,i,n){if(this.animations)return this.animations.play(t,e,i,n)}},r.Component.AutoCull=function(){},r.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},r.Component.Bounds=function(){},r.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+.5*this.width},set:function(t){this.x=t+this.offsetX-.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+.5*this.height},set:function(t){this.y=t+this.offsetY-.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(t){this.x=t+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(t){this.x=t-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(t){this.y=t+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(t){this.y=t-this.height+this.offsetY}},alignIn:function(t,e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),e){default:case r.TOP_LEFT:this.left=t.left-i,this.top=t.top-n;break;case r.TOP_CENTER:this.centerX=t.centerX+i,this.top=t.top-n;break;case r.TOP_RIGHT:this.right=t.right+i,this.top=t.top-n;break;case r.LEFT_CENTER:this.left=t.left-i,this.centerY=t.centerY+n;break;case r.CENTER:this.centerX=t.centerX+i,this.centerY=t.centerY+n;break;case r.RIGHT_CENTER:this.right=t.right+i,this.centerY=t.centerY+n;break;case r.BOTTOM_LEFT:this.left=t.left-i,this.bottom=t.bottom+n;break;case r.BOTTOM_CENTER:this.centerX=t.centerX+i,this.bottom=t.bottom+n;break;case r.BOTTOM_RIGHT:this.right=t.right+i,this.bottom=t.bottom+n}return this},alignTo:function(t,e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),e){default:case r.TOP_LEFT:this.left=t.left-i,this.bottom=t.top-n;break;case r.TOP_CENTER:this.centerX=t.centerX+i,this.bottom=t.top-n;break;case r.TOP_RIGHT:this.right=t.right+i,this.bottom=t.top-n;break;case r.LEFT_TOP:this.right=t.left-i,this.top=t.top-n;break;case r.LEFT_CENTER:this.right=t.left-i,this.centerY=t.centerY+n;break;case r.LEFT_BOTTOM:this.right=t.left-i,this.bottom=t.bottom+n;break;case r.RIGHT_TOP:this.left=t.right+i,this.top=t.top-n;break;case r.RIGHT_CENTER:this.left=t.right+i,this.centerY=t.centerY+n;break;case r.RIGHT_BOTTOM:this.left=t.right+i,this.bottom=t.bottom+n;break;case r.BOTTOM_LEFT:this.left=t.left-i,this.top=t.bottom+n;break;case r.BOTTOM_CENTER:this.centerX=t.centerX+i,this.top=t.bottom+n;break;case r.BOTTOM_RIGHT:this.right=t.right+i,this.top=t.bottom+n}return this}},r.Group.prototype.alignIn=r.Component.Bounds.prototype.alignIn,r.Group.prototype.alignTo=r.Component.Bounds.prototype.alignTo,r.Component.BringToTop=function(){},r.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},r.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},r.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},r.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},r.Component.Core=function(){},r.Component.Core.skipTypeChecks=!1,r.Component.Core.install=function(t){r.Utils.mixinPrototype(this,r.Component.Core.prototype),this.components={};for(var e=0;e<t.length;e++){var i=t[e],n=!1;"Destroy"===i&&(n=!0),r.Utils.mixinPrototype(this,r.Component[i].prototype,n),this.components[i]=!0}},r.Component.Core.init=function(t,e,i,n,o){if(!r.Component.Core.skipTypeChecks){if(!(t instanceof r.Game))throw new Error("The value passed as the `game` argument ("+t+") is not an instance of Phaser.Game.");"number"!=typeof e&&(console.warn("The `x` argument value (%s) should be a number.",e),e=0),"number"!=typeof i&&(console.warn("The `y` argument value (%s) should be a number.",i),i=0)}this.game=t,this.key=n,this.data={},this.position.set(e,i),this.world=new r.Point(e,i),this.previousPosition=new r.Point(e,i),this.events=new r.Events(this),this._bounds=new r.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new r.AnimationManager(this)),this.components.LoadTexture&&null!==n&&this.loadTexture(n,o),this.components.FixedToCamera&&(this.cameraOffset=new r.Point(e,i))},r.Component.Core.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.exists&&this.parent.exists?(this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate(),this.preUpdateChildren(),!0):(this.renderOrderID=-1,!1))},r.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(t){t?(this._exists=!0,this.body&&this.body.type===r.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===r.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},preUpdateChildren:function(){for(var t=0;t<this.children.length;){var e=this.children[t];e.preUpdate(),this===e.parent&&t++}},update:function(){},postUpdate:function(){this.customRender&&this.key.render(),this.components.PhysicsBody&&r.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&r.Component.FixedToCamera.postUpdate.call(this);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()}},r.Component.Crop=function(){},r.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,e){void 0===e&&(e=!1),t?(e&&null!==this.cropRect?this.cropRect.setTo(t.x,t.y,t.width,t.height):e&&null===this.cropRect?this.cropRect=new r.Rectangle(t.x,t.y,t.width,t.height):this.cropRect=t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){var t=this.texture.crop.x,e=this.texture.crop.y,i=this.texture.crop.width,n=this.texture.crop.height;this._crop=r.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var o=Math.max(this._frame.x,this._crop.x),s=Math.max(this._frame.y,this._crop.y),a=Math.min(this._frame.right,this._crop.right)-o,h=Math.min(this._frame.bottom,this._crop.bottom)-s;this.texture.crop.x=o,this.texture.crop.y=s,this.texture.crop.width=a,this.texture.crop.height=h,this.texture.frame.width=Math.min(a,this.cropRect.width),this.texture.frame.height=Math.min(h,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs(),16777215===this.tint||t===o&&e===s&&i===a&&n===h||(this.texture.requiresReTint=!0)}}},r.Component.Delta=function(){},r.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},r.Component.Destroy=function(){},r.Component.Destroy.prototype={destroyPhase:!1,destroy:function(t,e){if(null!==this.game&&!this.destroyPhase){void 0===t&&(t=!0),void 0===e&&(e=!1),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof r.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy(),this.game.tweens.removeFrom(this);var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this._crop&&(this._crop=null,this.cropRect=null),this._frame&&(this._frame=null),r.Video&&this.key instanceof r.Video&&this.key.onChangeSource.remove(this.resizeFrame,this),r.BitmapText&&this._glyphs&&(this._glyphs=[]),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.data={},this.renderable=!1,this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),e&&this.texture.destroy(!0),this.destroyPhase=!1,this.pendingDestroy=!1}}},r.Events=function(t){this.parent=t},r.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragUpdate&&this._onDragUpdate.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},r.Events.prototype.constructor=r.Events;for(var a in r.Events.prototype)r.Events.prototype.hasOwnProperty(a)&&0===a.indexOf("on")&&null===r.Events.prototype[a]&&function(t,e){"use strict";Object.defineProperty(r.Events.prototype,t,{get:function(){return this[e]||(this[e]=new r.Signal)}}),r.Events.prototype[t+"$dispatch"]=function(){return this[e]?this[e].dispatch.apply(this[e],arguments):null}}(a,"_"+a);r.Component.FixedToCamera=function(){},r.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},r.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(t){t?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new r.Point},r.Component.Health=function(){},r.Component.Health.prototype={health:1,maxHealth:100,damage:function(t){return this.alive&&(this.health-=t,this.health<=0&&this.kill()),this},setHealth:function(t){return this.health=t,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(t){return this.alive&&(this.health+=t,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}},r.Component.InCamera=function(){},r.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},r.Component.InputEnabled=function(){},r.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new r.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},r.Component.InWorld=function(){},r.Component.InWorld.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0},r.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},r.Component.LifeSpan=function(){},r.Component.LifeSpan.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):!(this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0))||(this.kill(),!1)},r.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(t){return void 0===t&&(t=100),this.alive=!0,this.exists=!0,this.visible=!0,"function"==typeof this.setHealth&&this.setHealth(t),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},r.Component.LoadTexture=function(){},r.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(t,e,i){t===r.PENDING_ATLAS?(t=e,e=0):e=e||0,(i||void 0===i)&&this.animations&&this.animations.stop(),this.key=t,this.customRender=!1;var n=this.game.cache,o=!0,s=!this.texture.baseTexture.scaleMode;if(r.RenderTexture&&t instanceof r.RenderTexture)this.key=t.key,this.setTexture(t);else if(r.BitmapData&&t instanceof r.BitmapData)this.customRender=!0,this.setTexture(t.texture),o=n.hasFrameData(t.key,r.Cache.BITMAPDATA)?!this.animations.loadFrameData(n.getFrameData(t.key,r.Cache.BITMAPDATA),e):!this.animations.loadFrameData(t.frameData,0);else if(r.Video&&t instanceof r.Video){this.customRender=!0;var a=t.texture.valid;this.setTexture(t.texture),this.setFrame(t.texture.frame.clone()),t.onChangeSource.add(this.resizeFrame,this),this.texture.valid=a}else if(r.Tilemap&&t instanceof r.TilemapLayer)this.setTexture(PIXI.Texture.fromCanvas(t.canvas));else if(t instanceof PIXI.Texture)this.setTexture(t);else{var h=n.getImage(t,!0);this.key=h.key,this.setTexture(new PIXI.Texture(h.base)),this.texture.baseTexture.skipRender="__default"===t,o=!this.animations.loadFrameData(h.frameData,e)}o&&(this._frame=r.Rectangle.clone(this.texture.frame)),s||(this.texture.baseTexture.scaleMode=1)},setFrame:function(t){this._frame=t,this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),t.rotated&&(this.texture.rotated=!0),this.cropRect&&this.updateCrop(),this.texture.requiresReTint=!0,this.texture._updateUvs(),this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(t,e,i){this.texture.frame.resize(e,i),this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}},frameName:{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}},r.Component.Overlap=function(){},r.Component.Overlap.prototype={overlap:function(t){return r.Rectangle.intersects(this.getBounds(),t.getBounds())}},r.Component.PhysicsBody=function(){},r.Component.PhysicsBody.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,this.preUpdateChildren(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!(!this._exists||!this.parent.exists)||(this.renderOrderID=-1,!1))},r.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},r.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(t){this.position.x=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},r.Component.Reset=function(){},r.Component.Reset.prototype.reset=function(t,e,i){return void 0===i&&(i=1),this.world.set(t,e),this.position.set(t,e),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=i),this.components.PhysicsBody&&this.body&&this.body.reset(t,e,!1,!1),this},r.Component.ScaleMinMax=function(){},r.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(t){this.scaleMin&&(t.a<this.scaleMin.x&&(t.a=this.scaleMin.x),t.d<this.scaleMin.y&&(t.d=this.scaleMin.y)),this.scaleMax&&(t.a>this.scaleMax.x&&(t.a=this.scaleMax.x),t.d>this.scaleMax.y&&(t.d=this.scaleMax.y))},setScaleMinMax:function(t,e,i,n){void 0===e?e=i=n=t:void 0===i&&(i=n=e,e=t),null===t?this.scaleMin=null:this.scaleMin?this.scaleMin.set(t,e):this.scaleMin=new r.Point(t,e),null===i?this.scaleMax=null:this.scaleMax?this.scaleMax.set(i,n):this.scaleMax=new r.Point(i,n),null===this.scaleMin?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}},r.Component.Smoothed=function(){},r.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){t?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}},r.GameObjectFactory=function(t){this.game=t,this.world=this.game.world},r.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},weapon:function(t,e,i,n,o){var s=this.game.plugins.add(r.Weapon);return o&&(s.bulletClass=o),s.createBullets(t,e,i,n),s},image:function(t,e,i,n,o){return void 0===o&&(o=this.world),o.add(new r.Image(this.game,t,e,i,n))},sprite:function(t,e,i,n,r){return void 0===r&&(r=this.world),r.create(t,e,i,n)},creature:function(t,e,i,n,o){void 0===o&&(o=this.world);var s=new r.Creature(this.game,t,e,i,n);return o.add(s),s},tween:function(t){return this.game.tweens.create(t)},group:function(t,e,i,n,o){return new r.Group(this.game,t,e,i,n,o)},physicsGroup:function(t,e,i,n){return new r.Group(this.game,e,i,n,!0,t)},spriteBatch:function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e="group"),void 0===i&&(i=!1),new r.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,e,i,n,o,s,a){return void 0===a&&(a=this.world),a.add(new r.TileSprite(this.game,t,e,i,n,o,s))},rope:function(t,e,i,n,o,s){return void 0===s&&(s=this.world),s.add(new r.Rope(this.game,t,e,i,n,o))},text:function(t,e,i,n,o){return void 0===o&&(o=this.world),o.add(new r.Text(this.game,t,e,i,n))},button:function(t,e,i,n,o,s,a,h,u,c){return void 0===c&&(c=this.world),c.add(new r.Button(this.game,t,e,i,n,o,s,a,h,u))},graphics:function(t,e,i){return void 0===i&&(i=this.world),i.add(new r.Graphics(this.game,t,e))},emitter:function(t,e,i){return this.game.particles.add(new r.Particles.Arcade.Emitter(this.game,t,e,i))},retroFont:function(t,e,i,n,o,s,a,h,u){return new r.RetroFont(this.game,t,e,i,n,o,s,a,h,u)},bitmapText:function(t,e,i,n,o,s){return void 0===s&&(s=this.world),s.add(new r.BitmapText(this.game,t,e,i,n,o))},tilemap:function(t,e,i,n,o){return new r.Tilemap(this.game,t,e,i,n,o)},renderTexture:function(t,e,i,n){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===n&&(n=!1);var o=new r.RenderTexture(this.game,t,e,i);return n&&this.game.cache.addRenderTexture(i,o),o},video:function(t,e){return new r.Video(this.game,t,e)},bitmapData:function(t,e,i,n){void 0===n&&(n=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());var o=new r.BitmapData(this.game,i,t,e);return n&&this.game.cache.addBitmapData(i,o),o},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new r.Filter[t](this.game)).init.apply(t,e),t},plugin:function(t){return this.game.plugins.add(t)}},r.GameObjectFactory.prototype.constructor=r.GameObjectFactory,r.GameObjectCreator=function(t){this.game=t,this.world=this.game.world},r.GameObjectCreator.prototype={image:function(t,e,i,n){return new r.Image(this.game,t,e,i,n)},sprite:function(t,e,i,n){return new r.Sprite(this.game,t,e,i,n)},tween:function(t){return new r.Tween(t,this.game,this.game.tweens)},group:function(t,e,i,n,o){return new r.Group(this.game,t,e,i,n,o)},spriteBatch:function(t,e,i){return void 0===e&&(e="group"),void 0===i&&(i=!1),new r.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},tileSprite:function(t,e,i,n,o,s){return new r.TileSprite(this.game,t,e,i,n,o,s)},rope:function(t,e,i,n,o){return new r.Rope(this.game,t,e,i,n,o)},text:function(t,e,i,n){return new r.Text(this.game,t,e,i,n)},button:function(t,e,i,n,o,s,a,h,u){return new r.Button(this.game,t,e,i,n,o,s,a,h,u)},graphics:function(t,e){return new r.Graphics(this.game,t,e)},emitter:function(t,e,i){return new r.Particles.Arcade.Emitter(this.game,t,e,i)},retroFont:function(t,e,i,n,o,s,a,h,u){return new r.RetroFont(this.game,t,e,i,n,o,s,a,h,u)},bitmapText:function(t,e,i,n,o,s){return new r.BitmapText(this.game,t,e,i,n,o,s)},tilemap:function(t,e,i,n,o){return new r.Tilemap(this.game,t,e,i,n,o)},renderTexture:function(t,e,i,n){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===n&&(n=!1);var o=new r.RenderTexture(this.game,t,e,i);return n&&this.game.cache.addRenderTexture(i,o),o},bitmapData:function(t,e,i,n){void 0===n&&(n=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());var o=new r.BitmapData(this.game,i,t,e);return n&&this.game.cache.addBitmapData(i,o),o},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new r.Filter[t](this.game)).init.apply(t,e),t}},r.GameObjectCreator.prototype.constructor=r.GameObjectCreator,r.Sprite=function(t,e,i,n,o){e=e||0,i=i||0,n=n||null,o=o||null,this.type=r.SPRITE,this.physicsType=r.SPRITE,PIXI.Sprite.call(this,r.Cache.DEFAULT),r.Component.Core.init.call(this,t,e,i,n,o)},r.Sprite.prototype=Object.create(PIXI.Sprite.prototype),r.Sprite.prototype.constructor=r.Sprite,r.Component.Core.install.call(r.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),r.Sprite.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate,r.Sprite.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate,r.Sprite.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate,r.Sprite.prototype.preUpdateCore=r.Component.Core.preUpdate,r.Sprite.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},r.Image=function(t,e,i,n,o){e=e||0,i=i||0,n=n||null,o=o||null,this.type=r.IMAGE,PIXI.Sprite.call(this,r.Cache.DEFAULT),r.Component.Core.init.call(this,t,e,i,n,o)},r.Image.prototype=Object.create(PIXI.Sprite.prototype),r.Image.prototype.constructor=r.Image,r.Component.Core.install.call(r.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]),r.Image.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate,r.Image.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate,r.Image.prototype.preUpdateCore=r.Component.Core.preUpdate,r.Image.prototype.preUpdate=function(){return!(!this.preUpdateInWorld()||!this.preUpdateLifeSpan())&&this.preUpdateCore()},r.Button=function(t,e,i,n,o,s,a,h,u,c){e=e||0,i=i||0,n=n||null,o=o||null,s=s||this,r.Image.call(this,t,e,i,n,h),this.type=r.BUTTON,this.physicsType=r.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new r.Signal,this.onInputOut=new r.Signal,this.onInputDown=new r.Signal,this.onInputUp=new r.Signal,this.onOverMouseOnly=!0,this.justReleasedPreventsOver=r.PointerMode.CONTACT,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.input.useHandCursor=!0,this.setFrames(a,h,u,c),null!==o&&this.onInputUp.add(o,s),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this)},r.Button.prototype=Object.create(r.Image.prototype),r.Button.prototype.constructor=r.Button;return r.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},r.Button.prototype.setStateFrame=function(t,e,i){var n="_on"+t+"Frame";null!==e?(this[n]=e,i&&this.changeStateFrame(t)):this[n]=null},r.Button.prototype.changeStateFrame=function(t){if(this.freezeFrames)return!1;var e=this["_on"+t+"Frame"];return"string"==typeof e?(this.frameName=e,!0):"number"==typeof e&&(this.frame=e,!0)},r.Button.prototype.setFrames=function(t,e,i,n){this.setStateFrame("Over",t,this.input.pointerOver()),this.setStateFrame("Out",e,!this.input.pointerOver()),this.setStateFrame("Down",i,this.input.pointerDown()),this.setStateFrame("Up",n,this.input.pointerUp())},r.Button.prototype.setStateSound=function(t,e,i){var n="on"+t+"Sound",o="on"+t+"SoundMarker";e instanceof r.Sound||e instanceof r.AudioSprite?(this[n]=e,this[o]="string"==typeof i?i:""):(this[n]=null,this[o]="")},r.Button.prototype.playStateSound=function(t){var e=this["on"+t+"Sound"];if(e){var i=this["on"+t+"SoundMarker"];return e.play(i),!0}return!1},r.Button.prototype.setSounds=function(t,e,i,n,r,o,s,a){this.setStateSound("Over",t,e),this.setStateSound("Out",r,o),this.setStateSound("Down",i,n),this.setStateSound("Up",s,a)},r.Button.prototype.setOverSound=function(t,e){this.setStateSound("Over",t,e)},r.Button.prototype.setOutSound=function(t,e){this.setStateSound("Out",t,e)},r.Button.prototype.setDownSound=function(t,e){this.setStateSound("Down",t,e)},r.Button.prototype.setUpSound=function(t,e){this.setStateSound("Up",t,e)},r.Button.prototype.onInputOverHandler=function(t,e){e.justReleased()&&(this.justReleasedPreventsOver&e.pointerMode)===e.pointerMode||(this.changeStateFrame("Over"),this.onOverMouseOnly&&!e.isMouse||(this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,e)))},r.Button.prototype.onInputOutHandler=function(t,e){this.changeStateFrame("Out"),this.playStateSound("Out"),this.onInputOut&&this.onInputOut.dispatch(this,e)},r.Button.prototype.onInputDownHandler=function(t,e){this.changeStateFrame("Down"),this.playStateSound("Down"),this.onInputDown&&this.onInputDown.dispatch(this,e)},r.Button.prototype.onInputUpHandler=function(t,e,i){if(this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,e,i),!this.freezeFrames)if(!0===this.forceOut||(this.forceOut&e.pointerMode)===e.pointerMode)this.changeStateFrame("Out");else{this.changeStateFrame("Up")||(i?this.changeStateFrame("Over"):this.changeStateFrame("Out"))}},r.SpriteBatch=function(t,e,i,n){void 0!==e&&null!==e||(e=t.world),r.Group.call(this,t,e,i,n),this.type=r.SPRITEBATCH,this.fastSpriteBatch=null,this.ready=!1},r.SpriteBatch.prototype=Object.create(r.Group.prototype),r.SpriteBatch.prototype.constructor=r.SpriteBatch,r.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||(this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(t.gl),this.ready=!0),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},r.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,n=!0,r=0;r<this.children.length;r++){var o=this.children[r];if(o.visible){var s=o.texture,a=s.frame;if(e.globalAlpha=this.worldAlpha*o.alpha,o.rotation%(2*Math.PI)==0)n&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n=!1),e.drawImage(s.baseTexture.source,a.x,a.y,a.width,a.height,o.anchor.x*(-a.width*o.scale.x)+o.position.x+.5+t.shakeX|0,o.anchor.y*(-a.height*o.scale.y)+o.position.y+.5+t.shakeY|0,a.width*o.scale.x,a.height*o.scale.y);else{n||(n=!0),o.displayObjectUpdateTransform();var h=o.worldTransform,u=h.tx*t.resolution+t.shakeX,c=h.ty*t.resolution+t.shakeY;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,0|u,0|c):e.setTransform(h.a,h.b,h.c,h.d,u,c),e.drawImage(s.baseTexture.source,a.x,a.y,a.width,a.height,o.anchor.x*-a.width+.5|0,o.anchor.y*-a.height+.5|0,a.width,a.height)}}}}},r.BitmapData=function(t,e,i,n,o){void 0!==i&&0!==i||(i=256),void 0!==n&&0!==n||(n=256),void 0===o&&(o=!1),this.game=t,this.key=e,this.width=i,this.height=n,this.canvas=r.Canvas.create(this,i,n,null,o),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.smoothProperty=t.renderType===r.CANVAS?t.renderer.renderSession.smoothProperty:r.Canvas.getSmoothingPrefix(this.context),this.imageData=this.context.getImageData(0,0,i,n),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data),this.baseTexture=new PIXI.BaseTexture(this.canvas,null,this.game.resolution),this.texture=new PIXI.Texture(this.baseTexture),this.frameData=new r.FrameData,this.textureFrame=this.frameData.addFrame(new r.Frame(0,0,0,i,n,"bitmapData")),this.texture.frame=this.textureFrame,this.type=r.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new r.Point,this._size=new r.Point,this._scale=new r.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new r.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new r.Circle,this._swapCanvas=void 0},r.BitmapData.prototype={move:function(t,e,i){return 0!==t&&this.moveH(t,i),0!==e&&this.moveV(e,i),this},moveH:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=r.CanvasPool.create(this,this.width,this.height));var i=this._swapCanvas.getContext("2d"),n=this.height,o=this.canvas;if(i.clearRect(0,0,this.width,this.height),t<0){t=Math.abs(t);var s=this.width-t;e&&i.drawImage(o,0,0,t,n,s,0,t,n),i.drawImage(o,t,0,s,n,0,0,s,n)}else{s=this.width-t;e&&i.drawImage(o,s,0,t,n,0,0,t,n),i.drawImage(o,0,0,s,n,t,0,s,n)}return this.clear(),this.copy(this._swapCanvas)},moveV:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=r.CanvasPool.create(this,this.width,this.height));var i=this._swapCanvas.getContext("2d"),n=this.width,o=this.canvas;if(i.clearRect(0,0,this.width,this.height),t<0){t=Math.abs(t);var s=this.height-t;e&&i.drawImage(o,0,0,n,t,0,s,n,t),i.drawImage(o,0,t,n,s,0,0,n,s)}else{s=this.height-t;e&&i.drawImage(o,0,s,n,t,0,0,n,t),i.drawImage(o,0,0,n,s,0,t,n,s)}return this.clear(),this.copy(this._swapCanvas)},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},load:function(t){if("string"==typeof t&&(t=this.game.cache.getImage(t)),t)return this.resize(t.width,t.height),this.cls(),this.draw(t),this.update(),this},clear:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.width),void 0===n&&(n=this.height),this.context.clearRect(t,e,i,n),this.dirty=!0,this},fill:function(t,e,i,n){return void 0===n&&(n=1),this.context.fillStyle="rgba("+t+","+e+","+i+","+n+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(t,e,i){var n=this.game.cache,r=new Image;if(e&&(r.onload=function(){var o=n.addImage(t,"",r),s=new PIXI.Texture(o.base);e.call(i||null,s),r.onload=null}),r.src=this.canvas.toDataURL("image/png"),!e){var o=n.addImage(t,"",r);return new PIXI.Texture(o.base)}return null},resize:function(t,e){return t===this.width&&e===this.height||(this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,void 0!==this._swapCanvas&&(this._swapCanvas.width=t,this._swapCanvas.height=e),this.baseTexture.width=t,this.baseTexture.height=e,this.textureFrame.width=t,this.textureFrame.height=e,this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.update(),this.dirty=!0),this},update:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=Math.max(1,this.width)),void 0===n&&(n=Math.max(1,this.height)),this.imageData=this.context.getImageData(t,e,i,n),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,e,i,n,o,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=this.width),void 0===s&&(s=this.height);for(var a=i+o,h=n+s,u=r.Color.createColor(),c={r:0,g:0,b:0,a:0},l=!1,d=n;d<h;d++)for(var p=i;p<a;p++)r.Color.unpackPixel(this.getPixel32(p,d),u),!1!==(c=t.call(e,u,p,d))&&null!==c&&void 0!==c&&(this.setPixel32(p,d,c.r,c.g,c.b,c.a,!1),l=!0);return l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(t,e,i,n,r,o){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=this.width),void 0===o&&(o=this.height);for(var s=i+r,a=n+o,h=0,u=0,c=!1,l=n;l<a;l++)for(var d=i;d<s;d++)h=this.getPixel32(d,l),(u=t.call(e,h,d,l))!==h&&(this.pixels[l*this.width+d]=u,c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,e,i,n,o,s,a,h,u){var c=0,l=0,d=this.width,p=this.height,f=r.Color.packPixel(t,e,i,n);void 0!==u&&u instanceof r.Rectangle&&(c=u.x,l=u.y,d=u.width,p=u.height);for(var m=0;m<p;m++)for(var g=0;g<d;g++)this.getPixel32(c+g,l+m)===f&&this.setPixel32(c+g,l+m,o,s,a,h,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,e,i,n){var o=t||0===t,s=e||0===e,a=i||0===i;if(o||s||a){void 0===n&&(n=new r.Rectangle(0,0,this.width,this.height));for(var h=r.Color.createColor(),u=n.y;u<n.bottom;u++)for(var c=n.x;c<n.right;c++)r.Color.unpackPixel(this.getPixel32(c,u),h,!0),o&&(h.h=t),s&&(h.s=e),a&&(h.l=i),r.Color.HSLtoRGB(h.h,h.s,h.l,h),this.setPixel32(c,u,h.r,h.g,h.b,h.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,e,i,n){if(void 0!==t&&null!==t||(t=!1),void 0!==e&&null!==e||(e=!1),void 0!==i&&null!==i||(i=!1),t||e||i){void 0===n&&(n=new r.Rectangle(0,0,this.width,this.height));for(var o=r.Color.createColor(),s=n.y;s<n.bottom;s++)for(var a=n.x;a<n.right;a++)r.Color.unpackPixel(this.getPixel32(a,s),o,!0),t&&(o.h=this.game.math.wrap(o.h+t,0,1)),e&&(o.s=this.game.math.clamp(o.s+e,0,1)),i&&(o.l=this.game.math.clamp(o.l+i,0,1)),r.Color.HSLtoRGB(o.h,o.s,o.l,o),this.setPixel32(a,s,o.r,o.g,o.b,o.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,e,i,n,o,s,a){return void 0===a&&(a=!0),t>=0&&t<=this.width&&e>=0&&e<=this.height&&(r.Device.LITTLE_ENDIAN?this.pixels[e*this.width+t]=s<<24|o<<16|n<<8|i:this.pixels[e*this.width+t]=i<<24|n<<16|o<<8|s,a&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(t,e,i,n,r,o){return this.setPixel32(t,e,i,n,r,255,o)},getPixel:function(t,e,i){i||(i=r.Color.createColor());var n=~~(t+e*this.width);return n*=4,i.r=this.data[n],i.g=this.data[++n],i.b=this.data[++n],i.a=this.data[++n],i},getPixel32:function(t,e){if(t>=0&&t<=this.width&&e>=0&&e<=this.height)return this.pixels[e*this.width+t]},getPixelRGB:function(t,e,i,n,o){return r.Color.unpackPixel(this.getPixel32(t,e),i,n,o)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){void 0===t&&(t=0);var e=r.Color.createColor(),i=0,n=0,o=1,s=!1;1===t?(o=-1,n=this.height):3===t&&(o=-1,i=this.width);do{r.Color.unpackPixel(this.getPixel32(i,n),e),0===t||1===t?++i===this.width&&(i=0,((n+=o)>=this.height||n<=0)&&(s=!0)):2!==t&&3!==t||++n===this.height&&(n=0,((i+=o)>=this.width||i<=0)&&(s=!0))}while(0===e.a&&!s);return e.x=i,e.y=n,e},getBounds:function(t){return void 0===t&&(t=new r.Rectangle),t.x=this.getFirstPixel(2).x,t.x===this.width?t.setTo(0,0,0,0):(t.y=this.getFirstPixel(0).y,t.width=this.getFirstPixel(3).x-t.x+1,t.height=this.getFirstPixel(1).y-t.y+1,t)},addToWorld:function(t,e,i,n,r,o){r=r||1,o=o||1;var s=this.game.add.image(t,e,this);return s.anchor.set(i,n),s.scale.set(r,o),s},copy:function(t,e,i,n,o,s,a,h,u,c,l,d,p,f,m,g,y){if(void 0!==t&&null!==t||(t=this),t instanceof r.RenderTexture&&(t=t.getCanvas()),this._image=t,t instanceof r.Sprite||t instanceof r.Image||t instanceof r.Text||t instanceof PIXI.Sprite)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,t.texture instanceof r.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source,void 0!==s&&null!==s||(s=t.x),void 0!==a&&null!==a||(a=t.y),t.texture.trim&&(s+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,a+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof r.BitmapData)this._image=t.canvas;else if("string"==typeof t){if(null===(t=this.game.cache.getImage(t)))return;this._image=t}this._size.set(this._image.width,this._image.height)}if(void 0!==e&&null!==e||(e=0),void 0!==i&&null!==i||(i=0),n&&(this._size.x=n),o&&(this._size.y=o),void 0!==s&&null!==s||(s=e),void 0!==a&&null!==a||(a=i),void 0!==h&&null!==h||(h=this._size.x),void 0!==u&&null!==u||(u=this._size.y),"number"==typeof c&&(this._rotate=c),"number"==typeof l&&(this._anchor.x=l),"number"==typeof d&&(this._anchor.y=d),"number"==typeof p&&(this._scale.x=p),"number"==typeof f&&(this._scale.y=f),"number"==typeof m&&(this._alpha.current=m),void 0===g&&(g=null),void 0===y&&(y=!1),!(this._alpha.current<=0||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y)){var v=this.context;return this._alpha.prev=v.globalAlpha,v.save(),v.globalAlpha=this._alpha.current,g&&(this.op=g),y&&(s|=0,a|=0),v.translate(s,a),v.scale(this._scale.x,this._scale.y),v.rotate(this._rotate),v.drawImage(this._image,this._pos.x+e,this._pos.y+i,this._size.x,this._size.y,-h*this._anchor.x,-u*this._anchor.y,h,u),v.restore(),v.globalAlpha=this._alpha.prev,this.dirty=!0,this}},copyTransform:function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=!1),!t.hasOwnProperty("worldTransform")||!t.worldVisible||0===t.worldAlpha)return this;var n=t.worldTransform;if(this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),0===n.a||0===n.d||0===this._size.x||0===this._size.y)return this;t.texture instanceof r.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source;var o=n.tx,s=n.ty;t.texture.trim&&(o+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,s+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0)),i&&(o|=0,s|=0);var a=this.context;return this._alpha.prev=a.globalAlpha,a.save(),a.globalAlpha=this._alpha.current,e&&(this.op=e),a[this.smoothProperty]=t.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,a.setTransform(n.a,n.b,n.c,n.d,o,s),a.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*t.anchor.x,-this._size.y*t.anchor.y,this._size.x,this._size.y),a.restore(),a.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(t,e,i,n,r,o,s){return this.copy(t,e.x,e.y,e.width,e.height,i,n,e.width,e.height,0,0,0,1,1,r,o,s)},draw:function(t,e,i,n,r,o,s){return this.copy(t,null,null,null,null,e,i,n,r,null,null,null,null,null,null,o,s)},drawGroup:function(t,e,i){return t.total>0&&t.forEachExists(this.drawGroupProxy,this,e,i),this},drawGroupProxy:function(t,e,i){if(t.hasOwnProperty("texture")&&this.copyTransform(t,e,i),t.type===r.GROUP&&t.exists)this.drawGroup(t,e,i);else if(t.hasOwnProperty("children")&&t.children.length>0)for(var n=0;n<t.children.length;n++)t.children[n].exists&&this.copyTransform(t.children[n],e,i)},drawFull:function(t,e,i){if(!1===t.worldVisible||0===t.worldAlpha||t.hasOwnProperty("exists")&&!1===t.exists)return this;if(t.type!==r.GROUP&&t.type!==r.EMITTER&&t.type!==r.BITMAPTEXT)if(t.type===r.GRAPHICS){var n=t.getBounds();this.ctx.save(),this.ctx.translate(n.x,n.y),PIXI.CanvasGraphics.renderGraphics(t,this.ctx),this.ctx.restore()}else this.copy(t,null,null,null,null,t.worldPosition.x,t.worldPosition.y,null,null,t.worldRotation,null,null,t.worldScale.x,t.worldScale.y,t.worldAlpha,e,i);if(t.children)for(var o=0;o<t.children.length;o++)this.drawFull(t.children[o],e,i);return this},shadow:function(t,e,i,n){var r=this.context;return void 0===t||null===t?r.shadowColor="rgba(0,0,0,0)":(r.shadowColor=t,r.shadowBlur=e||5,r.shadowOffsetX=i||10,r.shadowOffsetY=n||10),this},alphaMask:function(t,e,i,n){return void 0===n||null===n?this.draw(e).blendSourceAtop():this.draw(e,n.x,n.y,n.width,n.height).blendSourceAtop(),void 0===i||null===i?this.draw(t).blendReset():this.draw(t,i.x,i.y,i.width,i.height).blendReset(),this},extract:function(t,e,i,n,r,o,s,a,h){return void 0===r&&(r=255),void 0===o&&(o=!1),void 0===s&&(s=e),void 0===a&&(a=i),void 0===h&&(h=n),o&&t.resize(this.width,this.height),this.processPixelRGB(function(o,u,c){return o.r===e&&o.g===i&&o.b===n&&t.setPixel32(u,c,s,a,h,r,!1),!1},this),t.context.putImageData(t.imageData,0,0),t.dirty=!0,t},rect:function(t,e,i,n,r){return"undefined"!=typeof r&&(this.context.fillStyle=r),this.context.fillRect(t,e,i,n),this},text:function(t,e,i,n,r,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n="14px Courier"),void 0===r&&(r="rgb(255,255,255)"),void 0===o&&(o=!0);var s=this.context,a=s.font;return s.font=n,o&&(s.fillStyle="rgb(0,0,0)",s.fillText(t,e+1,i+1)),s.fillStyle=r,s.fillText(t,e,i),s.font=a,this},circle:function(t,e,i,n){var r=this.context;return void 0!==n&&(r.fillStyle=n),r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.closePath(),r.fill(),this},line:function(t,e,i,n,r,o){void 0===r&&(r="#fff"),void 0===o&&(o=1);var s=this.context;return s.beginPath(),s.moveTo(t,e),s.lineTo(i,n),s.lineWidth=o,s.strokeStyle=r,s.stroke(),s.closePath(),this},polygon:function(t,e,i,n){void 0===n&&(n="#fff"),void 0===i&&(i=0);var r=this.context;e&&(r.fillStyle=e),i&&(r.lineWidth=i,r.strokeStyle=n),r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var o=1,s=t.length;o<s;o++){var a=t[o];r.lineTo(a.x,a.y)}return r.closePath(),e&&r.fill(),i&&r.stroke(),this},textureLine:function(t,e,i){if(void 0===i&&(i="repeat-x"),"string"!=typeof e||(e=this.game.cache.getImage(e))){var n=t.length;"no-repeat"===i&&n>e.width&&(n=e.width);var o=this.context;return o.fillStyle=o.createPattern(e,i),this._circle=new r.Circle(t.start.x,t.start.y,e.height),this._circle.circumferencePoint(t.angle-1.5707963267948966,!1,this._pos),o.save(),o.translate(this._pos.x,this._pos.y),o.rotate(t.angle),o.fillRect(0,0,n,e.height),o.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy(),this.texture.destroy(!0),r.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this},copyBitmapData:function(t,e,i){t.update();for(var n,r=0;r<t.height;r++){n=(i+r)*this.width+e;for(var o=0;o<t.width;o++)this.pixels[n+o]=t.pixels[r*t.width+o]}return this}},Object.defineProperty(r.BitmapData.prototype,"smoothed",{get:function(){r.Canvas.getSmoothingEnabled(this.context)},set:function(t){r.Canvas.setSmoothingEnabled(this.context,t)}}),Object.defineProperty(r.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}}),r.BitmapData.getTransform=function(t,e,i,n,r,o){return"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof i&&(i=1),"number"!=typeof n&&(n=1),"number"!=typeof r&&(r=0),"number"!=typeof o&&(o=0),{sx:i,sy:n,scaleX:i,scaleY:n,skewX:r,skewY:o,translateX:t,translateY:e,tx:t,ty:e}},r.BitmapData.prototype.constructor=r.BitmapData,r.EarCut={},r.EarCut.Triangulate=function(t,e,i){i=i||2;var n=e&&e.length,o=n?e[0]*i:t.length,s=r.EarCut.linkedList(t,0,o,i,!0),a=[];if(!s)return a;var h,u,c,l,d,p,f;if(n&&(s=r.EarCut.eliminateHoles(t,e,s,i)),t.length>80*i){h=c=t[0],u=l=t[1];for(var m=i;m<o;m+=i)d=t[m],p=t[m+1],d<h&&(h=d),p<u&&(u=p),d>c&&(c=d),p>l&&(l=p);f=Math.max(c-h,l-u)}return r.EarCut.earcutLinked(s,a,i,h,u,f),a},r.EarCut.linkedList=function(t,e,i,n,o){var s,a,h,u=0;for(s=e,a=i-n;s<i;s+=n)u+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;if(o===u>0)for(s=e;s<i;s+=n)h=r.EarCut.insertNode(s,t[s],t[s+1],h);else for(s=i-n;s>=e;s-=n)h=r.EarCut.insertNode(s,t[s],t[s+1],h);return h},r.EarCut.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!r.EarCut.equals(n,n.next)&&0!==r.EarCut.area(n.prev,n,n.next))n=n.next;else{if(r.EarCut.removeNode(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e},r.EarCut.earcutLinked=function(t,e,i,n,o,s,a){if(t){!a&&s&&r.EarCut.indexCurve(t,n,o,s);for(var h,u,c=t;t.prev!==t.next;)if(h=t.prev,u=t.next,s?r.EarCut.isEarHashed(t,n,o,s):r.EarCut.isEar(t))e.push(h.i/i),e.push(t.i/i),e.push(u.i/i),r.EarCut.removeNode(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?(t=r.EarCut.cureLocalIntersections(t,e,i),r.EarCut.earcutLinked(t,e,i,n,o,s,2)):2===a&&r.EarCut.splitEarcut(t,e,i,n,o,s):r.EarCut.earcutLinked(r.EarCut.filterPoints(t),e,i,n,o,s,1);break}}},r.EarCut.isEar=function(t){var e=t.prev,i=t,n=t.next;if(r.EarCut.area(e,i,n)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(r.EarCut.pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y)&&r.EarCut.area(o.prev,o,o.next)>=0)return!1;o=o.next}return!0},r.EarCut.isEarHashed=function(t,e,i,n){var o=t.prev,s=t,a=t.next;if(r.EarCut.area(o,s,a)>=0)return!1;for(var h=o.x<s.x?o.x<a.x?o.x:a.x:s.x<a.x?s.x:a.x,u=o.y<s.y?o.y<a.y?o.y:a.y:s.y<a.y?s.y:a.y,c=o.x>s.x?o.x>a.x?o.x:a.x:s.x>a.x?s.x:a.x,l=o.y>s.y?o.y>a.y?o.y:a.y:s.y>a.y?s.y:a.y,d=r.EarCut.zOrder(h,u,e,i,n),p=r.EarCut.zOrder(c,l,e,i,n),f=t.nextZ;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&r.EarCut.pointInTriangle(o.x,o.y,s.x,s.y,a.x,a.y,f.x,f.y)&&r.EarCut.area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=d;){if(f!==t.prev&&f!==t.next&&r.EarCut.pointInTriangle(o.x,o.y,s.x,s.y,a.x,a.y,f.x,f.y)&&r.EarCut.area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0},r.EarCut.cureLocalIntersections=function(t,e,i){var n=t;do{var o=n.prev,s=n.next.next;r.EarCut.intersects(o,n,n.next,s)&&r.EarCut.locallyInside(o,s)&&r.EarCut.locallyInside(s,o)&&(e.push(o.i/i),e.push(n.i/i),e.push(s.i/i),r.EarCut.removeNode(n),r.EarCut.removeNode(n.next),n=t=s),n=n.next}while(n!==t);return n},r.EarCut.splitEarcut=function(t,e,i,n,o,s){var a=t;do{for(var h=a.next.next;h!==a.prev;){if(a.i!==h.i&&r.EarCut.isValidDiagonal(a,h)){var u=r.EarCut.splitPolygon(a,h);return a=r.EarCut.filterPoints(a,a.next),u=r.EarCut.filterPoints(u,u.next),r.EarCut.earcutLinked(a,e,i,n,o,s),void r.EarCut.earcutLinked(u,e,i,n,o,s)}h=h.next}a=a.next}while(a!==t)},r.EarCut.eliminateHoles=function(t,e,i,n){var o,s,a,h,u,c=[];for(o=0,s=e.length;o<s;o++)a=e[o]*n,h=o<s-1?e[o+1]*n:t.length,(u=r.EarCut.linkedList(t,a,h,n,!1))===u.next&&(u.steiner=!0),c.push(r.EarCut.getLeftmost(u));for(c.sort(compareX),o=0;o<c.length;o++)r.EarCut.eliminateHole(c[o],i),i=r.EarCut.filterPoints(i,i.next);return i},r.EarCut.compareX=function(t,e){return t.x-e.x},r.EarCut.eliminateHole=function(t,e){if(e=r.EarCut.findHoleBridge(t,e)){var i=r.EarCut.splitPolygon(e,t);r.EarCut.filterPoints(i,i.next)}},r.EarCut.findHoleBridge=function(t,e){var i,n=e,o=t.x,s=t.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y){var h=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);h<=o&&h>a&&(a=h,i=n.x<n.next.x?n:n.next)}n=n.next}while(n!==e);if(!i)return null;if(t.x===i.x)return i.prev;var u,c=i,l=1/0;for(n=i.next;n!==c;)o>=n.x&&n.x>=i.x&&r.EarCut.pointInTriangle(s<i.y?o:a,s,i.x,i.y,s<i.y?a:o,s,n.x,n.y)&&((u=Math.abs(s-n.y)/(o-n.x))<l||u===l&&n.x>i.x)&&r.EarCut.locallyInside(n,t)&&(i=n,l=u),n=n.next;return i},r.EarCut.indexCurve=function(t,e,i,n){var o=t;do{null===o.z&&(o.z=r.EarCut.zOrder(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,r.EarCut.sortLinked(o)},r.EarCut.sortLinked=function(t){var e,i,n,r,o,s,a,h,u=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,n=i,a=0,e=0;e<u&&(a++,n=n.nextZ);e++);for(h=u;a>0||h>0&&n;)0===a?(r=n,n=n.nextZ,h--):0!==h&&n?i.z<=n.z?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,h--):(r=i,i=i.nextZ,a--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(s>1);return t},r.EarCut.zOrder=function(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1},r.EarCut.getLeftmost=function(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i},r.EarCut.pointInTriangle=function(t,e,i,n,r,o,s,a){return(r-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(i-s)*(e-a)>=0&&(i-s)*(o-a)-(r-s)*(n-a)>=0},r.EarCut.isValidDiagonal=function(t,e){return r.EarCut.equals(t,e)||t.next.i!==e.i&&t.prev.i!==e.i&&!r.EarCut.intersectsPolygon(t,e)&&r.EarCut.locallyInside(t,e)&&r.EarCut.locallyInside(e,t)&&r.EarCut.middleInside(t,e)},r.EarCut.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},r.EarCut.equals=function(t,e){return t.x===e.x&&t.y===e.y},r.EarCut.intersects=function(t,e,i,n){return r.EarCut.area(t,e,i)>0!=r.EarCut.area(t,e,n)>0&&r.EarCut.area(i,n,t)>0!=r.EarCut.area(i,n,e)>0},r.EarCut.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&r.EarCut.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},r.EarCut.locallyInside=function(t,e){return r.EarCut.area(t.prev,t,t.next)<0?r.EarCut.area(t,e,t.next)>=0&&r.EarCut.area(t,t.prev,e)>=0:r.EarCut.area(t,e,t.prev)<0||r.EarCut.area(t,t.next,e)<0},r.EarCut.middleInside=function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n},r.EarCut.splitPolygon=function(t,e){var i=new r.EarCut.Node(t.i,t.x,t.y),n=new r.EarCut.Node(e.i,e.x,e.y),o=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n},r.EarCut.insertNode=function(t,e,i,n){var o=new r.EarCut.Node(t,e,i);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o},r.EarCut.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},r.EarCut.Node=function(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(t,e){var i,n=e.gl,o=e.projection,s=e.offset,a=e.shaderManager.primitiveShader;t.dirty&&PIXI.WebGLGraphics.updateGraphics(t,n);var h=t._webGL[n.id];if(h)for(var u=0;u<h.data.length;u++)1===h.data[u].mode?(i=h.data[u],e.stencilManager.pushStencil(t,i,e),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(i.indices.length-4)),e.stencilManager.popStencil(t,i,e)):(i=h.data[u],e.shaderManager.setShader(a),a=e.shaderManager.primitiveShader,n.uniformMatrix3fv(a.translationMatrix,!1,t.worldTransform.toArray(!0)),n.uniform1f(a.flipY,1),n.uniform2f(a.projectionVector,o.x,-o.y),n.uniform2f(a.offsetVector,-s.x,-s.y),n.uniform3fv(a.tintColor,r.Color.hexToRGBArray(t.tint)),n.uniform1f(a.alpha,t.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,i.buffer),n.vertexAttribPointer(a.aVertexPosition,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(a.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,i.indices.length,n.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(t,e){var i=t._webGL[e.id];i||(i=t._webGL[e.id]={lastIndex:0,data:[],gl:e}),t.dirty=!1;var n;if(t.clearDirty){for(t.clearDirty=!1,n=0;n<i.data.length;n++){var o=i.data[n];o.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(o)}i.data=[],i.lastIndex=0}var s;for(n=i.lastIndex;n<t.graphicsData.length;n++){var a=t.graphicsData[n];if(a.type===r.POLYGON){if(a.points=a.shape.points.slice(),a.shape.closed&&(a.points[0]===a.points[a.points.length-2]&&a.points[1]===a.points[a.points.length-1]||a.points.push(a.points[0],a.points[1])),a.fill&&a.points.length>=PIXI.WebGLGraphics.stencilBufferLimit)if(a.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit){s=PIXI.WebGLGraphics.switchMode(i,0);PIXI.WebGLGraphics.buildPoly(a,s)||(s=PIXI.WebGLGraphics.switchMode(i,1),PIXI.WebGLGraphics.buildComplexPoly(a,s))}else s=PIXI.WebGLGraphics.switchMode(i,1),PIXI.WebGLGraphics.buildComplexPoly(a,s);a.lineWidth>0&&(s=PIXI.WebGLGraphics.switchMode(i,0),PIXI.WebGLGraphics.buildLine(a,s))}else s=PIXI.WebGLGraphics.switchMode(i,0),a.type===r.RECTANGLE?PIXI.WebGLGraphics.buildRectangle(a,s):a.type===r.CIRCLE||a.type===r.ELLIPSE?PIXI.WebGLGraphics.buildCircle(a,s):a.type===r.ROUNDEDRECTANGLE&&PIXI.WebGLGraphics.buildRoundedRectangle(a,s);i.lastIndex++}for(n=0;n<i.data.length;n++)(s=i.data[n]).dirty&&s.upload()},PIXI.WebGLGraphics.switchMode=function(t,e){var i;return t.data.length?(i=t.data[t.data.length-1]).mode===e&&1!==e||((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)):((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)),i.dirty=!0,i},PIXI.WebGLGraphics.buildRectangle=function(t,e){var i=t.shape,n=i.x,o=i.y,s=i.width,a=i.height;if(t.fill){var h=r.Color.hexToRGBArray(t.fillColor),u=t.fillAlpha,c=h[0]*u,l=h[1]*u,d=h[2]*u,p=e.points,f=e.indices,m=p.length/6;p.push(n,o),p.push(c,l,d,u),p.push(n+s,o),p.push(c,l,d,u),p.push(n,o+a),p.push(c,l,d,u),p.push(n+s,o+a),p.push(c,l,d,u),f.push(m,m,m+1,m+2,m+3,m+3)}if(t.lineWidth){var g=t.points;t.points=[n,o,n+s,o,n+s,o+a,n,o+a,n,o],PIXI.WebGLGraphics.buildLine(t,e),t.points=g}},PIXI.WebGLGraphics.buildRoundedRectangle=function(t,e){var i=t.shape,n=i.x,o=i.y,s=i.width,a=i.height,h=i.radius,u=[];if(u.push(n,o+h),u=u.concat(PIXI.WebGLGraphics.quadraticBezierCurve(n,o+a-h,n,o+a,n+h,o+a)),u=u.concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+s-h,o+a,n+s,o+a,n+s,o+a-h)),u=u.concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+s,o+h,n+s,o,n+s-h,o)),u=u.concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+h,o,n,o,n,o+h)),t.fill){var c=r.Color.hexToRGBArray(t.fillColor),l=t.fillAlpha,d=c[0]*l,p=c[1]*l,f=c[2]*l,m=e.points,g=e.indices,y=m.length/6,v=r.EarCut.Triangulate(u,null,2),b=0;for(b=0;b<v.length;b+=3)g.push(v[b]+y),g.push(v[b]+y),g.push(v[b+1]+y),g.push(v[b+2]+y),g.push(v[b+2]+y);for(b=0;b<u.length;b++)m.push(u[b],u[++b],d,p,f,l)}if(t.lineWidth){var x=t.points;t.points=u,PIXI.WebGLGraphics.buildLine(t,e),t.points=x}},PIXI.WebGLGraphics.quadraticBezierCurve=function(t,e,i,n,r,o){function s(t,e,i){return t+(e-t)*i}for(var a,h,u,c,l,d,p=[],f=0,m=0;m<=20;m++)a=s(t,i,f=m/20),h=s(e,n,f),u=s(i,r,f),c=s(n,o,f),l=s(a,u,f),d=s(h,c,f),p.push(l,d);return p},PIXI.WebGLGraphics.buildCircle=function(t,e){var i,n,o=t.shape,s=o.x,a=o.y;t.type===r.CIRCLE?(i=o.radius,n=o.radius):(i=o.width,n=o.height);var h=2*Math.PI/40,u=0;if(t.fill){var c=r.Color.hexToRGBArray(t.fillColor),l=t.fillAlpha,d=c[0]*l,p=c[1]*l,f=c[2]*l,m=e.points,g=e.indices,y=m.length/6;for(g.push(y),u=0;u<41;u++)m.push(s,a,d,p,f,l),m.push(s+Math.sin(h*u)*i,a+Math.cos(h*u)*n,d,p,f,l),g.push(y++,y++);g.push(y-1)}if(t.lineWidth){var v=t.points;for(t.points=[],u=0;u<41;u++)t.points.push(s+Math.sin(h*u)*i,a+Math.cos(h*u)*n);PIXI.WebGLGraphics.buildLine(t,e),t.points=v}},PIXI.WebGLGraphics.buildLine=function(t,e){var i=0,n=t.points;if(0!==n.length){if(t.lineWidth%2)for(i=0;i<n.length;i++)n[i]+=.5;var o=new PIXI.Point(n[0],n[1]),s=new PIXI.Point(n[n.length-2],n[n.length-1]);if(o.x===s.x&&o.y===s.y){(n=n.slice()).pop(),n.pop();var a=(s=new PIXI.Point(n[n.length-2],n[n.length-1])).x+.5*(o.x-s.x),h=s.y+.5*(o.y-s.y);n.unshift(a,h),n.push(a,h)}var u,c,l,d,p,f,m,g,y,v,b,x,_,w,T,S,E,C,P,M,A,R,L=e.points,O=e.indices,I=n.length/2,B=n.length,k=L.length/6,D=t.lineWidth/2,F=r.Color.hexToRGBArray(t.lineColor),U=t.lineAlpha,N=F[0]*U,G=F[1]*U,j=F[2]*U;for(l=n[0],d=n[1],p=n[2],y=-(d-(f=n[3])),v=l-p,y/=R=Math.sqrt(y*y+v*v),v/=R,y*=D,v*=D,L.push(l-y,d-v,N,G,j,U),L.push(l+y,d+v,N,G,j,U),i=1;i<I-1;i++)l=n[2*(i-1)],d=n[2*(i-1)+1],p=n[2*i],f=n[2*i+1],m=n[2*(i+1)],g=n[2*(i+1)+1],y=-(d-f),v=l-p,y/=R=Math.sqrt(y*y+v*v),v/=R,y*=D,v*=D,b=-(f-g),x=p-m,b/=R=Math.sqrt(b*b+x*x),x/=R,E=(-y+l)*(-v+f)-(-y+p)*(-v+d),M=(-(b*=D)+m)*(-(x*=D)+f)-(-b+p)*(-x+g),A=(T=-v+d-(-v+f))*(P=-b+p-(-b+m))-(C=-x+g-(-x+f))*(S=-y+p-(-y+l)),Math.abs(A)<.1?(A+=10.1,L.push(p-y,f-v,N,G,j,U),L.push(p+y,f+v,N,G,j,U)):((u=(S*M-P*E)/A)-p)*(u-p)+((c=(C*E-T*M)/A)-f)+(c-f)>19600?(_=y-b,w=v-x,_/=R=Math.sqrt(_*_+w*w),w/=R,_*=D,w*=D,L.push(p-_,f-w),L.push(N,G,j,U),L.push(p+_,f+w),L.push(N,G,j,U),L.push(p-_,f-w),L.push(N,G,j,U),B++):(L.push(u,c),L.push(N,G,j,U),L.push(p-(u-p),f-(c-f)),L.push(N,G,j,U));for(l=n[2*(I-2)],d=n[2*(I-2)+1],p=n[2*(I-1)],y=-(d-(f=n[2*(I-1)+1])),v=l-p,y/=R=Math.sqrt(y*y+v*v),v/=R,y*=D,v*=D,L.push(p-y,f-v),L.push(N,G,j,U),L.push(p+y,f+v),L.push(N,G,j,U),O.push(k),i=0;i<B;i++)O.push(k++);O.push(k-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(t,e){var i=t.points.slice();if(!(i.length<6)){var n=e.indices;e.points=i,e.alpha=t.fillAlpha,e.color=r.Color.hexToRGBArray(t.fillColor);for(var o,s,a=1/0,h=-1/0,u=1/0,c=-1/0,l=0;l<i.length;l+=2)o=i[l],s=i[l+1],a=o<a?o:a,h=o>h?o:h,u=s<u?s:u,c=s>c?s:c;i.push(a,u,h,u,h,c,a,c);var d=i.length/2;for(l=0;l<d;l++)n.push(l)}},PIXI.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(!(i.length<6)){var n=e.points,o=e.indices,s=i.length/2,a=r.Color.hexToRGBArray(t.fillColor),h=t.fillAlpha,u=a[0]*h,c=a[1]*h,l=a[2]*h,d=r.EarCut.Triangulate(i,null,2);if(!d)return!1;var p=n.length/6,f=0;for(f=0;f<d.length;f+=3)o.push(d[f]+p),o.push(d[f]+p),o.push(d[f+1]+p),o.push(d[f+2]+p),o.push(d[f+2]+p);for(f=0;f<s;f++)n.push(i[2*f],i[2*f+1],u,c,l,h);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(t,e){var i=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var n=0;n<t.graphicsData.length;n++){var o=t.graphicsData[n],s=o.shape,a=o._fillTint,h=o._lineTint;if(e.lineWidth=o.lineWidth,o.type===r.POLYGON){e.beginPath();var u=s.points;e.moveTo(u[0],u[1]);for(var c=1;c<u.length/2;c++)e.lineTo(u[2*c],u[2*c+1]);s.closed&&e.lineTo(u[0],u[1]),u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&e.closePath(),o.fill&&(e.globalAlpha=o.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}else if(o.type===r.RECTANGLE)(o.fillColor||0===o.fillColor)&&(e.globalAlpha=o.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fillRect(s.x,s.y,s.width,s.height)),o.lineWidth&&(e.globalAlpha=o.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.strokeRect(s.x,s.y,s.width,s.height));else if(o.type===r.CIRCLE)e.beginPath(),e.arc(s.x,s.y,s.radius,0,2*Math.PI),e.closePath(),o.fill&&(e.globalAlpha=o.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke());else if(o.type===r.ELLIPSE){var l=2*s.width,d=2*s.height,p=s.x-l/2,f=s.y-d/2;e.beginPath();var m=l/2*.5522848,g=d/2*.5522848,y=p+l,v=f+d,b=p+l/2,x=f+d/2;e.moveTo(p,x),e.bezierCurveTo(p,x-g,b-m,f,b,f),e.bezierCurveTo(b+m,f,y,x-g,y,x),e.bezierCurveTo(y,x+g,b+m,v,b,v),e.bezierCurveTo(b-m,v,p,x+g,p,x),e.closePath(),o.fill&&(e.globalAlpha=o.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}else if(o.type===r.ROUNDEDRECTANGLE){var _=s.x,w=s.y,T=s.width,S=s.height,E=s.radius,C=Math.min(T,S)/2|0;E=E>C?C:E,e.beginPath(),e.moveTo(_,w+E),e.lineTo(_,w+S-E),e.quadraticCurveTo(_,w+S,_+E,w+S),e.lineTo(_+T-E,w+S),e.quadraticCurveTo(_+T,w+S,_+T,w+S-E),e.lineTo(_+T,w+E),e.quadraticCurveTo(_+T,w,_+T-E,w),e.lineTo(_+E,w),e.quadraticCurveTo(_,w,_,w+E),e.closePath(),(o.fillColor||0===o.fillColor)&&(e.globalAlpha=o.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),o.lineWidth&&(e.globalAlpha=o.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}}},PIXI.CanvasGraphics.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(0!==i){e.beginPath();for(var n=0;n<i;n++){var o=t.graphicsData[n],s=o.shape;if(o.type===r.POLYGON){var a=s.points;e.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)e.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(o.type===r.RECTANGLE)e.rect(s.x,s.y,s.width,s.height),e.closePath();else if(o.type===r.CIRCLE)e.arc(s.x,s.y,s.radius,0,2*Math.PI),e.closePath();else if(o.type===r.ELLIPSE){var u=2*s.width,c=2*s.height,l=s.x-u/2,d=s.y-c/2,p=u/2*.5522848,f=c/2*.5522848,m=l+u,g=d+c,y=l+u/2,v=d+c/2;e.moveTo(l,v),e.bezierCurveTo(l,v-f,y-p,d,y,d),e.bezierCurveTo(y+p,d,m,v-f,m,v),e.bezierCurveTo(m,v+f,y+p,g,y,g),e.bezierCurveTo(y-p,g,l,v+f,l,v),e.closePath()}else if(o.type===r.ROUNDEDRECTANGLE){var b=s.x,x=s.y,_=s.width,w=s.height,T=s.radius,S=Math.min(_,w)/2|0;T=T>S?S:T,e.moveTo(b,x+T),e.lineTo(b,x+w-T),e.quadraticCurveTo(b,x+w,b+T,x+w),e.lineTo(b+_-T,x+w),e.quadraticCurveTo(b+_,x+w,b+_,x+w-T),e.lineTo(b+_,x+T),e.quadraticCurveTo(b+_,x,b+_-T,x),e.lineTo(b+T,x),e.quadraticCurveTo(b,x,b,x+T),e.closePath()}}}},PIXI.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,n=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var o=t.graphicsData[r],s=0|o.fillColor,a=0|o.lineColor;o._fillTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*i*255<<8)+(255&s)/255*n*255,o._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*n*255}},r.GraphicsData=function(t,e,i,n,r,o,s){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=n,this.fillAlpha=r,this._fillTint=n,this.fill=o,this.shape=s,this.type=s.type},r.GraphicsData.prototype.constructor=r.GraphicsData,r.GraphicsData.prototype.clone=function(){return new r.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},r.Graphics=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.type=r.GRAPHICS,this.physicsType=r.SPRITE,this.anchor=new r.Point,PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new r.Rectangle(0,0,1,1),this.dirty=!0,this._boundsDirty=!1,this.webGLDirty=!1,this.cachedSpriteDirty=!1,r.Component.Core.init.call(this,t,e,i,"",null)},r.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),r.Graphics.prototype.constructor=r.Graphics,r.Component.Core.install.call(r.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),r.Graphics.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate,r.Graphics.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate,r.Graphics.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate,r.Graphics.prototype.preUpdateCore=r.Component.Core.preUpdate,r.Graphics.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},r.Graphics.prototype.postUpdate=function(){r.Component.PhysicsBody.postUpdate.call(this),r.Component.FixedToCamera.postUpdate.call(this),this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},r.Graphics.prototype.destroy=function(t){this.clear(),r.Component.Destroy.prototype.destroy.call(this,t)},r.Graphics.prototype.drawTriangle=function(t,e){void 0===e&&(e=!1);var i=new r.Polygon(t);if(e){var n=new r.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),o=new r.Point(t[1].x-t[0].x,t[1].y-t[0].y),s=new r.Point(t[1].x-t[2].x,t[1].y-t[2].y).cross(o);n.dot(s)>0&&this.drawPolygon(i)}else this.drawPolygon(i)},r.Graphics.prototype.drawTriangles=function(t,e,i){void 0===i&&(i=!1);var n,o=new r.Point,s=new r.Point,a=new r.Point,h=[];if(e)if(t[0]instanceof r.Point)for(n=0;n<e.length/3;n++)h.push(t[e[3*n]]),h.push(t[e[3*n+1]]),h.push(t[e[3*n+2]]),3===h.length&&(this.drawTriangle(h,i),h=[]);else for(n=0;n<e.length;n++)o.x=t[2*e[n]],o.y=t[2*e[n]+1],h.push(o.copyTo({})),3===h.length&&(this.drawTriangle(h,i),h=[]);else if(t[0]instanceof r.Point)for(n=0;n<t.length/3;n++)this.drawTriangle([t[3*n],t[3*n+1],t[3*n+2]],i);else for(n=0;n<t.length/6;n++)o.x=t[6*n+0],o.y=t[6*n+1],s.x=t[6*n+2],s.y=t[6*n+3],a.x=t[6*n+4],a.y=t[6*n+5],this.drawTriangle([o,s,a],i)},r.Graphics.prototype.lineStyle=function(t,e,i){return this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0===i?1:i,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new r.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},r.Graphics.prototype.moveTo=function(t,e){return this.drawShape(new r.Polygon([t,e])),this},r.Graphics.prototype.lineTo=function(t,e){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(t,e),this.dirty=!0,this._boundsDirty=!0,this},r.Graphics.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,o,s=this.currentPath.shape.points;0===s.length&&this.moveTo(0,0);for(var a=s[s.length-2],h=s[s.length-1],u=0,c=1;c<=20;++c)r=a+(t-a)*(u=c/20),o=h+(e-h)*u,s.push(r+(t+(i-t)*u-r)*u,o+(e+(n-e)*u-o)*u);return this.dirty=!0,this._boundsDirty=!0,this},r.Graphics.prototype.bezierCurveTo=function(t,e,i,n,r,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var s,a,h,u,c,l=this.currentPath.shape.points,d=l[l.length-2],p=l[l.length-1],f=0,m=1;m<=20;++m)h=(a=(s=1-(f=m/20))*s)*s,c=(u=f*f)*f,l.push(h*d+3*a*f*t+3*s*u*i+c*r,h*p+3*a*f*e+3*s*u*n+c*o);return this.dirty=!0,this._boundsDirty=!0,this},r.Graphics.prototype.arcTo=function(t,e,i,n,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var o=this.currentPath.shape.points,s=o[o.length-2],a=o[o.length-1]-e,h=s-t,u=n-e,c=i-t,l=Math.abs(a*c-h*u);if(l<1e-8||0===r)o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e);else{var d=a*a+h*h,p=u*u+c*c,f=a*u+h*c,m=r*Math.sqrt(d)/l,g=r*Math.sqrt(p)/l,y=m*f/d,v=g*f/p,b=m*c+g*h,x=m*u+g*a,_=h*(g+y),w=a*(g+y),T=c*(m+v),S=u*(m+v),E=Math.atan2(w-x,_-b),C=Math.atan2(S-x,T-b);this.arc(b+t,x+e,r,E,C,h*u>c*a)}return this.dirty=!0,this._boundsDirty=!0,this},r.Graphics.prototype.arc=function(t,e,i,n,r,o,s){if(n===r)return this;void 0===o&&(o=!1),void 0===s&&(s=40),!o&&r<=n?r+=2*Math.PI:o&&n<=r&&(n+=2*Math.PI);var a=o?-1*(n-r):r-n,h=Math.ceil(Math.abs(a)/(2*Math.PI))*s;if(0===a)return this;var u=t+Math.cos(n)*i,c=e+Math.sin(n)*i;o&&this.filling?this.moveTo(t,e):this.moveTo(u,c);for(var l=this.currentPath.shape.points,d=a/(2*h),p=2*d,f=Math.cos(d),m=Math.sin(d),g=h-1,y=g%1/g,v=0;v<=g;v++){var b=d+n+p*(v+y*v),x=Math.cos(b),_=-Math.sin(b);l.push((f*x+m*_)*i+t,(f*-_+m*x)*i+e)}return this.dirty=!0,this._boundsDirty=!0,this},r.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},r.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},r.Graphics.prototype.drawRect=function(t,e,i,n){return this.drawShape(new r.Rectangle(t,e,i,n)),this},r.Graphics.prototype.drawRoundedRect=function(t,e,i,n,o){return this.drawShape(new r.RoundedRectangle(t,e,i,n,o)),this},r.Graphics.prototype.drawCircle=function(t,e,i){return this.drawShape(new r.Circle(t,e,i)),this},r.Graphics.prototype.drawEllipse=function(t,e,i,n){return this.drawShape(new r.Ellipse(t,e,i,n)),this},r.Graphics.prototype.drawPolygon=function(t){t instanceof r.Polygon&&(t=t.points);var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i)e[i]=arguments[i]}return this.drawShape(new r.Polygon(e)),this},r.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},r.Graphics.prototype.generateTexture=function(t,e,i){void 0===t&&(t=1),void 0===e&&(e=PIXI.scaleModes.DEFAULT),void 0===i&&(i=0);var n=this.getBounds();n.width+=i,n.height+=i;var r=new PIXI.CanvasBuffer(n.width*t,n.height*t),o=PIXI.Texture.fromCanvas(r.canvas,e);return o.baseTexture.resolution=t,r.context.scale(t,t),r.context.translate(-n.x,-n.y),PIXI.CanvasGraphics.renderGraphics(this,r.context),o},r.Graphics.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=PIXI.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},r.Graphics.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);var e=t.context,i=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var n=t.resolution,r=i.tx*t.resolution+t.shakeX,o=i.ty*t.resolution+t.shakeY;e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,r,o),PIXI.CanvasGraphics.renderGraphics(this,e);for(var s=0;s<this.children.length;s++)this.children[s]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},r.Graphics.prototype.getBounds=function(t){if(this._currentBounds)return this._currentBounds;if(!this.renderable)return r.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,i=e.x,n=e.width+e.x,o=e.y,s=e.height+e.y,a=t||this.worldTransform,h=a.a,u=a.b,c=a.c,l=a.d,d=a.tx,p=a.ty,f=h*n+c*s+d,m=l*s+u*n+p,g=h*i+c*s+d,y=l*s+u*i+p,v=h*i+c*o+d,b=l*o+u*i+p,x=h*n+c*o+d,_=l*o+u*n+p,w=f,T=m,S=f,E=m;return S=g<S?g:S,S=v<S?v:S,S=x<S?x:S,E=y<E?y:E,E=b<E?b:E,E=_<E?_:E,w=g>w?g:w,w=v>w?v:w,w=x>w?x:w,T=y>T?y:T,T=b>T?b:T,T=_>T?_:T,this._bounds.x=S,this._bounds.width=w-S,this._bounds.y=E,this._bounds.height=T-E,this._currentBounds=this._bounds,this._currentBounds},r.Graphics.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=r.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var i=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return i},r.Graphics.prototype.containsPoint=function(t,e){void 0===e&&(e=new r.Point),this.worldTransform.applyInverse(t,e);for(var i=this.graphicsData,n=0;n<i.length;n++){var o=i[n];if(o.fill&&(o.shape&&o.shape.contains(e.x,e.y)))return!0}return!1},r.Graphics.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,i=1/0,n=-1/0;if(this.graphicsData.length)for(var o,s,a,h,u,c,l=0;l<this.graphicsData.length;l++){var d=this.graphicsData[l],p=d.type,f=d.lineWidth;if(o=d.shape,p===r.RECTANGLE||p===r.ROUNDEDRECTANGLE)a=o.x-f/2,h=o.y-f/2,u=o.width+f,c=o.height+f,t=a<t?a:t,e=a+u>e?a+u:e,i=h<i?h:i,n=h+c>n?h+c:n;else if(p===r.CIRCLE)a=o.x,h=o.y,u=o.radius+f/2,c=o.radius+f/2,t=a-u<t?a-u:t,e=a+u>e?a+u:e,i=h-c<i?h-c:i,n=h+c>n?h+c:n;else if(p===r.ELLIPSE)a=o.x,h=o.y,u=o.width+f/2,c=o.height+f/2,t=a-u<t?a-u:t,e=a+u>e?a+u:e,i=h-c<i?h-c:i,n=h+c>n?h+c:n;else{s=o.points;for(var m=0;m<s.length;m++)s[m]instanceof r.Point?(a=s[m].x,h=s[m].y):(a=s[m],h=s[m+1],m<s.length-1&&m++),t=a-f<t?a-f:t,e=a+f>e?a+f:e,i=h-f<i?h-f:i,n=h+f>n?h+f:n}}else t=0,e=0,i=0,n=0;var g=this.boundsPadding;this._localBounds.x=t-g,this._localBounds.width=e-t+2*g,this._localBounds.y=i-g,this._localBounds.height=n-i+2*g},r.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(t.width,t.height);else{var e=new PIXI.CanvasBuffer(t.width,t.height),i=PIXI.Texture.fromCanvas(e.canvas);this._cachedSprite=new PIXI.Sprite(i),this._cachedSprite.buffer=e,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._cachedSprite.buffer.context.translate(-t.x,-t.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},r.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},r.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},r.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,t instanceof r.Polygon&&(t=t.clone()).flatten();var e=new r.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(e),e.type===r.POLYGON&&(e.shape.closed=this.filling,this.currentPath=e),this.dirty=!0,this._boundsDirty=!0,e},Object.defineProperty(r.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite(),this.dirty=!0,this.webGLDirty=!0}}),r.RenderTexture=function(t,e,i,n,o,s,a,h){if(void 0===e&&(e=100),void 0===i&&(i=100),void 0===n&&(n=""),void 0===o&&(o=r.scaleModes.DEFAULT),void 0===s&&(s=1),void 0===a&&(a=PIXI.defaultRenderer),void 0===h&&(h=0),this.game=t,this.key=n,this.type=r.RENDERTEXTURE,this._tempMatrix=new r.Matrix,this.width=e,this.height=i,this.resolution=s,this.frame=new r.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=this.frame.clone(),this.baseTexture=new PIXI.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=o,this.baseTexture.hasLoaded=!0,PIXI.Texture.call(this,this.baseTexture,this.frame.clone()),this.renderer=a,this.renderer.type===r.WEBGL){var u=this.renderer.gl;this.baseTexture.textureIndex=h,this.baseTexture._dirty[u.id]=!1,this.textureBuffer=new PIXI.FilterTexture(u,this.width,this.height,this.baseTexture.scaleMode,h),this.baseTexture._glTextures[u.id]=this.textureBuffer.texture,this.projection=new r.Point(.5*this.width,.5*-this.height)}else this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this.tempMatrix=new r.Matrix,this._updateUvs()},r.RenderTexture.prototype=Object.create(PIXI.Texture.prototype),r.RenderTexture.prototype.constructor=r.RenderTexture,r.RenderTexture.prototype.renderXY=function(t,e,i,n){t.updateTransform(),this._tempMatrix.copyFrom(t.worldTransform),this._tempMatrix.tx=e,this._tempMatrix.ty=i,this.renderer.type===r.WEBGL?this._renderWebGL(t,this._tempMatrix,n):this._renderCanvas(t,this._tempMatrix,n)},r.RenderTexture.prototype.renderRawXY=function(t,e,i,n){this._tempMatrix.identity().translate(e,i),this.renderer.type===r.WEBGL?this._renderWebGL(t,this._tempMatrix,n):this._renderCanvas(t,this._tempMatrix,n)},r.RenderTexture.prototype.render=function(t,e,i){void 0===e||null===e?this._tempMatrix.copyFrom(t.worldTransform):this._tempMatrix.copyFrom(e),this.renderer.type===r.WEBGL?this._renderWebGL(t,this._tempMatrix,i):this._renderCanvas(t,this._tempMatrix,i)},r.RenderTexture.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,i&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===r.WEBGL&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},r.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===r.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},r.RenderTexture.prototype._renderWebGL=function(t,e,i){if(this.valid&&0!==t.alpha){var n=t.worldTransform;n.identity(),n.translate(0,2*this.projection.y),e&&n.append(e),n.scale(1,-1);for(var r=0;r<t.children.length;r++)t.children[r].updateTransform();var o=this.renderer.gl;o.viewport(0,0,this.width*this.resolution,this.height*this.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer,e),this.renderer.spriteBatch.dirty=!0,o.bindFramebuffer(o.FRAMEBUFFER,null)}},r.RenderTexture.prototype._renderCanvas=function(t,e,i){if(this.valid&&0!==t.alpha){var n=t.worldTransform;n.identity(),e&&n.append(e);for(var r=0;r<t.children.length;r++)t.children[r].updateTransform();i&&this.textureBuffer.clear();var o=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,this.textureBuffer.context,e),this.renderer.resolution=o}},r.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},r.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},r.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===r.WEBGL){var t=this.renderer.gl,e=this.textureBuffer.width,i=this.textureBuffer.height,n=new Uint8Array(4*e*i);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,n),t.bindFramebuffer(t.FRAMEBUFFER,null);var o=new PIXI.CanvasBuffer(e,i),s=o.context.getImageData(0,0,e,i);return s.data.set(n),o.context.putImageData(s,0,0),o.canvas}return this.textureBuffer.canvas},r.Text=function(t,e,i,n,o){e=e||0,i=i||0,n=void 0===n||null===n?"":n.toString(),this.type=r.TEXT,this.physicsType=r.SPRITE,this.padding=new r.Point,this.textBounds=null,this.canvas=r.CanvasPool.create(this),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this.splitRegExp=/(?:\r\n|\r|\n)/,this.characterLimitSize=-1,this.characterLimitSuffix="",this._res=t.renderer.resolution,this._text=n,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this._width=0,this._height=0,r.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(o),""!==n&&this.updateText()},r.Text.prototype=Object.create(r.Sprite.prototype),r.Text.prototype.constructor=r.Text,r.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},r.Text.prototype.update=function(){},r.Text.prototype.destroy=function(t){this.texture.destroy(!0),r.Component.Destroy.prototype.destroy.call(this,t)},r.Text.prototype.setShadow=function(t,e,i,n,r,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="rgba(0, 0, 0, 1)"),void 0===n&&(n=0),void 0===r&&(r=!0),void 0===o&&(o=!0),this.style.shadowOffsetX=t,this.style.shadowOffsetY=e,this.style.shadowColor=i,this.style.shadowBlur=n,this.style.shadowStroke=r,this.style.shadowFill=o,this.dirty=!0,this},r.Text.prototype.setStyle=function(t,e){void 0===e&&(e=!1);var i=Object.assign({},t);i.font=t.font||"bold 20pt Arial",i.backgroundColor=t.backgroundColor||null,i.fill=t.fill||"black",i.align=(t.align||"left").toLowerCase(),i.boundsAlignH=(t.boundsAlignH||"left").toLowerCase(),i.boundsAlignV=(t.boundsAlignV||"top").toLowerCase(),i.stroke=t.stroke||"black",i.strokeThickness=Number(t.strokeThickness)||0,i.wordWrap=t.wordWrap||!1,i.wordWrapWidth=t.wordWrapWidth||100,i.maxLines=t.maxLines||0,i.shadowOffsetX=t.shadowOffsetX||0,i.shadowOffsetY=t.shadowOffsetY||0,i.shadowColor=t.shadowColor||"rgba(0,0,0,0)",i.shadowBlur=t.shadowBlur||0,i.tabs=t.tabs||0;var n=this.fontToComponents(i.font);return i.fontStyle&&(n.fontStyle=i.fontStyle),i.fontVariant&&(n.fontVariant=i.fontVariant),i.fontWeight&&(n.fontWeight=i.fontWeight),i.fontSize&&("number"==typeof i.fontSize&&(i.fontSize=i.fontSize+"px"),n.fontSize=i.fontSize),this._fontComponents=n,i.font=this.componentsToFont(this._fontComponents),this.style=i,this.dirty=!0,e&&this.updateText(),this},r.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t=this.text;this.characterLimitSize>-1&&this.characterLimitSize<t.length&&(t=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix),this.style.wordWrap&&(t=this.runWordWrap(this.text));var e=t.split(this.splitRegExp),i=this.style.tabs,n=[],r=0,o=this.determineFontProperties(this.style.font),s=e.length;this.style.maxLines>0&&this.style.maxLines<e.length&&(s=this.style.maxLines),this._charCount=0;for(var a=0;a<s;a++){if(0===i){var h=this.style.strokeThickness+this.padding.x;this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(e[a]):h+=this.context.measureText(e[a]).width,this.style.wordWrap&&(h-=this.context.measureText(" ").width)}else{var u=e[a].split(/(?:\t)/);h=this.padding.x+this.style.strokeThickness;if(Array.isArray(i))for(var c=0,l=0;l<u.length;l++){var d=0;d=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(u[l]):Math.ceil(this.context.measureText(u[l]).width),l>0&&(c+=i[l-1]),h=c+d}else for(l=0;l<u.length;l++){this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(u[l]):h+=Math.ceil(this.context.measureText(u[l]).width);h+=this.game.math.snapToCeil(h,i)-h}}n[a]=Math.ceil(h),r=Math.max(r,n[a])}this.canvas.width=r*this._res;var p=o.fontSize+this.style.strokeThickness+this.padding.y,f=p*s,m=this._lineSpacing;m<0&&Math.abs(m)>p&&(m=-p),0!==m&&(f+=m>0?m*e.length:m*(e.length-1)),this.canvas.height=f*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round";var g,y;for(this._charCount=0,a=0;a<s;a++)g=this.style.strokeThickness/2,y=this.style.strokeThickness/2+a*p+o.ascent,a>0&&(y+=m*a),"right"===this.style.align?g+=r-n[a]:"center"===this.style.align&&(g+=(r-n[a])/2),this.autoRound&&(g=Math.round(g),y=Math.round(y)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(e[a],g,y):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===i?this.context.strokeText(e[a],g,y):this.renderTabLine(e[a],g,y,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===i?this.context.fillText(e[a],g,y):this.renderTabLine(e[a],g,y,!0)));this.updateTexture(),this.dirty=!1},r.Text.prototype.renderTabLine=function(t,e,i,n){var r=t.split(/(?:\t)/),o=this.style.tabs,s=0;if(Array.isArray(o))for(var a=0,h=0;h<r.length;h++)h>0&&(a+=o[h-1]),s=e+a,n?this.context.fillText(r[h],s,i):this.context.strokeText(r[h],s,i);else for(h=0;h<r.length;h++){var u=Math.ceil(this.context.measureText(r[h]).width);s=this.game.math.snapToCeil(e,o),n?this.context.fillText(r[h],s,i):this.context.strokeText(r[h],s,i),e=s+u}},r.Text.prototype.updateShadow=function(t){t?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},r.Text.prototype.measureLine=function(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];if(this.fontWeights.length>0||this.fontStyles.length>0){var r=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(r.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(r.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(r)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill)),e+=this.context.measureText(n).width,this._charCount++}return Math.ceil(e)},r.Text.prototype.updateLine=function(t,e,i){for(var n=0;n<t.length;n++){var r=t[n];if(this.fontWeights.length>0||this.fontStyles.length>0){var o=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(o.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(o.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(o)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(r,e,i)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(r,e,i)),e+=this.context.measureText(r).width,this._charCount++}},r.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},r.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},r.Text.prototype.addColor=function(t,e){return this.colors[e]=t,this.dirty=!0,this},r.Text.prototype.addStrokeColor=function(t,e){return this.strokeColors[e]=t,this.dirty=!0,this},r.Text.prototype.addFontStyle=function(t,e){return this.fontStyles[e]=t,this.dirty=!0,this},r.Text.prototype.addFontWeight=function(t,e){return this.fontWeights[e]=t,this.dirty=!0,this},r.Text.prototype.precalculateWordWrap=function(t){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;return this.runWordWrap(t).split(/(?:\r\n|\r|\n)/)},r.Text.prototype.runWordWrap=function(t){return this.useAdvancedWrap?this.advancedWordWrap(t):this.basicWordWrap(t)},r.Text.prototype.advancedWordWrap=function(t){for(var e=this.context,i=this.style.wordWrapWidth,n="",r=t.replace(/ +/gi," ").split(/\r?\n/gi),o=r.length,s=0;s<o;s++){var a=r[s],h="";a=a.replace(/^ *|\s*$/gi,"");if(e.measureText(a).width<i)n+=a+"\n";else{for(var u=i,c=a.split(" "),l=0;l<c.length;l++){var d=c[l],p=d+" ",f=e.measureText(p).width;if(f>u){if(0===l){for(var m=p;m.length&&(m=m.slice(0,-1),!((f=e.measureText(m).width)<=u)););if(!m.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var g=d.substr(m.length);c[l]=g,h+=m}var y=c[l].length?l:l+1,v=c.slice(y).join(" ").replace(/[ \n]*$/gi,"");r[s+1]=v+" "+(r[s+1]||""),o=r.length;break}h+=p,u-=f}n+=h.replace(/[ \n]*$/gi,"")+"\n"}}return n=n.replace(/[\s|\n]*$/gi,"")},r.Text.prototype.basicWordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var r=this.style.wordWrapWidth,o=i[n].split(" "),s=0;s<o.length;s++){var a=this.context.measureText(o[s]).width,h=a+this.context.measureText(" ").width;h>r?(s>0&&(e+="\n"),e+=o[s]+" ",r=this.style.wordWrapWidth-a):(r-=h,e+=o[s]+" ")}n<i.length-1&&(e+="\n")}return e},r.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);this.style.font!==e&&(this.style.font=e,this.dirty=!0,this.parent&&this.updateTransform())},r.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();return/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)||/['",]/.exec(i)||(i="'"+i+"'"),{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}return console.warn("Phaser.Text - unparsable CSS font: "+t),{font:t}},r.Text.prototype.componentsToFont=function(t){var e,i=[];return(e=t.fontStyle)&&"normal"!==e&&i.push(e),(e=t.fontVariant)&&"normal"!==e&&i.push(e),(e=t.fontWeight)&&"normal"!==e&&i.push(e),(e=t.fontSize)&&"medium"!==e&&i.push(e),(e=t.fontFamily)&&i.push(e),i.length||i.push(t.font),i.join(" ")},r.Text.prototype.setText=function(t,e){return void 0===e&&(e=!1),this.text=t.toString()||"",e?this.updateText():this.dirty=!0,this},r.Text.prototype.parseList=function(t){if(!Array.isArray(t))return this;for(var e="",i=0;i<t.length;i++)Array.isArray(t[i])?(e+=t[i].join("\t"),i<t.length-1&&(e+="\n")):(e+=t[i],i<t.length-1&&(e+="\t"));return this.text=e,this.dirty=!0,this},r.Text.prototype.setTextBounds=function(t,e,i,n){return void 0===t?this.textBounds=null:(this.textBounds?this.textBounds.setTo(t,e,i,n):this.textBounds=new r.Rectangle(t,e,i,n),this.style.wordWrapWidth>i&&(this.style.wordWrapWidth=i)),this.updateTexture(),this},r.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture,e=this.texture.crop,i=this.texture.frame,n=this.canvas.width,r=this.canvas.height;if(t.width=n,t.height=r,e.width=n,e.height=r,i.width=n,i.height=r,this.texture.width=n,this.texture.height=r,this._width=n,this._height=r,this.textBounds){var o=this.textBounds.x,s=this.textBounds.y;"right"===this.style.boundsAlignH?o+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(o+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?s+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(s+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-o,this.pivot.y=-s}this.renderable=0!==n&&0!==r,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},r.Text.prototype._renderWebGL=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,t)},r.Text.prototype._renderCanvas=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,t)},r.Text.prototype.determineFontProperties=function(t){var e=r.Text.fontPropertiesCache[t];if(!e){e={};var i=r.Text.fontPropertiesCanvas,n=r.Text.fontPropertiesContext;n.font=t;var o=Math.ceil(n.measureText("|M\xc9q").width),s=Math.ceil(n.measureText("|M\xc9q").width),a=2*s;if(s=1.4*s|0,i.width=o,i.height=a,n.fillStyle="#f00",n.fillRect(0,0,o,a),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText("|M\xc9q",0,s),!n.getImageData(0,0,o,a))return e.ascent=s,e.descent=s+6,e.fontSize=e.ascent+e.descent,r.Text.fontPropertiesCache[t]=e,e;var h,u,c=n.getImageData(0,0,o,a).data,l=c.length,d=4*o,p=0,f=!1;for(h=0;h<s;h++){for(u=0;u<d;u+=4)if(255!==c[p+u]){f=!0;break}if(f)break;p+=d}for(e.ascent=s-h,p=l-d,f=!1,h=a;h>s;h--){for(u=0;u<d;u+=4)if(255!==c[p+u]){f=!0;break}if(f)break;p-=d}e.descent=h-s,e.descent+=6,e.fontSize=e.ascent+e.descent,r.Text.fontPropertiesCache[t]=e}return e},r.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,t)},r.Text.prototype.setCharacterLimit=function(t,e){this.characterLimitSuffix=void 0===e?"":e,this.characterLimitSize=t,this.updateText()},Object.defineProperty(r.Text.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(r.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial",this._fontComponents=this.fontToComponents(t),this.updateFont(this._fontComponents)}}),Object.defineProperty(r.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=(t=t||"Arial").trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),this._fontComponents.fontFamily=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(r.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;return t&&/(?:^0$|px$)/.exec(t)?parseInt(t,10):t},set:function(t){"number"==typeof(t=t||"0")&&(t+="px"),this._fontComponents.fontSize=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(r.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontWeight=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(r.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontStyle=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(r.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontVariant=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(r.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){t!==this.style.fill&&(this.style.fill=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){(t=t.toLowerCase())!==this.style.align&&(this.style.align=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){t!==this._res&&(this._res=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){t!==this.style.tabs&&(this.style.tabs=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){(t=t.toLowerCase())!==this.style.boundsAlignH&&(this.style.boundsAlignH=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){(t=t.toLowerCase())!==this.style.boundsAlignV&&(this.style.boundsAlignV=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){t!==this.style.stroke&&(this.style.stroke=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){t!==this.style.strokeThickness&&(this.style.strokeThickness=Number(t),this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){t!==this.style.wordWrap&&(this.style.wordWrap=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){t!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){t!==this._lineSpacing&&(this._lineSpacing=parseFloat(t),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(r.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){t!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){t!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){t!==this.style.shadowColor&&(this.style.shadowColor=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){t!==this.style.shadowBlur&&(this.style.shadowBlur=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){t!==this.style.shadowStroke&&(this.style.shadowStroke=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){t!==this.style.shadowFill&&(this.style.shadowFill=t,this.dirty=!0)}}),Object.defineProperty(r.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*(this.texture.frame.width/this.resolution)},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(r.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*(this.texture.frame.height/this.resolution)},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),r.Text.fontPropertiesCache={},r.Text.fontPropertiesCanvas=document.createElement("canvas"),r.Text.fontPropertiesContext=r.Text.fontPropertiesCanvas.getContext("2d"),r.BitmapText=function(t,e,i,n,o,s,a){e=e||0,i=i||0,n=n||"",o=o||"",s=s||32,a=a||"left",PIXI.DisplayObjectContainer.call(this),this.type=r.BITMAPTEXT,this.physicsType=r.SPRITE,this.textWidth=0,this.textHeight=0,this.anchor=new r.Point,this._prevAnchor=new r.Point,this._glyphs=[],this._maxWidth=0,this._text=o.toString()||"",this._data=t.cache.getBitmapFont(n),this._font=n,this._fontSize=s,this._align=a,this._tint=16777215,this.updateText(),this.dirty=!1,r.Component.Core.init.call(this,t,e,i,"",null)},r.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),r.BitmapText.prototype.constructor=r.BitmapText,r.Component.Core.install.call(r.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),r.BitmapText.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate,r.BitmapText.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate,r.BitmapText.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate,r.BitmapText.prototype.preUpdateCore=r.Component.Core.preUpdate,r.BitmapText.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},r.BitmapText.prototype.postUpdate=function(){r.Component.PhysicsBody.postUpdate.call(this),r.Component.FixedToCamera.postUpdate.call(this),this.body&&this.body.type===r.Physics.ARCADE&&(this.textWidth===this.body.sourceWidth&&this.textHeight===this.body.sourceHeight||this.body.setSize(this.textWidth,this.textHeight))},r.BitmapText.prototype.setText=function(t){this.text=t},r.BitmapText.prototype.scanLine=function(t,e,i){for(var n=0,r=0,o=-1,s=0,a=null,h=this._maxWidth>0?this._maxWidth:null,u=[],c=0;c<i.length;c++){var l=c===i.length-1;if(/(?:\r\n|\r|\n)/.test(i.charAt(c)))return{width:r,text:i.substr(0,c),end:l,chars:u};var d=i.charCodeAt(c),p=t.chars[d],f=0;void 0===p&&(d=32,p=t.chars[d]);var m=a&&p.kerning[a]?p.kerning[a]:0;if(/(\s)/.test(i.charAt(c))&&(o=c,s=r),f=(m+p.texture.width+p.xOffset)*e,h&&r+f>=h&&o>-1)return{width:s||r,text:i.substr(0,c-(c-o)),end:!1,chars:u};r+=(p.xAdvance+m)*e,u.push(n+(p.xOffset+m)*e),n+=(p.xAdvance+m)*e,a=d}return{width:r,text:i,end:l,chars:u}},r.BitmapText.prototype.cleanText=function(t,e){void 0===e&&(e="");var i=this._data.font;if(!i)return"";for(var n=t.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),r=0;r<n.length;r++){for(var o="",s=n[r],a=0;a<s.length;a++)o=i.chars[s.charCodeAt(a)]?o.concat(s[a]):o.concat(e);n[r]=o}return n.join("\n")},r.BitmapText.prototype.updateText=function(){var t=this._data.font;if(t){var e=this.text,i=this._fontSize/t.size,n=[],r=0;this.textWidth=0;do{(c=this.scanLine(t,i,e)).y=r,n.push(c),c.width>this.textWidth&&(this.textWidth=c.width),r+=t.lineHeight*i,e=e.substr(c.text.length+1)}while(!1===c.end);this.textHeight=r;for(var o=0,s=0,a=this.textWidth*this.anchor.x,h=this.textHeight*this.anchor.y,u=0;u<n.length;u++){var c=n[u];"right"===this._align?s=this.textWidth-c.width:"center"===this._align&&(s=(this.textWidth-c.width)/2);for(var l=0;l<c.text.length;l++){var d=c.text.charCodeAt(l),p=t.chars[d];void 0===p&&(d=32,p=t.chars[d]);var f=this._glyphs[o];f?f.texture=p.texture:((f=new PIXI.Sprite(p.texture)).name=c.text[l],this._glyphs.push(f)),f.position.x=c.chars[l]+s-a,f.position.y=c.y+p.yOffset*i-h,f.scale.set(i),f.tint=this.tint,f.texture.requiresReTint=!0,f.cachedTint=16777215,f.parent||this.addChild(f),o++}}for(u=o;u<this._glyphs.length;u++)this.removeChild(this._glyphs[u])}},r.BitmapText.prototype.purgeGlyphs=function(){for(var t=this._glyphs.length,e=[],i=0;i<this._glyphs.length;i++)this._glyphs[i].parent!==this?this._glyphs[i].destroy():e.push(this._glyphs[i]);return this._glyphs=[],this._glyphs=e,this.updateText(),t-e.length},r.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor)),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(r.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){t===this._align||"left"!==t&&"center"!==t&&"right"!==t||(this._align=t,this.updateText())}}),Object.defineProperty(r.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this.updateText())}}),Object.defineProperty(r.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){t!==this._font&&(this._font=t.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(r.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){(t=parseInt(t,10))!==this._fontSize&&t>0&&(this._fontSize=t,this.updateText())}}),Object.defineProperty(r.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.updateText())}}),Object.defineProperty(r.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){t!==this._maxWidth&&(this._maxWidth=t,this.updateText())}}),Object.defineProperty(r.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(t){this._data.base.scaleMode=t?0:1}}),r.RetroFont=function(t,e,i,n,o,s,a,h,u,c){if(!t.cache.checkImageKey(e))return!1;void 0!==s&&null!==s||(s=t.cache.getImage(e).width/i),this.characterWidth=i,this.characterHeight=n,this.characterSpacingX=a||0,this.characterSpacingY=h||0,this.characterPerRow=s,this.offsetX=u||0,this.offsetY=c||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=t.cache.getImage(e),this._text="",this.grabData=[],this.frameData=new r.FrameData;for(var l=this.offsetX,d=this.offsetY,p=0,f=0;f<o.length;f++){var m=this.frameData.addFrame(new r.Frame(f,l,d,this.characterWidth,this.characterHeight));this.grabData[o.charCodeAt(f)]=m.index,++p===this.characterPerRow?(p=0,l=this.offsetX,d+=this.characterHeight+this.characterSpacingY):l+=this.characterWidth+this.characterSpacingX}t.cache.updateFrameData(e,this.frameData),this.stamp=new r.Image(t,0,0,e,0),r.RenderTexture.call(this,t,100,100,"",r.scaleModes.NEAREST),this.type=r.RETROFONT},r.RetroFont.prototype=Object.create(r.RenderTexture.prototype),r.RetroFont.prototype.constructor=r.RetroFont,r.RetroFont.ALIGN_LEFT="left",r.RetroFont.ALIGN_RIGHT="right",r.RetroFont.ALIGN_CENTER="center",r.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",r.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",r.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",r.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",r.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",r.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",r.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",r.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",r.RetroFont.prototype.setFixedWidth=function(t,e){void 0===e&&(e="left"),this.fixedWidth=t,this.align=e},r.RetroFont.prototype.setText=function(t,e,i,n,r,o){this.multiLine=e||!1,this.customSpacingX=i||0,this.customSpacingY=n||0,this.align=r||"left",this.autoUpperCase=!o,t.length>0&&(this.text=t)},r.RetroFont.prototype.buildRetroFontText=function(){var t=0,e=0;if(this.clear(),this.multiLine){var i=this._text.split("\n");this.fixedWidth>0?this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var n=0;n<i.length;n++)t=0,this.align===r.RetroFont.ALIGN_RIGHT?t=this.width-i[n].length*(this.characterWidth+this.customSpacingX):this.align===r.RetroFont.ALIGN_CENTER&&(t=this.width/2-i[n].length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(i[n],t,e,this.customSpacingX),e+=this.characterHeight+this.customSpacingY}else this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),t=0,this.align===r.RetroFont.ALIGN_RIGHT?t=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===r.RetroFont.ALIGN_CENTER&&(t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(this._text,t,0,this.customSpacingX);this.requiresReTint=!0},r.RetroFont.prototype.pasteLine=function(t,e,i,n){for(var r=0;r<t.length;r++)if(" "===t.charAt(r))e+=this.characterWidth+n;else if(this.grabData[t.charCodeAt(r)]>=0&&(this.stamp.frame=this.grabData[t.charCodeAt(r)],this.renderXY(this.stamp,e,i,!1),(e+=this.characterWidth+n)>this.width))break},r.RetroFont.prototype.getLongestLine=function(){var t=0;if(this._text.length>0)for(var e=this._text.split("\n"),i=0;i<e.length;i++)e[i].length>t&&(t=e[i].length);return t},r.RetroFont.prototype.removeUnsupportedCharacters=function(t){for(var e="",i=0;i<this._text.length;i++){var n=this._text[i],r=n.charCodeAt(0);(this.grabData[r]>=0||!t&&"\n"===n)&&(e=e.concat(n))}return e},r.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX!==t||this.offsetY!==e){for(var i=t-this.offsetX,n=e-this.offsetY,r=this.game.cache.getFrameData(this.stamp.key).getFrames(),o=r.length;o--;)r[o].x+=i,r[o].y+=n;this.buildRetroFontText()}},Object.defineProperty(r.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){var e;(e=this.autoUpperCase?t.toUpperCase():t)!==this._text&&(this._text=e,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(r.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t,this.buildRetroFontText()}}),r.Rope=function(t,e,i,n,o,s){this.points=[],this.points=s,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,e=e||0,i=i||0,n=n||null,o=o||null,this.type=r.ROPE,this.points=s,PIXI.DisplayObjectContainer.call(this),this.texture=r.Cache.DEFAULT,this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new Float32Array([0,0,100,0,100,100,0,100]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3]),s&&(this.vertices=new Float32Array(4*s.length),this.uvs=new Float32Array(4*s.length),this.colors=new Float32Array(2*s.length),this.indices=new Uint16Array(2*s.length)),this.dirty=!0,this.canvasPadding=0,this.drawMode=r.Rope.TRIANGLE_STRIP,r.Component.Core.init.call(this,t,e,i,n,o),this.refresh()},r.Rope.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),r.Rope.prototype.constructor=r.Rope,r.Component.Core.install.call(r.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),r.Rope.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate,r.Rope.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate,r.Rope.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate,r.Rope.prototype.preUpdateCore=r.Component.Core.preUpdate,r.Rope.TRIANGLE_STRIP=0,r.Rope.TRIANGLES=1,r.Rope.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},r.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},r.Rope.prototype.reset=function(t,e){return r.Component.Reset.prototype.reset.call(this,t,e),this},r.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=this.indices,n=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,i[0]=0,i[1]=1;for(var r,o,s=t.length,a=1;a<s;a++)o=a/(s-1),e[r=4*a]=o,e[r+1]=0,e[r+2]=o,e[r+3]=1,n[r=2*a]=1,n[r+1]=1,i[r=2*a]=r,i[r+1]=r+1}},r.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e,i=t[0],n={x:0,y:0};this.count-=.2;for(var r,o,s,a,h=this.vertices,u=t.length,c=0;c<u;c++)r=t[c],o=4*c,e=c<t.length-1?t[c+1]:r,n.y=-(e.x-i.x),n.x=e.y-i.y,10*(1-c/(u-1))>1&&1,s=Math.sqrt(n.x*n.x+n.y*n.y),a=this.texture.height/2,n.x/=s,n.y/=s,n.x*=a,n.y*=a,h[o]=r.x+n.x,h[o+1]=r.y+n.y,h[o+2]=r.x-n.x,h[o+3]=r.y-n.y,i=r;PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}},r.Rope.prototype.setTexture=function(t){this.texture=t},r.Rope.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},r.Rope.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},r.Rope.prototype._renderStrip=function(t){var e=t.gl,i=t.projection,n=t.offset,o=t.shaderManager.stripShader,s=this.drawMode===r.Rope.TRIANGLE_STRIP?e.TRIANGLE_STRIP:e.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),e.uniformMatrix3fv(o.translationMatrix,!1,this.worldTransform.toArray(!0)),e.uniform2f(o.projectionVector,i.x,-i.y),e.uniform2f(o.offsetVector,-n.x,-n.y),e.uniform1f(o.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW),e.vertexAttribPointer(o.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.vertexAttribPointer(o.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)):(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices),e.vertexAttribPointer(o.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.vertexAttribPointer(o.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),e.drawElements(s,this.indices.length,e.UNSIGNED_SHORT,0)},r.Rope.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform,n=i.tx*t.resolution+t.shakeX,o=i.ty*t.resolution+t.shakeY;t.roundPixels?e.setTransform(i.a,i.b,i.c,i.d,0|n,0|o):e.setTransform(i.a,i.b,i.c,i.d,n,o),this.drawMode===r.Rope.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(e):this._renderCanvasTriangles(e)},r.Rope.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,n=e.length/2;this.count++;for(var r=0;r<n-2;r++){var o=2*r;this._renderCanvasDrawTriangle(t,e,i,o,o+2,o+4)}},r.Rope.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,n=this.indices,r=n.length;this.count++;for(var o=0;o<r;o+=3){var s=2*n[o],a=2*n[o+1],h=2*n[o+2];this._renderCanvasDrawTriangle(t,e,i,s,a,h)}},r.Rope.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,o){var s=this.texture.baseTexture.source,a=this.texture.width,h=this.texture.height,u=e[n],c=e[r],l=e[o],d=e[n+1],p=e[r+1],f=e[o+1],m=i[n]*a,g=i[r]*a,y=i[o]*a,v=i[n+1]*h,b=i[r+1]*h,x=i[o+1]*h;if(this.canvasPadding>0){var _=this.canvasPadding/this.worldTransform.a,w=this.canvasPadding/this.worldTransform.d,T=(u+c+l)/3,S=(d+p+f)/3,E=u-T,C=d-S,P=Math.sqrt(E*E+C*C);u=T+E/P*(P+_),d=S+C/P*(P+w),C=p-S,c=T+(E=c-T)/(P=Math.sqrt(E*E+C*C))*(P+_),p=S+C/P*(P+w),C=f-S,l=T+(E=l-T)/(P=Math.sqrt(E*E+C*C))*(P+_),f=S+C/P*(P+w)}t.save(),t.beginPath(),t.moveTo(u,d),t.lineTo(c,p),t.lineTo(l,f),t.closePath(),t.clip();var M=m*b+v*y+g*x-b*y-v*g-m*x,A=u*b+v*l+c*x-b*l-v*c-u*x,R=m*c+u*y+g*l-c*y-u*g-m*l,L=m*b*l+v*c*y+u*g*x-u*b*y-v*g*l-m*c*x,O=d*b+v*f+p*x-b*f-v*p-d*x,I=m*p+d*y+g*f-p*y-d*g-m*f,B=m*b*f+v*p*y+d*g*x-d*b*y-v*g*f-m*p*x;t.transform(A/M,O/M,R/M,I/M,L/M,B/M),t.drawImage(s,0,0),t.restore()},r.Rope.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,n=i.length/2;this.count++,e.beginPath();for(var r=1;r<n-2;r++){var o=2*r,s=i[o],a=i[o+2],h=i[o+4],u=i[o+1],c=i[o+3],l=i[o+5];e.moveTo(s,u),e.lineTo(a,c),e.lineTo(h,l)}e.fillStyle="#FF0000",e.fill(),e.closePath()},r.Rope.prototype.getBounds=function(t){for(var e=t||this.worldTransform,i=e.a,n=e.b,r=e.c,o=e.d,s=e.tx,a=e.ty,h=-1/0,u=-1/0,c=1/0,l=1/0,d=this.vertices,p=0;p<d.length;p+=2){var f=d[p],m=d[p+1],g=i*f+r*m+s,y=o*m+n*f+a;c=g<c?g:c,l=y<l?y:l,h=g>h?g:h,u=y>u?y:u}if(c===-1/0||u===1/0)return PIXI.EmptyRectangle;var v=this._bounds;return v.x=c,v.width=h-c,v.y=l,v.height=u-l,this._currentBounds=v,v},Object.defineProperty(r.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){t&&"function"==typeof t?(this._hasUpdateAnimation=!0,this._updateAnimation=t):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(r.Rope.prototype,"segments",{get:function(){for(var t,e,i,n,o,s,a,h,u=[],c=0;c<this.points.length;c++)t=4*c,e=this.vertices[t]*this.scale.x,i=this.vertices[t+1]*this.scale.y,n=this.vertices[t+4]*this.scale.x,o=this.vertices[t+3]*this.scale.y,s=r.Math.difference(e,n),a=r.Math.difference(i,o),e+=this.world.x,i+=this.world.y,h=new r.Rectangle(e,i,s,a),u.push(h);return u}}),r.TileSprite=function(t,e,i,n,o,s,a){e=e||0,i=i||0,n=n||256,o=o||256,s=s||null,a=a||null,PIXI.Sprite.call(this,new PIXI.Texture(r.Cache.DEFAULT.baseTexture),n,o),this.type=r.TILESPRITE,this.physicsType=r.SPRITE,this._scroll=new r.Point,this.tileScale=new r.Point(1,1),this.tileScaleOffset=new r.Point(1,1),this.tilePosition=new r.Point,this.textureDebug=!1,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0,this._width=n,this._height=o,r.Component.Core.init.call(this,t,e,i,s,a)},r.TileSprite.prototype=Object.create(PIXI.Sprite.prototype),r.TileSprite.prototype.constructor=r.TileSprite,r.Component.Core.install.call(r.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),r.TileSprite.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate,r.TileSprite.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate,r.TileSprite.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate,r.TileSprite.prototype.preUpdateCore=r.Component.Core.preUpdate,r.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},r.TileSprite.prototype.autoScroll=function(t,e){return this._scroll.set(t,e),this},r.TileSprite.prototype.stopScroll=function(){return this._scroll.set(0,0),this},r.TileSprite.prototype.destroy=function(t){r.Component.Destroy.prototype.destroy.call(this,t),PIXI.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},r.TileSprite.prototype.reset=function(t,e){return r.Component.Reset.prototype.reset.call(this,t,e),this.tilePosition.x=0,this.tilePosition.y=0,this},r.TileSprite.prototype.setTexture=function(t){return this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215),this},r.TileSprite.prototype._renderWebGL=function(t){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this.refreshTexture){if(this.generateTilingTexture(!0,t),!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(this.tilingTexture.baseTexture.textureIndex=this.texture.baseTexture.textureIndex,t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}t.spriteBatch.renderTilingSprite(this);for(var e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);var i=!1;this._filters&&(i=!0,t.spriteBatch.stop(),t.filterManager.popFilter()),this._mask&&(i||t.spriteBatch.stop(),t.maskManager.popMask(this._mask,t)),i&&t.spriteBatch.start()}},r.TileSprite.prototype._renderCanvas=function(t){if(this.visible&&this.renderable&&0!==this.alpha){var e=t.context;this._mask&&t.maskManager.pushMask(this._mask,t),e.globalAlpha=this.worldAlpha;var i=this.worldTransform,n=t.resolution,r=i.tx*n+t.shakeX,o=i.ty*n+t.shakeY;if(e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,r,o),16777215===this.tint||!this.texture.requiresReTint&&this.cachedTint===this.tint||(this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1,this.refreshTexture=!0),this.refreshTexture){if(this.generateTilingTexture(!1,t),!this.tilingTexture)return;this.tilePattern=e.createPattern(this.tilingTexture.baseTexture.source,"repeat")}var s=t.currentBlendMode;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]);var a=this.tilePosition,h=this.tileScale;a.x%=this.tilingTexture.baseTexture.width,a.y%=this.tilingTexture.baseTexture.height,e.scale(h.x,h.y),e.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height),e.fillStyle=this.tilePattern,r=-a.x,o=-a.y;var u=this._width/h.x,c=this._height/h.y;t.roundPixels&&(r|=0,o|=0,u|=0,c|=0),e.fillRect(r,o,u,c),e.scale(1/h.x,1/h.y),e.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t);for(var l=0;l<this.children.length;l++)this.children[l]._renderCanvas(t);s!==this.blendMode&&(t.currentBlendMode=s,e.globalCompositeOperation=PIXI.blendModesCanvas[s])}},r.TileSprite.prototype.onTextureUpdate=function(){},r.TileSprite.prototype.generateTilingTexture=function(t){if(this.texture.baseTexture.hasLoaded){var e=this.texture,i=e.frame,n=this._frame.sourceSizeW||this._frame.width,o=this._frame.sourceSizeH||this._frame.height,s=0,a=0;this._frame.trimmed&&(s=this._frame.spriteSourceSizeX,a=this._frame.spriteSourceSizeY),t&&(n=r.Math.getNextPowerOfTwo(n),o=r.Math.getNextPowerOfTwo(o)),this.canvasBuffer?(this.canvasBuffer.resize(n,o),this.tilingTexture.baseTexture.width=n,this.tilingTexture.baseTexture.height=o,this.tilingTexture.needsUpdate=!0):(this.canvasBuffer=new PIXI.CanvasBuffer(n,o),this.tilingTexture=PIXI.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0,this.tilingTexture.needsUpdate=!0),this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,n,o));var h=e.crop.width,u=e.crop.height;h===n&&u===o||(h=n,u=o);var c=this.tintedTexture?this.tintedTexture:e.baseTexture.source;this.canvasBuffer.context.drawImage(c,e.crop.x,e.crop.y,e.crop.width,e.crop.height,s,a,h,u),this.tileScaleOffset.x=i.width/n,this.tileScaleOffset.y=i.height/o,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},r.TileSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),n=t*-this.anchor.x,r=e*(1-this.anchor.y),o=e*-this.anchor.y,s=this.worldTransform,a=s.a,h=s.b,u=s.c,c=s.d,l=s.tx,d=s.ty,p=a*n+u*o+l,f=c*o+h*n+d,m=a*i+u*o+l,g=c*o+h*i+d,y=a*i+u*r+l,v=c*r+h*i+d,b=a*n+u*r+l,x=c*r+h*n+d,_=-1/0,w=-1/0,T=1/0,S=1/0;T=b<(T=y<(T=m<(T=p<T?p:T)?m:T)?y:T)?b:T,S=x<(S=v<(S=g<(S=f<S?f:S)?g:S)?v:S)?x:S,_=b>(_=y>(_=m>(_=p>_?p:_)?m:_)?y:_)?b:_,w=x>(w=v>(w=g>(w=f>w?f:w)?g:w)?v:w)?x:w;var E=this._bounds;return E.x=T,E.width=_-T,E.y=S,E.height=w-S,this._currentBounds=E,E},Object.defineProperty(r.TileSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(r.TileSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),r.CanvasPool={create:function(t,e,i){var n,o=r.CanvasPool.getFirst();if(-1===o){var s={parent:t,canvas:document.createElement("canvas")};r.CanvasPool.pool.push(s),n=s.canvas}else r.CanvasPool.pool[o].parent=t,n=r.CanvasPool.pool[o].canvas;return void 0!==e&&(n.width=e,n.height=i),n},getFirst:function(){for(var t=r.CanvasPool.pool,e=0;e<t.length;e++)if(!t[e].parent)return e;return-1},remove:function(t){for(var e=r.CanvasPool.pool,i=0;i<e.length;i++)e[i].parent===t&&(e[i].parent=null,e[i].canvas.width=1,e[i].canvas.height=1)},removeByCanvas:function(t){for(var e=r.CanvasPool.pool,i=0;i<e.length;i++)e[i].canvas===t&&(e[i].parent=null,e[i].canvas.width=1,e[i].canvas.height=1)},getTotal:function(){for(var t=r.CanvasPool.pool,e=0,i=0;i<t.length;i++)t[i].parent&&e++;return e},getFree:function(){for(var t=r.CanvasPool.pool,e=0,i=0;i<t.length;i++)t[i].parent||e++;return e},log:function(){console.log("CanvasPool: %s used, %s free, %s total",this.getTotal(),this.getFree(),this.pool.length)}},r.CanvasPool.pool=[],Object.defineProperty(r.CanvasPool,"length",{get:function(){return this.pool.length}}),r.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.iOSVersion=0,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.canHandleAlpha=!1,this.canUseMultiply=!1,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.edge=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.safariVersion=0,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.dolby=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},r.Device=new r.Device,r.Device.onInitialized=new r.Signal,r.Device.whenReady=function(t,e,i){var n=this._readyCheck;if(this.deviceReadyAt||!n)t.call(e,this);else if(n._monitor||i)n._queue=n._queue||[],n._queue.push([t,e]);else{n._monitor=n.bind(this),n._queue=n._queue||[],n._queue.push([t,e]);var r="undefined"!=typeof window.cordova,o=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(n._monitor,0):r&&!o?document.addEventListener("deviceready",n._monitor,!1):(document.addEventListener("DOMContentLoaded",n._monitor,!1),window.addEventListener("load",n._monitor,!1))}},r.Device._readyCheck=function(){var t=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",t._monitor),document.removeEventListener("DOMContentLoaded",t._monitor),window.removeEventListener("load",t._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var e;e=t._queue.shift();){var i=e[0],n=e[1];i.call(n,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(t._monitor,20)},r.Device._initialize=function(){var t=this;!function(){var e=navigator.userAgent;/Playstation Vita/.test(e)?t.vita=!0:/Kindle/.test(e)||/\bKF[A-Z][A-Z]+/.test(e)||/Silk.*Mobile Safari/.test(e)?t.kindle=!0:/Android/.test(e)?t.android=!0:/CrOS/.test(e)?t.chromeOS=!0:/iP[ao]d|iPhone/i.test(e)?(t.iOS=!0,navigator.appVersion.match(/OS (\d+)/),t.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(e)?t.linux=!0:/Mac OS/.test(e)?t.macOS=!0:/Windows/.test(e)&&(t.windows=!0),(/Windows Phone/i.test(e)||/IEMobile/i.test(e))&&(t.android=!1,t.iOS=!1,t.macOS=!1,t.windows=!0,t.windowsPhone=!0);var i=/Silk/.test(e);(t.windows||t.macOS||t.linux&&!i||t.chromeOS)&&(t.desktop=!0),(t.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e))&&(t.desktop=!1)}(),function(){var e=navigator.userAgent;if(/Arora/.test(e)?t.arora=!0:/Edge\/\d+/.test(e)?t.edge=!0:/Chrome\/(\d+)/.test(e)&&!t.windowsPhone?(t.chrome=!0,t.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(e)?t.epiphany=!0:/Firefox\D+(\d+)/.test(e)?(t.firefox=!0,t.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(e)&&t.iOS?t.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(e)?(t.ie=!0,t.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(e)?t.midori=!0:/Opera/.test(e)?t.opera=!0:/Safari\/(\d+)/.test(e)&&!t.windowsPhone?(t.safari=!0,/Version\/(\d+)\./.test(e)&&(t.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)&&(t.ie=!0,t.trident=!0,t.tridentVersion=parseInt(RegExp.$1,10),t.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(e)&&(t.silk=!0),navigator.standalone&&(t.webApp=!0),"undefined"!=typeof window.cordova&&(t.cordova=!0),"undefined"!=typeof i&&(t.node=!0),t.node&&"object"==typeof i.versions&&(t.nodeWebkit=!!i.versions["node-webkit"],t.electron=!!i.versions.electron),navigator.isCocoonJS&&(t.cocoonJS=!0),t.cocoonJS)try{t.cocoonJSApp="undefined"!=typeof CocoonJS}catch(e){t.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(t.ejecta=!0),/Crosswalk/.test(e)&&(t.crosswalk=!0)}(),function(){t.audioData=!!window.Audio,t.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var e=document.createElement("audio");try{if(e.canPlayType&&(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(t.ogg=!0),(e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||e.canPlayType("audio/opus;").replace(/^no$/,""))&&(t.opus=!0),e.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(t.mp3=!0),e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(t.wav=!0),(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,""))&&(t.m4a=!0),e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(t.webm=!0),""!==e.canPlayType('audio/mp4;codecs="ec-3"')))if(t.edge)t.dolby=!0;else if(t.safari&&t.safariVersion>=9&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var i=parseInt(RegExp.$1,10),n=parseInt(RegExp.$2,10);(10===i&&n>=11||i>10)&&(t.dolby=!0)}}catch(t){}}(),function(){var e=document.createElement("video");try{e.canPlayType&&(e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(t.oggVideo=!0),e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.h264Video=!0,t.mp4Video=!0),e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(t.webmVideo=!0),e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(t.vp9Video=!0),e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.hlsVideo=!0))}catch(t){}}(),function(){var e,i=document.createElement("p"),n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(i,null);for(var r in n)void 0!==i.style[r]&&(i.style[r]="translate3d(1px,1px,1px)",e=window.getComputedStyle(i).getPropertyValue(n[r]));document.body.removeChild(i),t.css3D=void 0!==e&&e.length>0&&"none"!==e}(),t.pixelRatio=window.devicePixelRatio||1,t.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone"),t.iPhone4=2===t.pixelRatio&&t.iPhone,t.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad"),"undefined"!=typeof Int8Array?t.typedArray=!0:t.typedArray=!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(t.littleEndian=function(){var t=new ArrayBuffer(4),e=new Uint8Array(t),i=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,3569595041===i[0]||2712847316!==i[0]&&null}(),t.LITTLE_ENDIAN=t.littleEndian),t.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==t.littleEndian&&function(){if(void 0===Uint8ClampedArray)return!1;var t=r.CanvasPool.create(this,1,1).getContext("2d");if(!t)return!1;var e=t.createImageData(1,1);return r.CanvasPool.remove(this),e.data instanceof Uint8ClampedArray}(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(t.vibration=!0),function(){t.canvas=!!window.CanvasRenderingContext2D||t.cocoonJS;try{t.localStorage=!!localStorage.getItem}catch(e){t.localStorage=!1}t.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),t.fileSystem=!!window.requestFileSystem,t.webGL=function(){try{var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}(),t.webGL=!!t.webGL,t.worker=!!window.Worker,t.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,t.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,t.getUserMedia=t.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,t.firefox&&t.firefoxVersion<21&&(t.getUserMedia=!1),!t.iOS&&(t.ie||t.firefox||t.chrome)&&(t.canvasBitBltShift=!0),(t.safari||t.mobileSafari)&&(t.canvasBitBltShift=!1)}(),function(){var e=r.CanvasPool.create(this,6,1),i=e.getContext("2d");i.fillStyle="rgba(10, 20, 30, 0.5)",i.fillRect(0,0,1,1);var n=i.getImageData(0,0,1,1);if(n){i.putImageData(n,1,0);var o=i.getImageData(1,0,1,1);t.canHandleAlpha=o.data[0]===n.data[0]&&o.data[1]===n.data[1]&&o.data[2]===n.data[2]&&o.data[3]===n.data[3]}i.globalCompositeOperation="multiply",t.canUseMultiply="multiply"===i.globalCompositeOperation,r.CanvasPool.removeByCanvas(e),PIXI.CanvasTinter.tintMethod=t.canUseMultiply?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel}(),function(){for(var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],i=document.createElement("div"),n=0;n<e.length;n++)if(i[e[n]]){t.fullscreen=!0,t.requestFullscreen=e[n];break}var r=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(t.fullscreen)for(n=0;n<r.length;n++)if(document[r[n]]){t.cancelFullscreen=r[n];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(t.fullscreenKeyboard=!0)}(),("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(t.touch=!0),(window.PointerEvent||window.MSPointerEvent||window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(t.mspointer=!0),t.cocoonJS||("onwheel"in window||t.ie&&"WheelEvent"in window?t.wheelEvent="wheel":"onmousewheel"in window?t.wheelEvent="mousewheel":t.firefox&&"MouseScrollEvent"in window&&(t.wheelEvent="DOMMouseScroll"))},r.Device.canPlayAudio=function(t){return!("mp3"!==t||!this.mp3)||(!("ogg"!==t||!this.ogg&&!this.opus)||(!("m4a"!==t||!this.m4a)||(!("opus"!==t||!this.opus)||(!("wav"!==t||!this.wav)||(!("webm"!==t||!this.webm)||!("mp4"!==t||!this.dolby))))))},r.Device.canPlayVideo=function(t){return!("webm"!==t||!this.webmVideo&&!this.vp9Video)||(!("mp4"!==t||!this.mp4Video&&!this.h264Video)||(!("ogg"!==t&&"ogv"!==t||!this.oggVideo)||!("mpeg"!==t||!this.hlsVideo)))},r.Device.needsTouchUnlock=function(){return!!(!this.cocoonJS&&(this.iOS||this.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)},r.Device.isConsoleOpen=function(){return console.warn("Phaser.Device.isConsoleOpen is deprecated and will be removed."),!1},r.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537},r.Canvas={create:function(t,e,i,n,o){e=e||256,i=i||256;var s=o?document.createElement("canvas"):r.CanvasPool.create(t,e,i);return"string"==typeof n&&""!==n&&(s.id=n),s.width=e,s.height=i,s.style.display="block",s},setBackgroundColor:function(t,e){return e=e||"rgb(0,0,0)",t.style.backgroundColor=e,t},setTouchAction:function(t,e){return e=e||"none",t.style.msTouchAction=e,t.style["ms-touch-action"]=e,t.style["touch-action"]=e,t},setUserSelect:function(t,e){return e=e||"none",t.style["-webkit-touch-callout"]=e,t.style["-webkit-user-select"]=e,t.style["-khtml-user-select"]=e,t.style["-moz-user-select"]=e,t.style["-ms-user-select"]=e,t.style["user-select"]=e,t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",t},addToDOM:function(t,e,i){var n;return void 0===i&&(i=!0),e&&("string"==typeof e?n=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(n=e)),n||(n=document.body),i&&n.style&&(n.style.overflow="hidden"),n.appendChild(t),t},removeFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)},setTransform:function(t,e,i,n,r,o,s){return t.setTransform(n,o,s,r,e,i),t},setSmoothingEnabled:function(t,e){var i=r.Canvas.getSmoothingPrefix(t);return i&&(t[i]=e),t},getSmoothingPrefix:function(t){var e=["i","webkitI","msI","mozI","oI"];for(var i in e){var n=e[i]+"mageSmoothingEnabled";if(n in t)return n}return null},getSmoothingEnabled:function(t){var e=r.Canvas.getSmoothingPrefix(t);if(e)return t[e]},setImageRenderingCrisp:function(t){for(var e=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"],i=0;i<e.length;i++)t.style["image-rendering"]=e[i];return t.style.msInterpolationMode="nearest-neighbor",t},setImageRenderingBicubic:function(t){return t.style["image-rendering"]="auto",t.style.msInterpolationMode="bicubic",t}},r.RequestAnimationFrame=function(t,e){void 0===e&&(e=!1),this.game=t,this.isRunning=!1,this.forceSetTimeOut=e;for(var i=["ms","moz","webkit","o"],n=0;n<i.length&&!window.requestAnimationFrame;n++)window.requestAnimationFrame=window[i[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[n]+"CancelAnimationFrame"]||window[i[n]+"CancelRequestAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},r.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var t=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return t.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(e){return t.updateRAF(e)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(t){this.isRunning&&(this.game.update(Math.floor(t)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}},r.RequestAnimationFrame.prototype.constructor=r.RequestAnimationFrame,r.Math={PI2:2*Math.PI,HALF_PI:.5*Math.PI,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,degToRad:function(t){return t*r.Math.DEG_TO_RAD},radToDeg:function(t){return t*r.Math.RAD_TO_DEG},getNextPowerOfTwo:function(t){if(t>0&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},isPowerOfTwo:function(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)},random:function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=1),t===e)return t;if(t>e){var i=t;t=e,e=i}return Math.random()*(e-t)+t},between:function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=1),t===e)return t;if(t>e){var i=t;t=e,e=i}return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t},fuzzyEqual:function(t,e,i){return void 0===i&&(i=1e-4),Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){return void 0===i&&(i=1e-4),t<e+i},fuzzyGreaterThan:function(t,e,i){return void 0===i&&(i=1e-4),t>e-i},fuzzyCeil:function(t,e){return void 0===e&&(e=1e-4),Math.ceil(t-e)},fuzzyFloor:function(t,e){return void 0===e&&(e=1e-4),Math.floor(t+e)},average:function(){for(var t=0,e=arguments.length,i=0;i<e;i++)t+=+arguments[i];return t/e},shear:function(t){return t%1},snapTo:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,t=e*Math.round(t/e),i+t)},snapToFloor:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,t=e*Math.floor(t/e),i+t)},snapToCeil:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,t=e*Math.ceil(t/e),i+t)},roundTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var n=Math.pow(i,-e);return Math.round(t*n)/n},floorTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var n=Math.pow(i,-e);return Math.floor(t*n)/n},ceilTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var n=Math.pow(i,-e);return Math.ceil(t*n)/n},rotateToAngle:function(t,e,i){return void 0===i&&(i=.05),t===e?t:(Math.abs(e-t)<=i||Math.abs(e-t)>=r.Math.PI2-i?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=r.Math.PI2:e-=r.Math.PI2),e>t?t+=i:e<t&&(t-=i)),t)},getShortestAngle:function(t,e){var i=e-t;if(0===i)return 0;return i-360*Math.floor((i- -180)/360)},angleBetween:function(t,e,i,n){return Math.atan2(n-e,i-t)},angleBetweenY:function(t,e,i,n){return Math.atan2(i-t,n-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,!0)},normalizeAngle:function(t){return(t%=2*Math.PI)>=0?t:t+2*Math.PI},maxAdd:function(t,e,i){return Math.min(t+e,i)},minSub:function(t,e,i){return Math.max(t-e,i)},wrap:function(t,e,i){var n=i-e;if(n<=0)return 0;var r=(t-e)%n;return r<0&&(r+=n),r+e},wrapValue:function(t,e,i){return t=Math.abs(t),e=Math.abs(e),i=Math.abs(i),(t+e)%i},isOdd:function(t){return!!(1&t)},isEven:function(t){return!(1&t)},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])var t=arguments[0];else t=arguments;for(var e=1,i=0,n=t.length;e<n;e++)t[e]<t[i]&&(i=e);return t[i]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])var t=arguments[0];else t=arguments;for(var e=1,i=0,n=t.length;e<n;e++)t[e]>t[i]&&(i=e);return t[i]},minProperty:function(t){if(2===arguments.length&&"object"==typeof arguments[1])var e=arguments[1];else e=arguments.slice(1);for(var i=1,n=0,r=e.length;i<r;i++)e[i][t]<e[n][t]&&(n=i);return e[n][t]},maxProperty:function(t){if(2===arguments.length&&"object"==typeof arguments[1])var e=arguments[1];else e=arguments.slice(1);for(var i=1,n=0,r=e.length;i<r;i++)e[i][t]>e[n][t]&&(n=i);return e[n][t]},wrapAngle:function(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)},linearInterpolation:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n);return e<0?this.linear(t[0],t[1],n):e>1?this.linear(t[i],t[i-1],i-n):this.linear(t[r],t[r+1>i?i:r+1],n-r)},bezierInterpolation:function(t,e){for(var i=0,n=t.length-1,r=0;r<=n;r++)i+=Math.pow(1-e,n-r)*Math.pow(e,r)*t[r]*this.bernstein(n,r);return i},catmullRomInterpolation:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n);return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),this.catmullRom(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):this.catmullRom(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(0===t)return 1;for(var e=t;--t;)e*=t;return e},catmullRom:function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r;return(2*e-2*i+o+s)*(r*a)+(-3*e+3*i-2*o-s)*a+o*r+e},difference:function(t,e){return Math.abs(t-e)},roundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},sinCosGenerator:function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1);for(var r=e,o=i,s=n*Math.PI/t,a=[],h=[],u=0;u<t;u++)r+=(o-=r*s)*s,a[u]=o,h[u]=r;return{sin:h,cos:a,length:t}},hypot:function(t,e){return Math.sqrt(t*t+e*e)},distance:function(t,e,i,n){var r=t-i,o=e-n;return Math.sqrt(r*r+o*o)},distanceSq:function(t,e,i,n){var r=t-i,o=e-n;return r*r+o*o},distancePow:function(t,e,i,n,r){return void 0===r&&(r=2),Math.sqrt(Math.pow(i-t,r)+Math.pow(n-e,r))},clamp:function(t,e,i){return t<e?e:i<t?i:t},clampBottom:function(t,e){return t<e?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},smoothstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*(3-2*t)},smootherstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*t*(t*(6*t-15)+10)},sign:function(t){return t<0?-1:t>0?1:0},percent:function(t,e,i){return void 0===i&&(i=0),t>e||i>e?1:t<i||i>t?0:(t-i)/e}},r.RandomDataGenerator=function(t){void 0===t&&(t=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,"string"==typeof t?this.state(t):this.sow(t)},r.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|t,this.s0=this.s1,this.s1=this.s2,this.s2=t-this.c,this.s2},sow:function(t){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,t)for(var e=0;e<t.length&&null!=t[e];e++){var i=t[e];this.s0-=this.hash(i),this.s0+=~~(this.s0<0),this.s1-=this.hash(i),this.s1+=~~(this.s1<0),this.s2-=this.hash(i),this.s2+=~~(this.s2<0)}},hash:function(t){var e,i,n;for(n=4022871197,t=t.toString(),i=0;i<t.length;i++)e=.02519603282416938*(n+=t.charCodeAt(i)),e-=n=e>>>0,n=(e*=n)>>>0,n+=4294967296*(e-=n);return 2.3283064365386963e-10*(n>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){var t="",e="";for(e=t="";t++<36;e+=~t%5|3*t&4?(15^t?8^this.frac()*(20^t?16:4):4).toString(16):"-");return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1)+.5)]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(t){return"string"==typeof t&&t.match(/^!rnd/)&&(t=t.split(","),this.c=parseFloat(t[1]),this.s0=parseFloat(t[2]),this.s1=parseFloat(t[3]),this.s2=parseFloat(t[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}},r.RandomDataGenerator.prototype.constructor=r.RandomDataGenerator,r.QuadTree=function(t,e,i,n,r,o,s){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(t,e,i,n,r,o,s)},r.QuadTree.prototype={reset:function(t,e,i,n,r,o,s){this.maxObjects=r||10,this.maxLevels=o||4,this.level=s||0,this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:n,subWidth:Math.floor(i/2),subHeight:Math.floor(n/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(n/2)},this.objects.length=0,this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,!0)},populateHandler:function(t){t.body&&t.exists&&this.insert(t.body)},split:function(){this.nodes[0]=new r.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new r.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new r.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new r.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e,i=0;if(null==this.nodes[0]||-1===(e=this.getIndex(t))){if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i++}else this.nodes[e].insert(t)},getIndex:function(t){var e=-1;return t.x<this.bounds.right&&t.right<this.bounds.right?t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=1:t.y>this.bounds.bottom&&(e=2):t.x>this.bounds.right&&(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=0:t.y>this.bounds.bottom&&(e=3)),e},retrieve:function(t){if(t instanceof r.Rectangle)var e=this.objects,i=this.getIndex(t);else{if(!t.body)return this._empty;e=this.objects,i=this.getIndex(t.body)}return this.nodes[0]&&(e=-1!==i?e.concat(this.nodes[i].retrieve(t)):(e=(e=(e=e.concat(this.nodes[0].retrieve(t))).concat(this.nodes[1].retrieve(t))).concat(this.nodes[2].retrieve(t))).concat(this.nodes[3].retrieve(t))),e},clear:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}},r.QuadTree.prototype.constructor=r.QuadTree,r.Net=function(t){this.game=t},r.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(t){return-1!==window.location.hostname.indexOf(t)},updateQueryString:function(t,e,i,n){void 0===i&&(i=!1),void 0!==n&&""!==n||(n=window.location.href);var r="",o=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi");if(o.test(n))r="undefined"!=typeof e&&null!==e?n.replace(o,"$1"+t+"="+e+"$2$3"):n.replace(o,"$1$3").replace(/(&|\?)$/,"");else if("undefined"!=typeof e&&null!==e){var s=-1!==n.indexOf("?")?"&":"?",a=n.split("#");n=a[0]+s+t+"="+e,a[1]&&(n+="#"+a[1]),r=n}else r=n;if(!i)return r;window.location.href=r},getQueryString:function(t){void 0===t&&(t="");var e={},i=location.search.substring(1).split("&");for(var n in i){var r=i[n].split("=");if(r.length>1){if(t&&t===this.decodeURI(r[0]))return this.decodeURI(r[1]);e[this.decodeURI(r[0])]=this.decodeURI(r[1])}}return e},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}},r.Net.prototype.constructor=r.Net,r.TweenManager=function(t){this.game=t,this.frameBased=!1,this._tweens=[],this._add=[],this.easeMap={Power0:r.Easing.Power0,Power1:r.Easing.Power1,Power2:r.Easing.Power2,Power3:r.Easing.Power3,Power4:r.Easing.Power4,Linear:r.Easing.Linear.None,Quad:r.Easing.Quadratic.Out,Cubic:r.Easing.Cubic.Out,Quart:r.Easing.Quartic.Out,Quint:r.Easing.Quintic.Out,Sine:r.Easing.Sinusoidal.Out,Expo:r.Easing.Exponential.Out,Circ:r.Easing.Circular.Out,Elastic:r.Easing.Elastic.Out,Back:r.Easing.Back.Out,Bounce:r.Easing.Bounce.Out,"Quad.easeIn":r.Easing.Quadratic.In,"Cubic.easeIn":r.Easing.Cubic.In,"Quart.easeIn":r.Easing.Quartic.In,"Quint.easeIn":r.Easing.Quintic.In,"Sine.easeIn":r.Easing.Sinusoidal.In,"Expo.easeIn":r.Easing.Exponential.In,"Circ.easeIn":r.Easing.Circular.In,"Elastic.easeIn":r.Easing.Elastic.In,"Back.easeIn":r.Easing.Back.In,"Bounce.easeIn":r.Easing.Bounce.In,"Quad.easeOut":r.Easing.Quadratic.Out,"Cubic.easeOut":r.Easing.Cubic.Out,"Quart.easeOut":r.Easing.Quartic.Out,"Quint.easeOut":r.Easing.Quintic.Out,"Sine.easeOut":r.Easing.Sinusoidal.Out,"Expo.easeOut":r.Easing.Exponential.Out,"Circ.easeOut":r.Easing.Circular.Out,"Elastic.easeOut":r.Easing.Elastic.Out,"Back.easeOut":r.Easing.Back.Out,"Bounce.easeOut":r.Easing.Bounce.Out,"Quad.easeInOut":r.Easing.Quadratic.InOut,"Cubic.easeInOut":r.Easing.Cubic.InOut,"Quart.easeInOut":r.Easing.Quartic.InOut,"Quint.easeInOut":r.Easing.Quintic.InOut,"Sine.easeInOut":r.Easing.Sinusoidal.InOut,"Expo.easeInOut":r.Easing.Exponential.InOut,"Circ.easeInOut":r.Easing.Circular.InOut,"Elastic.easeInOut":r.Easing.Elastic.InOut,"Back.easeInOut":r.Easing.Back.InOut,"Bounce.easeInOut":r.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},r.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var t=0;t<this._tweens.length;t++)this._tweens[t].pendingDelete=!0;this._add=[]},removeFrom:function(t,e){void 0===e&&(e=!0);if(Array.isArray(t))for(i=0,n=t.length;i<n;i++)this.removeFrom(t[i]);else if(t.type===r.GROUP&&e)for(var i=0,n=t.children.length;i<n;i++)this.removeFrom(t.children[i]);else{for(i=0,n=this._tweens.length;i<n;i++)t===this._tweens[i].target&&this.remove(this._tweens[i]);for(i=0,n=this._add.length;i<n;i++)t===this._add[i].target&&this.remove(this._add[i])}},add:function(t){t._manager=this,this._add.push(t)},create:function(t){return new r.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);-1!==e?this._tweens[e].pendingDelete=!0:-1!==(e=this._add.indexOf(t))&&(this._add[e].pendingDelete=!0)},update:function(){var t=this._add.length,e=this._tweens.length;if(0===e&&0===t)return!1;for(var i=0;i<e;)this._tweens[i].update(this.game.time.time)?i++:(this._tweens.splice(i,1),e--);return t>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(t){return this._tweens.some(function(e){return e.target===t})},_pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t]._pause()},_resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t]._resume()},pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t].pause()},resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t].resume(!0)}},r.TweenManager.prototype.constructor=r.TweenManager,r.Tween=function(t,e,i){this.game=e,this.target=t,this.manager=i,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new r.Signal,this.onLoop=new r.Signal,this.onRepeat=new r.Signal,this.onChildComplete=new r.Signal,this.onComplete=new r.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this.frameBased=i.frameBased,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1,this._hasStarted=!1},r.Tween.updateColor=function(t){r.Color.updateColor(t.target)},r.Tween.prototype={to:function(t,e,i,n,o,s,a){return(void 0===e||e<=0)&&(e=1e3),void 0!==i&&null!==i||(i=r.Easing.Default),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push(new r.TweenData(this).to(t,e,i,o,s,a)),n&&this.start(),this)},from:function(t,e,i,n,o,s,a){return void 0===e&&(e=1e3),void 0!==i&&null!==i||(i=r.Easing.Default),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push(new r.TweenData(this).from(t,e,i,o,s,a)),n&&this.start(),this)},start:function(t){if(void 0===t&&(t=0),this.pendingDelete)return console.warn("Phaser.Tween.start cannot be called after Tween.stop"),this;if(null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var e=0;e<this.timeline.length;e++)for(var i in this.timeline[e].vEnd)this.properties[i]=this.target[i]||0,Array.isArray(this.properties[i])||(this.properties[i]*=1);for(e=0;e<this.timeline.length;e++)this.timeline[e].loadValues();return this.manager.add(this),this.isRunning=!0,(t<0||t>this.timeline.length-1)&&(t=0),this.current=t,this.timeline[this.current].start(),this},stop:function(t){return void 0===t&&(t=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,t&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(t,e,i){if(0===this.timeline.length)return this;if(void 0===i&&(i=0),-1===i)for(var n=0;n<this.timeline.length;n++)this.timeline[n][t]=e;else this.timeline[i][t]=e;return this},delay:function(t,e){return this.updateTweenData("delay",t,e)},repeat:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("repeatCounter",t,i),this.updateTweenData("repeatTotal",t,i),this.updateTweenData("repeatDelay",e,i)},repeatDelay:function(t,e){return this.updateTweenData("repeatDelay",t,e)},yoyo:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("yoyo",t,i),this.updateTweenData("yoyoDelay",e,i)},yoyoDelay:function(t,e){return this.updateTweenData("yoyoDelay",t,e)},easing:function(t,e){return"string"==typeof t&&this.manager.easeMap[t]&&(t=this.manager.easeMap[t]),this.updateTweenData("easingFunction",t,e)},interpolation:function(t,e,i){return void 0===e&&(e=r.Math),this.updateTweenData("interpolationFunction",t,i),this.updateTweenData("interpolationContext",e,i)},repeatAll:function(t){return void 0===t&&(t=0),this.repeatCounter=t,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1].chainedTween=arguments[t]:this.chainedTween=arguments[t];return this},loop:function(t){return void 0===t&&(t=!0),this.repeatCounter=t?-1:0,this},onUpdateCallback:function(t,e){return this._onUpdateCallback=t,this._onUpdateCallbackContext=e,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var t=0;t<this.timeline.length;t++)this.timeline[t].isRunning||(this.timeline[t].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(t){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;var e=this.timeline[this.current].update(t);if(e===r.TweenData.PENDING)return!0;if(e===r.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(e===r.TweenData.LOOPED)return-1===this.timeline[this.current].repeatCounter?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0;if(e===r.TweenData.COMPLETE){var i=!1;return this.reverse?(this.current--,this.current<0&&(this.current=this.timeline.length-1,i=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,i=!0)),i?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):this.repeatCounter>0?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(t,e){if(null===this.game||null===this.target)return null;void 0===t&&(t=60),void 0===e&&(e=[]);for(var i=0;i<this.timeline.length;i++)for(var n in this.timeline[i].vEnd)this.properties[n]=this.target[n]||0,Array.isArray(this.properties[n])||(this.properties[n]*=1);for(i=0;i<this.timeline.length;i++)this.timeline[i].loadValues();for(i=0;i<this.timeline.length;i++)e=e.concat(this.timeline[i].generateData(t));return e}},Object.defineProperty(r.Tween.prototype,"totalDuration",{get:function(){for(var t=0,e=0;e<this.timeline.length;e++)t+=this.timeline[e].duration;return t}}),r.Tween.prototype.constructor=r.Tween,r.TweenData=function(t){this.parent=t,this.game=t.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.repeatTotal=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=r.Easing.Default,this.interpolationFunction=r.Math.linearInterpolation,this.interpolationContext=r.Math,this.isRunning=!1,this.isFrom=!1},r.TweenData.PENDING=0,r.TweenData.RUNNING=1,r.TweenData.LOOPED=2,r.TweenData.COMPLETE=3,r.TweenData.prototype={to:function(t,e,i,n,r,o){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=n,this.repeatTotal=r,this.yoyo=o,this.isFrom=!1,this},from:function(t,e,i,n,r,o){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=n,this.repeatTotal=r,this.yoyo=o,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.parent.reverse?this.dt=this.duration:this.dt=0,this.delay>0?this.isRunning=!1:this.isRunning=!0,this.isFrom)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t],this.parent.target[t]=this.vStart[t];return this.value=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var t in this.parent.properties){if(this.vStart[t]=this.parent.properties[t],Array.isArray(this.vEnd[t])){if(0===this.vEnd[t].length)continue;0===this.percent&&(this.vEnd[t]=[this.vStart[t]].concat(this.vEnd[t]))}"undefined"!=typeof this.vEnd[t]?("string"==typeof this.vEnd[t]&&(this.vEnd[t]=this.vStart[t]+parseFloat(this.vEnd[t],10)),this.parent.properties[t]=this.vEnd[t]):this.vEnd[t]=this.vStart[t],this.vStartCache[t]=this.vStart[t],this.vEndCache[t]=this.vEnd[t]}return this},update:function(t){if(this.isRunning){if(t<this.startTime)return r.TweenData.RUNNING}else{if(!(t>=this.startTime))return r.TweenData.PENDING;this.isRunning=!0}var e=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;this.parent.reverse?(this.dt-=e*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=e*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);for(var i in this.vEnd){var n=this.vStart[i],o=this.vEnd[i];Array.isArray(o)?this.parent.target[i]=this.interpolationFunction.call(this.interpolationContext,o,this.value):this.parent.target[i]=n+(o-n)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():r.TweenData.RUNNING},generateData:function(t){this.parent.reverse?this.dt=this.duration:this.dt=0;var e=[],i=!1,n=1/t*1e3;do{this.parent.reverse?(this.dt-=n,this.dt=Math.max(this.dt,0)):(this.dt+=n,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var r={};for(var o in this.vEnd){var s=this.vStart[o],a=this.vEnd[o];Array.isArray(a)?r[o]=this.interpolationFunction.call(this.interpolationContext,a,this.value):r[o]=s+(a-s)*this.value}e.push(r),(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(i=!0)}while(!i);if(this.yoyo){var h=e.slice();h.reverse(),e=e.concat(h)}return e},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter){for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];return this.inReverse=!1,r.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return r.TweenData.COMPLETE;if(this.inReverse)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t];else{for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];this.repeatCounter>0&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.parent.reverse?this.dt=this.duration:this.dt=0,r.TweenData.LOOPED}},r.TweenData.prototype.constructor=r.TweenData,r.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},Out:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},InOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},Out:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)*.5:.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)}},Bounce:{In:function(t){return 1-r.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*r.Easing.Bounce.In(2*t):.5*r.Easing.Bounce.Out(2*t-1)+.5}}},r.Easing.Default=r.Easing.Linear.None,r.Easing.Power0=r.Easing.Linear.None,r.Easing.Power1=r.Easing.Quadratic.Out,r.Easing.Power2=r.Easing.Cubic.Out,r.Easing.Power3=r.Easing.Quartic.Out,r.Easing.Power4=r.Easing.Quintic.Out,r.Time=function(t){this.game=t,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=1/60,this.physicsElapsedMS=1/60*1e3,this.desiredFpsMult=1/60,this._desiredFps=60,this.suggestedFps=this.desiredFps,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new r.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},r.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start(),this.timeExpected=this.time},add:function(t){return this._timers.push(t),t},create:function(t){void 0===t&&(t=!0);var e=new r.Timer(this.game,t);return this._timers.push(e),e},removeAll:function(){for(var t=0;t<this._timers.length;t++)this._timers[t].destroy();this._timers=[],this.events.removeAll()},refresh:function(){var t=this.time;this.time=Date.now(),this.elapsedMS=this.time-t},update:function(t){var e=this.time;this.time=Date.now(),this.elapsedMS=this.time-e,this.prevTime=this.now,this.now=t,this.elapsed=this.now-this.prevTime,this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-t))),this.timeExpected=t+this.timeToCall),this.advancedTiming&&this.updateAdvancedTiming(),this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){for(var t=0,e=this._timers.length;t<e;)this._timers[t].update(this.time)?t++:(this._timers.splice(t,1),e--)},updateAdvancedTiming:function(){this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();for(var t=this._timers.length;t--;)this._timers[t]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var t=this._timers.length;t--;)this._timers[t]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(t){return this.time-t},elapsedSecondsSince:function(t){return.001*(this.time-t)},reset:function(){this._started=this.time,this.removeAll()}},Object.defineProperty(r.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(t){this._desiredFps=t,this.physicsElapsed=1/t,this.physicsElapsedMS=1e3*this.physicsElapsed,this.desiredFpsMult=1/t}}),r.Time.prototype.constructor=r.Time,r.Timer=function(t,e){void 0===e&&(e=!0),this.game=t,this.running=!1,this.autoDestroy=e,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new r.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},r.Timer.MINUTE=6e4,r.Timer.SECOND=1e3,r.Timer.HALF=500,r.Timer.QUARTER=250,r.Timer.prototype={create:function(t,e,i,n,o,s){var a=t=Math.round(t);0===this._now?a+=this.game.time.time:a+=this._now;var h=new r.TimerEvent(this,t,a,i,e,n,o,s);return this.events.push(h),this.order(),this.expired=!1,h},add:function(t,e,i){return this.create(t,!1,0,e,i,Array.prototype.slice.call(arguments,3))},repeat:function(t,e,i,n){return this.create(t,!1,e,i,n,Array.prototype.slice.call(arguments,4))},loop:function(t,e,i){return this.create(t,!0,0,e,i,Array.prototype.slice.call(arguments,3))},start:function(t){if(!this.running){this._started=this.game.time.time+(t||0),this.running=!0;for(var e=0;e<this.events.length;e++)this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=!1,void 0===t&&(t=!0),t&&(this.events.length=0)},remove:function(t){for(var e=0;e<this.events.length;e++)if(this.events[e]===t)return this.events[e].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(t,e){return t.tick<e.tick?-1:t.tick>e.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(t){if(this.paused)return!0;if(this.elapsed=t-this._now,this._now=t,this.elapsed>this.timeCap&&this.adjustEvents(t-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){for(;this._i<this._len&&this.running;){var e=this.events[this._i];if(!(this._now>=e.tick)||e.pendingDelete)break;this._newTick=this._now+e.delay-(this._now-e.tick),this._newTick<0&&(this._newTick=this._now+e.delay),!0===e.loop?(e.tick=this._newTick,e.callback.apply(e.callbackContext,e.args)):e.repeatCount>0?(e.repeatCount--,e.tick=this._newTick,e.callback.apply(e.callbackContext,e.args)):(this._marked++,e.pendingDelete=!0,e.callback.apply(e.callbackContext,e.args)),this._i++}this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return!this.expired||!this.autoDestroy},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(t){for(var e=0;e<this.events.length;e++)if(!this.events[e].pendingDelete){var i=this.events[e].tick-t;i<0&&(i=0),this.events[e].tick=this._now+i}var n=this.nextTick-t;this.nextTick=n<0?this._now:this._now+n},resume:function(){if(this.paused){var t=this.game.time.time;this._pauseTotal+=t-this._now,this._now=t,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.expired=!0,this.events=[],this._len=0,this._i=0}},Object.defineProperty(r.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(r.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(r.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(r.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(r.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),r.Timer.prototype.constructor=r.Timer,r.TimerEvent=function(t,e,i,n,r,o,s,a){this.timer=t,this.delay=e,this.tick=i,this.repeatCount=n-1,this.loop=r,this.callback=o,this.callbackContext=s,this.args=a,this.pendingDelete=!1},r.TimerEvent.prototype.constructor=r.TimerEvent,r.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},r.AnimationManager.prototype={loadFrameData:function(t,e){if(void 0===t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,void 0===e||null===e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return void 0===e||null===e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},add:function(t,e,i,n,o){return e=e||[],i=i||60,void 0===n&&(n=!1),void 0===o&&(o=!(!e||"number"!=typeof e[0])),this._outputFrames=[],this._frameData.getFrameIndexes(e,o,this._outputFrames),this._anims[t]=new r.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,n),this.currentAnim=this._anims[t],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[t]},validateFrames:function(t,e){void 0===e&&(e=!0);for(var i=0;i<t.length;i++)if(!0===e){if(t[i]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(t[i]))return!1;return!0},play:function(t,e,i,n){if(this._anims[t])return this.currentAnim===this._anims[t]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(e,i,n)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[t],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(e,i,n))},stop:function(t,e){void 0===e&&(e=!1),!this.currentAnim||"string"==typeof t&&t!==this.currentAnim.name||this.currentAnim.stop(e)},update:function(){return!(this.updateIfVisible&&!this.sprite.visible)&&(!(!this.currentAnim||!this.currentAnim.update())&&(this.currentFrame=this.currentAnim.currentFrame,!0))},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.currentFrame=this.currentAnim.currentFrame)},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){},destroy:function(){var t=null;for(var t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},r.AnimationManager.prototype.constructor=r.AnimationManager,Object.defineProperty(r.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(r.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(r.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),Object.defineProperty(r.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(r.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(t){var e;"number"==typeof t&&this._frameData&&(e=this._frameData.getFrame(t))&&(this.currentFrame=e,this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(r.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(t){var e;"string"==typeof t&&this._frameData&&(e=this._frameData.getFrameByName(t))?(this.currentFrame=e,this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame)):console.warn("Cannot set frameName: "+t)}}),r.Animation=function(t,e,i,n,o,s,a){void 0===a&&(a=!1),this.game=t,this._parent=e,this._frameData=n,this.name=i,this._frames=[],this._frames=this._frames.concat(o),this.delay=1e3/s,this.loop=a,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new r.Signal,this.onUpdate=null,this.onComplete=new r.Signal,this.onLoop=new r.Signal,this.isReversed=!1,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},r.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),"undefined"!=typeof i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=this.isReversed?this._frames.length-1:0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(t,e){var i;if(void 0===e&&(e=!1),"string"==typeof t)for(var n=0;n<this._frames.length;n++)this._frameData.getFrame(this._frames[n]).name===t&&(i=n);else if("number"==typeof t)if(e)i=t;else for(n=0;n<this._frames.length;n++)this._frames[n]===t&&(i=n);if(i){var r=this.isReversed?-1:1;this._frameIndex=i-r,this._timeNextFrame=this.game.time.time,this.update()}},stop:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&(!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay?(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay):this._frameDiff=0,this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1?this.loop?(this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0)))},updateCurrentFrame:function(t,e){if(void 0===e&&(e=!1),!this._frameData)return!1;var i=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(e||!e&&i!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),!this.onUpdate||!t||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)},next:function(t){void 0===t&&(t=1);var e=this._frameIndex+t;e>=this._frames.length&&(this.loop?e%=this._frames.length:e=this._frames.length-1),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},previous:function(t){void 0===t&&(t=1);var e=this._frameIndex-t;e<0&&(this.loop?e=this._frames.length+e:e++),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},r.Animation.prototype.constructor=r.Animation,Object.defineProperty(r.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t,t?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(r.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(t){this.isReversed=t}}),Object.defineProperty(r.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(r.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]),null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(r.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(t){t>0&&(this.delay=1e3/t)}}),Object.defineProperty(r.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new r.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),r.Animation.generateFrameNames=function(t,e,i,n,o){void 0===n&&(n="");var s=[],a="";if(e<i)for(var h=e;h<=i;h++)a=t+(a="number"==typeof o?r.Utils.pad(h.toString(),o,"0",1):h.toString())+n,s.push(a);else for(h=e;h>=i;h--)a=t+(a="number"==typeof o?r.Utils.pad(h.toString(),o,"0",1):h.toString())+n,s.push(a);return s},r.Frame=function(t,e,i,n,o,s){this.index=t,this.x=e,this.y=i,this.width=n,this.height=o,0!==this.width&&0!==this.height||console.warn('Phaser.Frame: Frame "'+this.name+'" has a width or height of zero'),this.name=s,this.centerX=Math.floor(n/2),this.centerY=Math.floor(o/2),this.distance=r.Math.distance(0,0,n,o),this.rotated=!1,this.trimmed=!1,this.sourceSizeW=n,this.sourceSizeH=o,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},r.Frame.prototype={resize:function(t,e){this.width=t,this.height=e,this.centerX=Math.floor(t/2),this.centerY=Math.floor(e/2),this.distance=r.Math.distance(0,0,t,e),this.sourceSizeW=t,this.sourceSizeH=e,this.right=this.x+t,this.bottom=this.y+e},setTrim:function(t,e,i,n,r,o,s){this.trimmed=t,t&&(this.sourceSizeW=e,this.sourceSizeH=i,this.centerX=Math.floor(e/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=n,this.spriteSourceSizeY=r,this.spriteSourceSizeW=o,this.spriteSourceSizeH=s)},clone:function(){var t=new r.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var e in this)this.hasOwnProperty(e)&&(t[e]=this[e]);return t},getRect:function(t){return void 0===t?t=new r.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}},r.Frame.prototype.constructor=r.Frame,r.FrameData=function(){this._frames=[],this._frameNames=[]},r.FrameData.prototype={addFrame:function(t){return t.index=this._frames.length,this._frames.push(t),""!==t.name&&(this._frameNames[t.name]=t.index),t},getFrame:function(t){return t>=this._frames.length&&(t=0),this._frames[t]},getFrameByName:function(t){return"number"==typeof this._frameNames[t]?this._frames[this._frameNames[t]]:null},checkFrameName:function(t){return null!=this._frameNames[t]},clone:function(){for(var t=new r.FrameData,e=0;e<this._frames.length;e++)t._frames.push(this._frames[e].clone());for(var i in this._frameNames)this._frameNames.hasOwnProperty(i)&&t._frameNames.push(this._frameNames[i]);return t},getFrameRange:function(t,e,i){void 0===i&&(i=[]);for(var n=t;n<=e;n++)i.push(this._frames[n]);return i},getFrames:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var n=0;n<this._frames.length;n++)i.push(this._frames[n]);else for(n=0;n<t.length;n++)e?i.push(this.getFrame(t[n])):i.push(this.getFrameByName(t[n]));return i},getFrameIndexes:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var n=0;n<this._frames.length;n++)i.push(this._frames[n].index);else for(n=0;n<t.length;n++)e&&this._frames[t[n]]?i.push(this._frames[t[n]].index):this.getFrameByName(t[n])&&i.push(this.getFrameByName(t[n]).index);return i},destroy:function(){this._frames=null,this._frameNames=null}},r.FrameData.prototype.constructor=r.FrameData,Object.defineProperty(r.FrameData.prototype,"total",{get:function(){return this._frames.length}}),r.AnimationParser={spriteSheet:function(t,e,i,n,o,s,a,h){void 0===o&&(o=-1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===h&&(h=0);var u=e;if("string"==typeof e&&(u=t.cache.getImage(e)),null===u)return null;var c=u.width,l=u.height;i<=0&&(i=Math.floor(-c/Math.min(-1,i))),n<=0&&(n=Math.floor(-l/Math.min(-1,n)));var d=Math.floor((c-s)/(i+a))*Math.floor((l-s)/(n+a));if(h>d||h<-d)return console.warn("Phaser.AnimationParser.spriteSheet: skipFrames = "+h.toString()+" is larger than total sprite number "+d.toString()),null;if(h<0&&(h=d+h),-1!==o&&(d=h+o),0===c||0===l||c<i||l<n||0===d)return console.warn("Phaser.AnimationParser.spriteSheet: '"+e+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;for(var p=new r.FrameData,f=s,m=s,g=0;g<d;g++)p.addFrame(new r.Frame(g,f,m,i,n,"")),(f+=i+a)+i>c&&(f=s,m+=n+a);return p},JSONData:function(t,e){if(!e.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(e);for(var i,n=new r.FrameData,o=e.frames,s=0;s<o.length;s++)i=n.addFrame(new r.Frame(s,o[s].frame.x,o[s].frame.y,o[s].frame.w,o[s].frame.h,o[s].filename)),o[s].trimmed&&i.setTrim(o[s].trimmed,o[s].sourceSize.w,o[s].sourceSize.h,o[s].spriteSourceSize.x,o[s].spriteSourceSize.y,o[s].spriteSourceSize.w,o[s].spriteSourceSize.h),o[s].rotated&&(i.rotated=!0);return n},JSONDataPyxel:function(t,e){if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(t){if(!e[t])return console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+t+'" key.'),void console.log(e)}),1!==e.layers.length)return console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps."),void console.log(e);for(var i=new r.FrameData,n=e.tileheight,o=e.tilewidth,s=e.layers[0].tiles,a=0;a<s.length;a++)i.addFrame(new r.Frame(a,s[a].x,s[a].y,o,n,"frame_"+a)).setTrim(!1);return i},JSONDataHash:function(t,e){if(!e.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(e);var i,n=new r.FrameData,o=e.frames,s=0;for(var a in o)i=n.addFrame(new r.Frame(s,o[a].frame.x,o[a].frame.y,o[a].frame.w,o[a].frame.h,a)),o[a].trimmed&&i.setTrim(o[a].trimmed,o[a].sourceSize.w,o[a].sourceSize.h,o[a].spriteSourceSize.x,o[a].spriteSourceSize.y,o[a].spriteSourceSize.w,o[a].spriteSourceSize.h),o[a].rotated&&(i.rotated=!0),s++;return n},XMLData:function(t,e){if(e.getElementsByTagName("TextureAtlas")){for(var i,n,o,s,a,h,u,c,l,d,p,f=new r.FrameData,m=e.getElementsByTagName("SubTexture"),g=0;g<m.length;g++)n=(o=m[g].attributes).name.value,s=parseInt(o.x.value,10),a=parseInt(o.y.value,10),h=parseInt(o.width.value,10),u=parseInt(o.height.value,10),c=null,l=null,o.frameX&&(c=Math.abs(parseInt(o.frameX.value,10)),l=Math.abs(parseInt(o.frameY.value,10)),d=parseInt(o.frameWidth.value,10),p=parseInt(o.frameHeight.value,10)),i=f.addFrame(new r.Frame(g,s,a,h,u,n)),null===c&&null===l||i.setTrim(!0,h,u,c,l,d,p);return f}console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag")}},r.Cache=function(t){this.game=t,this.autoResolveURL=!1,this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{},compressedTexture:{}},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.onSoundUnlock=new r.Signal,this._cacheMap=[],this._cacheMap[r.Cache.CANVAS]=this._cache.canvas,this._cacheMap[r.Cache.IMAGE]=this._cache.image,this._cacheMap[r.Cache.TEXTURE]=this._cache.texture,this._cacheMap[r.Cache.SOUND]=this._cache.sound,this._cacheMap[r.Cache.TEXT]=this._cache.text,this._cacheMap[r.Cache.PHYSICS]=this._cache.physics,this._cacheMap[r.Cache.TILEMAP]=this._cache.tilemap,this._cacheMap[r.Cache.BINARY]=this._cache.binary,this._cacheMap[r.Cache.BITMAPDATA]=this._cache.bitmapData,this._cacheMap[r.Cache.BITMAPFONT]=this._cache.bitmapFont,this._cacheMap[r.Cache.JSON]=this._cache.json,this._cacheMap[r.Cache.XML]=this._cache.xml,this._cacheMap[r.Cache.VIDEO]=this._cache.video,this._cacheMap[r.Cache.SHADER]=this._cache.shader,this._cacheMap[r.Cache.RENDER_TEXTURE]=this._cache.renderTexture,this._pendingCount=0,this.onReady=new r.Signal,this._addImages()},r.Cache.CANVAS=1,r.Cache.IMAGE=2,r.Cache.TEXTURE=3,r.Cache.SOUND=4,r.Cache.TEXT=5,r.Cache.PHYSICS=6,r.Cache.TILEMAP=7,r.Cache.BINARY=8,r.Cache.BITMAPDATA=9,r.Cache.BITMAPFONT=10,r.Cache.JSON=11,r.Cache.XML=12,r.Cache.VIDEO=13,r.Cache.SHADER=14,r.Cache.RENDER_TEXTURE=15,r.Cache.DEFAULT=null,r.Cache.DEFAULT_KEY="__default",r.Cache.DEFAULT_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",r.Cache.MISSING=null,r.Cache.MISSING_KEY="__missing",r.Cache.MISSING_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",r.Cache.READY_TIMEOUT=1e3,r.Cache.prototype={addCompressedTextureMetaData:function(t,e,i,n){this.checkImageKey(t)&&this.removeImage(t);var o=i in r.LoaderParser?r.LoaderParser[i](n):n,s={key:t,url:e,data:o,base:new PIXI.BaseTexture(o,null,this.game.resolution),frame:new r.Frame(0,0,0,o.width,o.height,t),frameData:new r.FrameData,fileFormat:i};return s.frameData.addFrame(new r.Frame(0,0,0,o.width,o.height,e)),this._cache.image[t]=s,this._resolveURL(e,s),s},addCanvas:function(t,e,i){void 0===i&&(i=e.getContext("2d")),this._cache.canvas[t]={canvas:e,context:i}},addImage:function(t,e,i){this.checkImageKey(t)&&this.removeImage(t),!1===i.complete&&console.warn('Phaser.Cache.addImage: Image "'+t+"\" hasn't been retrieved yet");var n={key:t,url:e,data:i,base:new PIXI.BaseTexture(i,null,this.game.resolution),frame:new r.Frame(0,0,0,i.width,i.height,t),frameData:new r.FrameData};return n.frameData.addFrame(new r.Frame(0,0,0,i.width,i.height,e)),this._cache.image[t]=n,this._resolveURL(e,n),"__default"===t?r.Cache.DEFAULT=new PIXI.Texture(n.base):"__missing"===t&&(r.Cache.MISSING=new PIXI.Texture(n.base)),n},addImageAsync:function(t,e,i){var n=this,r=new Image;r.onload=function(){i.call(this,n.addImage(t,null,r)),n._removePending(),r.onload=null},this._addPending(),r.src=e},addDefaultImage:function(){this.addImageAsync(r.Cache.DEFAULT_KEY,r.Cache.DEFAULT_SRC,function(t){t.base.skipRender=!0,r.Cache.DEFAULT=new PIXI.Texture(t.base)})},addMissingImage:function(){this.addImageAsync(r.Cache.MISSING_KEY,r.Cache.MISSING_SRC,function(t){r.Cache.MISSING=new PIXI.Texture(t.base)})},addSound:function(t,e,i,n,r){void 0===n&&(n=!0,r=!1),void 0===r&&(n=!1,r=!0);var o=!1;r&&(o=!0),this._cache.sound[t]={url:e,data:i,isDecoding:!1,decoded:o,webAudio:n,audioTag:r,locked:this.game.sound.touchLocked},this._resolveURL(e,this._cache.sound[t])},addText:function(t,e,i){this._cache.text[t]={url:e,data:i},this._resolveURL(e,this._cache.text[t])},addPhysicsData:function(t,e,i,n){this._cache.physics[t]={url:e,data:i,format:n},this._resolveURL(e,this._cache.physics[t])},addTilemap:function(t,e,i,n){this._cache.tilemap[t]={url:e,data:i,format:n},this._resolveURL(e,this._cache.tilemap[t])},addBinary:function(t,e){this._cache.binary[t]=e},addBitmapData:function(t,e,i){return e.key=t,void 0===i&&(i=new r.FrameData).addFrame(e.textureFrame),this._cache.bitmapData[t]={data:e,frameData:i},e},addBitmapFont:function(t,e,i,n,o,s,a){var h={url:e,data:i,font:null,base:new PIXI.BaseTexture(i,null,this.game.resolution)};void 0===s&&(s=0),void 0===a&&(a=0),h.font="json"===o?r.LoaderParser.jsonBitmapFont(n,h.base,s,a,!1,this.game.resolution):r.LoaderParser.xmlBitmapFont(n,h.base,s,a,!1,this.game.resolution),this._cache.bitmapFont[t]=h,this._resolveURL(e,h)},addBitmapFontFromAtlas:function(t,e,i,n,o,s,a){var h=this.getFrameByName(e,i);if(h){var u={font:null,base:this.getBaseTexture(e),frame:h};void 0===s&&(s=0),void 0===a&&(a=0);var c;"json"===o?(c=this.getJSON(n),u.font=r.LoaderParser.jsonBitmapFont(c,u.base,s,a,h,this.game.resolution)):(c=this.getXML(n),u.font=r.LoaderParser.xmlBitmapFont(c,u.base,s,a,h,this.game.resolution)),this._cache.bitmapFont[t]=u}},addJSON:function(t,e,i){this._cache.json[t]={url:e,data:i},this._resolveURL(e,this._cache.json[t])},addXML:function(t,e,i){this._cache.xml[t]={url:e,data:i},this._resolveURL(e,this._cache.xml[t])},addVideo:function(t,e,i,n){this._cache.video[t]={url:e,data:i,isBlob:n,locked:!0},this._resolveURL(e,this._cache.video[t])},addShader:function(t,e,i){this._cache.shader[t]={url:e,data:i},this._resolveURL(e,this._cache.shader[t])},addRenderTexture:function(t,e){this._cache.renderTexture[t]={texture:e,frame:new r.Frame(0,0,0,e.width,e.height,"","")}},addSpriteSheet:function(t,e,i,n,o,s,a,h,u){void 0===s&&(s=-1),void 0===a&&(a=0),void 0===h&&(h=0);var c={key:t,url:e,data:i,frameWidth:n,frameHeight:o,margin:a,spacing:h,base:new PIXI.BaseTexture(i,null,this.game.resolution),frameData:r.AnimationParser.spriteSheet(this.game,i,n,o,s,a,h,u)};this._cache.image[t]=c,this._resolveURL(e,c)},addTextureAtlas:function(t,e,i,n,o){var s={key:t,url:e,data:i,base:new PIXI.BaseTexture(i,null,this.game.resolution)};o===r.Loader.TEXTURE_ATLAS_XML_STARLING?s.frameData=r.AnimationParser.XMLData(this.game,n,t):o===r.Loader.TEXTURE_ATLAS_JSON_PYXEL?s.frameData=r.AnimationParser.JSONDataPyxel(this.game,n,t):Array.isArray(n.frames)?s.frameData=r.AnimationParser.JSONData(this.game,n,t):s.frameData=r.AnimationParser.JSONDataHash(this.game,n,t),this._cache.image[t]=s,this._resolveURL(e,s)},reloadSound:function(t){var e=this,i=this.getSound(t);i&&(i.data.src=i.url,i.data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},!1),i.data.load())},reloadSoundComplete:function(t){var e=this.getSound(t);e&&(e.locked=!1,this.onSoundUnlock.dispatch(t))},updateSound:function(t,e,i){var n=this.getSound(t);n&&(n[e]=i)},decodedSound:function(t,e){var i=this.getSound(t);i.data=e,i.decoded=!0,i.isDecoding=!1},isSoundDecoded:function(t){var e=this.getItem(t,r.Cache.SOUND,"isSoundDecoded");if(e)return e.decoded},isSoundReady:function(t){var e=this.getItem(t,r.Cache.SOUND,"isSoundDecoded");if(e)return e.decoded&&!this.game.sound.touchLocked},checkKey:function(t,e){return!!this._cacheMap[t][e]},checkURL:function(t){return!!this._urlMap[this._resolveURL(t)]},checkCanvasKey:function(t){return this.checkKey(r.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(r.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(r.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(r.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(r.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(r.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(r.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(r.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(r.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(r.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(r.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(r.Cache.XML,t)},checkVideoKey:function(t){return this.checkKey(r.Cache.VIDEO,t)},checkShaderKey:function(t){return this.checkKey(r.Cache.SHADER,t)},checkRenderTextureKey:function(t){return this.checkKey(r.Cache.RENDER_TEXTURE,t)},getItem:function(t,e,i,n){return this.checkKey(e,t)?void 0===n?this._cacheMap[e][t]:this._cacheMap[e][t][n]:(i&&console.warn("Phaser.Cache."+i+': Key "'+t+'" not found in Cache.'),null)},getCanvas:function(t){return this.getItem(t,r.Cache.CANVAS,"getCanvas","canvas")},getImage:function(t,e){void 0!==t&&null!==t||(t="__default"),void 0===e&&(e=!1);var i=this.getItem(t,r.Cache.IMAGE,"getImage");return null===i&&(i=this.getItem("__missing",r.Cache.IMAGE,"getImage")),e?i:i.data},getTextureFrame:function(t){return this.getItem(t,r.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(t){return this.getItem(t,r.Cache.SOUND,"getSound")},getSoundData:function(t){return this.getItem(t,r.Cache.SOUND,"getSoundData","data")},getText:function(t){return this.getItem(t,r.Cache.TEXT,"getText","data")},getPhysicsData:function(t,e,i){var n=this.getItem(t,r.Cache.PHYSICS,"getPhysicsData","data");if(null===n||void 0===e||null===e)return n;if(n[e]){var o=n[e];if(!o||!i)return o;for(var s in o)if((s=o[s]).fixtureKey===i)return s;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+t+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+e+'"');return null},getTilemapData:function(t){return this.getItem(t,r.Cache.TILEMAP,"getTilemapData")},getBinary:function(t){return this.getItem(t,r.Cache.BINARY,"getBinary")},getBitmapData:function(t){return this.getItem(t,r.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(t){return this.getItem(t,r.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(t,e){var i=this.getItem(t,r.Cache.JSON,"getJSON","data");return i?e?r.Utils.extend(!0,Array.isArray(i)?[]:{},i):i:null},getXML:function(t){return this.getItem(t,r.Cache.XML,"getXML","data")},getVideo:function(t){return this.getItem(t,r.Cache.VIDEO,"getVideo")},getShader:function(t){return this.getItem(t,r.Cache.SHADER,"getShader","data")},getRenderTexture:function(t){return this.getItem(t,r.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(t,e){return void 0===e&&(e=r.Cache.IMAGE),this.getItem(t,e,"getBaseTexture","base")},getFrame:function(t,e){return void 0===e&&(e=r.Cache.IMAGE),this.getItem(t,e,"getFrame","frame")},getFrameCount:function(t,e){var i=this.getFrameData(t,e);return i?i.total:0},getFrameData:function(t,e){return void 0===e&&(e=r.Cache.IMAGE),this.getItem(t,e,"getFrameData","frameData")},hasFrameData:function(t,e){return void 0===e&&(e=r.Cache.IMAGE),null!==this.getItem(t,e,"","frameData")},updateFrameData:function(t,e,i){void 0===i&&(i=r.Cache.IMAGE),this._cacheMap[i][t]&&(this._cacheMap[i][t].frameData=e)},getFrameByIndex:function(t,e,i){var n=this.getFrameData(t,i);return n?n.getFrame(e):null},getFrameByName:function(t,e,i){var n=this.getFrameData(t,i);return n?n.getFrameByName(e):null},getURL:function(t){return(t=this._resolveURL(t))?this._urlMap[t]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+t+'" or Cache.autoResolveURL was false'),null)},getKeys:function(t){void 0===t&&(t=r.Cache.IMAGE);var e=[];if(this._cacheMap[t])for(var i in this._cacheMap[t])"__default"!==i&&"__missing"!==i&&e.push(i);return e},removeCanvas:function(t){delete this._cache.canvas[t]},removeImage:function(t,e){void 0===e&&(e=!0);var i=this.getImage(t,!0);e&&i.base&&i.base.destroy(),delete this._cache.image[t]},removeSound:function(t){delete this._cache.sound[t]},removeText:function(t){delete this._cache.text[t]},removePhysics:function(t){delete this._cache.physics[t]},removeTilemap:function(t){delete this._cache.tilemap[t]},removeBinary:function(t){delete this._cache.binary[t]},removeBitmapData:function(t){delete this._cache.bitmapData[t]},removeBitmapFont:function(t){delete this._cache.bitmapFont[t]},removeJSON:function(t){delete this._cache.json[t]},removeXML:function(t){delete this._cache.xml[t]},removeVideo:function(t){delete this._cache.video[t]},removeShader:function(t){delete this._cache.shader[t]},removeRenderTexture:function(t){delete this._cache.renderTexture[t]},removeSpriteSheet:function(t){delete this._cache.spriteSheet[t]},removeTextureAtlas:function(t){delete this._cache.image[t]},clearGLTextures:function(){for(var t in this._cache.image)this._cache.image[t].base._glTextures=[]},_resolveURL:function(t,e){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+t,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",e&&(this._urlMap[this._urlTemp]=e),this._urlTemp):null},destroy:function(){for(var t=0;t<this._cacheMap.length;t++){var e=this._cacheMap[t];for(var i in e)"__default"!==i&&"__missing"!==i&&(this.destroyItem(e[i]),delete e[i])}this._urlMap=null,this._urlResolver=null,this._urlTemp=null},destroyItem:function(t){t.destroy?t.destroy():(t.base&&t.base.destroy&&t.base.destroy(),t.data&&t.data.destroy&&t.data.destroy(),t.frameData&&t.frameData.destroy&&t.frameData.destroy(),t.texture&&t.texture.destroy&&t.texture.destroy(!0))},_addImages:function(){this._pendingCount=0,this.addDefaultImage(),this.addMissingImage();var t=this,e=r.Cache.READY_TIMEOUT;r.Cache.READY_TIMEOUT>0?setTimeout(function(){t.isReady||(console.warn("Phaser.Cache: Still waiting for images after %s ms.",e),t._ready())},r.Cache.READY_TIMEOUT):this._ready()},_addPending:function(){this._pendingCount+=1},_removePending:function(){this._pendingCount-=1,this._checkReady()},_checkReady:function(){this.isReady&&this._ready()},_ready:function(){this._pendingCount=0,this.onReady.dispatch(this)}},r.Cache.prototype.constructor=r.Cache,Object.defineProperty(r.Cache.prototype,"isReady",{get:function(){return this._pendingCount<=0}}),r.Loader=function(t){this.game=t,this.cache=t.cache,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.path="",this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"},this.onLoadStart=new r.Signal,this.onLoadComplete=new r.Signal,this.onPackComplete=new r.Signal,this.onFileStart=new r.Signal,this.onFileComplete=new r.Signal,this.onFileError=new r.Signal,this.useXDomainRequest=!1,this._warnedAboutXDomainRequest=!1,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},r.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,r.Loader.TEXTURE_ATLAS_JSON_HASH=1,r.Loader.TEXTURE_ATLAS_XML_STARLING=2,r.Loader.PHYSICS_LIME_CORONA_JSON=3,r.Loader.PHYSICS_PHASER_JSON=4,r.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,r.Loader.prototype={setPreloadSprite:function(t,e){e=e||0,this.preloadSprite={sprite:t,direction:e,width:t.width,height:t.height,rect:null},this.preloadSprite.rect=0===e?new r.Rectangle(0,0,1,t.height):new r.Rectangle(0,0,t.width,1),t.crop(this.preloadSprite.rect),t.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(t,e){return this.getAssetIndex(t,e)>-1},getAssetIndex:function(t,e){for(var i=-1,n=0;n<this._fileList.length;n++){var r=this._fileList[n];if(r.type===t&&r.key===e&&(i=n,!r.loaded&&!r.loading))break}return i},getAsset:function(t,e){var i=this.getAssetIndex(t,e);return i>-1&&{index:i,file:this._fileList[i]}},reset:function(t,e){void 0===e&&(e=!1),this.resetLocked||(t&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,e&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(t,e,i,n,r,o){if(void 0===r&&(r=!1),void 0===e||""===e)return console.warn("Phaser.Loader: Invalid or no key given of type "+t),this;if(void 0===i||null===i){if(!o)return console.warn("Phaser.Loader: No URL given for file type: "+t+" key: "+e),this;i=e+o}var s={type:t,key:e,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(n)for(var a in n)s[a]=n[a];var h=this.getAssetIndex(t,e);if(r&&h>-1){var u=this._fileList[h];u.loading||u.loaded?(this._fileList.push(s),this._totalFileCount++):this._fileList[h]=s}else-1===h&&(this._fileList.push(s),this._totalFileCount++);return this},replaceInFileList:function(t,e,i,n){return this.addToFileList(t,e,i,n,!0)},pack:function(t,e,i,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),!e&&!i)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;var r={type:"packfile",key:t,url:e,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:n};i&&("string"==typeof i&&(i=JSON.parse(i)),r.data=i||{},r.loaded=!0);for(var o=0;o<this._fileList.length+1;o++){var s=this._fileList[o];if(!s||!s.loaded&&!s.loading&&"packfile"!==s.type){this._fileList.splice(o,0,r),this._totalPackCount++;break}}return this},image:function(t,e,i){return"object"==typeof e?this.texture(t,e,i):this.addToFileList("image",t,e,void 0,i,".png")},imageFromBitmapData:function(t,e,i){return this.image(t,e.canvas.toDataURL("image/png"),i)},imageFromGrid:function(t,e,i,n,r,o){return this.imageFromBitmapData(t,this.game.create.grid(t,e,i,n,r,o,!1))},imageFromTexture:function(t,e,i,n,r){return this.imageFromBitmapData(t,this.game.create.texture(t,e,i,n,r,!1))},texture:function(t,e,i){if(this.game.renderType===r.WEBGL){var n,o=this.game.renderer.extensions.compression;for(n in e)if(n.toUpperCase()in o)return this.addToFileList("texture",t,e[n],void 0,i,".pvr")}return e.truecolor&&this.addToFileList("image",t,e.truecolor,void 0,i,".png"),this},images:function(t,e){if(Array.isArray(e))for(var i=0;i<t.length;i++)this.image(t[i],e[i]);else for(i=0;i<t.length;i++)this.image(t[i]);return this},text:function(t,e,i){return this.addToFileList("text",t,e,void 0,i,".txt")},json:function(t,e,i){return this.addToFileList("json",t,e,void 0,i,".json")},shader:function(t,e,i){return this.addToFileList("shader",t,e,void 0,i,".frag")},xml:function(t,e,i){return this.addToFileList("xml",t,e,void 0,i,".xml")},script:function(t,e,i,n){return void 0===i&&(i=!1),!1!==i&&void 0===n&&(n=this),this.addToFileList("script",t,e,{syncPoint:!0,callback:i,callbackContext:n},!1,".js")},binary:function(t,e,i,n){return void 0===i&&(i=!1),!1!==i&&void 0===n&&(n=i),this.addToFileList("binary",t,e,{callback:i,callbackContext:n},!1,".bin")},spritesheet:function(t,e,i,n,r,o,s,a){return void 0===r&&(r=-1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:n,frameMax:r,margin:o,spacing:s,skipFrames:a},!1,".png")},audio:function(t,e,i){return this.game.sound.noAudio?this:(void 0===i&&(i=!0),"string"==typeof e&&(e=[e]),this.addToFileList("audio",t,e,{buffer:null,autoDecode:i}))},audioSprite:function(t,e,i,n,r){return this.game.sound.noAudio?this:(void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=!0),this.audio(t,e,r),i?this.json(t+"-audioatlas",i):n?("string"==typeof n&&(n=JSON.parse(n)),this.cache.addJSON(t+"-audioatlas","",n)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this)},audiosprite:function(t,e,i,n,r){return this.audioSprite(t,e,i,n,r)},video:function(t,e,i,n){return void 0===i&&(i=this.game.device.firefox?"loadeddata":"canplaythrough"),void 0===n&&(n=!1),"string"==typeof e&&(e=[e]),this.addToFileList("video",t,e,{buffer:null,asBlob:n,loadEvent:i})},tilemap:function(t,e,i,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=r.Tilemap.CSV),e||i||(e=n===r.Tilemap.CSV?t+".csv":t+".json"),i){switch(n){case r.Tilemap.CSV:break;case r.Tilemap.TILED_JSON:"string"==typeof i&&(i=JSON.parse(i))}this.cache.addTilemap(t,null,i,n)}else this.addToFileList("tilemap",t,e,{format:n});return this},physics:function(t,e,i,n){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=r.Physics.LIME_CORONA_JSON),e||i||(e=t+".json"),i?("string"==typeof i&&(i=JSON.parse(i)),this.cache.addPhysicsData(t,null,i,n)):this.addToFileList("physics",t,e,{format:n}),this},bitmapFont:function(t,e,i,n,r,o){if(void 0!==e&&null!==e||(e=t+".png"),void 0===i&&(i=null),void 0===n&&(n=null),null===i&&null===n&&(i=t+".xml"),void 0===r&&(r=0),void 0===o&&(o=0),i)this.addToFileList("bitmapfont",t,e,{atlasURL:i,xSpacing:r,ySpacing:o});else if("string"==typeof n){var s,a;try{s=JSON.parse(n)}catch(t){a=this.parseXml(n)}if(!a&&!s)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",t,e,{atlasURL:null,atlasData:s||a,atlasType:s?"json":"xml",xSpacing:r,ySpacing:o})}return this},atlasJSONArray:function(t,e,i,n){return this.atlas(t,e,i,n,r.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,e,i,n){return this.atlas(t,e,i,n,r.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=null),i||n||(i=t+".xml"),this.atlas(t,e,i,n,r.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,e,i,n,o){if(void 0!==e&&null!==e||(e=t+".png"),void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=r.Loader.TEXTURE_ATLAS_JSON_ARRAY),i||n||(i=o===r.Loader.TEXTURE_ATLAS_XML_STARLING?t+".xml":t+".json"),i)this.addToFileList("textureatlas",t,e,{atlasURL:i,format:o});else{switch(o){case r.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof n&&(n=JSON.parse(n));break;case r.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof n){var s=this.parseXml(n);if(!s)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");n=s}}this.addToFileList("textureatlas",t,e,{atlasURL:null,atlasData:n,format:o})}return this},withSyncPoint:function(t,e){this._withSyncPointDepth++;try{t.call(e||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(t,e){var i=this.getAsset(t,e);return i&&(i.file.syncPoint=!0),this},removeFile:function(t,e){var i=this.getAsset(t,e);i&&(i.loaded||i.loading||this._fileList.splice(i.index,1))},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var t=0;t<this._flightQueue.length;t++){((n=this._flightQueue[t]).loaded||n.error)&&(this._flightQueue.splice(t,1),t--,n.loading=!1,n.requestUrl=null,n.requestObject=null,n.error&&this.onFileError.dispatch(n.key,n),"packfile"!==n.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,n.key,!n.error,this._loadedFileCount,this._totalFileCount)):"packfile"===n.type&&n.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount)))}var e=!1,i=this.enableParallel?Math.max(1,this.maxParallelDownloads):1;for(t=this._processingHead;t<this._fileList.length;t++){var n;if("packfile"===(n=this._fileList[t]).type&&!n.error&&n.loaded&&t===this._processingHead&&(this.processPack(n),this._loadedPackCount++,this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount)),n.loaded||n.error?t===this._processingHead&&(this._processingHead=t+1):!n.loading&&this._flightQueue.length<i&&("packfile"!==n.type||n.data?e||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(n),n.loading=!0,this.onFileStart.dispatch(this.progress,n.key,n.url),this.loadFile(n)):(this._flightQueue.push(n),n.loading=!0,this.loadFile(n))),!n.loaded&&n.syncPoint&&(e=!0),this._flightQueue.length>=i||e&&this._loadedPackCount===this._totalPackCount)break}if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var r=this;setTimeout(function(){r.finishedLoading(!0)},2e3)}},finishedLoading:function(t){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,t||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.reset(),this.onLoadComplete.dispatch(),this.game.state&&this.game.state.loadComplete())},asyncComplete:function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,e&&(t.errorMessage=e,console.warn("Phaser.Loader - "+t.type+"["+t.key+"]: "+e)),this.processLoadQueue()},processPack:function(t){var e=t.data[t.key];if(e)for(var i=0;i<e.length;i++){var n=e[i];switch(n.type){case"image":this.image(n.key,n.url,n.overwrite);break;case"text":this.text(n.key,n.url,n.overwrite);break;case"json":this.json(n.key,n.url,n.overwrite);break;case"xml":this.xml(n.key,n.url,n.overwrite);break;case"script":this.script(n.key,n.url,n.callback,t.callbackContext||this);break;case"binary":this.binary(n.key,n.url,n.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(n.key,n.url,n.frameWidth,n.frameHeight,n.frameMax,n.margin,n.spacing,n.skipFrames);break;case"video":this.video(n.key,n.urls);break;case"audio":this.audio(n.key,n.urls,n.autoDecode);break;case"audiosprite":this.audiosprite(n.key,n.urls,n.jsonURL,n.jsonData,n.autoDecode);break;case"tilemap":this.tilemap(n.key,n.url,n.data,r.Tilemap[n.format]);break;case"physics":this.physics(n.key,n.url,n.data,r.Loader[n.format]);break;case"bitmapFont":this.bitmapFont(n.key,n.textureURL,n.atlasURL,n.atlasData,n.xSpacing,n.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlasXML":this.atlasXML(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlas":this.atlas(n.key,n.textureURL,n.atlasURL,n.atlasData,r.Loader[n.format]);break;case"shader":this.shader(n.key,n.url,n.overwrite)}}else console.warn("Phaser.Loader - "+t.key+": pack has data, but not for pack key")},transformUrl:function(t,e){return!!t&&(t.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?t:this.baseURL+e.path+t)},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url),t.url?this.game.sound.usingWebAudio?this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(t):this.fileError(t,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":t.url=this.getVideoURL(t.url),t.url?t.asBlob?this.xhrLoad(t,this.transformUrl(t.url,t),"blob",this.fileComplete):this.loadVideoTag(t):this.fileError(t,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":t.format===r.Tilemap.TILED_JSON?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete):t.format===r.Tilemap.CSV?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete):this.asyncComplete(t,"invalid Tilemap format: "+t.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"texture":"truecolor"===t.key.split("_").pop()?this.loadImageTag(t):this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}},loadImageTag:function(t){var e=this;t.data=new Image,t.data.name=t.key,this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.onload=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileComplete(t))},t.data.onerror=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileError(t))},t.data.src=this.transformUrl(t.url,t),!this.game.device.firefox&&t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,this.fileComplete(t))},loadVideoTag:function(t){var e=this;t.data=document.createElement("video"),t.data.name=t.key,t.data.controls=!1,t.data.autoplay=!1;var i=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!0,r.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!1,e.fileError(t)},t.data.addEventListener(t.loadEvent,i,!1),t.data.src=this.transformUrl(t.url,t),t.data.load()},loadAudioTag:function(t){var e=this;if(this.game.sound.touchLocked)t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),this.fileComplete(t);else{t.data=new Audio,t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.onerror=null,e.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.onerror=null,e.fileError(t)},t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",i,!1),t.data.load()}},xhrLoad:function(t,e,i,n,r){if(this.useXDomainRequest&&window.XDomainRequest)this.xhrLoadWithXDR(t,e,i,n,r);else{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=i,!1!==this.headers.requestedWith&&o.setRequestHeader("X-Requested-With",this.headers.requestedWith),this.headers[t.type]&&o.setRequestHeader("Accept",this.headers[t.type]),r=r||this.fileError;var s=this;o.onload=function(){try{return 4===o.readyState&&o.status>=400&&o.status<=599?r.call(s,t,o):n.call(s,t,o)}catch(e){s.hasLoaded?window.console&&console.error(e):s.asyncComplete(t,e.message||"Exception")}},o.onerror=function(){try{return r.call(s,t,o)}catch(e){s.hasLoaded?window.console&&console.error(e):s.asyncComplete(t,e.message||"Exception")}},t.requestObject=o,t.requestUrl=e,o.send()}},xhrLoadWithXDR:function(t,e,i,n,r){this._warnedAboutXDomainRequest||this.game.device.ie&&!(this.game.device.ieVersion>=10)||(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var o=new window.XDomainRequest;o.open("GET",e,!0),o.responseType=i,o.timeout=3e3,r=r||this.fileError;var s=this;o.onerror=function(){try{return r.call(s,t,o)}catch(e){s.asyncComplete(t,e.message||"Exception")}},o.ontimeout=function(){try{return r.call(s,t,o)}catch(e){s.asyncComplete(t,e.message||"Exception")}},o.onprogress=function(){},o.onload=function(){try{return 4===o.readyState&&o.status>=400&&o.status<=599?r.call(s,t,o):n.call(s,t,o)}catch(e){s.asyncComplete(t,e.message||"Exception")}},t.requestObject=o,t.requestUrl=e,setTimeout(function(){o.send()},0)},getVideoURL:function(t){for(var e=0;e<t.length;e++){var i,n=t[e];if(n.uri){if(i=n.type,n=n.uri,this.game.device.canPlayVideo(i))return n}else{if(0===n.indexOf("blob:")||0===n.indexOf("data:"))return n;n.indexOf("?")>=0&&(n=n.substr(0,n.indexOf("?")));if(i=n.substr((Math.max(0,n.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayVideo(i))return t[e]}}return null},getAudioURL:function(t){if(this.game.sound.noAudio)return null;for(var e=0;e<t.length;e++){var i,n=t[e];if(n.uri){if(i=n.type,n=n.uri,this.game.device.canPlayAudio(i))return n}else{if(0===n.indexOf("blob:")||0===n.indexOf("data:"))return n;n.indexOf("?")>=0&&(n=n.substr(0,n.indexOf("?")));if(i=n.substr((Math.max(0,n.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayAudio(i))return t[e]}}return null},fileError:function(t,e,i){var n="error loading asset from URL "+(t.requestUrl||this.transformUrl(t.url,t));!i&&e&&(i=e.status),i&&(n=n+" ("+i+")"),this.asyncComplete(t,n)},fileComplete:function(t,e){var i=!0;switch(t.type){case"packfile":var n=JSON.parse(e.responseText);t.data=n||{};break;case"texture":var o=/\.([^.]+)$/.exec(t.url.split("?",1)[0])[1].toLowerCase();null!==t.data?this.cache.addCompressedTextureMetaData(t.key,t.url,o,t.data):this.cache.addCompressedTextureMetaData(t.key,t.url,o,e.response);break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing,t.skipFrames);break;case"textureatlas":if(null==t.atlasURL)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(i=!1,t.format===r.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format===r.Loader.TEXTURE_ATLAS_JSON_HASH||t.format===r.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else{if(t.format!==r.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}break;case"bitmapfont":t.atlasURL?(i=!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}i?(t.atlasType="json",this.jsonLoadComplete(t,e)):(t.atlasType="xml",this.xmlLoadComplete(t,e))})):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=e.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=e.responseText,this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText,this.cache.addShader(t.key,t.url,t.data);break;case"physics":n=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,n,t.format);break;case"script":t.data=document.createElement("script"),t.data.language="javascript",t.data.type="text/javascript",t.data.defer=!1,t.data.text=e.responseText,document.head.appendChild(t.data),t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,e.responseText));break;case"binary":t.callback?t.data=t.callback.call(t.callbackContext,t.key,e.response):t.data=e.response,this.cache.addBinary(t.key,t.data)}i&&this.asyncComplete(t)},jsonLoadComplete:function(t,e){var i=JSON.parse(e.responseText);"tilemap"===t.type?this.cache.addTilemap(t.key,t.url,i,t.format):"bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,i,t.atlasType,t.xSpacing,t.ySpacing):"json"===t.type?this.cache.addJSON(t.key,t.url,i):this.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format),this.asyncComplete(t)},csvLoadComplete:function(t,e){var i=e.responseText;this.cache.addTilemap(t.key,t.url,i,t.format),this.asyncComplete(t)},xmlLoadComplete:function(t,e){var i=e.responseText,n=this.parseXml(i);if(!n){var r=e.responseType||e.contentType;return console.warn("Phaser.Loader - "+t.key+": invalid XML ("+r+")"),void this.asyncComplete(t,"invalid XML")}"bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,n,t.atlasType,t.xSpacing,t.ySpacing):"textureatlas"===t.type?this.cache.addTextureAtlas(t.key,t.url,t.data,n,t.format):"xml"===t.type&&this.cache.addXML(t.key,t.url,n),this.asyncComplete(t)},parseXml:function(t){var e;try{if(window.DOMParser){e=(new DOMParser).parseFromString(t,"text/xml")}else(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)}catch(t){e=null}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(r.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return r.Math.clamp(t||0,0,100)}}),Object.defineProperty(r.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),r.Loader.prototype.constructor=r.Loader,r.LoaderParser={bitmapFont:function(t,e,i,n,r,o){return this.xmlBitmapFont(t,e,i,n,r,o)},xmlBitmapFont:function(t,e,i,n,r,o){null==o&&(o=1);var s={},a=t.getElementsByTagName("info")[0],h=t.getElementsByTagName("common")[0];s.font=a.getAttribute("face"),s.size=parseInt(a.getAttribute("size"),10),s.lineHeight=parseInt(h.getAttribute("lineHeight"),10)+n,s.chars={};for(var u=t.getElementsByTagName("char"),c=r?r.x:0,l=r?r.y:0,d=0;d<u.length;d++){var p=parseInt(u[d].getAttribute("id"),10);s.chars[p]={x:c+parseInt(u[d].getAttribute("x"),10),y:l+parseInt(u[d].getAttribute("y"),10),width:parseInt(u[d].getAttribute("width"),10),height:parseInt(u[d].getAttribute("height"),10),xOffset:parseInt(u[d].getAttribute("xoffset"),10)/o,yOffset:parseInt(u[d].getAttribute("yoffset"),10)/o,xAdvance:(parseInt(u[d].getAttribute("xadvance"),10)+i)/o,kerning:{}}}var f=t.getElementsByTagName("kerning");for(d=0;d<f.length;d++){var m=parseInt(f[d].getAttribute("first"),10),g=parseInt(f[d].getAttribute("second"),10),y=parseInt(f[d].getAttribute("amount"),10)/o;s.chars[g].kerning[m]=y}return this.finalizeBitmapFont(e,s)},jsonBitmapFont:function(t,e,i,n,r,o){null==o&&(o=1);var s={font:t.font.info._face,size:parseInt(t.font.info._size,10),lineHeight:parseInt(t.font.common._lineHeight,10)+n,chars:{}},a=r?r.x:0,h=r?r.y:0;return t.font.chars.char.forEach(function(t){var e=parseInt(t._id,10);s.chars[e]={x:a+parseInt(t._x,10),y:h+parseInt(t._y,10),width:parseInt(t._width,10),height:parseInt(t._height,10),xOffset:parseInt(t._xoffset,10)/o,yOffset:parseInt(t._yoffset,10)/o,xAdvance:(parseInt(t._xadvance,10)+i)/o,kerning:{}}}),t.font.kernings&&t.font.kernings.kerning&&t.font.kernings.kerning.forEach(function(t){s.chars[t._second].kerning[t._first]=parseInt(t._amount,10)/o}),this.finalizeBitmapFont(e,s)},finalizeBitmapFont:function(t,e){return Object.keys(e.chars).forEach(function(i){var n=e.chars[i];n.texture=new PIXI.Texture(t,new r.Rectangle(n.x,n.y,n.width,n.height))}),e},pvr:function(t){var e,i=new Uint32Array(t.slice(0,52)),n=new Uint8Array(t),r=null,o=i[3]<<32|i[2],s=0;if(55727696===i[0]&&[0,1,2,3,6,7,9,11].indexOf(o)>=0){switch(o>=0&&o<=3?e="PVRTC":o>=7&&o<=11?e="S3TC":6===o&&(e="ETC1"),o){case 0:s=35841;break;case 1:s=35843;break;case 2:s=35840;break;case 3:s=35842;break;case 6:s=36196;break;case 7:s=33777;break;case 9:s=33778;break;case 11:s=33779;break;default:s=-1}r={complete:!0,fileFormat:"PVR",compressionAlgorithm:e,flags:i[1],pixelFormat:o,colorSpace:i[4],channelType:i[5],height:i[6],width:i[7],depth:i[8],numberOfSurfaces:i[9],numberOfFaces:i[10],numberOfMipmaps:i[11],metaDataSize:i[12],textureData:n.subarray(52+i[12],n.byteLength),glExtensionFormat:s}}return r},dds:function(t){var e=new Uint8Array(t),i=new Uint32Array(t),n=null;return 68===e[0]&&68===e[1]&&83===e[2]&&32===e[3]&&"DX10"===(n={complete:!0,fileFormat:"DDS",compressionAlgorithm:"S3TC",size:i[1],flags:i[2],height:i[3],width:i[4],pitch:i[5],depth:i[6],mipmapCount:i[7],formatSize:i[19],formatFlag:i[19],formatFourCC:[String.fromCharCode(e[84]),String.fromCharCode(e[85]),String.fromCharCode(e[86]),String.fromCharCode(e[87])].join(""),formatBitCount:i[21],formatRBitMask:i[22],formatGBitMask:i[23],formatBBitMask:i[24],formatABitMask:i[25],caps1:i[26],caps2:i[27],caps3:i[28],caps4:i[29],reserved2:i[30],DXGIFormat:null,resourceDimension:null,miscFlag:null,arraySize:null,textureData:e.subarray(i[1]+4,e.byteLength)}).formatFourCC&&(n.DXGIFormat=i[31],n.resourceDimension=i[32],n.miscFlag=i[33],n.arraySize=i[34],n.miscFlag=i[35]),n},ktx:function(t){var e=new Uint8Array(t),i=new Uint32Array(t),n=null,r=16+i[15]/4|0,o=i[r],s=i[7],a=0;if(171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&49===e[5]&&49===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]&&[36196,35840,35841,35842,35843,33776,33777,33778,33779].indexOf(s)>=0){switch(s){case 36196:a="ETC1";break;case 35840:case 35841:case 35842:case 35843:a="PVRTC";break;case 33776:case 33777:case 33778:case 33779:a="S3TC"}n={complete:!0,fileFormat:"KTX",compressionAlgorithm:a,endianness:i[3],glType:i[4],glTypeSize:i[5],glFormat:i[6],glInternalFormat:i[7],glBaseInternalFormat:i[8],width:i[9],height:i[10],pixelDepth:i[11],numberOfArrayElements:i[12],numberOfFaces:i[13],numberOfMipmapLevels:i[14],bytesOfKeyValueData:i[15],keyAndValueByteSize:i[16],imageSize:o,textureData:e.subarray(4*(r+1),o+100)}}return n},pkm:function(t){var e=new Uint8Array(t),i=null;return 80===e[0]&&75===e[1]&&77===e[2]&&32===e[3]&&(i={complete:!0,fileFormat:"PKM",compressionAlgorithm:"ETC1",format:65535&(e[6]<<8|e[7]),width:65535&(e[8]<<8|e[9]),height:65535&(e[10]<<8|e[11]),originalWidth:65535&(e[12]<<8|e[13]),originalHeight:65535&(e[14]<<8|e[15]),textureData:e.subarray(16,e.length)}),i}},r.AudioSprite=function(t,e){this.game=t,this.key=e,this.config=this.game.cache.getJSON(e+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={};for(var i in this.config.spritemap){var n=this.config.spritemap[i],r=this.game.add.sound(this.key);r.addMarker(i,n.start,n.end-n.start,null,n.loop),this.sounds[i]=r}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},r.AudioSprite.prototype={play:function(t,e){return void 0===e&&(e=1),this.sounds[t].play(t,null,e)},stop:function(t){if(t)this.sounds[t].stop();else for(var e in this.sounds)this.sounds[e].stop()},get:function(t){return this.sounds[t]}},r.AudioSprite.prototype.constructor=r.AudioSprite,r.Sound=function(t,e,i,n,o){void 0===i&&(i=1),void 0===n&&(n=!1),void 0===o&&(o=t.sound.connectToMaster),this.game=t,this.name=e,this.key=e,this.loop=n,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this._globalVolume=1,this._markedToDelete=!1,this._removeFromSoundManager=!1,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,void 0===this.context.createGain?this.gainNode=this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=i*this.game.sound.volume,o&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(e)&&this.game.cache.isSoundReady(e)?(this._sound=this.game.cache.getSoundData(e),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new r.Signal,this.onPlay=new r.Signal,this.onPause=new r.Signal,this.onResume=new r.Signal,this.onLoop=new r.Signal,this.onStop=new r.Signal,this.onMute=new r.Signal,this.onMarkerComplete=new r.Signal,this.onFadeComplete=new r.Signal,this._volume=i,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempPause=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},r.Sound.prototype={soundHasUnlocked:function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(t,e,i,n,r){void 0!==i&&null!==i||(i=1),void 0!==n&&null!==n||(n=1),void 0===r&&(r=!1),this.markers[t]={name:t,start:e,stop:e+i,volume:n,duration:i,durationMS:1e3*i,loop:r}},removeMarker:function(t){delete this.markers[t]},onEndedHandler:function(){this._sound.onended=null,this.isPlaying=!1,this.currentTime=this.durationMS,this.stop(),this._markedToDelete&&(this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode),this._removeFromSoundManager?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose()))},update:function(){this.game.cache.checkSoundKey(this.key)?(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=this.game.time.time),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))):this.destroy()},loopFull:function(t){return this.play(null,0,t,!0)},play:function(t,e,i,n,r){if(void 0!==t&&!1!==t&&null!==t||(t=""),void 0===r&&(r=!0),this.isPlaying&&!this.allowMultiple&&!r&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||r)){if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1}if(""===t&&Object.keys(this.markers).length>0)return this;if(""!==t){if(!this.markers[t])return console.warn("Phaser.Sound.play: audio marker "+t+" doesn't exist"),this;this.currentMarker=t,this.position=this.markers[t].start,this.volume=this.markers[t].volume,this.loop=this.markers[t].loop,this.duration=this.markers[t].duration,this.durationMS=this.markers[t].durationMS,"undefined"!=typeof i&&(this.volume=i),"undefined"!=typeof n&&(this.loop=n),this._tempMarker=t,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else e=e||0,void 0===i&&(i=this._volume),void 0===n&&(n=this.loop),this.position=Math.max(0,e),this.volume=i,this.loop=n,this.duration=0,this.durationMS=0,this._tempMarker=t,this._tempPosition=e,this._tempVolume=i,this._tempLoop=n;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._sound=this.context.createBufferSource(),this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),this._sound.buffer=this._buffer,this.loop&&""===t&&(this._sound.loop=!0),this.loop||""!==t||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===t?this._sound.start(0,0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted||this.game.sound.mute?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(t,e,i,n){t=t||"",e=e||0,i=i||1,void 0===n&&(n=!1),this.play(t,e,i,n,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=Math.max(0,this.position+this.pausedPosition/1e3);this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var e=this.duration-this.pausedPosition/1e3;void 0===this._sound.start?this._sound.noteGrainOn(0,t,e):this.loop&&this.game.device.chrome?42===this.game.device.chromeVersion?this._sound.start(0):this._sound.start(0,t):this._sound.start(0,t,e)}else this._sound.currentTime=this._tempPause,this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var t=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,t)}},fadeIn:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=this.currentMarker),this.paused||(this.play(i,0,0,e),this.fadeTo(t,1))},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,e){this.isPlaying&&!this.paused&&e!==this.volume&&(void 0===t&&(t=1e3),void 0!==e?(this.fadeTween=this.game.add.tween(this).to({volume:e},t,r.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this)):console.warn("Phaser.Sound.fadeTo: No Volume Specified."))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},updateGlobalVolume:function(t){this.usingAudioTag&&this._sound&&(this._globalVolume=t,this._sound.volume=this._globalVolume*this._volume)},destroy:function(t){void 0===t&&(t=!0),this._markedToDelete=!0,this._removeFromSoundManager=t,this.stop(),t?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},r.Sound.prototype.constructor=r.Sound,Object.defineProperty(r.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(r.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(r.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){(t=t||!1)!==this._muted&&(t?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}}),Object.defineProperty(r.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){this.usingAudioTag&&(t=this.game.math.clamp(t,0,1)),this._muted?this._muteVolume=t:(this._tempVolume=t,this._volume=t,this.usingWebAudio?this.gainNode.gain.value=t:this.usingAudioTag&&this._sound&&(this._sound.volume=this._globalVolume*t))}}),r.SoundManager=function(t){this.game=t,this.onSoundDecode=new r.Signal,this.onVolumeChange=new r.Signal,this.onMute=new r.Signal,this.onUnMute=new r.Signal,this.context=null,this.usingWebAudio=!1,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32,this.muteOnPause=!0,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new r.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null},r.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.noAudio=!0,void(this.touchLocked=!1);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingAudioTag=!0,void(this.touchLocked=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}if(null===this.context){if(void 0===window.Audio)return void(this.noAudio=!0);this.usingAudioTag=!0}else this.usingWebAudio=!0,void 0===this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this._setGain(1),this.masterGain.connect(this.context.destination);this.noAudio||this.game.device.needsTouchUnlock()&&this.setTouchLock()},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableAudio||(this.game.input.addTouchLockCallback(this.unlock,this,!0),this.touchLocked=!0)},unlock:function(){if(this.noAudio||!this.touchLocked||null!==this._unlockSource)return!0;if(this.usingAudioTag)this.touchLocked=!1,this._unlockSource=null;else if(this.usingWebAudio){var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0),"suspended"===this._unlockSource.context.state&&this._unlockSource.context.resume()}return!0},stopAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].stop()},pauseAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].pause()},resumeAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].resume()},decode:function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i&&!1===this.game.cache.isSoundDecoded(t)){this.game.cache.updateSound(t,"isDecoding",!0);var n=this;try{this.context.decodeAudioData(i,function(i){i&&(n.game.cache.decodedSound(t,i),n.onSoundDecode.dispatch(t,e))})}catch(t){}}},setDecodedCallback:function(t,e,i){"string"==typeof t&&(t=[t]),this._watchList.reset();for(var n=0;n<t.length;n++)t[n]instanceof r.Sound?this.game.cache.isSoundDecoded(t[n].key)||this._watchList.add(t[n].key):this.game.cache.isSoundDecoded(t[n])||this._watchList.add(t[n]);0===this._watchList.total?(this._watching=!1,e.call(i)):(this._watching=!0,this._watchCallback=e,this._watchContext=i)},update:function(){if(!this.noAudio){!this.touchLocked||null===this._unlockSource||this._unlockSource.playbackState!==this._unlockSource.PLAYING_STATE&&this._unlockSource.playbackState!==this._unlockSource.FINISHED_STATE||(this.touchLocked=!1,this._unlockSource=null);for(var t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(var e=this._watchList.first;e;)this.game.cache.isSoundDecoded(e)&&this._watchList.remove(e),e=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=!1),void 0===n&&(n=this.connectToMaster);var o=new r.Sound(this.game,t,e,i,n);return this._sounds.push(o),o},addSprite:function(t){return new r.AudioSprite(this.game,t)},remove:function(t){for(var e=this._sounds.length;e--;)if(this._sounds[e]===t)return this._sounds[e].destroy(!1),this._sounds.splice(e,1),!0;return!1},removeByKey:function(t){for(var e=this._sounds.length,i=0;e--;)this._sounds[e].key===t&&(this._sounds[e].destroy(!1),this._sounds.splice(e,1),i++);return i},play:function(t,e,i){if(!this.noAudio){var n=this.add(t,e,i);return n.play(),n}},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this._setGain(0));for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&this._setGain(this._muteVolume);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].destroy();this._sounds=[],this.onSoundDecode.dispose(),this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())},_setGain:function(t){this.masterGain.gain.setTargetAtTime(t,0,.01)}},r.SoundManager.prototype.constructor=r.SoundManager,Object.defineProperty(r.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){if(t=t||!1){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(r.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0?t=0:t>1&&(t=1),this._volume!==t){if(this._volume=t,this.usingWebAudio)this._setGain(t);else for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&this._sounds[e].updateGlobalVolume(t);this.onVolumeChange.dispatch(t)}}}),r.ScaleManager=function(t,e,i){this.game=t,this.dom=r.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new r.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.onOrientationChange=new r.Signal,this.enterIncorrectOrientation=new r.Signal,this.leaveIncorrectOrientation=new r.Signal,this.hasPhaserSetFullScreen=!1,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new r.Signal,this.onFullScreenChange=new r.Signal,this.onFullScreenError=new r.Signal,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new r.Point(1,1),this.scaleFactorInversed=new r.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new r.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=r.ScaleManager.NO_SCALE,this._fullScreenScaleMode=r.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new r.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new r.Signal,this.onResize=null,this.onResizeContext=null,this._pendingScaleMode=null,this._fullScreenRestore=null,this._gameSize=new r.Rectangle,this._userScaleFactor=new r.Point(1,1),this._userScaleTrim=new r.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new r.Rectangle,this._tempBounds=new r.Rectangle,this._lastReportedCanvasSize=new r.Rectangle,this._lastReportedGameSize=new r.Rectangle,this._booted=!1,t.config&&this.parseConfig(t.config),this.setupScale(e,i)},r.ScaleManager.EXACT_FIT=0,r.ScaleManager.NO_SCALE=1,r.ScaleManager.SHOW_ALL=2,r.ScaleManager.RESIZE=3,r.ScaleManager.USER_SCALE=4,r.ScaleManager.prototype={boot:function(){var t=this.compatibility;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?t.scrollTo=new r.Point(0,1):t.scrollTo=new r.Point(0,0)),this.game.device.desktop?(t.orientationFallback="screen",t.clickTrampoline="when-not-mouse"):(t.orientationFallback="",t.clickTrampoline="");var e=this;this._orientationChange=function(t){return e.orientationChange(t)},this._windowResize=function(t){return e.windowResize(t)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(t){return e.fullScreenChange(t)},this._fullScreenError=function(t){return e.fullScreenError(t)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),r.FlexGrid&&(this.grid=new r.FlexGrid(this,this.width,this.height)),this._booted=!0,null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(t){void 0!==t.scaleMode&&(this._booted?this.scaleMode=t.scaleMode:this._pendingScaleMode=t.scaleMode),void 0!==t.fullScreenScaleMode&&(this.fullScreenScaleMode=t.fullScreenScaleMode),t.fullScreenTarget&&(this.fullScreenTarget=t.fullScreenTarget)},setupScale:function(t,e){var i,n=new r.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?i=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(i=this.game.parent)),i?(this.parentNode=i,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),n.width=this._parentBounds.width,n.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,n.width=this.dom.visualBounds.width,n.height=this.dom.visualBounds.height,this.offset.set(0,0));var o=0,s=0;"number"==typeof t?o=t:(this.parentScaleFactor.x=parseInt(t,10)/100,o=n.width*this.parentScaleFactor.x),"number"==typeof e?s=e:(this.parentScaleFactor.y=parseInt(e,10)/100,s=n.height*this.parentScaleFactor.y),o=Math.floor(o),s=Math.floor(s),this._gameSize.setTo(0,0,o,s),this.updateDimensions(o,s,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(t,e){this._gameSize.setTo(0,0,t,e),this.currentScaleMode!==r.ScaleManager.RESIZE&&this.updateDimensions(t,e,!0),this.queueUpdate(!0)},setUserScale:function(t,e,i,n,r,o){this._userScaleFactor.setTo(t,e),this._userScaleTrim.setTo(0|i,0|n),void 0===r&&(r=!0),void 0===o&&(o=!0),r&&this.queueUpdate(o)},setResizeCallback:function(t,e){this.onResize=t,this.onResizeContext=e},signalSizeChange:function(){if(!r.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!r.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var t=this.width,e=this.height;this._lastReportedCanvasSize.setTo(0,0,t,e),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid&&this.grid.onResize(t,e),this.onSizeChange.dispatch(this,t,e),this.currentScaleMode===r.ScaleManager.RESIZE&&(this.game.state.resize(t,e),this.game.load.resize(t,e))}},setMinMax:function(t,e,i,n){this.minWidth=t,this.minHeight=e,"undefined"!=typeof i&&(this.maxWidth=i),"undefined"!=typeof n&&(this.maxHeight=n)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var t=this._updateThrottle;this._updateThrottleReset=t>=400?0:100,this.dom.getOffset(this.game.canvas,this.offset);var e=this._parentBounds.width,i=this._parentBounds.height,n=this.getParentBounds(this._parentBounds),o=n.width!==e||n.height!==i,s=this.updateOrientationState();(o||s)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,n),this.updateLayout(),this.signalSizeChange());var a=2*this._updateThrottle;this._updateThrottle<t&&(a=Math.min(t,this._updateThrottleReset)),this._updateThrottle=r.Math.clamp(a,25,this.trackParentInterval),this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x,this.height=e*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(t,e){void 0===e&&(e=!1),!0!==t||!0!==e?(this.forceLandscape=t,this.forcePortrait=e,this.queueUpdate(!0)):console.warn("Phaser.ScaleManager: forceLandscape and forcePortrait cannot both be true.")},classifyOrientation:function(t){return"portrait-primary"===t||"portrait-secondary"===t?"portrait":"landscape-primary"===t||"landscape-secondary"===t?"landscape":null},updateOrientationState:function(){var t=this.screenOrientation,e=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var i=t!==this.screenOrientation,n=e!==this.incorrectOrientation;return n&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(i||n)&&this.onOrientationChange.dispatch(this,t,e),i||n},orientationChange:function(t){this.event=t,this.queueUpdate(!0)},windowResize:function(t){this.event=t,this.queueUpdate(!0)},scrollTop:function(){var t=this.compatibility.scrollTo;t&&window.scrollTo(t.x,t.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var t=this.currentScaleMode;if(t!==r.ScaleManager.RESIZE){if(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():t===r.ScaleManager.EXACT_FIT?this.setExactFit():t===r.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():t===r.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):t===r.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),!this.compatibility.canExpandParent&&(t===r.ScaleManager.SHOW_ALL||t===r.ScaleManager.USER_SCALE)){var e=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,e.width),this.height=Math.min(this.height,e.height)}this.width=0|this.width,this.height=0|this.height,this.reflowCanvas()}else this.reflowGame()},getParentBounds:function(t){var e=t||new r.Rectangle,i=this.boundingParent,n=this.dom.visualBounds,o=this.dom.layoutBounds;if(i){var s=i.getBoundingClientRect(),a=i.offsetParent?i.offsetParent.getBoundingClientRect():i.getBoundingClientRect();e.setTo(s.left-a.left,s.top-a.top,s.width,s.height);var h=this.windowConstraints;if(h.right){var u="layout"===h.right?o:n;e.right=Math.min(e.right,u.width)}if(h.bottom){u="layout"===h.bottom?o:n;e.bottom=Math.min(e.bottom,u.height)}}else e.setTo(0,0,n.width,n.height);return e.setTo(Math.round(e.x),Math.round(e.y),Math.round(e.width),Math.round(e.height)),e},align:function(t,e){null!=t&&(this.pageAlignHorizontally=t),null!=e&&(this.pageAlignVertically=e)},alignCanvas:function(t,e){var i=this.getParentBounds(this._tempBounds),n=this.game.canvas,r=this.margin;if(t){r.left=r.right=0;var o=n.getBoundingClientRect();if(this.width<i.width&&!this.incorrectOrientation){var s=o.left-i.x,a=i.width/2-this.width/2,h=(a=Math.max(a,0))-s;r.left=Math.round(h)}n.style.marginLeft=r.left+"px",0!==r.left&&(r.right=-(i.width-o.width-r.left),n.style.marginRight=r.right+"px")}if(e){r.top=r.bottom=0;o=n.getBoundingClientRect();if(this.height<i.height&&!this.incorrectOrientation){s=o.top-i.y,a=i.height/2-this.height/2,h=(a=Math.max(a,0))-s;r.top=Math.round(h)}n.style.marginTop=r.top+"px",0!==r.top&&(r.bottom=-(i.height-o.height-r.top),n.style.marginBottom=r.bottom+"px")}r.x=r.left,r.y=r.top},reflowGame:function(){this.resetCanvas("","");var t=this.getParentBounds(this._tempBounds);this.updateDimensions(t.width,t.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=r.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=r.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(t,e){void 0===t&&(t=this.width+"px"),void 0===e&&(e=this.height+"px");var i=this.game.canvas;this.compatibility.noMargins||(i.style.marginLeft="",i.style.marginTop="",i.style.marginRight="",i.style.marginBottom=""),i.style.width=t,i.style.height=e},queueUpdate:function(t){t&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(t){t&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(t){var e,i=this.getParentBounds(this._tempBounds),n=i.width,r=i.height;e=t?Math.max(r/this.game.height,n/this.game.width):Math.min(r/this.game.height,n/this.game.width),this.width=Math.round(this.game.width*e),this.height=Math.round(this.game.height*e)},setExactFit:function(){var t=this.getParentBounds(this._tempBounds);this.width=t.width,this.height=t.height,this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var t=document.createElement("div");return t.style.margin="0",t.style.padding="0",t.style.background="#000",t},startFullScreen:function(t,e){if(this.isFullScreen)return!1;if(this.compatibility.supportsFullScreen){if("when-not-mouse"===this.compatibility.clickTrampoline){var i=this.game.input;if(i.activePointer&&i.activePointer!==i.mousePointer&&(e||!1!==e))return void i.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,!1])}void 0!==t&&this.game.renderType===r.CANVAS&&(this.game.stage.smoothed=t);var n=this.fullScreenTarget;n||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),n=this._createdFullScreenTarget);var o={targetElement:n};if(this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,o),this._createdFullScreenTarget){var s=this.game.canvas;s.parentNode.insertBefore(n,s),n.appendChild(s)}return this.game.device.fullscreenKeyboard?n[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):n[this.game.device.requestFullscreen](),!0}var a=this;setTimeout(function(){a.fullScreenError()},10)},stopFullScreen:function(){return!(!this.isFullScreen||!this.compatibility.supportsFullScreen)&&(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),!0)},cleanupCreatedTarget:function(){var t=this._createdFullScreenTarget;if(t&&t.parentNode){var e=t.parentNode;e.insertBefore(this.game.canvas,t),e.removeChild(t)}this._createdFullScreenTarget=null},prepScreenMode:function(t){var e=!!this._createdFullScreenTarget,i=this._createdFullScreenTarget||this.fullScreenTarget;t?(e||this.fullScreenScaleMode===r.ScaleManager.EXACT_FIT)&&i!==this.game.canvas&&(this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height},i.style.width="100%",i.style.height="100%"):(this._fullScreenRestore&&(i.style.width=this._fullScreenRestore.targetWidth,i.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(t){this.event=t,this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0)),this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(t){this.event=t,this.cleanupCreatedTarget(),console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API"),this.onFullScreenError.dispatch(this)},scaleSprite:function(t,e,i,n){if(void 0===e&&(e=this.width),void 0===i&&(i=this.height),void 0===n&&(n=!1),!t||!t.scale)return t;if(t.scale.x=1,t.scale.y=1,t.width<=0||t.height<=0||e<=0||i<=0)return t;var r=e,o=t.height*e/t.width,s=t.width*i/t.height,a=i,h=s>e;return(h=h?n:!n)?(t.width=Math.floor(r),t.height=Math.floor(o)):(t.width=Math.floor(s),t.height=Math.floor(a)),t},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},r.ScaleManager.prototype.constructor=r.ScaleManager,Object.defineProperty(r.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)return null;return this.game.canvas&&this.game.canvas.parentNode||null}}),Object.defineProperty(r.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){return t!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=t),this._scaleMode}}),Object.defineProperty(r.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(t){return t!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=t,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=t),this._fullScreenScaleMode}}),Object.defineProperty(r.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(r.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(t){t!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=t,this.queueUpdate(!0))}}),Object.defineProperty(r.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(t){t!==this._pageAlignVertically&&(this._pageAlignVertically=t,this.queueUpdate(!0))}}),Object.defineProperty(r.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(r.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(r.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(r.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(r.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),r.Utils.Debug=function(t){this.game=t,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.lineWidth=1,this.renderShadow=!0,this.currentColor=null,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1,this.isDisabled=!1,this._line=null,this._rect=null},r.Utils.Debug.prototype={boot:function(){this.game.renderType===r.CANVAS?this.context=this.game.context:(this.bmd=new r.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=r.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d")),this._line=new r.Line,this._rect=new r.Rectangle},resize:function(){this.bmd.resize(this.game.width,this.game.height),this.canvas.width=this.game.width,this.canvas.height=this.game.height},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(t,e,i,n){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),i=i||"rgb(255,255,255)",void 0===n&&(n=0),this.currentX=t,this.currentY=e,this.currentColor=i,this.columnWidth=n,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=i,this.context.fillStyle=i,this.context.font=this.font,this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var t=this.currentX,e=0;e<arguments.length;e++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[e],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[e],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback),this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding),this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying),this.line("Time: "+t.currentTime),this.line("Volume: "+t.volume+" Muted: "+t.mute),this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag),""!==t.currentMarker&&(this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")"),this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop),this.line("Position: "+t.position)),this.stop()},camera:function(t,e,i){var n=t.deadzone,r=t.target,o=t.view;n&&(this._rect.setTo(o.x+n.x,o.y+n.y,n.width,n.height),this.rectangle(this._rect,e,i)),r&&(this._line.setTo(o.centerX,o.centerY,r.x,r.y),this.geom(this._line,e,i),this.geom(r,e,!1,3))},cameraInfo:function(t,e,i,n){var r=t.bounds,o=t.deadzone,s=t.target,a=t.view;this.start(e,i,n),this.line("Camera ("+t.width+" x "+t.height+")"),this.line("x: "+t.x+" y: "+t.y),r&&this.line("Bounds x: "+r.x+" y: "+r.y+" w: "+r.width+" h: "+r.height),this.line("View x: "+a.x+" y: "+a.y+" w: "+a.width+" h: "+a.height),this.line("Deadzone: "+(o?"x: "+o.x+" y: "+o.y+" w: "+o.width+" h: "+o.height:o)),this.line("Total in view: "+t.totalInView),this.line("At limit: x: "+t.atLimit.x+" y: "+t.atLimit.y),this.line("Target: "+(s?s.name||s:s)),this.stop()},timer:function(t,e,i,n){this.start(e,i,n),this.line("Timer (running: "+t.running+" expired: "+t.expired+")"),this.line("Next Tick: "+t.next+" Duration: "+t.duration),this.line("Paused: "+t.paused+" Length: "+t.length),this.stop()},pointer:function(t,e,i,n,r){null!=t&&(void 0===e&&(e=!1),i=i||"rgba(0,255,0,0.5)",n=n||"rgba(255,0,0,0.5)",!0===e&&!0===t.isUp||(this.start(t.x,t.y-100,r),this.context.beginPath(),this.context.arc(t.x,t.y,t.circle.radius,0,2*Math.PI),t.active?this.context.fillStyle=i:this.context.fillStyle=n,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(t.positionDown.x,t.positionDown.y),this.context.lineTo(t.position.x,t.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+t.id+" Active: "+t.active),this.line("World X: "+t.worldX+" World Y: "+t.worldY),this.line("Screen X: "+t.x+" Screen Y: "+t.y+" In: "+t.withinGame),this.line("Duration: "+t.duration+" ms"),this.line("is Down: "+t.isDown+" is Up: "+t.isUp),this.stop()))},spriteInputInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite Input: ("+t.width+" x "+t.height+")"),this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1)),this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0)),this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0)),this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut()),this.stop()},key:function(t,e,i,n){this.start(e,i,n,150),this.line("Key:",t.keyCode,"isDown:",t.isDown),this.line("justDown:",t.justDown,"justUp:",t.justUp),this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0)),this.stop()},inputInfo:function(t,e,i){this.start(t,e,i),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(t,e,i){var n=t.getBounds();n.x+=this.game.camera.x,n.y+=this.game.camera.y,this.rectangle(n,e,i)},ropeSegments:function(t,e,i){var n=this;t.segments.forEach(function(t){n.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite:  ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y),this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1)),this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1)),this.line("visible: "+t.visible+" in camera: "+t.inCamera),this.line("bounds x: "+t._bounds.x.toFixed(1)+" y: "+t._bounds.y.toFixed(1)+" w: "+t._bounds.width.toFixed(1)+" h: "+t._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(t,e,i,n){this.start(e,i,n,100),t.name&&this.line(t.name),this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2)),this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2)),this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2)),this.stop()},lineInfo:function(t,e,i,n){this.start(e,i,n,80),this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2)),this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2)),this.line("length:",t.length.toFixed(2),"angle:",t.angle),this.stop()},pixel:function(t,e,i,n){n=n||2,this.start(),this.context.fillStyle=i,this.context.fillRect(t,e,n,n),this.stop()},geom:function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=0),e=e||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=e,this.context.strokeStyle=e,this.context.lineWidth=this.lineWidth,t instanceof r.Rectangle||1===n?i?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):t instanceof r.Circle||2===n?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,2*Math.PI,!1),this.context.closePath(),i?this.context.fill():this.context.stroke()):t instanceof r.Point||3===n?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):t instanceof r.Line||4===n?(this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()):(t instanceof r.Ellipse||5===n)&&(this.context.beginPath(),this.context.ellipse(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width/2,t.height/2,0,2*Math.PI,!1),this.context.closePath(),i?this.context.fill():this.context.stroke()),this.stop()},rectangle:function(t,e,i){void 0===i&&(i=!0),e=e||"rgba(0, 255, 0, 0.4)",this.start(),i?(this.context.fillStyle=e,this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)):(this.context.lineWidth=this.lineWidth,this.context.strokeStyle=e,this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)),this.stop()},text:function(t,e,i,n,r){n=n||"rgb(255,255,255)",r=r||"16px Courier",this.start(),this.context.font=r,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(t,e+1,i+1)),this.context.fillStyle=n,this.context.fillText(t,e,i),this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)",this.start();var i=t.bounds;if(0===t.nodes.length){this.context.strokeStyle=e,this.context.strokeRect(i.x,i.y,i.width,i.height),this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var n=0;n<t.objects.length;n++)this.context.strokeRect(t.objects[n].x,t.objects[n].y,t.objects[n].width,t.objects[n].height)}else for(n=0;n<t.nodes.length;n++)this.quadTree(t.nodes[n]);this.stop()},body:function(t,e,i){t.body&&(this.start(),t.body.type===r.Physics.ARCADE?r.Physics.Arcade.Body.render(this.context,t.body,e,i,this.lineWidth):t.body.type===r.Physics.NINJA?r.Physics.Ninja.Body.render(this.context,t.body,e,i):t.body.type===r.Physics.BOX2D&&r.Physics.Box2D.renderBody(this.context,t.body,e),this.stop())},bodyInfo:function(t,e,i,n){t.body&&(this.start(e,i,n,210),t.body.type===r.Physics.ARCADE?r.Physics.Arcade.Body.renderBodyInfo(this,t.body):t.body.type===r.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,t.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(t,e){this.start(),r.Physics.Box2D.renderBody(this.context,t,e),this.stop()},displayList:function(t){if(void 0===t&&(t=this.game.world),t.hasOwnProperty("renderOrderID")?console.log("["+t.renderOrderID+"]",t):console.log("[]",t),t.children&&t.children.length>0)for(var e=0;e<t.children.length;e++)this.game.debug.displayList(t.children[e])},renderer:function(t,e,i){var n=this.game.renderer,r=n.renderSession;if(this.start(t,e,i),this.line((n.gl?"WebGL":"Canvas")+" Renderer ("+n.width+" x "+n.height+")"),this.line("autoResize: "+n.autoResize),this.line("clearBeforeRender: "+n.clearBeforeRender),this.line("resolution: "+n.resolution),this.line("transparent: "+n.transparent),this.line("renderSession:"),n.gl){this.line("  currentBatchedTextures: ("+n.currentBatchedTextures.length+")");for(var o=0;o<n.currentBatchedTextures.length;o++)this.line("    "+n.currentBatchedTextures[o]);this.line("  drawCount: "+r.drawCount),this.line("  maxTextures: "+n.maxTextures),this.line("  maxTextureSize: "+n.maxTextureSize),this.line("  maxTextureAvailableSpace: "+r.maxTextureAvailableSpace),this.line("  roundPixels: "+r.roundPixels)}else this.line("  roundPixels: "+r.roundPixels),this.line("  scaleMode: "+(0===r.scaleMode?"LINEAR":1===r.scaleMode?"NEAREST":r.scaleMode));this.stop()},canvasPool:function(t,e,i,n){var o=r.CanvasPool;this.start(t,e,i,n||100),this.line("Canvas Pool"),this.line("Used:",o.getTotal()),this.line("Free:",o.getFree()),this.line("Total:",o.length),this.stop()},physicsGroup:function(t,e,i,n){t.forEach(this.body,this,n,e,i)},phaser:function(t,e,i){this.text("Phaser v"+r.VERSION+" "+(this.game.renderType===r.WEBGL?"WebGL":"Canvas")+" "+(this.game.device.webAudio?"WebAudio":"HTML Audio"),t,e,i,this.font)},destroy:function(){r.CanvasPool.remove(this)}},r.Utils.Debug.prototype.constructor=r.Utils.Debug,r.DOM={getOffset:function(t,e){e=e||new r.Point;var i=t.getBoundingClientRect(),n=r.DOM.scrollY,o=r.DOM.scrollX,s=document.documentElement.clientTop,a=document.documentElement.clientLeft;return e.x=i.left+o-a,e.y=i.top+n-s,e},getBounds:function(t,e){return void 0===e&&(e=0),!(!(t=t&&!t.nodeType?t[0]:t)||1!==t.nodeType)&&this.calibrate(t.getBoundingClientRect(),e)},calibrate:function(t,e){e=+e||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};return i.width=(i.right=t.right+e)-(i.left=t.left-e),i.height=(i.bottom=t.bottom+e)-(i.top=t.top-e),i},getAspectRatio:function(t){var e=(t=null==t?this.visualBounds:1===t.nodeType?this.getBounds(t):t).width,i=t.height;return"function"==typeof e&&(e=e.call(t)),"function"==typeof i&&(i=i.call(t)),e/i},inLayoutViewport:function(t,e){var i=this.getBounds(t,e);return!!i&&i.bottom>=0&&i.right>=0&&i.top<=this.layoutBounds.width&&i.left<=this.layoutBounds.height},getScreenOrientation:function(t){var e=window.screen,i=e.orientation||e.mozOrientation||e.msOrientation;if(i&&"string"==typeof i.type)return i.type;if("string"==typeof i)return i;var n="portrait-primary",r="landscape-primary";if("screen"===t)return e.height>e.width?n:r;if("viewport"===t)return this.visualBounds.height>this.visualBounds.width?n:r;if("window.orientation"===t&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?n:r;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return n;if(window.matchMedia("(orientation: landscape)").matches)return r}return this.visualBounds.height>this.visualBounds.width?n:r},visualBounds:new r.Rectangle,layoutBounds:new r.Rectangle,documentBounds:new r.Rectangle},r.Device.whenReady(function(t){var e=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},i=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(r.DOM,"scrollX",{get:e}),Object.defineProperty(r.DOM,"scrollY",{get:i}),Object.defineProperty(r.DOM.visualBounds,"x",{get:e}),Object.defineProperty(r.DOM.visualBounds,"y",{get:i}),Object.defineProperty(r.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(r.DOM.layoutBounds,"y",{value:0});if(t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight){var n=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},o=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(r.DOM.visualBounds,"width",{get:n}),Object.defineProperty(r.DOM.visualBounds,"height",{get:o}),Object.defineProperty(r.DOM.layoutBounds,"width",{get:n}),Object.defineProperty(r.DOM.layoutBounds,"height",{get:o})}else Object.defineProperty(r.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(r.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(r.DOM.layoutBounds,"width",{get:function(){var t=document.documentElement.clientWidth,e=window.innerWidth;return t<e?e:t}}),Object.defineProperty(r.DOM.layoutBounds,"height",{get:function(){var t=document.documentElement.clientHeight,e=window.innerHeight;return t<e?e:t}});Object.defineProperty(r.DOM.documentBounds,"x",{value:0}),Object.defineProperty(r.DOM.documentBounds,"y",{value:0}),Object.defineProperty(r.DOM.documentBounds,"width",{get:function(){var t=document.documentElement;return Math.max(t.clientWidth,t.offsetWidth,t.scrollWidth)}}),Object.defineProperty(r.DOM.documentBounds,"height",{get:function(){var t=document.documentElement;return Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight)}})},null,!0),r.ArraySet=function(t){this.position=0,this.list=t||[]},r.ArraySet.prototype={add:function(t){return this.exists(t)||this.list.push(t),t},getIndex:function(t){return this.list.indexOf(t)},getByKey:function(t,e){for(var i=this.list.length;i--;)if(this.list[i][t]===e)return this.list[i];return null},exists:function(t){return this.list.indexOf(t)>-1},reset:function(){this.list.length=0},remove:function(t){var e=this.list.indexOf(t);if(e>-1)return this.list.splice(e,1),t},setAll:function(t,e){for(var i=this.list.length;i--;)this.list[i]&&(this.list[i][t]=e)},callAll:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=this.list.length;i--;)this.list[i]&&this.list[i][t]&&this.list[i][t].apply(this.list[i],e)},removeAll:function(t){void 0===t&&(t=!1);for(var e=this.list.length;e--;)if(this.list[e]){var i=this.remove(this.list[e]);t&&i.destroy()}this.position=0,this.list=[]}},Object.defineProperty(r.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(r.ArraySet.prototype,"first",{get:function(){return this.position=0,this.list.length>0?this.list[0]:null}}),Object.defineProperty(r.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),r.ArraySet.prototype.constructor=r.ArraySet,r.ArrayUtils={getRandomItem:function(t,e,i){if(null===t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);var n=e+Math.floor(Math.random()*i);return void 0===t[n]?null:t[n]},removeRandomItem:function(t,e,i){if(null==t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);var n=e+Math.floor(Math.random()*i);if(n<t.length){var r=t.splice(n,1);return void 0===r[0]?null:r[0]}return null},remove:function(t,e,i){var n=t.length;if(!(e>=n||0===i)){null==i&&(i=1);for(var r=n-i,o=e;o<r;++o)t[o]=t[o+i];t.length=r}},shuffle:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},transposeMatrix:function(t){for(var e=t.length,i=t[0].length,n=new Array(i),r=0;r<i;r++){n[r]=new Array(e);for(var o=e-1;o>-1;o--)n[r][o]=t[o][r]}return n},rotateMatrix:function(t,e){if("string"!=typeof e&&(e=(e%360+360)%360),90===e||-270===e||"rotateLeft"===e)t=(t=r.ArrayUtils.transposeMatrix(t)).reverse();else if(-90===e||270===e||"rotateRight"===e)t=t.reverse(),t=r.ArrayUtils.transposeMatrix(t);else if(180===Math.abs(e)||"rotate180"===e){for(var i=0;i<t.length;i++)t[i].reverse();t=t.reverse()}return t},findClosest:function(t,e){if(!e.length)return NaN;if(1===e.length||t<e[0])return e[0];for(var i=1;e[i]<t;)i++;var n=e[i-1],r=i<e.length?e[i]:Number.POSITIVE_INFINITY;return r-t<=t-n?r:n},rotateRight:function(t){var e=t.pop();return t.unshift(e),e},rotateLeft:function(t){var e=t.shift();return t.push(e),e},rotate:function(t){var e=t.shift();return t.push(e),e},numberArray:function(t,e){void 0!==e&&null!==e||(e=t,t=0);for(var i=[],n=t;n<=e;n++)i.push(n);return i},numberArrayStep:function(t,e,i){void 0!==t&&null!==t||(t=0),void 0!==e&&null!==e||(e=t,t=0),void 0===i&&(i=1);for(var n=[],o=Math.max(r.Math.roundAwayFromZero((e-t)/(i||1)),0),s=0;s<o;s++)n.push(t),t+=i;return n}},r.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},r.LinkedList.prototype={add:function(t){return 0===this.total&&null===this.first&&null===this.last?(this.first=t,this.last=t,this.next=t,t.prev=this,this.total++,t):(this.last.next=t,t.prev=this.last,this.last=t,this.total++,t)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(t){if(1===this.total)return this.reset(),void(t.next=t.prev=null);t===this.first?this.first=this.first.next:t===this.last&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=t.prev=null,null===this.first&&(this.last=null),this.total--},callAll:function(t){if(this.first&&this.last){var e=this.first;do{e&&e[t]&&e[t].call(e),e=e.next}while(e!==this.last.next)}}},r.LinkedList.prototype.constructor=r.LinkedList,r.Create=function(t){this.game=t,this.bmd=null,this.canvas=null,this.ctx=null,this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},r.Create.PALETTE_ARNE=0,r.Create.PALETTE_JMP=1,r.Create.PALETTE_CGA=2,r.Create.PALETTE_C64=3,r.Create.PALETTE_JAPANESE_MACHINE=4,r.Create.prototype={texture:function(t,e,i,n,r,o,s,a){void 0===i&&(i=8),void 0===n&&(n=i),void 0===r&&(r=0),void 0===o&&(o=!0);var h=e[0].length*i,u=e.length*n;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(h,u),this.bmd.clear();for(var c=0;c<e.length;c++)for(var l=e[c],d=0;d<l.length;d++){var p=l[d];"."!==p&&" "!==p&&(this.ctx.fillStyle=this.palettes[r][p],this.ctx.fillRect(d*i,c*n,i,n))}return o?this.bmd.generateTexture(t,s,a):this.copy()},grid:function(t,e,i,n,r,o,s,a,h){void 0===s&&(s=!0),null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(e,i),this.ctx.fillStyle=o;for(var u=0;u<i;u+=r)this.ctx.fillRect(0,u,e,1);for(var c=0;c<e;c+=n)this.ctx.fillRect(c,0,1,i);return s?this.bmd.generateTexture(t,a,h):this.copy()},copy:function(t,e,i,n,r,o,s){return null==t&&(t=this.game.make.bitmapData()),t.resize(this.bmd.width,this.bmd.height),t.draw(this.bmd,e,i,n,r,o,s)}},r.Create.prototype.constructor=r.Create,r.FlexGrid=function(t,e,i){this.game=t.game,this.manager=t,this.width=e,this.height=i,this.boundsCustom=new r.Rectangle(0,0,e,i),this.boundsFluid=new r.Rectangle(0,0,e,i),this.boundsFull=new r.Rectangle(0,0,e,i),this.boundsNone=new r.Rectangle(0,0,e,i),this.positionCustom=new r.Point(0,0),this.positionFluid=new r.Point(0,0),this.positionFull=new r.Point(0,0),this.positionNone=new r.Point(0,0),this.scaleCustom=new r.Point(1,1),this.scaleFluid=new r.Point(1,1),this.scaleFluidInversed=new r.Point(1,1),this.scaleFull=new r.Point(1,1),this.scaleNone=new r.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=e/i,this.ratioV=i/e,this.multiplier=0,this.layers=[]},r.FlexGrid.prototype={setSize:function(t,e){this.width=t,this.height=e,this.ratioH=t/e,this.ratioV=e/t,this.scaleNone=new r.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(t,e,i,n){void 0===n&&(n=!0),this.customWidth=t,this.customHeight=e,this.boundsCustom.width=t,this.boundsCustom.height=e;var o=new r.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return n&&this.game.world.add(o),this.layers.push(o),"undefined"!=typeof i&&null!==typeof i&&o.addMultiple(i),o},createFluidLayer:function(t,e){void 0===e&&(e=!0);var i=new r.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return e&&this.game.world.add(i),this.layers.push(i),"undefined"!=typeof t&&null!==typeof t&&i.addMultiple(t),i},createFullLayer:function(t){var e=new r.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(e),this.layers.push(e),"undefined"!=typeof t&&e.addMultiple(t),e},createFixedLayer:function(t){var e=new r.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(e),this.layers.push(e),"undefined"!=typeof t&&e.addMultiple(t),e},reset:function(){for(var t=this.layers.length;t--;)this.layers[t].persist||(this.layers[t].position=null,this.layers[t].scale=null,this.layers.slice(t,1))},onResize:function(t,e){this.ratioH=t/e,this.ratioV=e/t,this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(t){this.manager.scaleSprite(t),t.x=this.manager.bounds.centerX,t.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},r.FlexGrid.prototype.constructor=r.FlexGrid,r.FlexLayer=function(t,e,i,n){r.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1),this.manager=t.manager,this.grid=t,this.persist=!1,this.position=e,this.bounds=i,this.scale=n,this.topLeft=i.topLeft,this.topMiddle=new r.Point(i.halfWidth,0),this.topRight=i.topRight,this.bottomLeft=i.bottomLeft,this.bottomMiddle=new r.Point(i.halfWidth,i.bottom),this.bottomRight=i.bottomRight},r.FlexLayer.prototype=Object.create(r.Group.prototype),r.FlexLayer.prototype.constructor=r.FlexLayer,r.FlexLayer.prototype.resize=function(){},r.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},r.Color={packPixel:function(t,e,i,n){return r.Device.LITTLE_ENDIAN?(n<<24|i<<16|e<<8|t)>>>0:(t<<24|e<<16|i<<8|n)>>>0},unpackPixel:function(t,e,i,n){return void 0!==e&&null!==e||(e=r.Color.createColor()),void 0!==i&&null!==i||(i=!1),void 0!==n&&null!==n||(n=!1),r.Device.LITTLE_ENDIAN?(e.a=(4278190080&t)>>>24,e.b=(16711680&t)>>>16,e.g=(65280&t)>>>8,e.r=255&t):(e.r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t),e.color=t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")",i&&r.Color.RGBtoHSL(e.r,e.g,e.b,e),n&&r.Color.RGBtoHSV(e.r,e.g,e.b,e),e},fromRGBA:function(t,e){return e||(e=r.Color.createColor()),e.r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",e},toRGBA:function(t,e,i,n){return t<<24|e<<16|i<<8|n},toABGR:function(t,e,i,n){return(n<<24|i<<16|e<<8|t)>>>0},hexToRGBArray:function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},RGBArrayToHex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},RGBtoHSL:function(t,e,i,n){n||(n=r.Color.createColor(t,e,i,1)),t/=255,e/=255,i/=255;var o=Math.min(t,e,i),s=Math.max(t,e,i);if(n.h=0,n.s=0,n.l=(s+o)/2,s!==o){var a=s-o;n.s=n.l>.5?a/(2-s-o):a/(s+o),s===t?n.h=(e-i)/a+(e<i?6:0):s===e?n.h=(i-t)/a+2:s===i&&(n.h=(t-e)/a+4),n.h/=6}return n},HSLtoRGB:function(t,e,i,n){if(n?(n.r=i,n.g=i,n.b=i):n=r.Color.createColor(i,i,i),0!==e){var o=i<.5?i*(1+e):i+e-i*e,s=2*i-o;n.r=r.Color.hueToColor(s,o,t+1/3),n.g=r.Color.hueToColor(s,o,t),n.b=r.Color.hueToColor(s,o,t-1/3)}return n.r=Math.floor(255*n.r|0),n.g=Math.floor(255*n.g|0),n.b=Math.floor(255*n.b|0),r.Color.updateColor(n),n},RGBtoHSV:function(t,e,i,n){n||(n=r.Color.createColor(t,e,i,255)),t/=255,e/=255,i/=255;var o=Math.min(t,e,i),s=Math.max(t,e,i),a=s-o;return n.h=0,n.s=0===s?0:a/s,n.v=s,s!==o&&(s===t?n.h=(e-i)/a+(e<i?6:0):s===e?n.h=(i-t)/a+2:s===i&&(n.h=(t-e)/a+4),n.h/=6),n},HSVtoRGB:function(t,e,i,n){void 0===n&&(n=r.Color.createColor(0,0,0,1,t,e,0,i));var o,s,a,h=Math.floor(6*t),u=6*t-h,c=i*(1-e),l=i*(1-u*e),d=i*(1-(1-u)*e);switch(h%6){case 0:o=i,s=d,a=c;break;case 1:o=l,s=i,a=c;break;case 2:o=c,s=i,a=d;break;case 3:o=c,s=l,a=i;break;case 4:o=d,s=c,a=i;break;case 5:o=i,s=c,a=l}return n.r=Math.floor(255*o),n.g=Math.floor(255*s),n.b=Math.floor(255*a),r.Color.updateColor(n),n},hueToColor:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},createColor:function(t,e,i,n,o,s,a,h){var u={r:t||0,g:e||0,b:i||0,a:n||1,h:o||0,s:s||0,l:a||0,v:h||0,color:0,color32:0,rgba:""};return r.Color.updateColor(u)},updateColor:function(t){return t.rgba="rgba("+t.r.toFixed()+","+t.g.toFixed()+","+t.b.toFixed()+","+t.a.toString()+")",t.color=r.Color.getColor(t.r,t.g,t.b),t.color32=r.Color.getColor32(255*t.a,t.r,t.g,t.b),t},getColor32:function(t,e,i,n){return t<<24|e<<16|i<<8|n},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,e,i,n,o){return void 0===n&&(n=255),void 0===o&&(o="#"),"#"===o?"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1):"0x"+r.Color.componentToHex(n)+r.Color.componentToHex(t)+r.Color.componentToHex(e)+r.Color.componentToHex(i)},hexToRGB:function(t){var e=r.Color.hexToColor(t);if(e)return r.Color.getColor32(e.a,e.r,e.g,e.b)},hexToColor:function(t,e){t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var i=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i){var n=parseInt(i[1],16),o=parseInt(i[2],16),s=parseInt(i[3],16);e?(e.r=n,e.g=o,e.b=s):e=r.Color.createColor(n,o,s)}return e},webToColor:function(t,e){e||(e=r.Color.createColor());var i=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);return i&&(e.r=~~Number(i[1]),e.g=~~Number(i[2]),e.b=~~Number(i[3]),e.a=void 0!==i[4]?Number(i[4]):1,r.Color.updateColor(e)),e},valueToColor:function(t,e){if(e||(e=r.Color.createColor()),"string"==typeof t)return 0===t.indexOf("rgb")?r.Color.webToColor(t,e):(e.a=1,r.Color.hexToColor(t,e));if("number"==typeof t){var i=r.Color.getRGB(t);return e.r=i.r,e.g=i.g,e.b=i.b,e.a=i.a/255,e}return e},componentToHex:function(t){var e=t.toString(16);return 1===e.length?"0"+e:e},HSVColorWheel:function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);for(var i=[],n=0;n<=359;n++)i.push(r.Color.HSVtoRGB(n/359,t,e));return i},HSLColorWheel:function(t,e){void 0===t&&(t=.5),void 0===e&&(e=.5);for(var i=[],n=0;n<=359;n++)i.push(r.Color.HSLtoRGB(n/359,t,e));return i},interpolateColor:function(t,e,i,n,o,s){void 0===o&&(o=255),void 0===s&&(s=0);var a=r.Color.getRGB(t),h=r.Color.getRGB(e);if(0===s)var u=(h.red-a.red)*n/i+a.red,c=(h.green-a.green)*n/i+a.green,l=(h.blue-a.blue)*n/i+a.blue;if(1===s){var d,p=r.Color.RGBtoHSV(a.r,a.g,a.b),f=r.Color.RGBtoHSV(h.r,h.g,h.b),m=f.h-p.h;if(p.h>f.h){var g=f.h;f.h=p.h,p.h=g,m=-m,n=i-n}m>.5&&(p.h=p.h+1,d=((f.h-p.h)*n/i+p.h)%1),m<=.5&&(d=(f.h-p.h)*n/i+p.h);var y=(f.s-p.s)*n/i+p.s,v=(f.v-p.v)*n/i+p.v,b=r.Color.HSVtoRGB(d,y,v,b);u=b.r,c=b.g,l=b.b}return r.Color.getColor32(o,u,c,l)},interpolateColorWithRGB:function(t,e,i,n,o,s){var a=r.Color.getRGB(t),h=(e-a.red)*s/o+a.red,u=(i-a.green)*s/o+a.green,c=(n-a.blue)*s/o+a.blue;return r.Color.getColor(h,u,c)},interpolateRGB:function(t,e,i,n,o,s,a,h){var u=(n-t)*h/a+t,c=(o-e)*h/a+e,l=(s-i)*h/a+i;return r.Color.getColor(u,c,l)},linear:function(t,e,i){return this.interpolateColor(t,e,1,i)},linearInterpolation:function(t,e){var i=r.Math.linear(0,t.length-1,e),n=t[Math.floor(i)],o=t[Math.ceil(i)];return this.linear(n,o,i%1)},getRandomColor:function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=255),void 0===i&&(i=255),e>255||t>e)return r.Color.getColor(255,255,255);var n=t+Math.round(Math.random()*(e-t)),o=t+Math.round(Math.random()*(e-t)),s=t+Math.round(Math.random()*(e-t));return r.Color.getColor32(i,n,o,s)},getRGB:function(t){return t>16777215?{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:255&t,a:t>>>24,r:t>>16&255,g:t>>8&255,b:255&t}:{alpha:255,red:t>>16&255,green:t>>8&255,blue:255&t,a:255,r:t>>16&255,g:t>>8&255,b:255&t}},getWebRGB:function(t){if("object"==typeof t)return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";var e=r.Color.getRGB(t);return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")"},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},blendNormal:function(t){return t},blendLighten:function(t,e){return e>t?e:t},blendDarken:function(t,e){return e>t?t:e},blendMultiply:function(t,e){return t*e/255},blendAverage:function(t,e){return(t+e)/2},blendAdd:function(t,e){return Math.min(255,t+e)},blendSubtract:function(t,e){return Math.max(0,t+e-255)},blendDifference:function(t,e){return Math.abs(t-e)},blendNegation:function(t,e){return 255-Math.abs(255-t-e)},blendScreen:function(t,e){return 255-((255-t)*(255-e)>>8)},blendExclusion:function(t,e){return t+e-2*t*e/255},blendOverlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},blendSoftLight:function(t,e){return e<128?2*(64+(t>>1))*(e/255):255-2*(255-(64+(t>>1)))*(255-e)/255},blendHardLight:function(t,e){return r.Color.blendOverlay(e,t)},blendColorDodge:function(t,e){return 255===e?e:Math.min(255,(t<<8)/(255-e))},blendColorBurn:function(t,e){return 0===e?e:Math.max(0,255-(255-t<<8)/e)},blendLinearDodge:function(t,e){return r.Color.blendAdd(t,e)},blendLinearBurn:function(t,e){return r.Color.blendSubtract(t,e)},blendLinearLight:function(t,e){return e<128?r.Color.blendLinearBurn(t,2*e):r.Color.blendLinearDodge(t,2*(e-128))},blendVividLight:function(t,e){return e<128?r.Color.blendColorBurn(t,2*e):r.Color.blendColorDodge(t,2*(e-128))},blendPinLight:function(t,e){return e<128?r.Color.blendDarken(t,2*e):r.Color.blendLighten(t,2*(e-128))},blendHardMix:function(t,e){return r.Color.blendVividLight(t,e)<128?0:255},blendReflect:function(t,e){return 255===e?e:Math.min(255,t*t/(255-e))},blendGlow:function(t,e){return r.Color.blendReflect(e,t)},blendPhoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},r.Physics=function(t,e){e=e||{},this.game=t,this.config=e,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.matter=null,this.parseConfig()},r.Physics.ARCADE=0,r.Physics.P2JS=1,r.Physics.NINJA=2,r.Physics.BOX2D=3,r.Physics.CHIPMUNK=4,r.Physics.MATTERJS=5,r.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&!0!==this.config.arcade||!r.Physics.hasOwnProperty("Arcade")||(this.arcade=new r.Physics.Arcade(this.game)),this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&r.Physics.hasOwnProperty("Ninja")&&(this.ninja=new r.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&!0===this.config.p2&&r.Physics.hasOwnProperty("P2")&&(this.p2=new r.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&r.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new r.Physics.BOX2D(this.game,this.config)),this.config.hasOwnProperty("matter")&&!0===this.config.matter&&r.Physics.hasOwnProperty("Matter")&&(this.matter=new r.Physics.Matter(this.game,this.config))},startSystem:function(t){t===r.Physics.ARCADE?this.arcade=new r.Physics.Arcade(this.game):t===r.Physics.P2JS?null===this.p2?this.p2=new r.Physics.P2(this.game,this.config):this.p2.reset():t===r.Physics.NINJA?this.ninja=new r.Physics.Ninja(this.game):t===r.Physics.BOX2D?null===this.box2d?this.box2d=new r.Physics.Box2D(this.game,this.config):this.box2d.reset():t===r.Physics.MATTERJS&&(null===this.matter?this.matter=new r.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(t,e,i){void 0===e&&(e=r.Physics.ARCADE),void 0===i&&(i=!1),e===r.Physics.ARCADE?this.arcade.enable(t):e===r.Physics.P2JS&&this.p2?this.p2.enable(t,i):e===r.Physics.NINJA&&this.ninja?this.ninja.enableAABB(t):e===r.Physics.BOX2D&&this.box2d?this.box2d.enable(t):e===r.Physics.MATTERJS&&this.matter?this.matter.enable(t):console.warn(t.key+" is attempting to enable a physics body using an unknown physics system.")},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate(),this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update(),this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld(),this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear(),this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset(),this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.matter&&this.matter.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null,this.matter=null}},r.Physics.prototype.constructor=r.Physics,r.Physics.Arcade=function(t){this.game=t,this.gravity=new r.Point,this.bounds=new r.Rectangle(0,0,t.world.width,t.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=r.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new r.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},r.Physics.Arcade.prototype.constructor=r.Physics.Arcade,r.Physics.Arcade.SORT_NONE=0,r.Physics.Arcade.LEFT_RIGHT=1,r.Physics.Arcade.RIGHT_LEFT=2,r.Physics.Arcade.TOP_BOTTOM=3,r.Physics.Arcade.BOTTOM_TOP=4,r.Physics.Arcade.prototype={setBounds:function(t,e,i,n){this.bounds.setTo(t,e,i,n)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(t,e){void 0===e&&(e=!0);var i=1;if(Array.isArray(t))for(i=t.length;i--;)t[i]instanceof r.Group?this.enable(t[i].children,e):(this.enableBody(t[i]),e&&t[i].hasOwnProperty("children")&&t[i].children.length>0&&this.enable(t[i],!0));else t instanceof r.Group?this.enable(t.children,e):(this.enableBody(t),e&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new r.Physics.Arcade.Body(t),t.parent&&t.parent instanceof r.Group&&t.parent.addToHash(t))},updateMotion:function(t){if(t.allowRotation){var e=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e,t.rotation+=t.angularVelocity*this.game.time.physicsElapsed}t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},computeVelocity:function(t,e,i,n,r,o){return void 0===o&&(o=1e4),1===t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed:2===t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed),n?i+=n*this.game.time.physicsElapsed:r&&e.allowDrag&&(i-(r*=this.game.time.physicsElapsed)>0?i-=r:i+r<0?i+=r:i=0),i>o?i=o:i<-o&&(i=-o),i},overlap:function(t,e,i,n,r){return i=i||null,n=n||null,r=r||i,this._total=0,this.collideObjects(t,e,i,n,r,!0),this._total>0},collide:function(t,e,i,n,r){return i=i||null,n=n||null,r=r||i,this._total=0,this.collideObjects(t,e,i,n,r,!1),this._total>0},sortLeftRight:function(t,e){return t.body&&e.body?t.body.x-e.body.x:0},sortRightLeft:function(t,e){return t.body&&e.body?e.body.x-t.body.x:0},sortTopBottom:function(t,e){return t.body&&e.body?t.body.y-e.body.y:0},sortBottomTop:function(t,e){return t.body&&e.body?e.body.y-t.body.y:0},sort:function(t,e){null!==t.physicsSortDirection?e=t.physicsSortDirection:void 0===e&&(e=this.sortDirection),e===r.Physics.Arcade.LEFT_RIGHT?t.hash.sort(this.sortLeftRight):e===r.Physics.Arcade.RIGHT_LEFT?t.hash.sort(this.sortRightLeft):e===r.Physics.Arcade.TOP_BOTTOM?t.hash.sort(this.sortTopBottom):e===r.Physics.Arcade.BOTTOM_TOP&&t.hash.sort(this.sortBottomTop)},collideObjects:function(t,e,i,n,r,o){if(!Array.isArray(t)&&Array.isArray(e))for(var s=0;s<e.length;s++)e[s]&&this.collideHandler(t,e[s],i,n,r,o);else if(Array.isArray(t)&&!Array.isArray(e))for(s=0;s<t.length;s++)t[s]&&this.collideHandler(t[s],e,i,n,r,o);else if(Array.isArray(t)&&Array.isArray(e)){for(s=0;s<t.length;s++)if(t[s])for(var a=0;a<e.length;a++)e[a]&&this.collideHandler(t[s],e[a],i,n,r,o)}else this.collideHandler(t,e,i,n,r,o)},collideHandler:function(t,e,i,n,o,s){if(void 0===e&&t.physicsType===r.GROUP)return this.sort(t),void this.collideGroupVsSelf(t,i,n,o,s);t&&e&&t.exists&&e.exists&&(this.sortDirection!==r.Physics.Arcade.SORT_NONE&&(t.physicsType===r.GROUP&&this.sort(t),e.physicsType===r.GROUP&&this.sort(e)),t.physicsType===r.SPRITE?e.physicsType===r.SPRITE?this.collideSpriteVsSprite(t,e,i,n,o,s):e.physicsType===r.GROUP?this.collideSpriteVsGroup(t,e,i,n,o,s):e.physicsType===r.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,e,i,n,o,s):t.physicsType===r.GROUP?e.physicsType===r.SPRITE?this.collideSpriteVsGroup(e,t,i,n,o,s):e.physicsType===r.GROUP?this.collideGroupVsGroup(t,e,i,n,o,s):e.physicsType===r.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,e,i,n,o,s):t.physicsType===r.TILEMAPLAYER&&(e.physicsType===r.SPRITE?this.collideSpriteVsTilemapLayer(e,t,i,n,o,s):e.physicsType===r.GROUP&&this.collideGroupVsTilemapLayer(e,t,i,n,o,s)))},collideSpriteVsSprite:function(t,e,i,n,r,o){return!(!t.body||!e.body)&&(this.separate(t.body,e.body,n,r,o)&&(i&&i.call(r,t,e),this._total++),!0)},collideSpriteVsGroup:function(t,e,i,n,o,s){if(0!==e.length&&t.body)if(this.skipQuadTree||t.body.skipQuadTree)for(var a={},h=0;h<e.hash.length;h++){var u=e.hash[h];if(u&&u.exists&&u.body){if(a=u.body.getBounds(a),this.sortDirection===r.Physics.Arcade.LEFT_RIGHT){if(t.body.right<a.x)break;if(a.right<t.body.x)continue}else if(this.sortDirection===r.Physics.Arcade.RIGHT_LEFT){if(t.body.x>a.right)break;if(a.x>t.body.right)continue}else if(this.sortDirection===r.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<a.y)break;if(a.bottom<t.body.y)continue}else if(this.sortDirection===r.Physics.Arcade.BOTTOM_TOP){if(t.body.y>a.bottom)break;if(a.y>t.body.bottom)continue}this.collideSpriteVsSprite(t,u,i,n,o,s)}}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(e);var c=this.quadTree.retrieve(t);for(h=0;h<c.length;h++)this.separate(t.body,c[h],n,o,s)&&(i&&i.call(o,t,c[h].sprite),this._total++)}},collideGroupVsSelf:function(t,e,i,n,o){if(0!==t.length)for(var s=0;s<t.hash.length;s++){var a={},h=t.hash[s];if(h&&h.exists&&h.body){a=h.body.getBounds(a);for(var u=s+1;u<t.hash.length;u++){var c={},l=t.hash[u];if(l&&l.exists&&l.body){if(c=l.body.getBounds(c),this.sortDirection===r.Physics.Arcade.LEFT_RIGHT){if(a.right<c.x)break;if(c.right<a.x)continue}else if(this.sortDirection===r.Physics.Arcade.RIGHT_LEFT){if(a.x>c.right)continue;if(c.x>a.right)break}else if(this.sortDirection===r.Physics.Arcade.TOP_BOTTOM){if(a.bottom<c.y)continue;if(c.bottom<a.y)break}else if(this.sortDirection===r.Physics.Arcade.BOTTOM_TOP){if(a.y>c.bottom)continue;if(c.y>h.body.bottom)break}this.collideSpriteVsSprite(h,l,e,i,n,o)}}}}},collideGroupVsGroup:function(t,e,i,n,o,s){if(0!==t.length&&0!==e.length)for(var a=0;a<t.children.length;a++)t.children[a].exists&&(t.children[a].physicsType===r.GROUP?this.collideGroupVsGroup(t.children[a],e,i,n,o,s):this.collideSpriteVsGroup(t.children[a],e,i,n,o,s))},separate:function(t,e,i,n,r){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e))return!1;if(i&&!1===i.call(n,t.sprite,e.sprite))return!1;if(t.isCircle&&e.isCircle)return this.separateCircle(t,e,r);if(t.isCircle!==e.isCircle){var o=t.isCircle?e:t,s=t.isCircle?t:e,a={x:o.x,y:o.y,right:o.right,bottom:o.bottom},h=s.center;if((h.y<a.y||h.y>a.bottom)&&(h.x<a.x||h.x>a.right))return this.separateCircle(t,e,r)}var u=!1,c=!1;this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?(u=this.separateX(t,e,r),this.intersects(t,e)&&(c=this.separateY(t,e,r))):(c=this.separateY(t,e,r),this.intersects(t,e)&&(u=this.separateX(t,e,r)));var l=u||c;return l&&(r?(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)):(t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite))),l},intersects:function(t,e){return t!==e&&(t.isCircle?e.isCircle?r.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.halfWidth+e.halfWidth:this.circleBodyIntersects(t,e):e.isCircle?this.circleBodyIntersects(e,t):!(t.right<=e.position.x)&&(!(t.bottom<=e.position.y)&&(!(t.position.x>=e.right)&&!(t.position.y>=e.bottom))))},circleBodyIntersects:function(t,e){var i=r.Math.clamp(t.center.x,e.left,e.right),n=r.Math.clamp(t.center.y,e.top,e.bottom);return(t.center.x-i)*(t.center.x-i)+(t.center.y-n)*(t.center.y-n)<=t.halfWidth*t.halfWidth},separateCircle:function(t,e,i){this.getOverlapX(t,e),this.getOverlapY(t,e);var n=e.center.x-t.center.x,o=e.center.y-t.center.y,s=Math.atan2(o,n),a=0;if(t.isCircle!==e.isCircle){var h={x:e.isCircle?t.position.x:e.position.x,y:e.isCircle?t.position.y:e.position.y,right:e.isCircle?t.right:e.right,bottom:e.isCircle?t.bottom:e.bottom},u={x:t.isCircle?t.center.x:e.center.x,y:t.isCircle?t.center.y:e.center.y,radius:t.isCircle?t.halfWidth:e.halfWidth};u.y<h.y?u.x<h.x?a=r.Math.distance(u.x,u.y,h.x,h.y)-u.radius:u.x>h.right&&(a=r.Math.distance(u.x,u.y,h.right,h.y)-u.radius):u.y>h.bottom&&(u.x<h.x?a=r.Math.distance(u.x,u.y,h.x,h.bottom)-u.radius:u.x>h.right&&(a=r.Math.distance(u.x,u.y,h.right,h.bottom)-u.radius)),a*=-1}else a=t.halfWidth+e.halfWidth-r.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y);if(i||0===a||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==a&&(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)),0!==a;var c=t.velocity.x*Math.cos(s)+t.velocity.y*Math.sin(s),l=t.velocity.x*Math.sin(s)-t.velocity.y*Math.cos(s),d=e.velocity.x*Math.cos(s)+e.velocity.y*Math.sin(s),p=e.velocity.x*Math.sin(s)-e.velocity.y*Math.cos(s),f=((t.mass-e.mass)*c+2*e.mass*d)/(t.mass+e.mass),m=(2*t.mass*c+(e.mass-t.mass)*d)/(t.mass+e.mass);return t.immovable||(t.velocity.x=(f*Math.cos(s)-l*Math.sin(s))*t.bounce.x,t.velocity.y=(l*Math.cos(s)+f*Math.sin(s))*t.bounce.y),e.immovable||(e.velocity.x=(m*Math.cos(s)-p*Math.sin(s))*e.bounce.x,e.velocity.y=(p*Math.cos(s)+m*Math.sin(s))*e.bounce.y),Math.abs(s)<Math.PI/2?t.velocity.x>0&&!t.immovable&&e.velocity.x>t.velocity.x?t.velocity.x*=-1:e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x?e.velocity.x*=-1:t.velocity.y>0&&!t.immovable&&e.velocity.y>t.velocity.y?t.velocity.y*=-1:e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y&&(e.velocity.y*=-1):Math.abs(s)>Math.PI/2&&(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x?t.velocity.x*=-1:e.velocity.x>0&&!e.immovable&&t.velocity.x>e.velocity.x?e.velocity.x*=-1:t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y?t.velocity.y*=-1:e.velocity.y>0&&!e.immovable&&t.velocity.x>e.velocity.y&&(e.velocity.y*=-1)),t.immovable||(t.x+=t.velocity.x*this.game.time.physicsElapsed-a*Math.cos(s),t.y+=t.velocity.y*this.game.time.physicsElapsed-a*Math.sin(s)),e.immovable||(e.x+=e.velocity.x*this.game.time.physicsElapsed+a*Math.cos(s),e.y+=e.velocity.y*this.game.time.physicsElapsed+a*Math.sin(s)),t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite),!0},getOverlapX:function(t,e,i){var n=0,r=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;return 0===t.deltaX()&&0===e.deltaX()?(t.embedded=!0,e.embedded=!0):t.deltaX()>e.deltaX()?(n=t.right-e.x)>r&&!i||!1===t.checkCollision.right||!1===e.checkCollision.left?n=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0):t.deltaX()<e.deltaX()&&(-(n=t.x-e.width-e.x)>r&&!i||!1===t.checkCollision.left||!1===e.checkCollision.right?n=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=n,e.overlapX=n,n},getOverlapY:function(t,e,i){var n=0,r=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;return 0===t.deltaY()&&0===e.deltaY()?(t.embedded=!0,e.embedded=!0):t.deltaY()>e.deltaY()?(n=t.bottom-e.y)>r&&!i||!1===t.checkCollision.down||!1===e.checkCollision.up?n=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0):t.deltaY()<e.deltaY()&&(-(n=t.y-e.bottom)>r&&!i||!1===t.checkCollision.up||!1===e.checkCollision.down?n=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=n,e.overlapY=n,n},separateX:function(t,e,i){var n=this.getOverlapX(t,e,i);if(i||0===n||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==n||t.embedded&&e.embedded;var r=t.velocity.x,o=e.velocity.x;if(t.immovable||e.immovable)t.immovable?(e.x+=n,e.velocity.x=r-o*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y)):(t.x-=n,t.velocity.x=o-r*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y));else{n*=.5,t.x-=n,e.x+=n;var s=Math.sqrt(o*o*e.mass/t.mass)*(o>0?1:-1),a=Math.sqrt(r*r*t.mass/e.mass)*(r>0?1:-1),h=.5*(s+a);s-=h,a-=h,t.velocity.x=h+s*t.bounce.x,e.velocity.x=h+a*e.bounce.x}return!0},separateY:function(t,e,i){var n=this.getOverlapY(t,e,i);if(i||0===n||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY)return 0!==n||t.embedded&&e.embedded;var r=t.velocity.y,o=e.velocity.y;if(t.immovable||e.immovable)t.immovable?(e.y+=n,e.velocity.y=r-o*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x)):(t.y-=n,t.velocity.y=o-r*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x));else{n*=.5,t.y-=n,e.y+=n;var s=Math.sqrt(o*o*e.mass/t.mass)*(o>0?1:-1),a=Math.sqrt(r*r*t.mass/e.mass)*(r>0?1:-1),h=.5*(s+a);s-=h,a-=h,t.velocity.y=h+s*t.bounce.y,e.velocity.y=h+a*e.bounce.y}return!0},getObjectsUnderPointer:function(t,e,i,n){if(0!==e.length&&t.exists)return this.getObjectsAtLocation(t.x,t.y,e,i,n,t)},getObjectsAtLocation:function(t,e,i,n,o,s){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i);for(var a=new r.Rectangle(t,e,1,1),h=[],u=this.quadTree.retrieve(a),c=0;c<u.length;c++)u[c].hitTest(t,e)&&(n&&n.call(o,s,u[c].sprite),h.push(u[c].sprite));return h},moveToObject:function(t,e,i,n){void 0===i&&(i=60),void 0===n&&(n=0);var o=r.Point.angle(e,t);return n>0&&(i=this.distanceBetween(t,e)/(n/1e3)),t.body.velocity.setToPolar(o,i),o},moveToPointer:function(t,e,i,n){void 0===e&&(e=60),i=i||this.game.input.activePointer,void 0===n&&(n=0);var r=this.angleToPointer(t,i);return n>0&&(e=this.distanceToPointer(t,i)/(n/1e3)),t.body.velocity.setToPolar(r,e),r},moveToXY:function(t,e,i,n,r){void 0===n&&(n=60),void 0===r&&(r=0);var o=Math.atan2(i-t.y,e-t.x);return r>0&&(n=this.distanceToXY(t,e,i)/(r/1e3)),t.body.velocity.setToPolar(o,n),o},velocityFromAngle:function(t,e,i){return void 0===e&&(e=60),(i=i||new r.Point).setToPolar(t,e,!0)},velocityFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new r.Point).setToPolar(t,e)},accelerationFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new r.Point).setToPolar(t,e)},accelerateToObject:function(t,e,i,n,r){void 0===i&&(i=60),void 0===n&&(n=1e3),void 0===r&&(r=1e3);var o=this.angleBetween(t,e);return t.body.acceleration.setToPolar(o,i),t.body.maxVelocity.setTo(n,r),o},accelerateToPointer:function(t,e,i,n,r){void 0===i&&(i=60),void 0===e&&(e=this.game.input.activePointer),void 0===n&&(n=1e3),void 0===r&&(r=1e3);var o=this.angleToPointer(t,e);return t.body.acceleration.setToPolar(o,i),t.body.maxVelocity.setTo(n,r),o},accelerateToXY:function(t,e,i,n,r,o){void 0===n&&(n=60),void 0===r&&(r=1e3),void 0===o&&(o=1e3);var s=this.angleToXY(t,e,i);return t.body.acceleration.setTo(s,n),t.body.maxVelocity.setTo(r,o),s},distanceBetween:function(t,e,i){void 0===i&&(i=!1);var n=i?t.world.x-e.world.x:t.x-e.x,r=i?t.world.y-e.world.y:t.y-e.y;return Math.sqrt(n*n+r*r)},distanceToXY:function(t,e,i,n){void 0===n&&(n=!1);var r=n?t.world.x-e:t.x-e,o=n?t.world.y-i:t.y-i;return Math.sqrt(r*r+o*o)},distanceToPointer:function(t,e,i){void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1);var n=i?t.world.x-e.worldX:t.x-e.worldX,r=i?t.world.y-e.worldY:t.y-e.worldY;return Math.sqrt(n*n+r*r)},closest:function(t,e,i){for(var n=1/0,r=null,o=0,s=e.length;o<s;o++){var a=e[o],h=this.distanceBetween(t,a,i);h<n&&(r=a,n=h)}return r},farthest:function(t,e,i){for(var n=-1,r=null,o=0,s=e.length;o<s;o++){var a=e[o],h=this.distanceBetween(t,a,i);h>n&&(r=a,n=h)}return r},angleBetween:function(t,e,i){return void 0===i&&(i=!1),i?r.Point.angle(e.world,t.world):r.Point.angle(e,t)},angleBetweenCenters:function(t,e){var i=e.centerX-t.centerX,n=e.centerY-t.centerY;return Math.atan2(n,i)},angleToXY:function(t,e,i,n){return void 0===n&&(n=!1),n?Math.atan2(i-t.world.y,e-t.world.x):Math.atan2(i-t.y,e-t.x)},angleToPointer:function(t,e,i){return void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1),i?Math.atan2(e.worldY-t.world.y,e.worldX-t.world.x):Math.atan2(e.worldY-t.y,e.worldX-t.x)},worldAngleToPointer:function(t,e){return this.angleToPointer(t,e,!0)}},r.Physics.Arcade.Body=function(t){this.sprite=t,this.game=t.game,this.type=r.Physics.ARCADE,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new r.Point,this.position=new r.Point(t.x,t.y),this.prev=new r.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=t.angle,this.preRotation=t.angle,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height,t.texture&&(this.sourceWidth=t.texture.frame.width,this.sourceHeight=t.texture.frame.height),this.halfWidth=Math.abs(t.width/2),this.halfHeight=Math.abs(t.height/2),this.center=new r.Point(t.x+this.halfWidth,t.y+this.halfHeight),this.velocity=new r.Point,this.newVelocity=new r.Point,this.deltaMax=new r.Point,this.acceleration=new r.Point,this.allowDrag=!0,this.drag=new r.Point,this.allowGravity=!0,this.gravity=new r.Point,this.bounce=new r.Point,this.worldBounce=null,this.onWorldBounds=null,this.onCollide=null,this.onOverlap=null,this.maxVelocity=new r.Point(1e4,1e4),this.friction=new r.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=r.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={none:!0,up:!1,down:!1,left:!1,right:!1},this.tilePadding=new r.Point,this.dirty=!1,this.skipQuadTree=!1,this.syncBounds=!1,this.isMoving=!1,this.stopVelocityOnCollide=!0,this.moveTimer=0,this.moveDistance=0,this.moveDuration=0,this.moveTarget=null,this.moveEnd=null,this.onMoveComplete=new r.Signal,this.movementCallback=null,this.movementCallbackContext=null,this._reset=!0,this._sx=t.scale.x,this._sy=t.scale.y,this._dx=0,this._dy=0},r.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var t=this.sprite.getBounds();t.ceilAll(),t.width===this.width&&t.height===this.height||(this.width=t.width,this.height=t.height,this._reset=!0)}else{var e=Math.abs(this.sprite.scale.x),i=Math.abs(this.sprite.scale.y);e===this._sx&&i===this._sy||(this.width=this.sourceWidth*e,this.height=this.sourceHeight*i,this._sx=e,this._sy=i,this._reset=!0)}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.updateCenter())},updateCenter:function(){this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.none=!0,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.overlapR=0,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.updateCenter(),this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.updateCenter(),this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=this.velocity.atan()),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var t=0,e=0!==this.overlapX||0!==this.overlapY;if(this.moveDuration>0?(this.moveTimer+=this.game.time.elapsedMS,t=this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),t=this.moveTarget.length/this.moveDistance),this.movementCallback)var i=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,t);return!(e||t>=1||void 0!==i&&!0!==i)||(this.stopMovement(t>=1||this.stopVelocityOnCollide&&e),!1)},stopMovement:function(t){this.isMoving&&(this.isMoving=!1,t&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,this.deltaX()<0?this.facing=r.LEFT:this.deltaX()>0&&(this.facing=r.RIGHT),this.deltaY()<0?this.facing=r.UP:this.deltaY()>0&&(this.facing=r.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.updateCenter(),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var t=this.position,e=this.game.physics.arcade.bounds,i=this.game.physics.arcade.checkCollision,n=this.worldBounce?-this.worldBounce.x:-this.bounce.x,r=this.worldBounce?-this.worldBounce.y:-this.bounce.y;return t.x<e.x&&i.left?(t.x=e.x,this.velocity.x*=n,this.blocked.left=!0,this.blocked.none=!1):this.right>e.right&&i.right&&(t.x=e.right-this.width,this.velocity.x*=n,this.blocked.right=!0,this.blocked.none=!1),t.y<e.y&&i.up?(t.y=e.y,this.velocity.y*=r,this.blocked.up=!0,this.blocked.none=!1):this.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.height,this.velocity.y*=r,this.blocked.down=!0,this.blocked.none=!1),!this.blocked.none},moveFrom:function(t,e,i){if(void 0===e&&(e=this.speed),0===e)return!1;var n;return void 0===i?(n=this.angle,i=this.game.math.radToDeg(n)):n=this.game.math.degToRad(i),this.moveTimer=0,this.moveDuration=t,0===i||180===i?this.velocity.set(Math.cos(n)*e,0):90===i||270===i?this.velocity.set(0,Math.sin(n)*e):this.velocity.setToPolar(n,e),this.isMoving=!0,!0},moveTo:function(t,e,i){var n=e/(t/1e3);if(0===n)return!1;var o;return void 0===i?(o=this.angle,i=this.game.math.radToDeg(o)):o=this.game.math.degToRad(i),e=Math.abs(e),this.moveDuration=0,this.moveDistance=e,null===this.moveTarget&&(this.moveTarget=new r.Line,this.moveEnd=new r.Point),this.moveTarget.fromAngle(this.x,this.y,o,e),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,this.y,this.x,this.y),0===i||180===i?this.velocity.set(Math.cos(o)*n,0):90===i||270===i?this.velocity.set(0,Math.sin(o)*n):this.velocity.setToPolar(o,n),this.isMoving=!0,!0},setSize:function(t,e,i,n){void 0===i&&(i=this.offset.x),void 0===n&&(n=this.offset.y),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(i,n),this.updateCenter(),this.isCircle=!1,this.radius=0},setCircle:function(t,e,i){void 0===e&&(e=this.offset.x),void 0===i&&(i=this.offset.y),t>0?(this.isCircle=!0,this.radius=t,this.sourceWidth=2*t,this.sourceHeight=2*t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(e,i),this.updateCenter()):this.isCircle=!1},reset:function(t,e){this.stop(),this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this.updateBounds(),this.updateCenter()},stop:function(){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0},getBounds:function(t){return t.x=this.x,t.y=this.y,t.right=this.right,t.bottom=this.bottom,t},hitTest:function(t,e){return this.isCircle?r.Circle.contains(this,t,e):r.Rectangle.contains(this,t,e)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof r.Group&&this.sprite.parent.removeFromHash(this.sprite),this.sprite.body=null,this.sprite=null}},Object.defineProperty(r.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}}),Object.defineProperty(r.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(r.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}}),Object.defineProperty(r.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(r.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(r.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),r.Physics.Arcade.Body.render=function(t,e,i,n,r){void 0===n&&(n=!0),i=i||"rgba(0,255,0,0.4)",t.fillStyle=i,t.strokeStyle=i,t.lineWidth=r||1,e.isCircle?(t.beginPath(),t.arc(e.center.x-e.game.camera.x,e.center.y-e.game.camera.y,e.halfWidth,0,2*Math.PI),n?t.fill():t.stroke()):n?t.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height):t.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)},r.Physics.Arcade.Body.renderBodyInfo=function(t,e){t.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height),t.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2)),t.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2)),t.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2)),t.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down),t.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)},r.Physics.Arcade.Body.prototype.constructor=r.Physics.Arcade.Body,r.Physics.Arcade.TilemapCollision=function(){},r.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(t,e,i,n,r,o){if(t.body){var s=e.getTiles(t.body.position.x-t.body.tilePadding.x-e.getTileOffsetX(),t.body.position.y-t.body.tilePadding.y-e.getTileOffsetY(),t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,!1,!1);if(0!==s.length)for(var a=0;a<s.length;a++)n?n.call(r,t,s[a])&&this.separateTile(a,t.body,s[a],e,o)&&(this._total++,i&&i.call(r,t,s[a])):this.separateTile(a,t.body,s[a],e,o)&&(this._total++,i&&i.call(r,t,s[a]))}},collideGroupVsTilemapLayer:function(t,e,i,n,r,o){if(0!==t.length)for(var s=0;s<t.children.length;s++)t.children[s].exists&&this.collideSpriteVsTilemapLayer(t.children[s],e,i,n,r,o)},separateTile:function(t,e,i,n,r){if(!e.enable)return!1;var o=n.getTileOffsetX(),s=n.getTileOffsetY();if(!i.intersects(e.position.x-o,e.position.y-s,e.right-o,e.bottom-s))return!1;if(r)return!0;if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,e.sprite,i))return!1;if("undefined"!=typeof i.layer.callbacks&&i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,e.sprite,i))return!1;if(!(i.faceLeft||i.faceRight||i.faceTop||i.faceBottom))return!1;var a=0,h=0,u=0,c=1;if(e.deltaAbsX()>e.deltaAbsY()?u=-1:e.deltaAbsX()<e.deltaAbsY()&&(c=-1),0!==e.deltaX()&&0!==e.deltaY()&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(u=Math.min(Math.abs(e.position.x-o-i.right),Math.abs(e.right-o-i.left)),c=Math.min(Math.abs(e.position.y-s-i.bottom),Math.abs(e.bottom-s-i.top))),u<c){if((i.faceLeft||i.faceRight)&&0!==(a=this.tileCheckX(e,i,n))&&!i.intersects(e.position.x-o,e.position.y-s,e.right-o,e.bottom-s))return!0;(i.faceTop||i.faceBottom)&&(h=this.tileCheckY(e,i,n))}else{if((i.faceTop||i.faceBottom)&&0!==(h=this.tileCheckY(e,i,n))&&!i.intersects(e.position.x-o,e.position.y-s,e.right-o,e.bottom-s))return!0;(i.faceLeft||i.faceRight)&&(a=this.tileCheckX(e,i,n))}return 0!==a||0!==h},tileCheckX:function(t,e,i){var n=0,r=i.getTileOffsetX();return t.deltaX()<0&&!t.blocked.left&&e.collideRight&&t.checkCollision.left?e.faceRight&&t.x-r<e.right&&(n=t.x-r-e.right)<-this.TILE_BIAS&&(n=0):t.deltaX()>0&&!t.blocked.right&&e.collideLeft&&t.checkCollision.right&&e.faceLeft&&t.right-r>e.left&&(n=t.right-r-e.left)>this.TILE_BIAS&&(n=0),0!==n&&(t.customSeparateX?t.overlapX=n:this.processTileSeparationX(t,n)),n},tileCheckY:function(t,e,i){var n=0,r=i.getTileOffsetY();return t.deltaY()<0&&!t.blocked.up&&e.collideDown&&t.checkCollision.up?e.faceBottom&&t.y-r<e.bottom&&(n=t.y-r-e.bottom)<-this.TILE_BIAS&&(n=0):t.deltaY()>0&&!t.blocked.down&&e.collideUp&&t.checkCollision.down&&e.faceTop&&t.bottom-r>e.top&&(n=t.bottom-r-e.top)>this.TILE_BIAS&&(n=0),0!==n&&(t.customSeparateY?t.overlapY=n:this.processTileSeparationY(t,n)),n},processTileSeparationX:function(t,e){e<0?(t.blocked.left=!0,t.blocked.none=!1):e>0&&(t.blocked.right=!0,t.blocked.none=!1),t.position.x-=e,0===t.bounce.x?t.velocity.x=0:t.velocity.x=-t.velocity.x*t.bounce.x},processTileSeparationY:function(t,e){e<0?(t.blocked.up=!0,t.blocked.none=!1):e>0&&(t.blocked.down=!0,t.blocked.none=!1),t.position.y-=e,0===t.bounce.y?t.velocity.y=0:t.velocity.y=-t.velocity.y*t.bounce.y}},r.Utils.mixinPrototype(r.Physics.Arcade.prototype,r.Physics.Arcade.TilemapCollision.prototype),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,r.Physics.P2=function(t,e){this.game=t,void 0===e?e={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(e.hasOwnProperty("gravity")||(e.gravity=[0,0]),e.hasOwnProperty("broadphase")||(e.broadphase=new p2.SAPBroadphase)),this.config=e,this.world=new p2.World(this.config),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new r.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new r.Signal,this.onBodyRemoved=new r.Signal,this.onSpringAdded=new r.Signal,this.onSpringRemoved=new r.Signal,this.onConstraintAdded=new r.Signal,this.onConstraintRemoved=new r.Signal,this.onContactMaterialAdded=new r.Signal,this.onContactMaterialRemoved=new r.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new r.Signal,this.onEndContact=new r.Signal,e.hasOwnProperty("mpx")&&e.hasOwnProperty("pxm")&&e.hasOwnProperty("mpxi")&&e.hasOwnProperty("pxmi")&&(this.mpx=e.mpx,this.mpxi=e.mpxi,this.pxm=e.pxm,this.pxmi=e.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new r.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new r.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new r.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this._boundsLeft=!0,this._boundsRight=!0,this._boundsTop=!0,this._boundsBottom=!0,this._boundsOwnGroup=!1,this.setBoundsToWorld(!0,!0,!0,!0,!1)},r.Physics.P2.prototype={removeBodyNextStep:function(t){this._toRemove.push(t)},preUpdate:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0},enable:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!0);var n=1;if(Array.isArray(t))for(n=t.length;n--;)t[n]instanceof r.Group?this.enable(t[n].children,e,i):(this.enableBody(t[n],e),i&&t[n].hasOwnProperty("children")&&t[n].children.length>0&&this.enable(t[n],e,!0));else t instanceof r.Group?this.enable(t.children,e,i):(this.enableBody(t,e),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,e,!0))},enableBody:function(t,e){t.hasOwnProperty("body")&&null===t.body&&(t.body=new r.Physics.P2.Body(this.game,t,t.x,t.y,1),t.body.debug=e,"undefined"!=typeof t.anchor&&t.anchor.set(.5))},setImpactEvents:function(t){t?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(t,e){this.postBroadphaseCallback=t,this.callbackContext=e,null!==t?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(t){if(this.postBroadphaseCallback&&0!==t.pairs.length)for(var e=t.pairs.length-2;e>=0;e-=2)t.pairs[e].parent&&t.pairs[e+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,t.pairs[e].parent,t.pairs[e+1].parent)&&t.pairs.splice(e,2)},impactHandler:function(t){if(t.bodyA.parent&&t.bodyB.parent){var e=t.bodyA.parent,i=t.bodyB.parent;e._bodyCallbacks[t.bodyB.id]&&e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,i,t.shapeA,t.shapeB),i._bodyCallbacks[t.bodyA.id]&&i._bodyCallbacks[t.bodyA.id].call(i._bodyCallbackContext[t.bodyA.id],i,e,t.shapeB,t.shapeA),e._groupCallbacks[t.shapeB.collisionGroup]&&e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,i,t.shapeA,t.shapeB),i._groupCallbacks[t.shapeA.collisionGroup]&&i._groupCallbacks[t.shapeA.collisionGroup].call(i._groupCallbackContext[t.shapeA.collisionGroup],i,e,t.shapeB,t.shapeA)}},beginContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onBeginContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyA.parent&&t.bodyA.parent.onBeginContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyB.parent&&t.bodyB.parent.onBeginContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA,t.contactEquations))},endContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onEndContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB),t.bodyA.parent&&t.bodyA.parent.onEndContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB),t.bodyB.parent&&t.bodyB.parent.onEndContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA))},setBoundsToWorld:function(t,e,i,n,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,e,i,n,r)},setWorldMaterial:function(t,e,i,n,r){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===r&&(r=!0),e&&this.walls.left&&(this.walls.left.shapes[0].material=t),i&&this.walls.right&&(this.walls.right.shapes[0].material=t),n&&this.walls.top&&(this.walls.top.shapes[0].material=t),r&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=t)},updateBoundsCollisionGroup:function(t){void 0===t&&(t=!0);var e=t?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=e),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=e),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=e),this._boundsOwnGroup=t},setBounds:function(t,e,i,n,r,o,s,a,h){void 0===r&&(r=this._boundsLeft),void 0===o&&(o=this._boundsRight),void 0===s&&(s=this._boundsTop),void 0===a&&(a=this._boundsBottom),void 0===h&&(h=this._boundsOwnGroup),this.setupWall(r,"left",t,e,1.5707963267948966,h),this.setupWall(o,"right",t+i,e,-1.5707963267948966,h),this.setupWall(s,"top",t,e,-3.141592653589793,h),this.setupWall(a,"bottom",t,e+n,0,h),this._boundsLeft=r,this._boundsRight=o,this._boundsTop=s,this._boundsBottom=a,this._boundsOwnGroup=h},setupWall:function(t,e,i,n,r,o){t?(this.walls[e]?this.walls[e].position=[this.pxmi(i),this.pxmi(n)]:(this.walls[e]=new p2.Body({mass:0,position:[this.pxmi(i),this.pxmi(n)],angle:r}),this.walls[e].addShape(new p2.Plane),this.world.addBody(this.walls[e])),o&&(this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[e]&&(this.world.removeBody(this.walls[e]),this.walls[e]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.nothingCollisionGroup=new r.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new r.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new r.Physics.P2.CollisionGroup(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var t=this.world.constraints,e=t.length-1;e>=0;e--)this.world.removeConstraint(t[e]);var i=this.world.bodies;for(e=i.length-1;e>=0;e--)this.world.removeBody(i[e]);var n=this.world.springs;for(e=n.length-1;e>=0;e--)this.world.removeSpring(n[e]);var r=this.world.contactMaterials;for(e=r.length-1;e>=0;e--)this.world.removeContactMaterial(r[e]);this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear(),this.game=null},addBody:function(t){return!t.data.world&&(this.world.addBody(t.data),this.onBodyAdded.dispatch(t),!0)},removeBody:function(t){return t.data.world===this.world&&(this.world.removeBody(t.data),this.onBodyRemoved.dispatch(t)),t},addSpring:function(t){return t instanceof r.Physics.P2.Spring||t instanceof r.Physics.P2.RotationalSpring?this.world.addSpring(t.data):this.world.addSpring(t),this.onSpringAdded.dispatch(t),t},removeSpring:function(t){return t instanceof r.Physics.P2.Spring||t instanceof r.Physics.P2.RotationalSpring?this.world.removeSpring(t.data):this.world.removeSpring(t),this.onSpringRemoved.dispatch(t),t},createDistanceConstraint:function(t,e,i,n,o,s){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new r.Physics.P2.DistanceConstraint(this,t,e,i,n,o,s));console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(t,e,i,n){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new r.Physics.P2.GearConstraint(this,t,e,i,n));console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(t,e,i,n,o,s){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new r.Physics.P2.RevoluteConstraint(this,t,e,i,n,o,s));console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(t,e,i,n,o){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new r.Physics.P2.LockConstraint(this,t,e,i,n,o));console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(t,e,i,n,o,s,a){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new r.Physics.P2.PrismaticConstraint(this,t,e,i,n,o,s,a));console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(t){return this.world.addConstraint(t),this.onConstraintAdded.dispatch(t),t},removeConstraint:function(t){return this.world.removeConstraint(t),this.onConstraintRemoved.dispatch(t),t},addContactMaterial:function(t){return this.world.addContactMaterial(t),this.onContactMaterialAdded.dispatch(t),t},removeContactMaterial:function(t){return this.world.removeContactMaterial(t),this.onContactMaterialRemoved.dispatch(t),t},getContactMaterial:function(t,e){return this.world.getContactMaterial(t,e)},setMaterial:function(t,e){for(var i=e.length;i--;)e[i].setMaterial(t)},createMaterial:function(t,e){t=t||"";var i=new r.Physics.P2.Material(t);return this.materials.push(i),"undefined"!=typeof e&&e.setMaterial(i),i},createContactMaterial:function(t,e,i){void 0===t&&(t=this.createMaterial()),void 0===e&&(e=this.createMaterial());var n=new r.Physics.P2.ContactMaterial(t,e,i);return this.addContactMaterial(n)},getBodies:function(){for(var t=[],e=this.world.bodies.length;e--;)t.push(this.world.bodies[e].parent);return t},getBody:function(t){return t instanceof p2.Body?t:t instanceof r.Physics.P2.Body?t.data:t.body&&t.body.type===r.Physics.P2JS?t.body.data:null},getSprings:function(){for(var t=[],e=this.world.springs.length;e--;)t.push(this.world.springs[e].parent);return t},getConstraints:function(){for(var t=[],e=this.world.constraints.length;e--;)t.push(this.world.constraints[e]);return t},hitTest:function(t,e,i,n){void 0===e&&(e=this.world.bodies),void 0===i&&(i=5),void 0===n&&(n=!1);for(var o=[this.pxmi(t.x),this.pxmi(t.y)],s=[],a=e.length;a--;)e[a]instanceof r.Physics.P2.Body&&(!n||e[a].data.type!==p2.Body.STATIC)?s.push(e[a].data):e[a]instanceof p2.Body&&e[a].parent&&(!n||e[a].type!==p2.Body.STATIC)?s.push(e[a]):e[a]instanceof r.Sprite&&e[a].hasOwnProperty("body")&&(!n||e[a].body.data.type!==p2.Body.STATIC)&&s.push(e[a].body.data);return this.world.hitTest(o,s,i)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var e=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e),this._collisionGroupID++;var i=new r.Physics.P2.CollisionGroup(e);return this.collisionGroups.push(i),t&&this.setCollisionGroup(t,i),i},setCollisionGroup:function(t,e){if(t instanceof r.Group)for(var i=0;i<t.total;i++)t.children[i].body&&t.children[i].body.type===r.Physics.P2JS&&t.children[i].body.setCollisionGroup(e);else t.body.setCollisionGroup(e)},createSpring:function(t,e,i,n,o,s,a,h,u){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addSpring(new r.Physics.P2.Spring(this,t,e,i,n,o,s,a,h,u));console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(t,e,i,n,o){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addSpring(new r.Physics.P2.RotationalSpring(this,t,e,i,n,o));console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(t,e,i,n,o,s){void 0===n&&(n=!1);var a=new r.Physics.P2.Body(this.game,null,t,e,i);if(s){if(!a.addPolygon(o,s))return!1}return n&&this.world.addBody(a.data),a},createParticle:function(t,e,i,n,o,s){void 0===n&&(n=!1);var a=new r.Physics.P2.Body(this.game,null,t,e,i);if(s){if(!a.addPolygon(o,s))return!1}return n&&this.world.addBody(a.data),a},convertCollisionObjects:function(t,e,i){void 0===i&&(i=!0);for(var n=[],r=0,o=t.collision[e].length;r<o;r++){var s=t.collision[e][r],a=s.polyline||s.polygon;if(a)var h=this.createBody(s.x,s.y,0,i,{},a);else if(s.rectangle){(h=this.createBody(s.x,s.y,0,i)).addRectangle(s.width,s.height,s.width/2,s.height/2)}h&&n.push(h)}return n},clearTilemapLayerBodies:function(t,e){e=t.getLayer(e);for(var i=t.layers[e].bodies.length;i--;)t.layers[e].bodies[i].destroy();t.layers[e].bodies.length=0},convertTilemap:function(t,e,i,n){e=t.getLayer(e),void 0===i&&(i=!0),void 0===n&&(n=!0),this.clearTilemapLayerBodies(t,e);for(var r=0,o=0,s=0,a=0,h=t.layers[e].height;a<h;a++){r=0;for(var u=0,c=t.layers[e].width;u<c;u++){var l=t.layers[e].data[a][u];if(l&&l.index>-1&&l.collides)if(n){var d=t.getTileRight(e,u,a);if(0===r&&(o=l.x*l.width,s=l.y*l.height,r=l.width),d&&d.collides)r+=l.width;else{(p=this.createBody(o,s,0,!1)).addRectangle(r,l.height,r/2,l.height/2,0),i&&this.addBody(p),t.layers[e].bodies.push(p),r=0}}else{var p;(p=this.createBody(l.x*l.width,l.y*l.height,0,!1)).addRectangle(l.width,l.height,l.width/2,l.height/2,0),i&&this.addBody(p),t.layers[e].bodies.push(p)}}}return t.layers[e].bodies},mpx:function(t){return t*=20},pxm:function(t){return.05*t},mpxi:function(t){return t*=-20},pxmi:function(t){return-.05*t}},Object.defineProperty(r.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}}),Object.defineProperty(r.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}}),Object.defineProperty(r.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}}),Object.defineProperty(r.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}}),Object.defineProperty(r.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}}),Object.defineProperty(r.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}}),Object.defineProperty(r.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}}),Object.defineProperty(r.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(r.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}}),Object.defineProperty(r.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}}),Object.defineProperty(r.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),r.Physics.P2.FixtureList=function(t){Array.isArray(t)||(t=[t]),this.rawList=t,this.init(),this.parse(this.rawList)},r.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(t,e){this.getFixtures(e).forEach(function(e){e.collisionGroup=t})},setMask:function(t,e){this.getFixtures(e).forEach(function(e){e.collisionMask=t})},setSensor:function(t,e){this.getFixtures(e).forEach(function(e){e.sensor=t})},setMaterial:function(t,e){this.getFixtures(e).forEach(function(e){e.material=t})},getFixtures:function(t){var e=[];if(t){t instanceof Array||(t=[t]);var i=this;return t.forEach(function(t){i.namedFixtures[t]&&e.push(i.namedFixtures[t])}),this.flatten(e)}return this.allFixtures},getFixtureByKey:function(t){return this.namedFixtures[t]},getGroup:function(t){return this.groupedFixtures[t]},parse:function(){var t,e,i,n;i=this.rawList,n=[];for(t in i)e=i[t],isNaN(t-0)?this.namedFixtures[t]=this.flatten(e):(this.groupedFixtures[t]=this.groupedFixtures[t]||[],this.groupedFixtures[t]=this.groupedFixtures[t].concat(e)),n.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(t){var e,i;return e=[],i=arguments.callee,t.forEach(function(t){return Array.prototype.push.apply(e,Array.isArray(t)?i(t):[t])}),e}},r.Physics.P2.PointProxy=function(t,e){this.world=t,this.destination=e},r.Physics.P2.PointProxy.prototype.constructor=r.Physics.P2.PointProxy,Object.defineProperty(r.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(t){this.destination[0]=this.world.pxm(t)}}),Object.defineProperty(r.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(t){this.destination[1]=this.world.pxm(t)}}),Object.defineProperty(r.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=t}}),Object.defineProperty(r.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=t}}),r.Physics.P2.InversePointProxy=function(t,e){this.world=t,this.destination=e},r.Physics.P2.InversePointProxy.prototype.constructor=r.Physics.P2.InversePointProxy,Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}}),Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}}),Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}}),Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=-t}}),r.Physics.P2.Body=function(t,e,i,n,o){e=e||null,i=i||0,n=n||0,void 0===o&&(o=1),this.game=t,this.world=t.physics.p2,this.sprite=e,this.type=r.Physics.P2JS,this.offset=new r.Point,this.data=new p2.Body({position:[this.world.pxmi(i),this.world.pxmi(n)],mass:o}),this.data.parent=this,this.velocity=new r.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new r.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new r.Point,this.onBeginContact=new r.Signal,this.onEndContact=new r.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this.dirty=!1,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this._reset=!1,e&&(this.setRectangleFromSprite(e),e.exists&&this.game.physics.p2.addBody(this))},r.Physics.P2.Body.prototype={createBodyCallback:function(t,e,i){var n=-1;t.id?n=t.id:t.body&&(n=t.body.id),n>-1&&(null===e?(delete this._bodyCallbacks[n],delete this._bodyCallbackContext[n]):(this._bodyCallbacks[n]=e,this._bodyCallbackContext[n]=i))},createGroupCallback:function(t,e,i){null===e?(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]):(this._groupCallbacks[t.mask]=e,this._groupCallbackContext[t.mask]=i)},getCollisionMask:function(){var t=0;this._collideWorldBounds&&(t=this.game.physics.p2.boundsCollisionGroup.mask);for(var e=0;e<this.collidesWith.length;e++)t|=this.collidesWith[e].mask;return t},updateCollisionMask:function(t){var e=this.getCollisionMask();if(void 0===t)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionMask=e;else t.collisionMask=e},setCollisionGroup:function(t,e){var i=this.getCollisionMask();if(void 0===e)for(var n=this.data.shapes.length-1;n>=0;n--)this.data.shapes[n].collisionGroup=t.mask,this.data.shapes[n].collisionMask=i;else e.collisionGroup=t.mask,e.collisionMask=i},clearCollision:function(t,e,i){if(void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i)for(var n=this.data.shapes.length-1;n>=0;n--)t&&(this.data.shapes[n].collisionGroup=null),e&&(this.data.shapes[n].collisionMask=null);else t&&(i.collisionGroup=null),e&&(i.collisionMask=null);t&&(this.collidesWith.length=0)},removeCollisionGroup:function(t,e,i){void 0===e&&(e=!0);var n;if(Array.isArray(t))for(var r=0;r<t.length;r++)(n=this.collidesWith.indexOf(t[r]))>-1&&(this.collidesWith.splice(n,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));else(n=this.collidesWith.indexOf(t))>-1&&(this.collidesWith.splice(n,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));var o=this.getCollisionMask();if(void 0===i)for(r=this.data.shapes.length-1;r>=0;r--)this.data.shapes[r].collisionMask=o;else i.collisionMask=o},collides:function(t,e,i,n){if(Array.isArray(t))for(var r=0;r<t.length;r++)-1===this.collidesWith.indexOf(t[r])&&(this.collidesWith.push(t[r]),e&&this.createGroupCallback(t[r],e,i));else-1===this.collidesWith.indexOf(t)&&(this.collidesWith.push(t),e&&this.createGroupCallback(t,e,i));var o=this.getCollisionMask();if(void 0===n)for(r=this.data.shapes.length-1;r>=0;r--)this.data.shapes[r].collisionMask=o;else n.collisionMask=o},adjustCenterOfMass:function(){this.data.adjustCenterOfMass(),this.shapeChanged()},getVelocityAtPoint:function(t,e){return this.data.getVelocityAtPoint(t,e)},applyDamping:function(t){this.data.applyDamping(t)},applyImpulse:function(t,e,i){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyImpulseLocal:function(t,e,i){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyForce:function(t,e,i){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(t,e){return this.data.toLocalFrame(t,e)},toWorldFrame:function(t,e){return this.data.toWorldFrame(t,e)},rotateLeft:function(t){this.data.angularVelocity=this.world.pxm(-t)},rotateRight:function(t){this.data.angularVelocity=this.world.pxm(t)},moveForward:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(i),this.data.velocity[1]=e*Math.sin(i)},moveBackward:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.velocity[0]=-e*Math.cos(i),this.data.velocity[1]=-e*Math.sin(i)},thrust:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.force[0]+=e*Math.cos(i),this.data.force[1]+=e*Math.sin(i)},thrustLeft:function(t){var e=this.world.pxmi(-t),i=this.data.angle;this.data.force[0]+=e*Math.cos(i),this.data.force[1]+=e*Math.sin(i)},thrustRight:function(t){var e=this.world.pxmi(-t),i=this.data.angle;this.data.force[0]-=e*Math.cos(i),this.data.force[1]-=e*Math.sin(i)},reverse:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.force[0]-=e*Math.cos(i),this.data.force[1]-=e*Math.sin(i)},moveLeft:function(t){this.data.velocity[0]=this.world.pxmi(-t)},moveRight:function(t){this.data.velocity[0]=this.world.pxmi(t)},moveUp:function(t){this.data.velocity[1]=this.world.pxmi(-t)},moveDown:function(t){this.data.velocity[1]=this.world.pxmi(t)},preUpdate:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation||(this.sprite.rotation=this.data.angle),this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1},reset:function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),i&&this.setZeroDamping(),n&&(this.mass=1),this.x=t,this.y=e},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var t=0;t<this.game.physics.p2._toRemove.length;t++)this.game.physics.p2._toRemove[t]===this&&this.game.physics.p2._toRemove.splice(t,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var t=this.data.shapes.length;t--;)this.data.removeShape(this.data.shapes[t]);this.shapeChanged()},addShape:function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(i)],n),this.shapeChanged(),t},addCircle:function(t,e,i,n){var r=new p2.Circle({radius:this.world.pxm(t)});return this.addShape(r,e,i,n)},addRectangle:function(t,e,i,n,r){var o=new p2.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(o,i,n,r)},addPlane:function(t,e,i){var n=new p2.Plane;return this.addShape(n,t,e,i)},addParticle:function(t,e,i){var n=new p2.Particle;return this.addShape(n,t,e,i)},addLine:function(t,e,i,n){var r=new p2.Line({length:this.world.pxm(t)});return this.addShape(r,e,i,n)},addCapsule:function(t,e,i,n,r){var o=new p2.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(o,i,n,r)},addPolygon:function(t,e){t=t||{},Array.isArray(e)||(e=Array.prototype.slice.call(arguments,1));var i=[];if(1===e.length&&Array.isArray(e[0]))i=e[0].slice(0);else if(Array.isArray(e[0]))i=e.slice();else if("number"==typeof e[0])for(var n=0,r=e.length;n<r;n+=2)i.push([e[n],e[n+1]]);var o=i.length-1;i[o][0]===i[0][0]&&i[o][1]===i[0][1]&&i.pop();for(var s=0;s<i.length;s++)i[s][0]=this.world.pxmi(i[s][0]),i[s][1]=this.world.pxmi(i[s][1]);var a=this.data.fromPolygon(i,t);return this.shapeChanged(),a},removeShape:function(t){var e=this.data.removeShape(t);return this.shapeChanged(),e},setCircle:function(t,e,i,n){return this.clearShapes(),this.addCircle(t,e,i,n)},setRectangle:function(t,e,i,n,r){return void 0===t&&(t=16),void 0===e&&(e=16),this.clearShapes(),this.addRectangle(t,e,i,n,r)},setRectangleFromSprite:function(t){return void 0===t&&(t=this.sprite),this.clearShapes(),this.addRectangle(t.width,t.height,0,0,t.rotation)},setMaterial:function(t,e){if(void 0===e)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].material=t;else e.material=t},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(t,e){for(var i=this.game.cache.getPhysicsData(t,e),n=[],r=0;r<i.length;r++){var o=i[r],s=this.addFixture(o);n[o.filter.group]=n[o.filter.group]||[],n[o.filter.group]=n[o.filter.group].concat(s),o.fixtureKey&&(n[o.fixtureKey]=s)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),n},addFixture:function(t){var e=[];if(t.circle){(u=new p2.Circle({radius:this.world.pxm(t.circle.radius)})).collisionGroup=t.filter.categoryBits,u.collisionMask=t.filter.maskBits,u.sensor=t.isSensor;var i=p2.vec2.create();i[0]=this.world.pxmi(t.circle.position[0]-this.sprite.width/2),i[1]=this.world.pxmi(t.circle.position[1]-this.sprite.height/2),this.data.addShape(u,i),e.push(u)}else for(var n=t.polygons,r=p2.vec2.create(),o=0;o<n.length;o++){for(var s=n[o],a=[],h=0;h<s.length;h+=2)a.push([this.world.pxmi(s[h]),this.world.pxmi(s[h+1])]);for(var u=new p2.Convex({vertices:a}),c=0;c!==u.vertices.length;c++){var l=u.vertices[c];p2.vec2.sub(l,l,u.centerOfMass)}p2.vec2.scale(r,u.centerOfMass,1),r[0]-=this.world.pxmi(this.sprite.width/2),r[1]-=this.world.pxmi(this.sprite.height/2),u.updateTriangles(),u.updateCenterOfMass(),u.updateBoundingRadius(),u.collisionGroup=t.filter.categoryBits,u.collisionMask=t.filter.maskBits,u.sensor=t.isSensor,this.data.addShape(u,r),e.push(u)}return e},loadPolygon:function(t,e,i){if(null===t)var n=e;else n=this.game.cache.getPhysicsData(t,e);"number"!=typeof i&&(i=1);for(var r=p2.vec2.create(),o=0;o<n.length;o++){for(var s=[],a=0;a<n[o].shape.length;a+=2)s.push([this.world.pxmi(n[o].shape[a]*i),this.world.pxmi(n[o].shape[a+1]*i)]);for(var h=new p2.Convex({vertices:s}),u=0;u!==h.vertices.length;u++){var c=h.vertices[u];p2.vec2.sub(c,c,h.centerOfMass)}p2.vec2.scale(r,h.centerOfMass,1),r[0]-=this.world.pxmi(this.sprite.width/2),r[1]-=this.world.pxmi(this.sprite.height/2),h.updateTriangles(),h.updateCenterOfMass(),h.updateBoundingRadius(),this.data.addShape(h,r)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},r.Physics.P2.Body.prototype.constructor=r.Physics.P2.Body,r.Physics.P2.Body.DYNAMIC=1,r.Physics.P2.Body.STATIC=2,r.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(r.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===r.Physics.P2.Body.STATIC},set:function(t){t&&this.data.type!==r.Physics.P2.Body.STATIC?(this.data.type=r.Physics.P2.Body.STATIC,this.mass=0):t||this.data.type!==r.Physics.P2.Body.STATIC||(this.data.type=r.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===r.Physics.P2.Body.DYNAMIC},set:function(t){t&&this.data.type!==r.Physics.P2.Body.DYNAMIC?(this.data.type=r.Physics.P2.Body.DYNAMIC,this.mass=1):t||this.data.type!==r.Physics.P2.Body.DYNAMIC||(this.data.type=r.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===r.Physics.P2.Body.KINEMATIC},set:function(t){t&&this.data.type!==r.Physics.P2.Body.KINEMATIC?(this.data.type=r.Physics.P2.Body.KINEMATIC,this.mass=4):t||this.data.type!==r.Physics.P2.Body.KINEMATIC||(this.data.type=r.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(t){t!==this.data.allowSleep&&(this.data.allowSleep=t)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"angle",{get:function(){return r.Math.wrapAngle(r.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=r.Math.degToRad(r.Math.wrapAngle(t))}}),Object.defineProperty(r.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}}),Object.defineProperty(r.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(t){this.data.angularForce=t}}),Object.defineProperty(r.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}}),Object.defineProperty(r.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(t){this.data.damping=t}}),Object.defineProperty(r.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(t){t!==this.data.fixedRotation&&(this.data.fixedRotation=t)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}}),Object.defineProperty(r.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(t){t!==this.data.mass&&(this.data.mass=t,this.data.updateMassProperties())}}),Object.defineProperty(r.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(t){t!==this.data.type&&(this.data.type=t)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(t){this.data.angle=t}}),Object.defineProperty(r.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}}),Object.defineProperty(r.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(r.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?this.debugBody=new r.Physics.P2.BodyDebug(this.game,this.data):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(r.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(t){t&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!t&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),r.Physics.P2.BodyDebug=function(t,e,i){r.Group.call(this,t);var n={pixelsPerLengthUnit:t.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=Object.assign(n,i),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=e,this.canvas=new r.Graphics(t),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw(),this.updateSpriteTransform()},r.Physics.P2.BodyDebug.prototype=Object.create(r.Group.prototype),r.Physics.P2.BodyDebug.prototype.constructor=r.Physics.P2.BodyDebug,Object.assign(r.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var t,e,i,n,r,o,s,a,h,u,c,l,d,p;if(s=this.body,(h=this.canvas).clear(),i=parseInt(this.randomPastelHex(),16),16711680,o=this.lineWidth,s instanceof p2.Body&&s.shapes.length){var f=s.shapes.length;for(n=0;n!==f;){if(e=s.shapes[n],a=e.position||0,t=e.angle||0,e instanceof p2.Circle)this.drawCircle(h,a[0]*this.ppu,a[1]*this.ppu,t,e.radius*this.ppu,i,o);else if(e instanceof p2.Capsule)this.drawCapsule(h,a[0]*this.ppu,a[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,16711680,i,o);else if(e instanceof p2.Plane)this.drawPlane(h,a[0]*this.ppu,-a[1]*this.ppu,i,16711680,5*o,10*o,10*o,100*this.ppu,t);else if(e instanceof p2.Line)this.drawLine(h,e.length*this.ppu,16711680,o);else if(e instanceof p2.Box)this.drawRectangle(h,a[0]*this.ppu,a[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,16711680,i,o);else if(e instanceof p2.Convex){for(c=[],l=p2.vec2.create(),r=d=0,p=e.vertices.length;0<=p?d<p:d>p;r=0<=p?++d:--d)u=e.vertices[r],p2.vec2.rotate(l,u,t),c.push([(l[0]+a[0])*this.ppu,-(l[1]+a[1])*this.ppu]);this.drawConvex(h,c,e.triangles,16711680,i,o,this.settings.debugPolygons,[a[0]*this.ppu,-a[1]*this.ppu])}n++}}},drawRectangle:function(t,e,i,n,r,o,s,a,h){void 0===h&&(h=1),void 0===s&&(s=0),t.lineStyle(h,s,1),t.beginFill(a),t.drawRect(e-r/2,i-o/2,r,o)},drawCircle:function(t,e,i,n,r,o,s){void 0===s&&(s=1),void 0===o&&(o=16777215),t.lineStyle(s,0,1),t.beginFill(o,1),t.drawCircle(e,i,2*-r),t.endFill(),t.moveTo(e,i),t.lineTo(e+r*Math.cos(-n),i+r*Math.sin(-n))},drawLine:function(t,e,i,n){void 0===n&&(n=1),void 0===i&&(i=0),t.lineStyle(5*n,i,1),t.moveTo(-e/2,0),t.lineTo(e/2,0)},drawConvex:function(t,e,i,n,r,o,s,a){var h,u,c,l,d,p,f,m,g,y,v;if(void 0===o&&(o=1),void 0===n&&(n=0),s){for(h=[16711680,65280,255],u=0;u!==e.length+1;)l=e[u%e.length],d=e[(u+1)%e.length],f=l[0],y=l[1],m=d[0],v=d[1],t.lineStyle(o,h[u%h.length],1),t.moveTo(f,-y),t.lineTo(m,-v),t.drawCircle(f,-y,2*o),u++;return t.lineStyle(o,0,1),t.drawCircle(a[0],a[1],2*o)}for(t.lineStyle(o,n,1),t.beginFill(r),u=0;u!==e.length;)p=(c=e[u])[0],g=c[1],0===u?t.moveTo(p,-g):t.lineTo(p,-g),u++;if(t.endFill(),e.length>2)return t.moveTo(e[e.length-1][0],-e[e.length-1][1]),t.lineTo(e[0][0],-e[0][1])},drawPath:function(t,e,i,n,r){var o,s,a,h,u,c,l,d,p,f,m;for(void 0===r&&(r=1),void 0===i&&(i=0),t.lineStyle(r,i,1),"number"==typeof n&&t.beginFill(n),s=null,a=null,o=0;o<e.length;)f=(p=e[o])[0],m=p[1],f===s&&m===a||(0===o?t.moveTo(f,m):(h=s,u=a,c=f,l=m,d=e[(o+1)%e.length][0],0!==(c-h)*(e[(o+1)%e.length][1]-u)-(d-h)*(l-u)&&t.lineTo(f,m)),s=f,a=m),o++;"number"==typeof n&&t.endFill(),e.length>2&&"number"==typeof n&&(t.moveTo(e[e.length-1][0],e[e.length-1][1]),t.lineTo(e[0][0],e[0][1]))},drawPlane:function(t,e,i,n,r,o,s,a,h,u){var c,l;void 0===o&&(o=1),void 0===n&&(n=16777215),t.lineStyle(o,r,11),t.beginFill(n),t.moveTo(e,-i),c=e+Math.cos(u)*this.game.width,l=i+Math.sin(u)*this.game.height,t.lineTo(c,-l),t.moveTo(e,-i),c=e+Math.cos(u)*-this.game.width,l=i+Math.sin(u)*-this.game.height,t.lineTo(c,-l)},drawCapsule:function(t,e,i,n,r,o,s,a,h){void 0===h&&(h=1),void 0===s&&(s=0),t.lineStyle(h,s,1);var u=Math.cos(n),c=Math.sin(n);t.beginFill(a,1),t.drawCircle(-r/2*u+e,-r/2*c+i,2*-o),t.drawCircle(r/2*u+e,r/2*c+i,2*-o),t.endFill(),t.lineStyle(h,s,0),t.beginFill(a,1),t.moveTo(-r/2*u+o*c+e,-r/2*c+o*u+i),t.lineTo(r/2*u+o*c+e,r/2*c+o*u+i),t.lineTo(r/2*u-o*c+e,r/2*c-o*u+i),t.lineTo(-r/2*u-o*c+e,-r/2*c-o*u+i),t.endFill(),t.lineStyle(h,s,1),t.moveTo(-r/2*u+o*c+e,-r/2*c+o*u+i),t.lineTo(r/2*u+o*c+e,r/2*c+o*u+i),t.moveTo(-r/2*u-o*c+e,-r/2*c-o*u+i),t.lineTo(r/2*u-o*c+e,r/2*c-o*u+i)},randomPastelHex:function(){var t,e,i,n;return i=[255,255,255],n=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor((n+3*i[0])/4),e=Math.floor((e+3*i[1])/4),t=Math.floor((t+3*i[2])/4),this.rgbToHex(n,e,t)},rgbToHex:function(t,e,i){return this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},componentToHex:function(t){var e;return 2===(e=t.toString(16)).length?e:e+"0"}}),r.Physics.P2.Spring=function(t,e,i,n,r,o,s,a,h,u){this.game=t.game,this.world=t,void 0===n&&(n=1),void 0===r&&(r=100),void 0===o&&(o=1);var c={restLength:n=t.pxm(n),stiffness:r,damping:o};"undefined"!=typeof s&&null!==s&&(c.worldAnchorA=[t.pxm(s[0]),t.pxm(s[1])]),"undefined"!=typeof a&&null!==a&&(c.worldAnchorB=[t.pxm(a[0]),t.pxm(a[1])]),"undefined"!=typeof h&&null!==h&&(c.localAnchorA=[t.pxm(h[0]),t.pxm(h[1])]),"undefined"!=typeof u&&null!==u&&(c.localAnchorB=[t.pxm(u[0]),t.pxm(u[1])]),this.data=new p2.LinearSpring(e,i,c),this.data.parent=this},r.Physics.P2.Spring.prototype.constructor=r.Physics.P2.Spring,r.Physics.P2.RotationalSpring=function(t,e,i,n,r,o){this.game=t.game,this.world=t,void 0===n&&(n=null),void 0===r&&(r=100),void 0===o&&(o=1),n&&(n=t.pxm(n));var s={restAngle:n,stiffness:r,damping:o};this.data=new p2.RotationalSpring(e,i,s),this.data.parent=this},r.Physics.P2.Spring.prototype.constructor=r.Physics.P2.Spring,r.Physics.P2.Material=function(t){this.name=t,p2.Material.call(this)},r.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),r.Physics.P2.Material.prototype.constructor=r.Physics.P2.Material,r.Physics.P2.ContactMaterial=function(t,e,i){p2.ContactMaterial.call(this,t,e,i)},r.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),r.Physics.P2.ContactMaterial.prototype.constructor=r.Physics.P2.ContactMaterial,r.Physics.P2.CollisionGroup=function(t){this.mask=t},r.Physics.P2.DistanceConstraint=function(t,e,i,n,r,o,s){void 0===n&&(n=100),void 0===r&&(r=[0,0]),void 0===o&&(o=[0,0]),void 0===s&&(s=Number.MAX_VALUE),this.game=t.game,this.world=t;var a={distance:n=t.pxm(n),localAnchorA:r=[t.pxmi(r[0]),t.pxmi(r[1])],localAnchorB:o=[t.pxmi(o[0]),t.pxmi(o[1])],maxForce:s};p2.DistanceConstraint.call(this,e,i,a)},r.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),r.Physics.P2.DistanceConstraint.prototype.constructor=r.Physics.P2.DistanceConstraint,r.Physics.P2.GearConstraint=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=1),this.game=t.game,this.world=t;var o={angle:n,ratio:r};p2.GearConstraint.call(this,e,i,o)},r.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),r.Physics.P2.GearConstraint.prototype.constructor=r.Physics.P2.GearConstraint,r.Physics.P2.LockConstraint=function(t,e,i,n,r,o){void 0===n&&(n=[0,0]),void 0===r&&(r=0),void 0===o&&(o=Number.MAX_VALUE),this.game=t.game,this.world=t;var s={localOffsetB:n=[t.pxm(n[0]),t.pxm(n[1])],localAngleB:r,maxForce:o};p2.LockConstraint.call(this,e,i,s)},r.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),r.Physics.P2.LockConstraint.prototype.constructor=r.Physics.P2.LockConstraint,r.Physics.P2.PrismaticConstraint=function(t,e,i,n,r,o,s,a){void 0===n&&(n=!0),void 0===r&&(r=[0,0]),void 0===o&&(o=[0,0]),void 0===s&&(s=[0,0]),void 0===a&&(a=Number.MAX_VALUE),this.game=t.game,this.world=t;var h={localAnchorA:r=[t.pxmi(r[0]),t.pxmi(r[1])],localAnchorB:o=[t.pxmi(o[0]),t.pxmi(o[1])],localAxisA:s,maxForce:a,disableRotationalLock:!n};p2.PrismaticConstraint.call(this,e,i,h)},r.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),r.Physics.P2.PrismaticConstraint.prototype.constructor=r.Physics.P2.PrismaticConstraint,r.Physics.P2.RevoluteConstraint=function(t,e,i,n,r,o,s){void 0===o&&(o=Number.MAX_VALUE),void 0===s&&(s=null),this.game=t.game,this.world=t,i=[t.pxmi(i[0]),t.pxmi(i[1])],r=[t.pxmi(r[0]),t.pxmi(r[1])],s&&(s=[t.pxmi(s[0]),t.pxmi(s[1])]);var a={worldPivot:s,localPivotA:i,localPivotB:r,maxForce:o};p2.RevoluteConstraint.call(this,e,n,a)},r.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),r.Physics.P2.RevoluteConstraint.prototype.constructor=r.Physics.P2.RevoluteConstraint,r.ImageCollection=function(t,e,i,n,r,o,s){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===r&&(r=0),void 0===o&&(o=0),this.name=t,this.firstgid=0|e,this.imageWidth=0|i,this.imageHeight=0|n,this.imageMargin=0|r,this.imageSpacing=0|o,this.properties=s||{},this.images=[],this.total=0},r.ImageCollection.prototype={containsImageIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},addImage:function(t,e){this.images.push({gid:t,image:e}),this.total++}},r.ImageCollection.prototype.constructor=r.ImageCollection,r.Tile=function(t,e,i,n,r,o){this.layer=t,this.index=e,this.x=i,this.y=n,this.rotation=0,this.flipped=!1,this.worldX=i*r,this.worldY=n*o,this.width=r,this.height=o,this.centerX=Math.abs(r/2),this.centerY=Math.abs(o/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},r.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,n){return!(i<=this.worldX)&&(!(n<=this.worldY)&&(!(t>=this.worldX+this.width)&&!(e>=this.worldY+this.height)))},setCollisionCallback:function(t,e){this.collisionCallback=t,this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(t,e,i,n){this.collideLeft=t,this.collideRight=e,this.collideUp=i,this.collideDown=n,this.faceLeft=t,this.faceRight=e,this.faceTop=i,this.faceBottom=n},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(t,e){return t&&e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:!!e&&(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)},copy:function(t){this.index=t.index,this.alpha=t.alpha,this.properties=t.properties,this.collideUp=t.collideUp,this.collideDown=t.collideDown,this.collideLeft=t.collideLeft,this.collideRight=t.collideRight,this.collisionCallback=t.collisionCallback,this.collisionCallbackContext=t.collisionCallbackContext}},r.Tile.prototype.constructor=r.Tile,Object.defineProperty(r.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(r.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(r.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(r.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(r.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(r.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),r.Tilemap=function(t,e,i,n,o,s){this.game=t,this.key=e;var a=r.TilemapParser.parse(this.game,e,i,n,o,s);null!==a&&(this.width=a.width,this.height=a.height,this.tileWidth=a.tileWidth,this.tileHeight=a.tileHeight,this.orientation=a.orientation,this.format=a.format,this.version=a.version,this.properties=a.properties,this.widthInPixels=a.widthInPixels,this.heightInPixels=a.heightInPixels,this.layers=a.layers,this.tilesets=a.tilesets,this.imagecollections=a.imagecollections,this.tiles=a.tiles,this.objects=a.objects,this.collideIndexes=[],this.collision=a.collision,this.images=a.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},r.Tilemap.CSV=0,r.Tilemap.TILED_JSON=1,r.Tilemap.NORTH=0,r.Tilemap.EAST=1,r.Tilemap.SOUTH=2,r.Tilemap.WEST=3,r.Tilemap.prototype={create:function(t,e,i,n,r,o){return void 0===o&&(o=this.game.world),this.width=e,this.height=i,this.setTileSize(n,r),this.layers.length=0,this.createBlankLayer(t,e,i,n,r,o)},setTileSize:function(t,e){this.tileWidth=t,this.tileHeight=e,this.widthInPixels=this.width*t,this.heightInPixels=this.height*e},addTilesetImage:function(t,e,i,n,o,s,a){if(void 0===t)return null;void 0===i&&(i=this.tileWidth),void 0===n&&(n=this.tileHeight),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),0===i&&(i=32),0===n&&(n=32);var h=null;if(void 0!==e&&null!==e||(e=t),e instanceof r.BitmapData)h=e.canvas;else{if(!this.game.cache.checkImageKey(e))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+e+'"'),null;h=this.game.cache.getImage(e)}var u=this.getTilesetIndex(t);if(null===u&&this.format===r.Tilemap.TILED_JSON)return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+t+'"'),console.log("Tilesets: ",this.tilesets),null;if(this.tilesets[u])return this.tilesets[u].setImage(h),this.tilesets[u];var c=new r.Tileset(t,a,i,n,o,s,{});c.setImage(h),this.tilesets.push(c);for(var l=this.tilesets.length-1,d=o,p=o,f=0,m=0,g=0,y=a;y<a+c.total&&(this.tiles[y]=[d,p,l],d+=i+s,++f!==c.total)&&(++m!==c.columns||(d=o,p+=n+s,m=0,++g!==c.rows));y++);return c},createFromObjects:function(t,e,i,n,o,s,a,h,u,c){if(void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===a&&(a=this.game.world),void 0===h&&(h=r.Sprite),void 0===u&&(u=!0),void 0===c&&(c=!0),!this.objects[t])return console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t),void console.log("Objects: ",this.objects);for(var l=0;l<this.objects[t].length;l++){var d=!1,p=this.objects[t][l];if(void 0!==p.gid&&"number"==typeof e&&p.gid===e?d=!0:void 0!==p.id&&"number"==typeof e&&p.id===e?d=!0:void 0!==p.name&&"string"==typeof e&&p.name===e&&(d=!0),d){var f=new h(this.game,parseFloat(p.x,10),parseFloat(p.y,10),i,n);f.name=p.name,f.autoCull=s,f.exists=o,f.visible=p.visible,c&&(p.width&&(f.width=p.width),p.height&&(f.height=p.height)),p.rotation&&(f.angle=p.rotation),u&&(f.y-=f.height),a.add(f);for(var m in p.properties)a.set(f,m,p.properties[m],!1,!1,0,!0)}}},createFromTiles:function(t,e,i,n,o,s){"number"==typeof t&&(t=[t]),void 0===e||null===e?e=[]:"number"==typeof e&&(e=[e]),n=this.getLayer(n),void 0===o&&(o=this.game.world),void 0===s&&(s={}),void 0===s.customClass&&(s.customClass=r.Sprite),void 0===s.adjustY&&(s.adjustY=!0);var a=this.layers[n].width,h=this.layers[n].height;if(this.copy(0,0,a,h,n),this._results.length<2)return 0;for(var u,c=0,l=1,d=this._results.length;l<d;l++)if(-1!==t.indexOf(this._results[l].index)){u=new s.customClass(this.game,this._results[l].worldX,this._results[l].worldY,i);for(var p in s)u[p]=s[p];o.add(u),c++}if(1===e.length)for(l=0;l<t.length;l++)this.replace(t[l],e[0],0,0,a,h,n);else if(e.length>1)for(l=0;l<t.length;l++)this.replace(t[l],e[l],0,0,a,h,n);return c},createLayer:function(t,e,i,n){void 0===e&&(e=this.game.width),void 0===i&&(i=this.game.height),void 0===n&&(n=this.game.world);var o=t;if("string"==typeof t&&(o=this.getLayerIndex(t)),null===o||o>this.layers.length)return console.warn('Tilemap.createLayer: Invalid layer ID given: "'+t+'"'),void console.log("Layers: ",this.layers);void 0===e||e<=0?e=Math.min(this.game.width,this.layers[o].widthInPixels):e>this.game.width&&(e=this.game.width),void 0===i||i<=0?i=Math.min(this.game.height,this.layers[o].heightInPixels):i>this.game.height&&(i=this.game.height),this.enableDebug&&(console.group("Tilemap.createLayer"),console.log("Name:",this.layers[o].name),console.log("Size:",e,"x",i),console.log("Tileset:",this.tilesets[0].name,"index:",o));var s=n.add(new r.TilemapLayer(this.game,this,o,e,i));return this.enableDebug&&console.groupEnd(),s},createBlankLayer:function(t,e,i,n,o,s){void 0===s&&(s=this.game.world);if(null===this.getLayerIndex(t)){for(var a,h={name:t,x:0,y:0,width:e,height:i,widthInPixels:e*n,heightInPixels:i*o,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},u=[],c=0;c<i;c++){a=[];for(var l=0;l<e;l++)a.push(new r.Tile(h,-1,l,c,n,o));u.push(a)}h.data=u,this.layers.push(h),this.currentLayer=this.layers.length-1;var d=h.widthInPixels,p=h.heightInPixels;d>this.game.width&&(d=this.game.width),p>this.game.height&&(p=this.game.height);return(u=new r.TilemapLayer(this.game,this,this.layers.length-1,d,p)).name=t,s.add(u)}console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+t)},getIndex:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name===e)return i;return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},setTileIndexCallback:function(t,e,i,n){if(n=this.getLayer(n),"number"==typeof t)null===e?delete this.layers[n].callbacks[t]:this.layers[n].callbacks[t]={callback:e,callbackContext:i};else for(var r=0,o=t.length;r<o;r++)null===e?delete this.layers[n].callbacks[t[r]]:this.layers[n].callbacks[t[r]]={callback:e,callbackContext:i}},setTileLocationCallback:function(t,e,i,n,r,o,s){if(s=this.getLayer(s),this.copy(t,e,i,n,s),!(this._results.length<2))for(var a=1;a<this._results.length;a++)this._results[a].setCollisionCallback(r,o)},setCollision:function(t,e,i,n){if(void 0===e&&(e=!0),void 0===n&&(n=!0),i=this.getLayer(i),"number"==typeof t)return this.setCollisionByIndex(t,e,i,!0);if(Array.isArray(t)){for(var r=0;r<t.length;r++)this.setCollisionByIndex(t[r],e,i,!1);n&&this.calculateFaces(i)}},setCollisionBetween:function(t,e,i,n,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n=this.getLayer(n),!(t>e)){for(var o=t;o<=e;o++)this.setCollisionByIndex(o,i,n,!1);r&&this.calculateFaces(n)}},setCollisionByExclusion:function(t,e,i,n){void 0===e&&(e=!0),void 0===n&&(n=!0),i=this.getLayer(i);for(var r=0,o=this.tiles.length;r<o;r++)-1===t.indexOf(r)&&this.setCollisionByIndex(r,e,i,!1);n&&this.calculateFaces(i)},setCollisionByIndex:function(t,e,i,n){if(void 0===e&&(e=!0),void 0===i&&(i=this.currentLayer),void 0===n&&(n=!0),e)this.collideIndexes.push(t);else{var r=this.collideIndexes.indexOf(t);r>-1&&this.collideIndexes.splice(r,1)}for(var o=0;o<this.layers[i].height;o++)for(var s=0;s<this.layers[i].width;s++){var a=this.layers[i].data[o][s];a&&a.index===t&&(e?a.setCollision(!0,!0,!0,!0):a.resetCollision(),a.faceTop=e,a.faceBottom=e,a.faceLeft=e,a.faceRight=e)}return n&&this.calculateFaces(i),i},getLayer:function(t){if(void 0===t)t=this.currentLayer;else if("string"==typeof t){var e=t;(t=this.getLayerIndex(t))||console.warn("No such layer name: "+e)}else t instanceof r.TilemapLayer&&(t=t.index);return t},setPreventRecalculate:function(t){if(!0===t&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate={}),!1===t&&!0===this.preventingRecalculate){this.preventingRecalculate=!1;for(var e in this.needToRecalculate)this.calculateFaces(e);this.needToRecalculate=!1}},calculateFaces:function(t){if(this.preventingRecalculate)this.needToRecalculate[t]=!0;else for(var e=null,i=null,n=null,r=null,o=0,s=this.layers[t].height;o<s;o++)for(var a=0,h=this.layers[t].width;a<h;a++){var u=this.layers[t].data[o][a];u&&(e=this.getTileAbove(t,a,o),i=this.getTileBelow(t,a,o),n=this.getTileLeft(t,a,o),r=this.getTileRight(t,a,o),u.collides&&(u.faceTop=!0,u.faceBottom=!0,u.faceLeft=!0,u.faceRight=!0),e&&e.collides&&(u.faceTop=!1),i&&i.collides&&(u.faceBottom=!1),n&&n.collides&&(u.faceLeft=!1),r&&r.collides&&(u.faceRight=!1))}},getTileAbove:function(t,e,i){return i>0?this.layers[t].data[i-1][e]:null},getTileBelow:function(t,e,i){return i<this.layers[t].height-1?this.layers[t].data[i+1][e]:null},getTileLeft:function(t,e,i){return e>0?this.layers[t].data[i][e-1]:null},getTileRight:function(t,e,i){return e<this.layers[t].width-1?this.layers[t].data[i][e+1]:null},setLayer:function(t){t=this.getLayer(t),this.layers[t]&&(this.currentLayer=t)},hasTile:function(t,e,i){return i=this.getLayer(i),void 0!==this.layers[i].data[e]&&void 0!==this.layers[i].data[e][t]&&this.layers[i].data[e][t].index>-1},removeTile:function(t,e,i){if(i=this.getLayer(i),t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height&&this.hasTile(t,e,i)){var n=this.layers[i].data[e][t];return this.layers[i].data[e][t]=new r.Tile(this.layers[i],-1,t,e,this.tileWidth,this.tileHeight),this.layers[i].dirty=!0,this.calculateFaces(i),n}},removeTileWorldXY:function(t,e,i,n,r){return r=this.getLayer(r),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.removeTile(t,e,r)},putTile:function(t,e,i,n){if(null===t)return this.removeTile(e,i,n);if(n=this.getLayer(n),e>=0&&e<this.layers[n].width&&i>=0&&i<this.layers[n].height){var o;return t instanceof r.Tile?(o=t.index,this.hasTile(e,i,n)?this.layers[n].data[i][e].copy(t):this.layers[n].data[i][e]=new r.Tile(n,o,e,i,t.width,t.height)):(o=t,this.hasTile(e,i,n)?this.layers[n].data[i][e].index=o:this.layers[n].data[i][e]=new r.Tile(this.layers[n],o,e,i,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(o)>-1?this.layers[n].data[i][e].setCollision(!0,!0,!0,!0):this.layers[n].data[i][e].resetCollision(),this.layers[n].dirty=!0,this.calculateFaces(n),this.layers[n].data[i][e]}return null},putTileWorldXY:function(t,e,i,n,r,o){return o=this.getLayer(o),e=this.game.math.snapToFloor(e,n)/n,i=this.game.math.snapToFloor(i,r)/r,this.putTile(t,e,i,o)},searchTileIndex:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=!1),n=this.getLayer(n);var r=0;if(i){for(var o=this.layers[n].height-1;o>=0;o--)for(var s=this.layers[n].width-1;s>=0;s--)if(this.layers[n].data[o][s].index===t){if(r===e)return this.layers[n].data[o][s];r++}}else for(o=0;o<this.layers[n].height;o++)for(s=0;s<this.layers[n].width;s++)if(this.layers[n].data[o][s].index===t){if(r===e)return this.layers[n].data[o][s];r++}return null},getTile:function(t,e,i,n){return void 0===n&&(n=!1),i=this.getLayer(i),t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height?-1===this.layers[i].data[e][t].index?n?this.layers[i].data[e][t]:null:this.layers[i].data[e][t]:null},getTileWorldXY:function(t,e,i,n,r,o){return void 0===i&&(i=this.tileWidth),void 0===n&&(n=this.tileHeight),r=this.getLayer(r),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.getTile(t,e,r,o)},copy:function(t,e,i,n,r){r=this.getLayer(r);if(this.layers[r]){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.layers[r].width),void 0===n&&(n=this.layers[r].height),t<0&&(t=0),e<0&&(e=0),i>this.layers[r].width&&(i=this.layers[r].width),n>this.layers[r].height&&(n=this.layers[r].height),this._results.length=0,this._results.push({x:t,y:e,width:i,height:n,layer:r});for(var o=e;o<e+n;o++)for(var s=t;s<t+i;s++)this._results.push(this.layers[r].data[o][s]);return this._results}this._results.length=0},paste:function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=0),n=this.getLayer(n),i&&!(i.length<2)){for(var r=t-i[1].x,o=e-i[1].y,s=1;s<i.length;s++)this.layers[n].data[o+i[s].y][r+i[s].x].copy(i[s]);this.layers[n].dirty=!0,this.calculateFaces(n)}},swap:function(t,e,i,n,r,o,s){s=this.getLayer(s),this.copy(i,n,r,o,s),this._results.length<2||(this._tempA=t,this._tempB=e,this._results.forEach(this.swapHandler,this),this.paste(i,n,this._results,s))},swapHandler:function(t){t.index===this._tempA?t.index=this._tempB:t.index===this._tempB&&(t.index=this._tempA)},forEach:function(t,e,i,n,r,o,s){s=this.getLayer(s),this.copy(i,n,r,o,s),this._results.length<2||(this._results.forEach(t,e),this.paste(i,n,this._results,s))},replace:function(t,e,i,n,r,o,s){if(s=this.getLayer(s),this.copy(i,n,r,o,s),!(this._results.length<2)){for(var a=1;a<this._results.length;a++)this._results[a].index===t&&(this._results[a].index=e);this.paste(i,n,this._results,s)}},random:function(t,e,i,n,r){if(r=this.getLayer(r),this.copy(t,e,i,n,r),!(this._results.length<2)){for(var o=[],s=1;s<this._results.length;s++)if(this._results[s].index){var a=this._results[s].index;-1===o.indexOf(a)&&o.push(a)}for(var h=1;h<this._results.length;h++)this._results[h].index=this.game.rnd.pick(o);this.paste(t,e,this._results,r)}},shuffle:function(t,e,i,n,o){if(o=this.getLayer(o),this.copy(t,e,i,n,o),!(this._results.length<2)){for(var s=[],a=1;a<this._results.length;a++)this._results[a].index&&s.push(this._results[a].index);r.ArrayUtils.shuffle(s);for(var h=1;h<this._results.length;h++)this._results[h].index=s[h-1];this.paste(t,e,this._results,o)}},fill:function(t,e,i,n,r,o){if(o=this.getLayer(o),this.copy(e,i,n,r,o),!(this._results.length<2)){for(var s=1;s<this._results.length;s++)this._results[s].index=t;this.paste(e,i,this._results,o)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var t="",e=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(var n=0;n<this.layers[this.currentLayer].width;n++)t+="%c  ",this.layers[this.currentLayer].data[i][n]>1?this.debugMap[this.layers[this.currentLayer].data[i][n]]?e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):e.push("background: #ffffff"):e.push("background: rgb(0, 0, 0)");t+="\n"}e[0]=t,console.log.apply(console,e)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},r.Tilemap.prototype.constructor=r.Tilemap,Object.defineProperty(r.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){t!==this.currentLayer&&this.setLayer(t)}}),r.TilemapLayer=function(t,e,i,n,o){n|=0,o|=0,r.Sprite.call(this,t,0,0),this.map=e,this.index=i,this.layer=e.layers[i],this.canvas=r.CanvasPool.create(this,n,o),this.context=this.canvas.getContext("2d"),this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas,null,this.game.resolution))),this.type=r.TILEMAPLAYER,this.physicsType=r.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:e.tileWidth,tileHeight:e.tileHeight,cw:e.tileWidth,ch:e.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this.tileOffset=new r.Point(this.layer.offsetX||0,this.layer.offsetY||0),this._results=[],t.device.canvasBitBltShift||(this.renderSettings.copyCanvas=r.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},r.TilemapLayer.prototype=Object.create(r.Sprite.prototype),r.TilemapLayer.prototype.constructor=r.TilemapLayer,r.TilemapLayer.prototype.preUpdateCore=r.Component.Core.preUpdate,r.TilemapLayer.sharedCopyCanvas=null,r.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=r.CanvasPool.create(this,2,2)),this.sharedCopyCanvas},r.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},r.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y},r.TilemapLayer.prototype._renderCanvas=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderCanvas.call(this,t)},r.TilemapLayer.prototype._renderWebGL=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderWebGL.call(this,t)},r.TilemapLayer.prototype.destroy=function(){r.CanvasPool.remove(this),r.Component.Destroy.prototype.destroy.call(this)},r.TilemapLayer.prototype.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.texture.frame.resize(t,e),this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.texture.baseTexture.width=t,this.texture.baseTexture.height=e,this.texture.baseTexture.dirty(),this.texture.requiresUpdate=!0,this.texture._updateUvs(),this.dirty=!0},r.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},r.TilemapLayer.prototype.getTileOffsetX=function(){return this.tileOffset.x||(this.fixedToCamera?0:this.position.x)},r.TilemapLayer.prototype.getTileOffsetY=function(){return this.tileOffset.y||(this.fixedToCamera?0:this.position.y)},r.TilemapLayer.prototype._fixX=function(t){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?t:0===this.scrollFactorX&&0!==this.position.x?t-this.position.x:this._scrollX+(t-this._scrollX/this.scrollFactorX)},r.TilemapLayer.prototype._unfixX=function(t){return 1===this.scrollFactorX?t:this._scrollX/this.scrollFactorX+(t-this._scrollX)},r.TilemapLayer.prototype._fixY=function(t){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?t:0===this.scrollFactorY&&0!==this.position.y?t-this.position.y:this._scrollY+(t-this._scrollY/this.scrollFactorY)},r.TilemapLayer.prototype._unfixY=function(t){return 1===this.scrollFactorY?t:this._scrollY/this.scrollFactorY+(t-this._scrollY)},r.TilemapLayer.prototype.getTileX=function(t){return Math.floor(this._fixX(t)/this._mc.tileWidth)},r.TilemapLayer.prototype.getTileY=function(t){return Math.floor(this._fixY(t)/this._mc.tileHeight)},r.TilemapLayer.prototype.getTileXY=function(t,e,i){return i.x=this.getTileX(t),i.y=this.getTileY(e),i},r.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,n){e||(e=this.rayStepRate),void 0===i&&(i=!1),void 0===n&&(n=!1);var r=this.getTiles(t.x,t.y,t.width,t.height,i,n);if(0===r.length)return[];for(var o=t.coordinatesOnLine(e),s=[],a=0;a<r.length;a++)for(var h=0;h<o.length;h++){var u=r[a],c=o[h];if(u.containsPoint(c[0],c[1])){s.push(u);break}}return s},r.TilemapLayer.prototype.getTiles=function(t,e,i,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1);var s=!(r||o);t=this._fixX(t),e=this._fixY(e);for(var a=Math.floor(t/(this._mc.cw*this.scale.x)),h=Math.floor(e/(this._mc.ch*this.scale.y)),u=Math.ceil((t+i)/(this._mc.cw*this.scale.x))-a,c=Math.ceil((e+n)/(this._mc.ch*this.scale.y))-h;this._results.length;)this._results.pop();for(var l=h;l<h+c;l++)for(var d=a;d<a+u;d++){var p=this.layer.data[l];p&&p[d]&&(s||p[d].isInteresting(r,o))&&this._results.push(p[d])}return this._results.slice()},r.TilemapLayer.prototype.resolveTileset=function(t){var e=this._mc.tilesets;if(t<2e3)for(;e.length<t;)e.push(void 0);var i=this.map.tiles[t]&&this.map.tiles[t][2];if(null!==i){var n=this.map.tilesets[i];if(n&&n.containsTileIndex(t))return e[t]=n}return e[t]=null},r.TilemapLayer.prototype.resetTilesetCache=function(){for(var t=this._mc.tilesets;t.length;)t.pop()},r.TilemapLayer.prototype.setScale=function(t,e){t=t||1,e=e||t;for(var i=0;i<this.layer.data.length;i++)for(var n=this.layer.data[i],r=0;r<n.length;r++){var o=n[r];o.width=this.map.tileWidth*t,o.height=this.map.tileHeight*e,o.worldX=o.x*o.width,o.worldY=o.y*o.height}this.scale.setTo(t,e)},r.TilemapLayer.prototype.shiftCanvas=function(t,e,i){var n=t.canvas,r=n.width-Math.abs(e),o=n.height-Math.abs(i),s=0,a=0,h=e,u=i;e<0&&(s=-e,h=0),i<0&&(a=-i,u=0);var c=this.renderSettings.copyCanvas;if(c){(c.width<r||c.height<o)&&(c.width=r,c.height=o);var l=c.getContext("2d");l.clearRect(0,0,r,o),l.drawImage(n,s,a,r,o,0,0,r,o),t.clearRect(h,u,r,o),t.drawImage(c,0,0,r,o,h,u,r,o)}else t.save(),t.globalCompositeOperation="copy",t.drawImage(n,s,a,r,o,h,u,r,o),t.restore()},r.TilemapLayer.prototype.renderRegion=function(t,e,i,n,r,o){var s=this.context,a=this.layer.width,h=this.layer.height,u=this._mc.tileWidth,c=this._mc.tileHeight,l=this._mc.tilesets,d=NaN;this._wrap||(i<=r&&(i=Math.max(0,i),r=Math.min(a-1,r)),n<=o&&(n=Math.max(0,n),o=Math.min(h-1,o)));var p,f,m,g,y,v,b=i*u-t,x=(i+(1<<20)*a)%a;for(g=(n+(1<<20)*h)%h,v=o-n,f=n*c-e;v>=0;g++,v--,f+=c){g>=h&&(g-=h);var _=this.layer.data[g];for(m=x,y=r-i,p=b;y>=0;m++,y--,p+=u){m>=a&&(m-=a);var w=_[m];if(w&&!(w.index<0)){var T=w.index,S=l[T];void 0===S&&(S=this.resolveTileset(T)),w.alpha===d||this.debug||(s.globalAlpha=w.alpha,d=w.alpha),S?w.rotation||w.flipped?(s.save(),s.translate(p+w.centerX,f+w.centerY),s.rotate(w.rotation),w.flipped&&s.scale(-1,1),S.draw(s,-w.centerX,-w.centerY,T),s.restore()):S.draw(s,p,f,T):this.debugSettings.missingImageFill&&(s.fillStyle=this.debugSettings.missingImageFill,s.fillRect(p,f,u,c)),w.debug&&this.debugSettings.debuggedTileOverfill&&(s.fillStyle=this.debugSettings.debuggedTileOverfill,s.fillRect(p,f,u,c))}}}},r.TilemapLayer.prototype.renderDeltaScroll=function(t,e){var i=this._mc.scrollX,n=this._mc.scrollY,r=this.canvas.width,o=this.canvas.height,s=this._mc.tileWidth,a=this._mc.tileHeight,h=0,u=-s,c=0,l=-a;if(t<0?(h=r+t,u=r-1):t>0&&(u=t),e<0?(c=o+e,l=o-1):e>0&&(l=e),this.shiftCanvas(this.context,t,e),h=Math.floor((h+i)/s),u=Math.floor((u+i)/s),c=Math.floor((c+n)/a),l=Math.floor((l+n)/a),h<=u){this.context.clearRect(h*s-i,0,(u-h+1)*s,o);var d=Math.floor((0+n)/a),p=Math.floor((o-1+n)/a);this.renderRegion(i,n,h,d,u,p)}if(c<=l){this.context.clearRect(0,c*a-n,r,(l-c+1)*a);var f=Math.floor((0+i)/s),m=Math.floor((r-1+i)/s);this.renderRegion(i,n,f,c,m,l)}},r.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX,e=this._mc.scrollY,i=this.canvas.width,n=this.canvas.height,r=this._mc.tileWidth,o=this._mc.tileHeight,s=Math.floor(t/r),a=Math.floor((i-1+t)/r),h=Math.floor(e/o),u=Math.floor((n-1+e)/o);this.context.clearRect(0,0,i,n),this.renderRegion(t,e,s,h,a,u)},r.TilemapLayer.prototype.render=function(){var t=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,t=!0);var e=this.canvas.width,i=this.canvas.height,n=0|this._scrollX,r=0|this._scrollY,o=this._mc,s=o.scrollX-n,a=o.scrollY-r;if(t||0!==s||0!==a||o.renderWidth!==e||o.renderHeight!==i)return this.context.save(),o.scrollX=n,o.scrollY=r,o.renderWidth===e&&o.renderHeight===i||(o.renderWidth=e,o.renderHeight=i),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(t=!0)),!t&&this.renderSettings.enableScrollDelta&&Math.abs(s)+Math.abs(a)<Math.min(e,i)?this.renderDeltaScroll(s,a):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}},r.TilemapLayer.prototype.renderDebug=function(){var t,e,i,n,r,o,s=this._mc.scrollX,a=this._mc.scrollY,h=this.context,u=this.canvas.width,c=this.canvas.height,l=this.layer.width,d=this.layer.height,p=this._mc.tileWidth,f=this._mc.tileHeight,m=Math.floor(s/p),g=Math.floor((u-1+s)/p),y=Math.floor(a/f),v=Math.floor((c-1+a)/f),b=m*p-s,x=y*f-a,_=(m+(1<<20)*l)%l,w=(y+(1<<20)*d)%d;for(h.strokeStyle=this.debugSettings.facingEdgeStroke,n=w,o=v-y,e=x;o>=0;n++,o--,e+=f){n>=d&&(n-=d);var T=this.layer.data[n];for(i=_,r=g-m,t=b;r>=0;i++,r--,t+=p){i>=l&&(i-=l);var S=T[i];!S||S.index<0||!S.collides||(this.debugSettings.collidingTileOverfill&&(h.fillStyle=this.debugSettings.collidingTileOverfill,h.fillRect(t,e,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(h.beginPath(),S.faceTop&&(h.moveTo(t,e),h.lineTo(t+this._mc.cw,e)),S.faceBottom&&(h.moveTo(t,e+this._mc.ch),h.lineTo(t+this._mc.cw,e+this._mc.ch)),S.faceLeft&&(h.moveTo(t,e),h.lineTo(t,e+this._mc.ch)),S.faceRight&&(h.moveTo(t+this._mc.cw,e),h.lineTo(t+this._mc.cw,e+this._mc.ch)),h.closePath(),h.stroke()))}}},Object.defineProperty(r.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(t){this._wrap=t,this.dirty=!0}}),Object.defineProperty(r.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(t){this._scrollX=t}}),Object.defineProperty(r.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(t){this._scrollY=t}}),Object.defineProperty(r.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=0|t,this.dirty=!0}}),Object.defineProperty(r.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=0|t,this.dirty=!0}}),r.TilemapParser={INSERT_NULL:!1,parse:function(t,e,i,n,o,s){if(void 0===i&&(i=32),void 0===n&&(n=32),void 0===o&&(o=10),void 0===s&&(s=10),void 0===e)return this.getEmptyData();if(null===e)return this.getEmptyData(i,n,o,s);var a=t.cache.getTilemapData(e);if(a){if(a.format===r.Tilemap.CSV)return this.parseCSV(e,a.data,i,n);if(!a.format||a.format===r.Tilemap.TILED_JSON)return this.parseTiledJSON(a.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+e)},parseCSV:function(t,e,i,n){for(var o=this.getEmptyData(),s=[],a=(e=e.trim()).split("\n"),h=a.length,u=0,c=0;c<a.length;c++){s[c]=[];for(var l=a[c].split(","),d=0;d<l.length;d++)s[c][d]=new r.Tile(o.layers[0],parseInt(l[d],10),d,c,i,n);0===u&&(u=l.length)}return o.format=r.Tilemap.CSV,o.name=t,o.width=u,o.height=h,o.tileWidth=i,o.tileHeight=n,o.widthInPixels=u*i,o.heightInPixels=h*n,o.layers[0].width=u,o.layers[0].height=h,o.layers[0].widthInPixels=o.widthInPixels,o.layers[0].heightInPixels=o.heightInPixels,o.layers[0].data=s,o},getEmptyData:function(t,e,i,n){return{width:void 0!==i&&null!==i?i:0,height:void 0!==n&&null!==n?n:0,tileWidth:void 0!==t&&null!==t?t:0,tileHeight:void 0!==e&&null!==e?e:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},_slice:function(t,e){var i={};for(var n in e){var r=e[n];"undefined"!=typeof t[r]&&(i[r]=t[r])}return i},parseObjectGroup:function(t,e,i,n,r){n=n||t.name,r=r||{x:0,y:0};var o=this._slice;n||console.warn("No name found for objectGroup",t),void 0!==r.x&&void 0!==r.y||console.warn("Malformed xy properties in relativePosition",r),e[n]=e[n]||[],i[n]=i[n]||[];for(var s=0,a=t.objects.length;s<a;s++){var h=t.objects[s];if(h.gid){var u={gid:h.gid,name:h.name,type:h.type||"",x:h.x+r.x,y:h.y+r.y,width:h.width,height:h.height,visible:h.visible,properties:h.properties};h.rotation&&(u.rotation=h.rotation),e[n].push(u)}else if(h.polyline){u={name:h.name,type:h.type,x:h.x+r.x,y:h.y+r.y,width:h.width,height:h.height,visible:h.visible,properties:h.properties};h.rotation&&(u.rotation=h.rotation),u.polyline=[];for(var c=0;c<h.polyline.length;c++)u.polyline.push([h.polyline[c].x,h.polyline[c].y]);i[n].push(u),e[n].push(u)}else if(h.polygon){(u=o(h,["name","type","x","y","visible","rotation","properties"])).x+=r.x,u.y+=r.y,u.polygon=[];for(c=0;c<h.polygon.length;c++)u.polygon.push([h.polygon[c].x,h.polygon[c].y]);i[n].push(u),e[n].push(u)}else if(h.ellipse){(u=o(h,["name","type","ellipse","x","y","width","height","visible","rotation","properties"])).x+=r.x,u.y+=r.y,i[n].push(u),e[n].push(u)}else{(u=o(h,["name","type","x","y","width","height","visible","rotation","properties"])).x+=r.x,u.y+=r.y,u.rectangle=!0,i[n].push(u),e[n].push(u)}}return{objectsCollection:e,collisionCollection:i}},parseTiledJSON:function(t){if("orthogonal"!==t.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;for(var e={width:t.width,height:t.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,orientation:t.orientation,format:r.Tilemap.TILED_JSON,version:t.version,properties:t.properties,widthInPixels:t.width*t.tilewidth,heightInPixels:t.height*t.tileheight},i=[],n=0;n<t.layers.length;n++)if("tilelayer"===t.layers[n].type){var o=t.layers[n];if(!o.compression&&o.encoding&&"base64"===o.encoding){for(var s=window.atob(o.data),a=s.length,h=new Array(a),u=0;u<a;u+=4)h[u/4]=(s.charCodeAt(u)|s.charCodeAt(u+1)<<8|s.charCodeAt(u+2)<<16|s.charCodeAt(u+3)<<24)>>>0;o.data=h,delete o.encoding}else if(o.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+o.name+"'");continue}var c={name:o.name,x:o.x,y:o.y,width:o.width,height:o.height,widthInPixels:o.width*t.tilewidth,heightInPixels:o.height*t.tileheight,alpha:o.opacity,offsetX:o.offsetx,offsetY:o.offsety,visible:o.visible,properties:{},indexes:[],callbacks:[],bodies:[]};o.properties&&(c.properties=o.properties);var l,d,p,f=0,m=[],g=[],y=0;for(a=o.data.length;y<a;y++){if(l=0,d=!1,M=o.data[y],p=0,M>536870912)switch(M>2147483648&&(M-=2147483648,p+=4),M>1073741824&&(M-=1073741824,p+=2),M>536870912&&(M-=536870912,p+=1),p){case 5:l=Math.PI/2;break;case 6:l=Math.PI;break;case 3:l=3*Math.PI/2;break;case 4:l=0,d=!0;break;case 7:l=Math.PI/2,d=!0;break;case 2:l=Math.PI,d=!0;break;case 1:l=3*Math.PI/2,d=!0}if(M>0){(D=new r.Tile(c,M,f,g.length,t.tilewidth,t.tileheight)).rotation=l,D.flipped=d,0!==p&&(D.flippedVal=p),m.push(D)}else r.TilemapParser.INSERT_NULL?m.push(null):m.push(new r.Tile(c,-1,f,g.length,t.tilewidth,t.tileheight));++f===o.width&&(g.push(m),f=0,m=[])}c.data=g,i.push(c)}e.layers=i;var v=[];for(n=0;n<t.layers.length;n++)if("imagelayer"===t.layers[n].type){var b=t.layers[n],x={name:b.name,image:b.image,x:b.x,y:b.y,alpha:b.opacity,visible:b.visible,properties:{}};b.properties&&(x.properties=b.properties),v.push(x)}e.images=v;var _=[],w={},T=[],S=null;for(n=0;n<t.tilesets.length;n++){if((U=t.tilesets[n]).source)console.warn("Phaser.TilemapParser - Phaser can't load external tilesets (%s). Use the Embed Tileset button and then export the map again.",U.source);else if(U.image){var E=new r.Tileset(U.name,U.firstgid,U.tilewidth,U.tileheight,U.margin,U.spacing,U.properties);U.tileproperties&&(E.tileProperties=U.tileproperties),E.updateTileData(U.imagewidth,U.imageheight),_.push(E)}else{if(!U.tiles)throw new Error("Tileset "+U.name+" has no `image` or `tiles` property.");var C=new r.ImageCollection(U.name,U.firstgid,U.tilewidth,U.tileheight,U.margin,U.spacing,U.properties);for(var P in U.tiles){x=U.tiles[P].image;var M=U.firstgid+parseInt(P,10);C.addImage(M,x)}T.push(C)}for(var P in U.tiles){(L=U.tiles[P].objectgroup)&&(w[parseInt(P,10)+U.firstgid]=L)}S&&(S.lastgid=U.firstgid-1),S=U}if(0===_.length&&0===T.length)throw new Error("This tilemap has no tilesets.");e.tilesets=_,e.imagecollections=T;var A={},R={};for(n=0;n<t.layers.length;n++)if("objectgroup"===t.layers[n].type){var L=t.layers[n];this.parseObjectGroup(L,A,R)}e.objects=A,e.collision=R,e.tiles=[];for(n=0;n<e.tilesets.length;n++){f=(U=e.tilesets[n]).tileMargin;var O=U.tileMargin,I=0,B=0,k=0;for(y=U.firstgid;y<U.firstgid+U.total&&(e.tiles[y]=[f,O,n],f+=U.tileWidth+U.tileSpacing,++I!==U.total)&&(++B!==U.columns||(f=U.tileMargin,O+=U.tileHeight+U.tileSpacing,B=0,++k!==U.rows));y++);}var D,F,U;for(n=0;n<e.layers.length;n++){R[(c=e.layers[n]).name]=[],U=null;for(u=0;u<c.data.length;u++){m=c.data[u];for(var N=0;N<m.length;N++)if(!(null===(D=m[N])||D.index<0)){F=e.tiles[D.index][2],(U=e.tilesets[F]).tileProperties&&U.tileProperties[D.index-U.firstgid]&&(D.properties=r.Utils.mixin(U.tileProperties[D.index-U.firstgid],D.properties));(L=w[D.index])&&this.parseObjectGroup(L,e.objects,e.collision,D.layer.name,{x:D.worldX+L.x,y:D.worldY+L.y})}}}return e}},r.Tileset=function(t,e,i,n,r,o,s){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===r&&(r=0),void 0===o&&(o=0),this.name=t,this.firstgid=0|e,this.tileWidth=0|i,this.tileHeight=0|n,this.tileMargin=0|r,this.tileSpacing=0|o,this.properties=s||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},r.Tileset.prototype={draw:function(t,e,i,n){var r=n-this.firstgid<<1;r>=0&&r+1<this.drawCoords.length&&t.drawImage(this.image,this.drawCoords[r],this.drawCoords[r+1],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},setImage:function(t){this.image=t,this.updateTileData(t.width,t.height)},setSpacing:function(t,e){this.tileMargin=0|t,this.tileSpacing=0|e,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(t,e){var i=(e-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),n=(t-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);i%1==0&&n%1==0||console.warn("Phaser.Tileset - '%s' image tile area (%s x %s) is not a whole multiple of tile size (%s x %s + %s + %s)",this.name,t,e,this.tileWidth,this.tileHeight,this.tileMargin,this.tileSpacing),i=Math.floor(i),n=Math.floor(n),(this.rows&&this.rows!==i||this.columns&&this.columns!==n)&&console.warn("Phaser.Tileset - Tile layout from image '%s' (%s rows by %s columns) differs from tileset '%s' (%s rows by %s columns)",this.image.name,n,i,this.name,this.columns,this.rows),this.rows=i,this.columns=n,this.total=i*n,this.drawCoords.length=0;for(var r=this.tileMargin,o=this.tileMargin,s=0;s<this.rows;s++){for(var a=0;a<this.columns;a++)this.drawCoords.push(r),this.drawCoords.push(o),r+=this.tileWidth+this.tileSpacing;r=this.tileMargin,o+=this.tileHeight+this.tileSpacing}}},r.Tileset.prototype.constructor=r.Tileset,r.Particle=function(t,e,i,n,o){r.Sprite.call(this,t,e,i,n,o),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},r.Particle.prototype=Object.create(r.Sprite.prototype),r.Particle.prototype.constructor=r.Particle,r.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},r.Particle.prototype.onEmit=function(){},r.Particle.prototype.setAlphaData=function(t){this.alphaData=t,this._a=t.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},r.Particle.prototype.setScaleData=function(t){this.scaleData=t,this._s=t.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},r.Particle.prototype.reset=function(t,e,i){return r.Component.Reset.prototype.reset.call(this,t,e,i),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},r.Particles=function(t){this.game=t,this.emitters={},this.ID=0},r.Particles.prototype={add:function(t){return this.emitters[t.id]=t,t},remove:function(t){delete this.emitters[t.id]},update:function(){for(var t in this.emitters)this.emitters[t].exists&&this.emitters[t].update()}},r.Particles.prototype.constructor=r.Particles,r.Particles.Arcade={},r.Particles.Arcade.Emitter=function(t,e,i,n){this.maxParticles=n||50,r.Group.call(this,t),this._id=this.game.particles.ID++,this.name="emitter"+this.id,this.type=r.EMITTER,this.physicsType=r.GROUP,this.area=new r.Rectangle(e,i,1,1),this.minAngle=null,this.maxAngle=null,this.minSpeed=0,this.maxSpeed=100,this.minParticleSpeed=new r.Point(-100,-100),this.maxParticleSpeed=new r.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.particleClass=r.Particle,this.particleDrag=new r.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new r.Point,this.on=!1,this.particleAnchor=new r.Point(.5,.5),this.blendMode=r.blendModes.NORMAL,this.emitX=e,this.emitY=i,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this.counts={emitted:0,failed:0,totalEmitted:0,totalFailed:0},this._gravity=new r.Point(0,100),this._minParticleScale=new r.Point(1,1),this._maxParticleScale=new r.Point(1,1),this._total=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},r.Particles.Arcade.Emitter.prototype=Object.create(r.Group.prototype),r.Particles.Arcade.Emitter.prototype.constructor=r.Particles.Arcade.Emitter,r.Particles.Arcade.Emitter.prototype.update=function(){if(this.counts.emitted=0,this.counts.failed=0,this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(this._flowQuantity>0){for(var t=0;t<this._flowQuantity;t++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,this._total>0&&this._counter>=this._total&&(this.on=!1));for(t=this.children.length;t--;)this.children[t].exists&&this.children[t].update()},r.Particles.Arcade.Emitter.prototype.makeParticles=function(t,e,i,n,r,o){void 0===e&&(e=0),void 0===i&&(i=this.maxParticles),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=null);var s,a=0,h=t,u=e;for(this._frames=e,i>this.maxParticles&&(this.maxParticles=i);a<i;)Array.isArray(t)&&(h=this.game.rnd.pick(t)),Array.isArray(e)&&(u=this.game.rnd.pick(e)),s=new this.particleClass(this.game,0,0,h,u,o),this.game.physics.arcade.enable(s,!1),s.body.checkCollision.none=!n,s.body.collideWorldBounds=r,s.body.skipQuadTree=!0,s.exists=!1,s.visible=!1,s.anchor.copyFrom(this.particleAnchor),this.add(s),a++;return this},r.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},r.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},r.Particles.Arcade.Emitter.prototype.explode=function(t,e){return void 0===e&&(e=this.maxParticles),this._flowTotal=0,this.start(!0,t,0,e,!1),this},r.Particles.Arcade.Emitter.prototype.flow=function(t,e,i,n,r){return void 0!==e&&null!==e||(e=250),void 0!==i&&0!==i||(i=1),void 0===n&&(n=-1),void 0===r&&(r=!0),i>this.maxParticles&&(i=this.maxParticles),this._counter=0,this._flowQuantity=i,this._flowTotal=n,r?(this.start(!0,t,e,i),this._counter+=i,this.on=!0,this._timer=this.game.time.time+e*this.game.time.slowMotion):this.start(!1,t,e,i),this},r.Particles.Arcade.Emitter.prototype.start=function(t,e,i,n,r){if(void 0===t&&(t=!0),void 0===e&&(e=0),void 0!==i&&null!==i||(i=250),void 0===n&&(n=0),void 0===r&&(r=!1),n>this.maxParticles&&(n=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=e,this.frequency=i,t||r)for(var o=0;o<n;o++)this.emitParticle();else this.on=!0,this._total=n,this._counter=0,this._timer=this.game.time.time+i*this.game.time.slowMotion;return this},r.Particles.Arcade.Emitter.prototype.emitParticle=function(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null);var r=this.getNextParticle();if(null===r)return this.counts.failed++,this.counts.totalFailed++,!1;this.counts.emitted++,this.counts.totalEmitted++;var o=this.game.rnd;void 0!==i&&void 0!==n?r.loadTexture(i,n):void 0!==i&&(r.loadTexture(i),r.frame=Array.isArray(this._frames)?o.pick(this._frames):this._frames);var s=this.emitX,a=this.emitY;return null!==t?s=t:this.width>1&&(s=o.between(this.left,this.right)),null!==e?a=e:this.height>1&&(a=o.between(this.top,this.bottom)),this.resetParticle(r,s,a),!0},r.Particles.Arcade.Emitter.prototype.getNextParticle=function(){for(var t=this.length;t--;){var e=this.next();if(!e.exists)return e}return null},r.Particles.Arcade.Emitter.prototype.resetParticle=function(t,e,i){var n=this.game.rnd;t.reset(e,i),t.angle=0,t.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(t):this.particleSendToBack&&this.sendToBack(t),this.autoScale?t.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?t.scale.set(n.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y?t.scale.set(n.realInRange(this._minParticleScale.x,this._maxParticleScale.x),n.realInRange(this._minParticleScale.y,this._maxParticleScale.y)):t.scale.set(this._minParticleScale.x,this._minParticleScale.y),this.autoAlpha?t.setAlphaData(this.alphaData):t.alpha=n.realInRange(this.minParticleAlpha,this.maxParticleAlpha),t.blendMode=this.blendMode;var r=t.body;r.updateBounds(),r.bounce.copyFrom(this.bounce),r.drag.copyFrom(this.particleDrag),null!=this.minAngle&&null!=this.maxAngle?this.game.physics.arcade.velocityFromAngle(this.minAngle===this.maxAngle?this.minAngle:n.between(this.minAngle,this.maxAngle),this.minSpeed===this.maxSpeed?this.minSpeed:n.between(this.minSpeed,this.maxSpeed),r.velocity):(r.velocity.x=n.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),r.velocity.y=n.between(this.minParticleSpeed.y,this.maxParticleSpeed.y)),r.angularVelocity=n.between(this.minRotation,this.maxRotation),r.gravity.copyFrom(this.gravity),r.angularDrag=this.angularDrag,t.onEmit()},r.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),r.Group.prototype.destroy.call(this,!0,!1)},r.Particles.Arcade.Emitter.prototype.setSize=function(t,e){return this.area.width=t,this.area.height=e,this},r.Particles.Arcade.Emitter.prototype.setXSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.x=t,this.maxParticleSpeed.x=e,this},r.Particles.Arcade.Emitter.prototype.setYSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.y=t,this.maxParticleSpeed.y=e,this},r.Particles.Arcade.Emitter.prototype.setRotation=function(t,e){return t=t||0,e=e||0,this.minRotation=t,this.maxRotation=e,this},r.Particles.Arcade.Emitter.prototype.setAlpha=function(t,e,i,n,o){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=r.Easing.Linear.None),void 0===o&&(o=!1),this.minParticleAlpha=t,this.maxParticleAlpha=e,this.autoAlpha=!1,i>0&&t!==e){var s={v:t},a=this.game.make.tween(s).to({v:e},i,n);a.yoyo(o),this.alphaData=a.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}return this},r.Particles.Arcade.Emitter.prototype.setScale=function(t,e,i,n,o,s,a){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=r.Easing.Linear.None),void 0===a&&(a=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,i),this._maxParticleScale.set(e,n),this.autoScale=!1,o>0&&(t!==e||i!==n)){var h={x:t,y:i},u=this.game.make.tween(h).to({x:e,y:n},o,s);u.yoyo(a),this.scaleData=u.generateData(60),this.scaleData.reverse(),this.autoScale=!0}return this},r.Particles.Arcade.Emitter.prototype.setAngle=function(t,e,i,n){return this.minAngle=t,this.maxAngle=e,null!=i&&(this.minSpeed=i),null!=n&&(this.maxSpeed=n),this},r.Particles.Arcade.Emitter.prototype.at=function(t){return t.center?(this.emitX=t.center.x,this.emitY=t.center.y):(this.emitX=t.world.x+t.anchor.x*t.width,this.emitY=t.world.y+t.anchor.y*t.height),this},Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"gravity",{get:function(){return this._gravity},set:function(t){"number"==typeof t?this._gravity.y=t:this._gravity=t}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(t){this.area.width=t}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(t){this.area.height=t}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(t){this.emitX=t}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(t){this.emitY=t}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"output",{get:function(){return 1e3*this._flowQuantity/this.frequency}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"lifespanOutput",{get:function(){return(0===this.lifespan?1/0:this.lifespan)*this._flowQuantity/this.frequency}}),Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"remainder",{get:function(){return this.maxParticles-this.lifespanOutput}}),r.Weapon=function(t,e){r.Plugin.call(this,t,e),this.bullets=null,this.autoExpandBulletsGroup=!1,this.autofire=!1,this.shots=0,this.fireLimit=0,this.fireRate=100,this.fireRateVariance=0,this.fireFrom=new r.Rectangle(0,0,1,1),this.fireAngle=r.ANGLE_UP,this.bulletInheritSpriteSpeed=!1,this.bulletAnimation="",this.bulletFrameRandom=!1,this.bulletFrameCycle=!1,this.bulletWorldWrap=!1,this.bulletWorldWrapPadding=0,this.bulletAngleOffset=0,this.bulletAngleVariance=0,this.bulletSpeed=200,this.bulletSpeedVariance=0,this.bulletLifespan=0,this.bulletKillDistance=0,this.bulletGravity=new r.Point(0,0),this.bulletRotateToVelocity=!1,this.bulletKey="",this.bulletFrame="",this._bulletClass=r.Bullet,this._bulletCollideWorldBounds=!1,this._bulletKillType=r.Weapon.KILL_WORLD_BOUNDS,this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0},this.bounds=new r.Rectangle,this.bulletBounds=t.world.bounds,this.bulletFrames=[],this.bulletFrameIndex=0,this.anims={},this.onFire=new r.Signal,this.onKill=new r.Signal,this.onFireLimit=new r.Signal,this.trackedSprite=null,this.trackedPointer=null,this.multiFire=!1,this._hasFired=!1,this.trackRotation=!1,this.trackOffset=new r.Point,this._nextFire=0,this._tempNextFire=0,this._rotatedPoint=new r.Point},r.Weapon.prototype=Object.create(r.Plugin.prototype),r.Weapon.prototype.constructor=r.Weapon,r.Weapon.KILL_NEVER=0,r.Weapon.KILL_LIFESPAN=1,r.Weapon.KILL_DISTANCE=2,r.Weapon.KILL_WEAPON_BOUNDS=3,r.Weapon.KILL_CAMERA_BOUNDS=4,r.Weapon.KILL_WORLD_BOUNDS=5,r.Weapon.KILL_STATIC_BOUNDS=6,r.Weapon.prototype.createBullets=function(t,e,i,n){return void 0===t&&(t=1),void 0===n&&(n=this.game.world),this.bullets||(this.bullets=this.game.add.physicsGroup(r.Physics.ARCADE,n),this.bullets.classType=this._bulletClass),0!==t&&(-1===t&&(this.autoExpandBulletsGroup=!0,t=1),this.bullets.createMultiple(t,e,i),this.bullets.setAll("data.bulletManager",this),this.bulletKey=e,this.bulletFrame=i),this},r.Weapon.prototype.forEach=function(t,e){return this.bullets.forEachExists(t,e,arguments),this},r.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this},r.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this},r.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",!0),this},r.Weapon.prototype.resetShots=function(t){return this.shots=0,void 0!==t&&(this.fireLimit=t),this},r.Weapon.prototype.destroy=function(){this.parent.remove(this,!1),this.bullets.destroy(),this.game=null,this.parent=null,this.active=!1,this.visible=!1},r.Weapon.prototype.update=function(){this._bulletKillType===r.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)),this.autofire&&this.fire()},r.Weapon.prototype.postRender=function(){this.multiFire&&this._hasFired&&(this._hasFired=!1,this._nextFire=this._tempNextFire)},r.Weapon.prototype.trackSprite=function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=!1),this.trackedPointer=null,this.trackedSprite=t,this.trackRotation=n,this.trackOffset.set(e,i),this},r.Weapon.prototype.trackPointer=function(t,e,i){return void 0===t&&(t=this.game.input.activePointer),void 0===e&&(e=0),void 0===i&&(i=0),this.trackedPointer=t,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(e,i),this},r.Weapon.prototype.fireMany=function(t,e){this.multiFire=!0;var i=[],n=this;return e||this.trackedSprite||this.trackedPointer?t.forEach(function(t){i.push(n.fire(e,null,null,t.x,t.y))}):t.forEach(function(t){i.push(n.fire(t))}),i},r.Weapon.prototype.fireOffset=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.fire(null,null,null,t,e)},r.Weapon.prototype.fire=function(t,e,i,n,o){if(void 0===e&&(e=null),void 0===i&&(i=null),this.game.time.now<this._nextFire||this.fireLimit>0&&this.shots===this.fireLimit)return null;var s=this.bulletSpeed;0!==this.bulletSpeedVariance&&(s+=r.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)),t?this.fireFrom.width>1?this.fireFrom.centerOn(t.x,t.y):(this.fireFrom.x=t.x,this.fireFrom.y=t.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.worldRotation),this.fireFrom.width>1?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):this.fireFrom.width>1?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(s+=this.trackedSprite.body.speed)):this.trackedPointer&&(this.fireFrom.width>1?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y)),void 0!==n&&(this.fireFrom.x+=n),void 0!==o&&(this.fireFrom.y+=o);var a=this.fireFrom.width>1?this.fireFrom.randomX:this.fireFrom.x,h=this.fireFrom.height>1?this.fireFrom.randomY:this.fireFrom.y,u=this.trackRotation?this.trackedSprite.angle:this.fireAngle;null!==e&&null!==i&&(u=this.game.math.radToDeg(Math.atan2(i-h,e-a))),0!==this.bulletAngleVariance&&(u+=r.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));var c=0,l=0;0===u||180===u?c=Math.cos(this.game.math.degToRad(u))*s:90===u||270===u?l=Math.sin(this.game.math.degToRad(u))*s:(c=Math.cos(this.game.math.degToRad(u))*s,l=Math.sin(this.game.math.degToRad(u))*s);var d=null;if(this.autoExpandBulletsGroup?(d=this.bullets.getFirstExists(!1,!0,a,h,this.bulletKey,this.bulletFrame)).data.bulletManager=this:d=this.bullets.getFirstExists(!1),d){if(d.reset(a,h),d.data.fromX=a,d.data.fromY=h,d.data.killType=this.bulletKillType,d.data.killDistance=this.bulletKillDistance,d.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===r.Weapon.KILL_LIFESPAN&&(d.lifespan=this.bulletLifespan),d.angle=u+this.bulletAngleOffset,""!==this.bulletAnimation){if(null===d.animations.getAnimation(this.bulletAnimation)){var p=this.anims[this.bulletAnimation];d.animations.add(p.name,p.frames,p.frameRate,p.loop,p.useNumericIndex)}d.animations.play(this.bulletAnimation)}else this.bulletFrameCycle?(d.frame=this.bulletFrames[this.bulletFrameIndex],this.bulletFrameIndex++,this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(d.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]);d.data.bodyDirty&&(this._data.customBody&&d.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),d.body.collideWorldBounds=this.bulletCollideWorldBounds,d.data.bodyDirty=!1),d.body.velocity.set(c,l),d.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);var f=0;if(0!==this.bulletSpeedVariance){var m=this.fireRate;(m+=r.Math.between(-this.fireRateVariance,this.fireRateVariance))<0&&(m=0),f=this.game.time.now+m}else f=this.game.time.now+this.fireRate;this.multiFire?this._hasFired||(this._hasFired=!0,this._tempNextFire=f,this.shots++):(this._nextFire=f,this.shots++),this.onFire.dispatch(d,this,s),this.fireLimit>0&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit)}return d},r.Weapon.prototype.fireAtPointer=function(t){return void 0===t&&(t=this.game.input.activePointer),this.fire(null,t.worldX,t.worldY)},r.Weapon.prototype.fireAtSprite=function(t){return this.fire(null,t.world.x,t.world.y)},r.Weapon.prototype.fireAtXY=function(t,e){return this.fire(null,t,e)},r.Weapon.prototype.setBulletBodyOffset=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),this._data.customBody=!0,this._data.width=t,this._data.height=e,this._data.offsetX=i,this._data.offsetY=n,this.bullets.callAll("body.setSize","body",t,e,i,n),this.bullets.setAll("data.bodyDirty",!1),this},r.Weapon.prototype.setBulletFrames=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=!1),this.bulletFrames=r.ArrayUtils.numberArray(t,e),this.bulletFrameIndex=0,this.bulletFrameCycle=i,this.bulletFrameRandom=n,this},r.Weapon.prototype.addBulletAnimation=function(t,e,i,n,r){return this.anims[t]={name:t,frames:e,frameRate:i,loop:n,useNumericIndex:r},this.bullets.callAll("animations.add","animations",t,e,i,n,r),this.bulletAnimation=t,this},r.Weapon.prototype.debug=function(t,e,i){void 0===t&&(t=16),void 0===e&&(e=32),void 0===i&&(i=!1),this.game.debug.text("Weapon Plugin",t,e),this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,t,e+24),i&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")},Object.defineProperty(r.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(t){this._bulletClass=t,this.bullets&&(this.bullets.classType=this._bulletClass)}}),Object.defineProperty(r.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case r.Weapon.KILL_STATIC_BOUNDS:case r.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case r.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case r.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds}this._bulletKillType=t}}),Object.defineProperty(r.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(t){this._bulletCollideWorldBounds=t,this.bullets.setAll("body.collideWorldBounds",t),this.bullets.setAll("data.bodyDirty",!1)}}),Object.defineProperty(r.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(t){this.fireFrom.x=t}}),Object.defineProperty(r.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(t){this.fireFrom.y=t}}),r.Bullet=function(t,e,i,n,o){r.Sprite.call(this,t,e,i,n,o),this.anchor.set(.5),this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}},r.Bullet.prototype=Object.create(r.Sprite.prototype),r.Bullet.prototype.constructor=r.Bullet,r.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this},r.Bullet.prototype.update=function(){this.exists&&(this.data.killType>r.Weapon.KILL_LIFESPAN&&(this.data.killType===r.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=this.body.velocity.atan()),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))},r.Video=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),this.game=t,this.key=e,this.width=0,this.height=0,this.type=r.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new r.Signal,this.onChangeSource=new r.Signal,this.onComplete=new r.Signal,this.onAccess=new r.Signal,this.onError=new r.Signal,this.onTimeout=new r.Signal,this.timeout=15e3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._pendingChangeSource=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,e&&this.game.cache.checkVideoKey(e)){var n=this.game.cache.getVideo(e);n.isBlob?this.createVideoFromBlob(n.data):this.video=n.data,this.width=this.video.videoWidth,this.height=this.video.videoHeight}else i&&this.createVideoFromURL(i,!1);this.video&&!i?(this.baseTexture=new PIXI.BaseTexture(this.video,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height)):(this.baseTexture=new PIXI.BaseTexture(r.Cache.DEFAULT.baseTexture.source,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height)),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new r.Frame(0,0,0,this.width,this.height,"video"),this.texture.setFrame(this.textureFrame),this.texture.valid=!1,null!==e&&this.video&&(this.texture.valid=this.video.canplay),this.snapshot=null,r.BitmapData&&(this.snapshot=new r.BitmapData(this.game,"",this.width,this.height)),this.game.device.needsTouchUnlock()?this.setTouchLock():n&&(n.locked=!1)},r.Video.prototype={connectToMediaStream:function(t,e){return t&&e&&(this.video=t,this.videoStream=e,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=null),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;null!==this.videoStream&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),null!==e&&(this.video.width=e),null!==i&&(this.video.height=i),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:t,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(t){this.getUserMediaError(t)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID),this.onTimeout.dispatch(this)},getUserMediaError:function(t){clearTimeout(this._timeOutID),this.onError.dispatch(this,t)},getUserMediaSuccess:function(t){clearTimeout(this._timeOutID),this.videoStream=t,void 0!==this.video.mozSrcObject?this.video.mozSrcObject=t:this.video.src=window.URL&&window.URL.createObjectURL(t)||t;var e=this;this.video.onloadeddata=function(){function t(){if(i>0)if(e.video.videoWidth>0){var n=e.video.videoWidth,r=e.video.videoHeight;isNaN(e.video.videoHeight)&&(r=n/(4/3)),e.video.play(),e.isStreaming=!0,e.baseTexture.source=e.video,e.updateTexture(null,n,r),e.onAccess.dispatch(e)}else window.setTimeout(t,500);else console.warn("Unable to connect to video stream. Webcam error?");i--}var i=10;t()}},createVideoFromBlob:function(t){var e=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.addEventListener("loadeddata",function(t){e.updateTexture(t)},!0),this.video.src=window.URL.createObjectURL(t),this.video.canplay=!0,this},createVideoFromURL:function(t,e){return void 0===e&&(e=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,e&&this.video.setAttribute("autoplay","autoplay"),this.video.src=t,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=t,this},updateTexture:function(t,e,i){var n=!1;void 0!==e&&null!==e||(e=this.video.videoWidth,n=!0),void 0!==i&&null!==i||(i=this.video.videoHeight),this.width=e,this.height=i,this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video),this.baseTexture.forceLoaded(e,i),this.texture.frame.resize(e,i),this.texture.width=e,this.texture.height=i,this.texture.valid=!0,this.snapshot&&this.snapshot.resize(e,i),n&&null!==this.key&&(this.onChangeSource.dispatch(this,e,i),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(t,e){return this._pendingChangeSource?this:(void 0===t&&(t=!1),void 0===e&&(e=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=t?"loop":"",this.video.playbackRate=e,this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4!==this.video.readyState?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,t,e)),this)},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0),this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(t){t.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},addToWorld:function(t,e,i,n,r,o){r=r||1,o=o||1;var s=this.game.add.image(t,e,this);return s.anchor.set(i,n),s.scale.set(r,o),s},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||this.video.play())},changeSource:function(t,e){return void 0===e&&(e=!0),this.texture.valid=!1,this.video.pause(),this._pendingChangeSource=!0,this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=t,this.video.load(),this._autoplay=e,e||(this.paused=!0),this},checkVideoProgress:function(){4===this.video.readyState?(this._pendingChangeSource=!1,this.updateTexture()):(this.retry--,this.retry>0?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming))},setTouchLock:function(){this.game.input.addTouchLockCallback(this.unlock,this,!0),this.touchLocked=!0},unlock:function(){if(this.touchLocked=!1,this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate),this.key){var t=this.game.cache.getVideo(this.key);t&&!t.isBlob&&(t.locked=!1)}return!0},grab:function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=1),void 0===i&&(i=null),null!==this.snapshot)return t&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,e,i),this.snapshot;console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable")},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay"),this.video.removeAttribute("src"),this.video=null}},destroy:function(){this.stop(),this.removeVideoElement(),this.touchLocked&&this.game.input.touch.removeTouchLockCallback(this.unlock,this),this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(r.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(t){this.video.currentTime=t}}),Object.defineProperty(r.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(r.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(r.Video.prototype,"mute",{get:function(){return this._muted},set:function(t){if(t=t||null){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(r.Video.prototype,"paused",{get:function(){return this._paused},set:function(t){if(t=t||null,!this.touchLocked)if(t){if(this._paused)return;this._codePaused=!0,this.setPause()}else{if(!this._paused)return;this._codePaused=!1,this.setResume()}}}),Object.defineProperty(r.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(t){t<0?t=0:t>1&&(t=1),this.video&&(this.video.volume=t)}}),Object.defineProperty(r.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(t){this.video&&(this.video.playbackRate=t)}}),Object.defineProperty(r.Video.prototype,"loop",{get:function(){return!!this.video&&this.video.loop},set:function(t){t&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}}),Object.defineProperty(r.Video.prototype,"playing",{get:function(){return!!this.video&&!(this.video.paused&&this.video.ended)}}),r.Video.prototype.constructor=r.Video,void 0===PIXI.blendModes&&(PIXI.blendModes=r.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=r.scaleModes),void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new r.Matrix),PIXI.TextureSilentFail=!0,PIXI.canUseNewCanvasBlendModes=function(){return r.Device.canUseMultiply},"undefined"!=typeof t&&t.exports&&(e=t.exports=r),e.Phaser=r,r}).call(this)}).call(e,i("1WNV"))},"8I79":function(t,e,i){"use strict";i.d(e,"a",function(){return s});var n=i("/oeL"),r=i("Fjvy"),o=i("R1JD"),s=function(){function t(t,e){this._namespace=r.a._defaultNamespace,this._verticalScrolling=r.a.defaultIsVerticalScrolling,this._offset=r.a.defaultScrollOffset,this._duration=r.a.defaultDuration,this._easingLogic=r.a.defaultEasingLogic,this._interruptible=r.a.defaultInterruptible,this._advancedInlineOffsetCalculation=r.a.defaultAdvancedInlineOffsetCalculation,this._pageScrollFinish=new n.p,this._startScrollPosition=0,this._interruptListenersAttached=!1,this._timer=null,this._namespace=t,this.document=e}return t.simpleInstance=function(e,i,n){return t.newInstance({document:e,scrollTarget:i,namespace:n})},t.newInstance=function(e){(o.a.isUndefinedOrNull(e.namespace)||e.namespace.length<=0)&&(e.namespace=r.a._defaultNamespace);var i=new t(e.namespace,document);return o.a.isUndefinedOrNull(e.scrollingViews)||0===e.scrollingViews.length?(i._isInlineScrolling=!1,i._scrollingViews=[document.documentElement,document.body,document.body.parentNode]):(i._isInlineScrolling=!0,i._scrollingViews=e.scrollingViews),i._scrollTarget=e.scrollTarget,o.a.isUndefinedOrNull(e.verticalScrolling)||(i._verticalScrolling=e.verticalScrolling),o.a.isUndefinedOrNull(e.pageScrollOffset)||(i._offset=e.pageScrollOffset),o.a.isUndefinedOrNull(e.pageScrollEasingLogic)||(i._easingLogic=e.pageScrollEasingLogic),o.a.isUndefinedOrNull(e.pageScrollDuration)&&!o.a.isUndefinedOrNull(e.pageScrollSpeed)?(i._speed=e.pageScrollSpeed,i._duration=void 0):o.a.isUndefinedOrNull(e.pageScrollDuration)||(i._duration=e.pageScrollDuration),o.a.isUndefinedOrNull(e.pageScrollFinishListener)||(i._pageScrollFinish=e.pageScrollFinishListener),i._interruptible=e.pageScrollInterruptible||o.a.isUndefinedOrNull(e.pageScrollInterruptible)&&r.a.defaultInterruptible,i._advancedInlineOffsetCalculation=e.advancedInlineOffsetCalculation||o.a.isUndefinedOrNull(e.advancedInlineOffsetCalculation)&&r.a.defaultAdvancedInlineOffsetCalculation,i},t.prototype.getScrollPropertyValue=function(t){return this.verticalScrolling?t.scrollTop:t.scrollLeft},t.prototype.extractScrollTargetPosition=function(){var t;if("string"==typeof this._scrollTarget){var e=this._scrollTarget;t=null!==e.match(/^#[^\s]+$/g)?this.document.getElementById(e.substr(1)):this.document.querySelector(e)}else t=this._scrollTarget;if(null===t||void 0===t)return{top:NaN,left:NaN};if(this._isInlineScrolling){var i={top:t.offsetTop,left:t.offsetLeft};if(this._advancedInlineOffsetCalculation&&1===this.scrollingViews.length){for(var s={top:0,left:0},a=t.ownerDocument.defaultView,h=!1,u=t.parentElement;!h&&!o.a.isUndefinedOrNull(u);)"relative"===a.getComputedStyle(u).getPropertyValue("position")&&(s.top+=u.offsetTop,s.left+=u.offsetLeft),h=(u=u.parentElement)===this.scrollingViews[0];h?(i.top+=s.top,i.left+=s.left):(r.a._logLevel>=2||r.a._logLevel>=1&&Object(n._5)())&&console.warn("Unable to find nested scrolling targets parent!")}return i}return o.a.extractElementPosition(this.document,t)},t.prototype.getCurrentOffset=function(){return this._offset},t.prototype.setScrollPosition=function(t){var e=this;return r.a._logLevel>=5&&Object(n._5)()&&console.warn("Scroll Position: "+t),this.scrollingViews.reduce(function(i,n){var s=e.getScrollPropertyValue(n);if(n&&!o.a.isUndefinedOrNull(s)){var a=Math.abs(s-t),h=a<r.a._minScrollDistance;if(e.verticalScrolling?n.scrollTop=t:n.scrollLeft=t,h||a>Math.abs(e.getScrollPropertyValue(n)-t))return!0}return i},!1)},t.prototype.fireEvent=function(t){this._pageScrollFinish&&this._pageScrollFinish.emit(t)},t.prototype.attachInterruptListeners=function(t){var e=this;this._interruptListenersAttached&&this.detachInterruptListeners(),this._interruptListener=function(i){t.report(i,e)},r.a._interruptEvents.forEach(function(t){return e.document.body.addEventListener(t,e._interruptListener)}),this._interruptListenersAttached=!0},t.prototype.detachInterruptListeners=function(){var t=this;r.a._interruptEvents.forEach(function(e){return t.document.body.removeEventListener(e,t._interruptListener)}),this._interruptListenersAttached=!1},Object.defineProperty(t.prototype,"namespace",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollTarget",{get:function(){return this._scrollTarget},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalScrolling",{get:function(){return this._verticalScrolling},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollingViews",{get:function(){return this._scrollingViews},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startScrollPosition",{get:function(){return this._startScrollPosition},set:function(t){this._startScrollPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetScrollPosition",{get:function(){return this._targetScrollPosition},set:function(t){this._targetScrollPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceToScroll",{get:function(){return this._distanceToScroll},set:function(t){this._distanceToScroll=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"executionDuration",{get:function(){return this._executionDuration},set:function(t){this._executionDuration=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"easingLogic",{get:function(){return this._easingLogic},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interruptible",{get:function(){return this._interruptible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(t){this._startTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this._endTime},set:function(t){this._endTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timer",{get:function(){return this._timer},set:function(t){this._timer=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interruptListenersAttached",{get:function(){return this._interruptListenersAttached},enumerable:!0,configurable:!0}),t}()},"8Ut3":function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("AP4T"),r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(t){function e(e,i){t.call(this),this.value=e,this.scheduler=i,this._isScalar=!0,i&&(this._isScalar=!1)}return r(e,t),e.create=function(t,i){return new e(t,i)},e.dispatch=function(t){var e=t.done,i=t.value,n=t.subscriber;e?n.complete():(n.next(i),n.closed||(t.done=!0,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.value,n=this.scheduler;if(n)return n.schedule(e.dispatch,0,{done:!1,value:i,subscriber:t});t.next(i),t.closed||t.complete()},e}(n.a)},"939O":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("6nA8"),r=i("+2h+"),o=i("0ndw"),s=function(){function t(t){this.game=t,this.k=.025,this.resolution=20}return t.prototype.newInstance=function(t){var e=this.game.height-t,i=this.createwaterPoints(this.resolution,e,this.k);return this.createWater(i),new r.Water(this.game,t,this.resolution,i)},t.prototype.createwaterPoints=function(t,e,i){for(var n=Array(),r=this.game.width/t,s=0;s<=t;s++)n.push(new o.WaterPoint(this.game,r*s,e,e,i));return n},t.prototype.createWater=function(t){t.push(new n.Point(this.game.width,this.game.height)),t.push(new n.Point(0,this.game.height))},t}();e.WaterFactory=s},AP4T:function(t,e,i){"use strict";var n=i("xIGM"),r=i("E9/g"),o=i("V7AE"),s=i("grVA"),a=i("mz3w"),h=i("ExCY");i.d(e,"a",function(){return u});var u=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var n=this.operator,a=function(t,e,i){if(t){if(t instanceof r.a)return t;if(t[o.a])return t[o.a]()}return t||e||i?new r.a(t,e,i):new r.a(s.a)}(t,e,i);if(n?n.call(a,this.source):a.add(this.source?this._subscribe(a):this._trySubscribe(a)),a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.syncErrorThrown=!0,t.syncErrorValue=e,t.error(e)}},t.prototype.forEach=function(t,e){var i=this;if(e||(n.a.Rx&&n.a.Rx.config&&n.a.Rx.config.Promise?e=n.a.Rx.config.Promise:n.a.Promise&&(e=n.a.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,n){var r;r=i.subscribe(function(e){if(r)try{t(e)}catch(t){n(t),r.unsubscribe()}else t(e)},n,e)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[a.a]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 0===t.length?this:Object(h.b)(t)(this)},t.prototype.toPromise=function(t){var e=this;if(t||(n.a.Rx&&n.a.Rx.config&&n.a.Rx.config.Promise?t=n.a.Rx.config.Promise:n.a.Promise&&(t=n.a.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,i){var n;e.subscribe(function(t){return n=t},function(t){return i(t)},function(){return t(n)})})},t.create=function(e){return new t(e)},t}()},B1iP:function(t,e,i){"use strict";e.a=function(t){return"function"==typeof t}},B8Mb:function(t,e,i){"use strict";function n(t){return t||new a}i.d(e,"c",function(){return a}),e.b=n,i.d(e,"a",function(){return h});var r=i("/oeL"),o=i("Fjvy"),s=i("R1JD"),a=function(){function t(){var e=this;this.runningInstances=[],this.onInterrupted={report:function(t,i){if(i.interruptible){var n=!0;"keyup"===t.type?-1===o.a._interruptKeys.indexOf(t.keyCode)&&(n=!1):"mousedown"===t.type&&(i.scrollingViews.some(function(e){return e.contains(t.target)})||(n=!1)),n&&e.stopAll(i.namespace)}}},t.instanceCounter>0&&(o.a._logLevel>=2||o.a._logLevel>=1&&Object(r._5)())&&console.warn("An instance of PageScrollService already exists, usually including one provider should be enough, so double check."),t.instanceCounter++}return t.prototype.stopInternal=function(t,e){var i=this.runningInstances.indexOf(e);return i>=0&&this.runningInstances.splice(i,1),e.interruptListenersAttached&&e.detachInterruptListeners(),!!e.timer&&(clearInterval(e.timer),e.timer=void 0,e.fireEvent(!t),!0)},t.prototype.start=function(t){var e=this;if(this.stopAll(t.namespace),null!==t.scrollingViews&&0!==t.scrollingViews.length){var i=!1;t.startScrollPosition=0,t.scrollingViews.forEach(function(e){if(!s.a.isUndefinedOrNull(e)){var n=t.getScrollPropertyValue(e);!i&&n&&(t.startScrollPosition=n,i=!0)}});var n=t.getCurrentOffset(),a=t.extractScrollTargetPosition();if(t.targetScrollPosition=Math.round((t.verticalScrolling?a.top:a.left)-n),t.distanceToScroll=t.targetScrollPosition-t.startScrollPosition,isNaN(t.distanceToScroll))return(o.a._logLevel>=2||o.a._logLevel>=1&&Object(r._5)())&&console.log("Scrolling not possible, as we can't find the specified target"),void t.fireEvent(!1);var h=Math.abs(t.distanceToScroll)<o.a._minScrollDistance;t.executionDuration=t.duration,!s.a.isUndefinedOrNull(t.speed)&&s.a.isUndefinedOrNull(t.duration)&&(t.executionDuration=Math.abs(t.distanceToScroll)/t.speed*1e3);var u=t.executionDuration<=o.a._interval;if(h||u)return(o.a._logLevel>=2||o.a._logLevel>=1&&Object(r._5)())&&(h?console.log("Scrolling not possible, as we can't get any closer to the destination"):console.log("Scroll duration shorter that interval length, jumping to target")),t.setScrollPosition(t.targetScrollPosition),void t.fireEvent(!0);(t.interruptible||s.a.isUndefinedOrNull(t.interruptible)&&o.a.defaultInterruptible)&&t.attachInterruptListeners(this.onInterrupted),t.startTime=(new Date).getTime(),t.endTime=t.startTime+t.executionDuration,t.timer=setInterval(function(t){var i,n=(new Date).getTime(),r=!1;t.endTime<=n?(i=t.targetScrollPosition,r=!0):i=Math.round(t.easingLogic.ease(n-t.startTime,t.startScrollPosition,t.distanceToScroll,t.executionDuration)),t.setScrollPosition(i)||(r=!0),r&&e.stopInternal(!1,t)},o.a._interval,t),this.runningInstances.push(t)}else(o.a._logLevel>=2||o.a._logLevel>=1&&Object(r._5)())&&console.warn("No scrollingViews specified, this ng2-page-scroll does not know which DOM elements to scroll")},t.prototype.stopAll=function(t){if(this.runningInstances.length>0){for(var e=!1,i=0;i<this.runningInstances.length;++i){var n=this.runningInstances[i];(s.a.isUndefinedOrNull(t)||0===t.length||n.namespace===t)&&(e=!0,this.stopInternal(!0,n),i--)}return e}return!1},t.prototype.stop=function(t){return this.stopInternal(!0,t)},t.instanceCounter=0,t.decorators=[{type:r.u}],t.ctorParameters=function(){return[]},t}(),h={provide:a,deps:[[new r.H,new r.S,a]],useFactory:n}},BkNc:function(t,e,i){"use strict";function n(t){var e=t.value,i=t.subscriber;i.closed||(i.next(e),i.complete())}function r(t){var e=t.err,i=t.subscriber;i.closed||i.error(e)}function o(t){var e=+t.length;return isNaN(e)?0:0!==e&&function(t){return"number"==typeof t&&Vt.a.isFinite(t)}(e)?(e=function(t){var e=+t;if(0===e)return e;if(isNaN(e))return e;return e<0?-1:1}(e)*Math.floor(Math.abs(e)))<=0?0:e>Qt?Qt:e:e}function s(t,e){return function(t,e){return Object(he.a)(t,e,1)}(t,e)(this)}function a(t,e){return function(t,e){return function(i){return i.lift(new le(t,e,i))}}(t,e)(this)}function h(t,e,i){return function(t,e,i){return function(n){return n.lift(new ge(t,e,i,n))}}(t,e,i)(this)}function u(t,e,i){return function(t,e,i){return function(n){return n.lift(new be(t,e,i,n))}}(t,e,i)(this)}function c(t,e,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),Object(he.a)(t,e,i)(this)}function l(t,e){var i=!1;return arguments.length>=2&&(i=!0),function(n){return n.lift(new Te(t,e,i))}}function d(t){return function(e){return 0===t?new te.a:e.lift(new Me(t))}}function p(t,e){return arguments.length>=2?function(i){return Object(Ie.a)(l(t,e),d(1),function(t){return void 0===t&&(t=null),function(e){return e.lift(new Le(t))}}(e))(i)}:function(e){return Object(Ie.a)(l(function(e,i,n){return t(e,i,n+1)}),d(1))(e)}}function f(t){return function(t){return function(e){var i=new Fe(t),n=e.lift(i);return i.caught=n}}(t)(this)}function m(){return Object(Ne.a)(1)(this)}function g(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),Object(Ne.a)(t)(this)}function y(t){return new ei(t)}function v(t,e,i){var n=i.path.split("/");if(n.length>t.length)return null;if("full"===i.pathMatch&&(e.hasChildren()||n.length<t.length))return null;for(var r={},o=0;o<n.length;o++){var s=n[o],a=t[o];if(s.startsWith(":"))r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,n.length),posParams:r}}function b(t,e){void 0===e&&(e="");for(var i=0;i<t.length;i++){var n=t[i];!function(t,e){if(!t)throw new Error("\n      Invalid configuration of route '"+e+"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    ");if(Array.isArray(t))throw new Error("Invalid configuration of route '"+e+"': Array cannot be specified");if(!t.component&&t.outlet&&t.outlet!==ti)throw new Error("Invalid configuration of route '"+e+"': a componentless route cannot have a named outlet set");if(t.redirectTo&&t.children)throw new Error("Invalid configuration of route '"+e+"': redirectTo and children cannot be used together");if(t.redirectTo&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': redirectTo and loadChildren cannot be used together");if(t.children&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': children and loadChildren cannot be used together");if(t.redirectTo&&t.component)throw new Error("Invalid configuration of route '"+e+"': redirectTo and component cannot be used together");if(t.path&&t.matcher)throw new Error("Invalid configuration of route '"+e+"': path and matcher cannot be used together");if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error("Invalid configuration of route '"+e+"'. One of the following must be provided: component, redirectTo, children or loadChildren");if(void 0===t.path&&void 0===t.matcher)throw new Error("Invalid configuration of route '"+e+"': routes must have either a path or a matcher specified");if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error("Invalid configuration of route '"+e+"': path cannot start with a slash");if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch){throw new Error("Invalid configuration of route '{path: \""+e+'", redirectTo: "'+t.redirectTo+"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.")}if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error("Invalid configuration of route '"+e+"': pathMatch can only be set to 'prefix' or 'full'");t.children&&b(t.children,e)}(n,function(t,e){if(!e)return t;return t||e.path?t&&!e.path?t+"/":!t&&e.path?e.path:t+"/"+e.path:""}(e,n))}}function x(t,e){var i=Object.keys(t),n=Object.keys(e);if(i.length!=n.length)return!1;for(var r,o=0;o<i.length;o++)if(r=i[o],t[r]!==e[r])return!1;return!0}function _(t){return Array.prototype.concat.apply([],t)}function w(t){return t.length>0?t[t.length-1]:null}function T(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)}function S(t){var e=g.call(t);return a.call(e,function(t){return!0===t})}function E(t){return Object(Bt._21)(t)?t:Object(Bt._22)(t)?Ge(Promise.resolve(t)):ae(t)}function C(t,e,i){return i?function(t,e){return x(t,e)}(t.queryParams,e.queryParams)&&P(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(function(i){return e[i]===t[i]})}(t.queryParams,e.queryParams)&&M(t.root,e.root)}function P(t,e){if(!R(t.segments,e.segments))return!1;if(t.numberOfChildren!==e.numberOfChildren)return!1;for(var i in e.children){if(!t.children[i])return!1;if(!P(t.children[i],e.children[i]))return!1}return!0}function M(t,e){return A(t,e,e.segments)}function A(t,e,i){if(t.segments.length>i.length){return!!R(r=t.segments.slice(0,i.length),i)&&!e.hasChildren()}if(t.segments.length===i.length){if(!R(t.segments,i))return!1;for(var n in e.children){if(!t.children[n])return!1;if(!M(t.children[n],e.children[n]))return!1}return!0}var r=i.slice(0,t.segments.length),o=i.slice(t.segments.length);return!!R(t.segments,r)&&(!!t.children[ti]&&A(t.children[ti],e,o))}function R(t,e){return t.length===e.length&&t.every(function(t,i){return t.path===e[i].path})}function L(t,e){var i=[];return T(t.children,function(t,n){n===ti&&(i=i.concat(e(t,n)))}),T(t.children,function(t,n){n!==ti&&(i=i.concat(e(t,n)))}),i}function O(t){return t.segments.map(function(t){return D(t)}).join("/")}function I(t,e){if(!t.hasChildren())return O(t);if(e){var i=t.children[ti]?I(t.children[ti],!1):"",n=[];return T(t.children,function(t,e){e!==ti&&n.push(e+":"+I(t,!1))}),n.length>0?i+"("+n.join("//")+")":i}var r=L(t,function(e,i){return i===ti?[I(t.children[ti],!1)]:[i+":"+I(e,!1)]});return O(t)+"/("+r.join("//")+")"}function B(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";")}function k(t){return decodeURIComponent(t)}function D(t){return""+B(t.path)+function(t){return Object.keys(t).map(function(e){return";"+B(e)+"="+B(t[e])}).join("")}(t.parameters)}function F(t){var e=t.match(ci);return e?e[0]:""}function U(t){return new Ht.a(function(e){return e.error(new fi(t))})}function N(t){return new Ht.a(function(e){return e.error(new mi(t))})}function G(t){return new Ht.a(function(e){return e.error(new Error("Only absolute redirects can have named outlets. redirectTo: '"+t+"'"))})}function j(t){return new Ht.a(function(e){return e.error(function(t){var e=Error("NavigationCancelingError: "+t);return e[ii]=!0,e}("Cannot load children because the guard of the route \"path: '"+t.path+"'\" returned false"))})}function V(t,e,i){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||i.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var n=(e.matcher||v)(i,t,e);return n?{matched:!0,consumedSegments:n.consumed,lastChild:n.consumed.length,positionalParamSegments:n.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function H(t,e,i,n){if(i.length>0&&function(t,e,i){return i.some(function(i){return W(t,e,i)&&X(i)!==ti})}(t,i,n)){return{segmentGroup:z(new oi(e,function(t,e){var i={};i[ti]=e;for(var n=0,r=t;n<r.length;n++){var o=r[n];""===o.path&&X(o)!==ti&&(i[X(o)]=new oi([],{}))}return i}(n,new oi(i,t.children)))),slicedSegments:[]}}if(0===i.length&&function(t,e,i){return i.some(function(i){return W(t,e,i)})}(t,i,n)){return{segmentGroup:z(new oi(t.segments,function(t,e,i,n){for(var r={},o=0,s=i;o<s.length;o++){var a=s[o];W(t,e,a)&&!n[X(a)]&&(r[X(a)]=new oi([],{}))}return Object.assign({},n,r)}(t,i,n,t.children))),slicedSegments:i}}return{segmentGroup:t,slicedSegments:i}}function z(t){if(1===t.numberOfChildren&&t.children[ti]){var e=t.children[ti];return new oi(t.segments.concat(e.segments),e.children)}return t}function W(t,e,i){return(!(t.hasChildren()||e.length>0)||"full"!==i.pathMatch)&&(""===i.path&&void 0!==i.redirectTo)}function X(t){return t.outlet||ti}function q(t,e){if(t===e.value)return e;for(var i=0,n=e.children;i<n.length;i++){var r=q(t,n[i]);if(r)return r}return null}function Y(t,e){if(t===e.value)return[e];for(var i=0,n=e.children;i<n.length;i++){var r=Y(t,n[i]);if(r.length)return r.unshift(e),r}return[]}function K(t,e){var i=function(t,e){var i=new _i([],{},{},"",{},ti,e,null,t.root,-1,{});return new wi("",new vi(i,[]))}(t,e),n=new Ut([new si("",{})]),r=new Ut({}),o=new Ut({}),s=new Ut({}),a=new Ut(""),h=new xi(n,r,s,a,o,ti,e,i.root);return h.snapshot=i.root,new bi(new vi(h,[]),i)}function Z(t){for(var e=t.pathFromRoot,i=e.length-1;i>=1;){var n=e[i],r=e[i-1];if(n.routeConfig&&""===n.routeConfig.path)i--;else{if(r.component)break;i--}}return e.slice(i).reduce(function(t,e){return{params:Object.assign({},t.params,e.params),data:Object.assign({},t.data,e.data),resolve:Object.assign({},t.resolve,e._resolvedData)}},{params:{},data:{},resolve:{}})}function Q(t,e){e.value._routerState=t,e.children.forEach(function(e){return Q(t,e)})}function J(t){var e=t.children.length>0?" { "+t.children.map(J).join(", ")+" } ":"";return""+t.value+e}function $(t){if(t.snapshot){var e=t.snapshot,i=t._futureSnapshot;t.snapshot=i,x(e.queryParams,i.queryParams)||t.queryParams.next(i.queryParams),e.fragment!==i.fragment&&t.fragment.next(i.fragment),x(e.params,i.params)||t.params.next(i.params),function(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!x(t[i],e[i]))return!1;return!0}(e.url,i.url)||t.url.next(i.url),x(e.data,i.data)||t.data.next(i.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function tt(t,e){var i=x(t.params,e.params)&&function(t,e){return R(t,e)&&t.every(function(t,i){return x(t.parameters,e[i].parameters)})}(t.url,e.url),n=!t.parent!=!e.parent;return i&&!n&&(!t.parent||tt(t.parent,e.parent))}function et(t,e,i){if(i&&t.shouldReuseRoute(e.value,i.value.snapshot)){(o=i.value)._futureSnapshot=e.value;var n=function(t,e,i){return e.children.map(function(e){for(var n=0,r=i.children;n<r.length;n++){var o=r[n];if(t.shouldReuseRoute(o.value.snapshot,e.value))return et(t,e,o)}return et(t,e)})}(t,e,i);return new vi(o,n)}if(t.retrieve(e.value)){var r=t.retrieve(e.value).route;return it(e,r),r}var o=function(t){return new xi(new Ut(t.url),new Ut(t.params),new Ut(t.queryParams),new Ut(t.fragment),new Ut(t.data),t.outlet,t.component,t)}(e.value);n=e.children.map(function(e){return et(t,e)});return new vi(o,n)}function it(t,e){if(t.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=t.value;for(var i=0;i<t.children.length;++i)it(t.children[i],e.children[i])}function nt(t,e,i,n,r){if(0===i.length)return ot(e.root,e.root,e,n,r);var o=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new Ti(!0,0,t);var e=0,i=!1,n=t.reduce(function(t,n,r){if("object"==typeof n&&null!=n){if(n.outlets){var o={};return T(n.outlets,function(t,e){o[e]="string"==typeof t?t.split("/"):t}),t.concat([{outlets:o}])}if(n.segmentPath)return t.concat([n.segmentPath])}return"string"!=typeof n?t.concat([n]):0===r?(n.split("/").forEach(function(n,r){0==r&&"."===n||(0==r&&""===n?i=!0:".."===n?e++:""!=n&&t.push(n))}),t):t.concat([n])},[]);return new Ti(i,e,n)}(i);if(o.toRoot())return ot(e.root,new oi([],{}),e,n,r);var s=function(t,e,i){if(t.isAbsolute)return new Si(e.root,!0,0);if(-1===i.snapshot._lastPathIndex)return new Si(i.snapshot._urlSegment,!0,0);var n=rt(t.commands[0])?0:1,r=i.snapshot._lastPathIndex+n;return function(t,e,i){var n=t,r=e,o=i;for(;o>r;){if(o-=r,!(n=n.parent))throw new Error("Invalid number of '../'");r=n.segments.length}return new Si(n,!1,r-o)}(i.snapshot._urlSegment,r,t.numberOfDoubleDots)}(o,e,t),a=s.processChildren?ut(s.segmentGroup,s.index,o.commands):ht(s.segmentGroup,s.index,o.commands);return ot(s.segmentGroup,a,e,n,r)}function rt(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function ot(t,e,i,n,r){var o={};return n&&T(n,function(t,e){o[e]=Array.isArray(t)?t.map(function(t){return""+t}):""+t}),i.root===t?new ri(e,o,r):new ri(st(i.root,t,e),o,r)}function st(t,e,i){var n={};return T(t.children,function(t,r){n[r]=t===e?i:st(t,e,i)}),new oi(t.segments,n)}function at(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[ti]:""+t}function ht(t,e,i){if(t||(t=new oi([],{})),0===t.segments.length&&t.hasChildren())return ut(t,e,i);var n=function(t,e,i){var n=0,r=e,o={match:!1,pathIndex:0,commandIndex:0};for(;r<t.segments.length;){if(n>=i.length)return o;var s=t.segments[r],a=at(i[n]),h=n<i.length-1?i[n+1]:null;if(r>0&&void 0===a)break;if(a&&h&&"object"==typeof h&&void 0===h.outlets){if(!lt(a,h,s))return o;n+=2}else{if(!lt(a,{},s))return o;n++}r++}return{match:!0,pathIndex:r,commandIndex:n}}(t,e,i),r=i.slice(n.commandIndex);if(n.match&&n.pathIndex<t.segments.length){var o=new oi(t.segments.slice(0,n.pathIndex),{});return o.children[ti]=new oi(t.segments.slice(n.pathIndex),t.children),ut(o,0,r)}return n.match&&0===r.length?new oi(t.segments,{}):n.match&&!t.hasChildren()?ct(t,e,i):n.match?ut(t,0,r):ct(t,e,i)}function ut(t,e,i){if(0===i.length)return new oi(t.segments,{});var n=function(t){return"object"!=typeof t[0]?(e={},e[ti]=t,e):void 0===t[0].outlets?(i={},i[ti]=t,i):t[0].outlets;var e,i}(i),r={};return T(n,function(i,n){null!==i&&(r[n]=ht(t.children[n],e,i))}),T(t.children,function(t,e){void 0===n[e]&&(r[e]=t)}),new oi(t.segments,r)}function ct(t,e,i){for(var n=t.segments.slice(0,e),r=0;r<i.length;){if("object"==typeof i[r]&&void 0!==i[r].outlets){var o=function(t){var e={};return T(t,function(t,i){null!==t&&(e[i]=ct(new oi([],{}),0,t))}),e}(i[r].outlets);return new oi(n,o)}if(0===r&&rt(i[0])){var s=t.segments[e];n.push(new si(s.path,i[0])),r++}else{var a=at(i[r]),h=r<i.length-1?i[r+1]:null;a&&h&&rt(h)?(n.push(new si(a,function(t){var e={};return T(t,function(t,i){return e[i]=""+t}),e}(h))),r+=2):(n.push(new si(a,{})),r++)}}return new oi(n,{})}function lt(t,e,i){return t==i.path&&x(e,i.parameters)}function dt(t){for(var e=t;e._sourceSegment;)e=e._sourceSegment;return e}function pt(t){for(var e=t,i=e._segmentIndexShift?e._segmentIndexShift:0;e._sourceSegment;)i+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return i-1}function ft(t,e,i,n){if(i.length>0&&function(t,e,i){return i.some(function(i){return mt(t,e,i)&&gt(i)!==ti})}(t,i,n)){var r=new oi(e,function(t,e,i,n){var r={};r[ti]=n,n._sourceSegment=t,n._segmentIndexShift=e.length;for(var o=0,s=i;o<s.length;o++){var a=s[o];if(""===a.path&&gt(a)!==ti){var h=new oi([],{});h._sourceSegment=t,h._segmentIndexShift=e.length,r[gt(a)]=h}}return r}(t,e,n,new oi(i,t.children)));return r._sourceSegment=t,r._segmentIndexShift=e.length,{segmentGroup:r,slicedSegments:[]}}if(0===i.length&&function(t,e,i){return i.some(function(i){return mt(t,e,i)})}(t,i,n)){var o=new oi(t.segments,function(t,e,i,n){for(var r={},o=0,s=i;o<s.length;o++){var a=s[o];if(mt(t,e,a)&&!n[gt(a)]){var h=new oi([],{});h._sourceSegment=t,h._segmentIndexShift=t.segments.length,r[gt(a)]=h}}return Object.assign({},n,r)}(t,i,n,t.children));return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:i}}var s=new oi(t.segments,t.children);return s._sourceSegment=t,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:i}}function mt(t,e,i){return(!(t.hasChildren()||e.length>0)||"full"!==i.pathMatch)&&(""===i.path&&void 0===i.redirectTo)}function gt(t){return t.outlet||ti}function yt(t){return t.data||{}}function vt(t){return t.resolve||{}}function bt(t){throw t}function xt(t){return ae(null)}function _t(t){$(t.value),t.children.forEach(_t)}function wt(t){var e={};return t&&t.children.forEach(function(t){return e[t.value.outlet]=t}),e}function Tt(t){return""===t||!!t}function St(){return new Bt.F("Router",Ii)}function Et(t,e,i){return void 0===i&&(i={}),i.useHash?new It.f(t,e):new It.o(t,e)}function Ct(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Pt(t){return[{provide:Bt.a,multi:!0,useValue:t},{provide:Ai,multi:!0,useValue:t}]}function Mt(t,e,i,n,r,o,s,a,h,u,c){void 0===h&&(h={});var l=new Ii(null,e,i,n,r,o,s,_(a));if(u&&(l.urlHandlingStrategy=u),c&&(l.routeReuseStrategy=c),h.errorHandler&&(l.errorHandler=h.errorHandler),h.enableTracing){var d=Object(je.t)();l.events.subscribe(function(t){d.logGroup("Router Event: "+t.constructor.name),d.log(t.toString()),d.log(t),d.logGroupEnd()})}return l}function At(t){return t.routerState.root}function Rt(t){return t.appInitializer.bind(t)}function Lt(t){return t.bootstrapListener.bind(t)}var Ot=i("6Xbx"),It=i("qbdv"),Bt=i("/oeL"),kt=i("TO51"),Dt=i("Upor"),Ft=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Ut=function(t){function e(e){t.call(this),this._value=e}return Ft(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var i=t.prototype._subscribe.call(this,e);return i&&!i.closed&&e.next(this._value),i},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Dt.a;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(kt.a),Nt=i("1j/l"),Gt=i("kQVV"),jt=i("mHG6"),Vt=i("xIGM"),Ht=i("AP4T"),zt=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Wt=function(t){function e(e,i){t.call(this),this.promise=e,this.scheduler=i}return zt(e,t),e.create=function(t,i){return new e(t,i)},e.prototype._subscribe=function(t){var e=this,i=this.promise,o=this.scheduler;if(null==o)this._isScalar?t.closed||(t.next(this.value),t.complete()):i.then(function(i){e.value=i,e._isScalar=!0,t.closed||(t.next(i),t.complete())},function(e){t.closed||t.error(e)}).then(null,function(t){Vt.a.setTimeout(function(){throw t})});else if(this._isScalar){if(!t.closed)return o.schedule(n,0,{value:this.value,subscriber:t})}else i.then(function(i){e.value=i,e._isScalar=!0,t.closed||t.add(o.schedule(n,0,{value:i,subscriber:t}))},function(e){t.closed||t.add(o.schedule(r,0,{err:e,subscriber:t}))}).then(null,function(t){Vt.a.setTimeout(function(){throw t})})},e}(Ht.a),Xt=i("X3fp"),qt=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Yt=function(t){function e(e,i){if(t.call(this),this.scheduler=i,null==e)throw new Error("iterator cannot be null.");this.iterator=function(t){var e=t[Xt.a];if(!e&&"string"==typeof t)return new Kt(t);if(!e&&void 0!==t.length)return new Zt(t);if(!e)throw new TypeError("object is not iterable");return t[Xt.a]()}(e)}return qt(e,t),e.create=function(t,i){return new e(t,i)},e.dispatch=function(t){var e=t.index,i=t.hasError,n=t.iterator,r=t.subscriber;if(i)r.error(t.error);else{var o=n.next();o.done?r.complete():(r.next(o.value),t.index=e+1,r.closed?"function"==typeof n.return&&n.return():this.schedule(t))}},e.prototype._subscribe=function(t){var i=this.iterator,n=this.scheduler;if(n)return n.schedule(e.dispatch,0,{index:0,iterator:i,subscriber:t});for(;;){var r=i.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed){"function"==typeof i.return&&i.return();break}}},e}(Ht.a),Kt=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length),this.str=t,this.idx=e,this.len=i}return t.prototype[Xt.a]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},t}(),Zt=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=o(t)),this.arr=t,this.idx=e,this.len=i}return t.prototype[Xt.a]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},t}(),Qt=Math.pow(2,53)-1,Jt=i("Oryw"),$t=i("8Ut3"),te=i("Ecq+"),ee=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ie=function(t){function e(e,i){t.call(this),this.arrayLike=e,this.scheduler=i,i||1!==e.length||(this._isScalar=!0,this.value=e[0])}return ee(e,t),e.create=function(t,i){var n=t.length;return 0===n?new te.a:1===n?new $t.a(t[0],i):new e(t,i)},e.dispatch=function(t){var e=t.arrayLike,i=t.index,n=t.length,r=t.subscriber;r.closed||(i>=n?r.complete():(r.next(e[i]),t.index=i+1,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.arrayLike,n=this.scheduler,r=i.length;if(n)return n.schedule(e.dispatch,0,{arrayLike:i,index:0,length:r,subscriber:t});for(var o=0;o<r&&!t.closed;o++)t.next(i[o]);t.complete()},e}(Ht.a),ne=i("YRqN"),re=i("mz3w"),oe=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},se=function(t){function e(e,i){t.call(this,null),this.ish=e,this.scheduler=i}return oe(e,t),e.create=function(t,i){if(null!=t){if("function"==typeof t[re.a])return t instanceof Ht.a&&!i?t:new e(t,i);if(Object(Nt.a)(t))return new Jt.a(t,i);if(Object(jt.a)(t))return new Wt(t,i);if("function"==typeof t[Xt.a]||"string"==typeof t)return new Yt(t,i);if(Object(Gt.a)(t))return new ie(t,i)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")},e.prototype._subscribe=function(t){var e=this.ish,i=this.scheduler;return null==i?e[re.a]().subscribe(t):e[re.a]().subscribe(new ne.a(t,i,0))},e}(Ht.a).create,ae=Jt.a.of,he=i("wP3s"),ue=i("E9/g"),ce=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},le=function(){function t(t,e,i){this.predicate=t,this.thisArg=e,this.source=i}return t.prototype.call=function(t,e){return e.subscribe(new de(t,this.predicate,this.thisArg,this.source))},t}(),de=function(t){function e(e,i,n,r){t.call(this,e),this.predicate=i,this.thisArg=n,this.source=r,this.index=0,this.thisArg=n||this}return ce(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(ue.a),pe=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},fe=function(t){function e(){var e=t.call(this,"no elements in sequence");this.name=e.name="EmptyError",this.stack=e.stack,this.message=e.message}return pe(e,t),e}(Error),me=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ge=function(){function t(t,e,i,n){this.predicate=t,this.resultSelector=e,this.defaultValue=i,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new ye(t,this.predicate,this.resultSelector,this.defaultValue,this.source))},t}(),ye=function(t){function e(e,i,n,r,o){t.call(this,e),this.predicate=i,this.resultSelector=n,this.defaultValue=r,this.source=o,this.index=0,this.hasCompleted=!1,this._emitted=!1}return me(e,t),e.prototype._next=function(t){var e=this.index++;this.predicate?this._tryPredicate(t,e):this._emit(t,e)},e.prototype._tryPredicate=function(t,e){var i;try{i=this.predicate(t,e,this.source)}catch(t){return void this.destination.error(t)}i&&this._emit(t,e)},e.prototype._emit=function(t,e){this.resultSelector?this._tryResultSelector(t,e):this._emitFinal(t)},e.prototype._tryResultSelector=function(t,e){var i;try{i=this.resultSelector(t,e)}catch(t){return void this.destination.error(t)}this._emitFinal(i)},e.prototype._emitFinal=function(t){var e=this.destination;this._emitted||(this._emitted=!0,e.next(t),e.complete(),this.hasCompleted=!0)},e.prototype._complete=function(){var t=this.destination;this.hasCompleted||"undefined"==typeof this.defaultValue?this.hasCompleted||t.error(new fe):(t.next(this.defaultValue),t.complete())},e}(ue.a),ve=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},be=function(){function t(t,e,i,n){this.predicate=t,this.resultSelector=e,this.defaultValue=i,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new xe(t,this.predicate,this.resultSelector,this.defaultValue,this.source))},t}(),xe=function(t){function e(e,i,n,r,o){t.call(this,e),this.predicate=i,this.resultSelector=n,this.defaultValue=r,this.source=o,this.hasValue=!1,this.index=0,"undefined"!=typeof r&&(this.lastValue=r,this.hasValue=!0)}return ve(e,t),e.prototype._next=function(t){var e=this.index++;if(this.predicate)this._tryPredicate(t,e);else{if(this.resultSelector)return void this._tryResultSelector(t,e);this.lastValue=t,this.hasValue=!0}},e.prototype._tryPredicate=function(t,e){var i;try{i=this.predicate(t,e,this.source)}catch(t){return void this.destination.error(t)}if(i){if(this.resultSelector)return void this._tryResultSelector(t,e);this.lastValue=t,this.hasValue=!0}},e.prototype._tryResultSelector=function(t,e){var i;try{i=this.resultSelector(t,e)}catch(t){return void this.destination.error(t)}this.lastValue=i,this.hasValue=!0},e.prototype._complete=function(){var t=this.destination;this.hasValue?(t.next(this.lastValue),t.complete()):t.error(new fe)},e}(ue.a),_e=i("dmC+"),we=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Te=function(){function t(t,e,i){void 0===i&&(i=!1),this.accumulator=t,this.seed=e,this.hasSeed=i}return t.prototype.call=function(t,e){return e.subscribe(new Se(t,this.accumulator,this.seed,this.hasSeed))},t}(),Se=function(t){function e(e,i,n,r){t.call(this,e),this.accumulator=i,this._seed=n,this.hasSeed=r,this.index=0}return we(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,i=this.index++;try{e=this.accumulator(this.seed,t,i)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(ue.a),Ee=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Ce=function(t){function e(){var e=t.call(this,"argument out of range");this.name=e.name="ArgumentOutOfRangeError",this.stack=e.stack,this.message=e.message}return Ee(e,t),e}(Error),Pe=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Me=function(){function t(t){if(this.total=t,this.total<0)throw new Ce}return t.prototype.call=function(t,e){return e.subscribe(new Ae(t,this.total))},t}(),Ae=function(t){function e(e,i){t.call(this,e),this.total=i,this.ring=new Array,this.count=0}return Pe(e,t),e.prototype._next=function(t){var e=this.ring,i=this.total,n=this.count++;if(e.length<i)e.push(t);else{e[n%i]=t}},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var i=this.count>=this.total?this.total:this.count,n=this.ring,r=0;r<i;r++){var o=e++%i;t.next(n[o])}t.complete()},e}(ue.a),Re=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Le=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new Oe(t,this.defaultValue))},t}(),Oe=function(t){function e(e,i){t.call(this,e),this.defaultValue=i,this.isEmpty=!0}return Re(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(ue.a),Ie=i("ExCY"),Be=i("lI6h"),ke=i("qgI0"),De=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Fe=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new Ue(t,this.selector,this.caught))},t}(),Ue=function(t){function e(e,i,n){t.call(this,e),this.selector=i,this.caught=n}return De(e,t),e.prototype.error=function(e){if(!this.isStopped){var i=void 0;try{i=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle(),this.add(Object(ke.a)(this,i))}},e}(Be.a),Ne=i("bywS"),Ge=Wt.create,je=i("fc+i"),Ve=i("LaOa");i.d(e,"d",function(){return We}),i.d(e,"e",function(){return ze}),i.d(e,"f",function(){return Xe}),i.d(e,"m",function(){return Pi}),i.d(e,"n",function(){return Ii}),i.d(e,"l",function(){return Ai}),i.d(e,"j",function(){return Zi}),i.d(e,"k",function(){return en}),i.d(e,"o",function(){return $i}),i.d(e,"b",function(){return Vi}),i.d(e,"g",function(){return qi}),i.d(e,"h",function(){return Xi}),i.d(e,"i",function(){return Wi}),i.d(e,"p",function(){return Yi}),i.d(e,"a",function(){return xi}),i.d(e,"q",function(){return Li}),i.d(e,"c",function(){return hi}),i.d(e,"r",function(){return ai}),i.d(e,"s",function(){return Qi}),i.d(e,"y",function(){return tn}),i.d(e,"z",function(){return Rt}),i.d(e,"A",function(){return Lt}),i.d(e,"v",function(){return Ct}),i.d(e,"u",function(){return Et}),i.d(e,"x",function(){return At}),i.d(e,"t",function(){return St}),i.d(e,"w",function(){return Mt});var He=function(){function t(t,e){this.id=t,this.url=e}return t.prototype.toString=function(){return"NavigationStart(id: "+this.id+", url: '"+this.url+"')"},t}(),ze=function(){function t(t,e,i){this.id=t,this.url=e,this.urlAfterRedirects=i}return t.prototype.toString=function(){return"NavigationEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"')"},t}(),We=function(){function t(t,e,i){this.id=t,this.url=e,this.reason=i}return t.prototype.toString=function(){return"NavigationCancel(id: "+this.id+", url: '"+this.url+"')"},t}(),Xe=function(){function t(t,e,i){this.id=t,this.url=e,this.error=i}return t.prototype.toString=function(){return"NavigationError(id: "+this.id+", url: '"+this.url+"', error: "+this.error+")"},t}(),qe=function(){function t(t,e,i,n){this.id=t,this.url=e,this.urlAfterRedirects=i,this.state=n}return t.prototype.toString=function(){return"RoutesRecognized(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(),Ye=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadStart(path: "+this.route.path+")"},t}(),Ke=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadEnd(path: "+this.route.path+")"},t}(),Ze=function(){function t(t,e,i,n){this.id=t,this.url=e,this.urlAfterRedirects=i,this.state=n}return t.prototype.toString=function(){return"GuardsCheckStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(),Qe=function(){function t(t,e,i,n,r){this.id=t,this.url=e,this.urlAfterRedirects=i,this.state=n,this.shouldActivate=r}return t.prototype.toString=function(){return"GuardsCheckEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+", shouldActivate: "+this.shouldActivate+")"},t}(),Je=function(){function t(t,e,i,n){this.id=t,this.url=e,this.urlAfterRedirects=i,this.state=n}return t.prototype.toString=function(){return"ResolveStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(),$e=function(){function t(t,e,i,n){this.id=t,this.url=e,this.urlAfterRedirects=i,this.state=n}return t.prototype.toString=function(){return"ResolveEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(),ti="primary",ei=function(){function t(t){this.params=t||{}}return t.prototype.has=function(t){return this.params.hasOwnProperty(t)},t.prototype.get=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e[0]:e}return null},t.prototype.getAll=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e:[e]}return[]},Object.defineProperty(t.prototype,"keys",{get:function(){return Object.keys(this.params)},enumerable:!0,configurable:!0}),t}(),ii="ngNavigationCancelingError",ni=function(){return function(t,e){this.routes=t,this.module=e}}(),ri=function(){function t(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}return Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=y(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return ui.serialize(this)},t}(),oi=function(){function t(t,e){var i=this;this.segments=t,this.children=e,this.parent=null,T(e,function(t,e){return t.parent=i})}return t.prototype.hasChildren=function(){return this.numberOfChildren>0},Object.defineProperty(t.prototype,"numberOfChildren",{get:function(){return Object.keys(this.children).length},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return O(this)},t}(),si=function(){function t(t,e){this.path=t,this.parameters=e}return Object.defineProperty(t.prototype,"parameterMap",{get:function(){return this._parameterMap||(this._parameterMap=y(this.parameters)),this._parameterMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return D(this)},t}(),ai=function(){function t(){}return t.prototype.parse=function(t){},t.prototype.serialize=function(t){},t}(),hi=function(){function t(){}return t.prototype.parse=function(t){var e=new pi(t);return new ri(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())},t.prototype.serialize=function(t){return""+("/"+I(t.root,!0))+function(t){var e=Object.keys(t).map(function(e){var i=t[e];return Array.isArray(i)?i.map(function(t){return B(e)+"="+B(t)}).join("&"):B(e)+"="+B(i)});return e.length?"?"+e.join("&"):""}(t.queryParams)+("string"==typeof t.fragment?"#"+encodeURI(t.fragment):"")},t}(),ui=new hi,ci=/^[^\/()?;=&#]+/,li=/^[^=?&#]+/,di=/^[^?&#]+/,pi=function(){function t(t){this.url=t,this.remaining=t}return t.prototype.parseRootSegment=function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new oi([],{}):new oi([],this.parseChildren())},t.prototype.parseQueryParams=function(){var t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t},t.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURI(this.remaining):null},t.prototype.parseChildren=function(){if(""===this.remaining)return{};this.consumeOptional("/");var t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());var e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));var i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[ti]=new oi(t,e)),i},t.prototype.parseSegment=function(){var t=F(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(t),new si(k(t),this.parseMatrixParams())},t.prototype.parseMatrixParams=function(){for(var t={};this.consumeOptional(";");)this.parseParam(t);return t},t.prototype.parseParam=function(t){var e=F(this.remaining);if(e){this.capture(e);var i="";if(this.consumeOptional("=")){var n=F(this.remaining);n&&(i=n,this.capture(i))}t[k(e)]=k(i)}},t.prototype.parseQueryParam=function(t){var e=function(t){var e=t.match(li);return e?e[0]:""}(this.remaining);if(e){this.capture(e);var i="";if(this.consumeOptional("=")){var n=function(t){var e=t.match(di);return e?e[0]:""}(this.remaining);n&&(i=n,this.capture(i))}var r=k(e),o=k(i);if(t.hasOwnProperty(r)){var s=t[r];Array.isArray(s)||(s=[s],t[r]=s),s.push(o)}else t[r]=o}},t.prototype.parseParens=function(t){var e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var i=F(this.remaining),n=this.remaining[i.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error("Cannot parse url '"+this.url+"'");var r=void 0;i.indexOf(":")>-1?(r=i.substr(0,i.indexOf(":")),this.capture(r),this.capture(":")):t&&(r=ti);var o=this.parseChildren();e[r]=1===Object.keys(o).length?o[ti]:new oi([],o),this.consumeOptional("//")}return e},t.prototype.peekStartsWith=function(t){return this.remaining.startsWith(t)},t.prototype.consumeOptional=function(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)},t.prototype.capture=function(t){if(!this.consumeOptional(t))throw new Error('Expected "'+t+'".')},t}(),fi=function(){return function(t){this.segmentGroup=t||null}}(),mi=function(){return function(t){this.urlTree=t}}(),gi=function(){function t(t,e,i,n,r){this.configLoader=e,this.urlSerializer=i,this.urlTree=n,this.config=r,this.allowRedirects=!0,this.ngModule=t.get(Bt.E)}return t.prototype.apply=function(){var t=this,e=this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,ti),i=_e.a.call(e,function(e){return t.createUrlTree(e,t.urlTree.queryParams,t.urlTree.fragment)});return f.call(i,function(e){if(e instanceof mi)return t.allowRedirects=!1,t.match(e.urlTree);if(e instanceof fi)throw t.noMatchError(e);throw e})},t.prototype.match=function(t){var e=this,i=this.expandSegmentGroup(this.ngModule,this.config,t.root,ti),n=_e.a.call(i,function(i){return e.createUrlTree(i,t.queryParams,t.fragment)});return f.call(n,function(t){if(t instanceof fi)throw e.noMatchError(t);throw t})},t.prototype.noMatchError=function(t){return new Error("Cannot match any routes. URL Segment: '"+t.segmentGroup+"'")},t.prototype.createUrlTree=function(t,e,i){var n=t.segments.length>0?new oi([],(r={},r[ti]=t,r)):t;return new ri(n,e,i);var r},t.prototype.expandSegmentGroup=function(t,e,i,n){return 0===i.segments.length&&i.hasChildren()?_e.a.call(this.expandChildren(t,e,i),function(t){return new oi([],t)}):this.expandSegment(t,i,e,i.segments,n,!0)},t.prototype.expandChildren=function(t,e,i){var n=this;return function(t,e){if(0===Object.keys(t).length)return ae({});var i=[],n=[],r={};T(t,function(t,o){var s=_e.a.call(e(o,t),function(t){return r[o]=t});o===ti?i.push(s):n.push(s)});var o=m.call(ae.apply(void 0,i.concat(n))),s=u.call(o);return _e.a.call(s,function(){return r})}(i.children,function(i,r){return n.expandSegmentGroup(t,e,r,i)})},t.prototype.expandSegment=function(t,e,i,n,r,o){var s=this,a=ae.apply(void 0,i),u=_e.a.call(a,function(a){var h=s.expandSegmentAgainstRoute(t,e,i,a,n,r,o);return f.call(h,function(t){if(t instanceof fi)return ae(null);throw t})}),c=m.call(u),l=h.call(c,function(t){return!!t});return f.call(l,function(t,i){if(t instanceof fe){if(s.noLeftoversInUrl(e,n,r))return ae(new oi([],{}));throw new fi(e)}throw t})},t.prototype.noLeftoversInUrl=function(t,e,i){return 0===e.length&&!t.children[i]},t.prototype.expandSegmentAgainstRoute=function(t,e,i,n,r,o,s){return X(n)!==o?U(e):void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,e,n,r):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,n,r,o):U(e)},t.prototype.expandSegmentAgainstRouteUsingRedirect=function(t,e,i,n,r,o){return"**"===n.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,n,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,n,r,o)},t.prototype.expandWildCardWithParamsAgainstRouteUsingRedirect=function(t,e,i,n){var r=this,o=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?N(o):c.call(this.lineralizeSegments(i,o),function(i){var o=new oi(i,{});return r.expandSegment(t,o,e,i,n,!1)})},t.prototype.expandRegularSegmentAgainstRouteUsingRedirect=function(t,e,i,n,r,o){var s=this,a=V(e,n,r),h=a.matched,u=a.consumedSegments,l=a.lastChild,d=a.positionalParamSegments;if(!h)return U(e);var p=this.applyRedirectCommands(u,n.redirectTo,d);return n.redirectTo.startsWith("/")?N(p):c.call(this.lineralizeSegments(n,p),function(n){return s.expandSegment(t,e,i,n.concat(r.slice(l)),o,!1)})},t.prototype.matchSegmentAgainstRoute=function(t,e,i,n){var r=this;if("**"===i.path)return i.loadChildren?_e.a.call(this.configLoader.load(t.injector,i),function(t){return i._loadedConfig=t,new oi(n,{})}):ae(new oi(n,{}));var o=V(e,i,n),s=o.matched,a=o.consumedSegments,h=o.lastChild;if(!s)return U(e);var u=n.slice(h),l=this.getChildConfig(t,i);return c.call(l,function(t){var i=t.module,n=t.routes,o=H(e,a,u,n),s=o.segmentGroup,h=o.slicedSegments;if(0===h.length&&s.hasChildren()){var c=r.expandChildren(i,n,s);return _e.a.call(c,function(t){return new oi(a,t)})}if(0===n.length&&0===h.length)return ae(new oi(a,{}));var l=r.expandSegment(i,s,n,h,ti,!0);return _e.a.call(l,function(t){return new oi(a.concat(t.segments),t.children)})})},t.prototype.getChildConfig=function(t,e){var i=this;return e.children?ae(new ni(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?ae(e._loadedConfig):c.call(function(t,e){var i=e.canLoad;return i&&0!==i.length?S(_e.a.call(se(i),function(i){var n=t.get(i);return E(n.canLoad?n.canLoad(e):n(e))})):ae(!0)}(t.injector,e),function(n){return n?_e.a.call(i.configLoader.load(t.injector,e),function(t){return e._loadedConfig=t,t}):j(e)}):ae(new ni([],t))},t.prototype.lineralizeSegments=function(t,e){for(var i=[],n=e.root;;){if(i=i.concat(n.segments),0===n.numberOfChildren)return ae(i);if(n.numberOfChildren>1||!n.children[ti])return G(t.redirectTo);n=n.children[ti]}},t.prototype.applyRedirectCommands=function(t,e,i){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,i)},t.prototype.applyRedirectCreatreUrlTree=function(t,e,i,n){var r=this.createSegmentGroup(t,e.root,i,n);return new ri(r,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)},t.prototype.createQueryParams=function(t,e){var i={};return T(t,function(t,n){if("string"==typeof t&&t.startsWith(":")){var r=t.substring(1);i[n]=e[r]}else i[n]=t}),i},t.prototype.createSegmentGroup=function(t,e,i,n){var r=this,o=this.createSegments(t,e.segments,i,n),s={};return T(e.children,function(e,o){s[o]=r.createSegmentGroup(t,e,i,n)}),new oi(o,s)},t.prototype.createSegments=function(t,e,i,n){var r=this;return e.map(function(e){return e.path.startsWith(":")?r.findPosParam(t,e,n):r.findOrReturn(e,i)})},t.prototype.findPosParam=function(t,e,i){var n=i[e.path.substring(1)];if(!n)throw new Error("Cannot redirect to '"+t+"'. Cannot find '"+e.path+"'.");return n},t.prototype.findOrReturn=function(t,e){for(var i=0,n=0,r=e;n<r.length;n++){var o=r[n];if(o.path===t.path)return e.splice(i),o;i++}return t},t}(),yi=function(){function t(t){this._root=t}return Object.defineProperty(t.prototype,"root",{get:function(){return this._root.value},enumerable:!0,configurable:!0}),t.prototype.parent=function(t){var e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null},t.prototype.children=function(t){var e=q(t,this._root);return e?e.children.map(function(t){return t.value}):[]},t.prototype.firstChild=function(t){var e=q(t,this._root);return e&&e.children.length>0?e.children[0].value:null},t.prototype.siblings=function(t){var e=Y(t,this._root);if(e.length<2)return[];return e[e.length-2].children.map(function(t){return t.value}).filter(function(e){return e!==t})},t.prototype.pathFromRoot=function(t){return Y(t,this._root).map(function(t){return t.value})},t}(),vi=function(){function t(t,e){this.value=t,this.children=e}return t.prototype.toString=function(){return"TreeNode("+this.value+")"},t}(),bi=function(t){function e(e,i){var n=t.call(this,e)||this;return n.snapshot=i,Q(n,e),n}return Ot.a(e,t),e.prototype.toString=function(){return this.snapshot.toString()},e}(yi),xi=function(){function t(t,e,i,n,r,o,s,a){this.url=t,this.params=e,this.queryParams=i,this.fragment=n,this.data=r,this.outlet=o,this.component=s,this._futureSnapshot=a}return Object.defineProperty(t.prototype,"routeConfig",{get:function(){return this._futureSnapshot.routeConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=_e.a.call(this.params,function(t){return y(t)})),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=_e.a.call(this.queryParams,function(t){return y(t)})),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.snapshot?this.snapshot.toString():"Future("+this._futureSnapshot+")"},t}(),_i=function(){function t(t,e,i,n,r,o,s,a,h,u,c){this.url=t,this.params=e,this.queryParams=i,this.fragment=n,this.data=r,this.outlet=o,this.component=s,this._routeConfig=a,this._urlSegment=h,this._lastPathIndex=u,this._resolve=c}return Object.defineProperty(t.prototype,"routeConfig",{get:function(){return this._routeConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=y(this.params)),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=y(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"Route(url:'"+this.url.map(function(t){return t.toString()}).join("/")+"', path:'"+(this._routeConfig?this._routeConfig.path:"")+"')"},t}(),wi=function(t){function e(e,i){var n=t.call(this,i)||this;return n.url=e,Q(n,i),n}return Ot.a(e,t),e.prototype.toString=function(){return J(this._root)},e}(yi),Ti=function(){function t(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&rt(i[0]))throw new Error("Root segment cannot have matrix parameters");var n=i.find(function(t){return"object"==typeof t&&null!=t&&t.outlets});if(n&&n!==w(i))throw new Error("{outlets:{}} has to be the last command")}return t.prototype.toRoot=function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]},t}(),Si=function(){return function(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}(),Ei=function(){return function(){}}(),Ci=function(){function t(t,e,i,n){this.rootComponentType=t,this.config=e,this.urlTree=i,this.url=n}return t.prototype.recognize=function(){try{var t=ft(this.urlTree.root,[],[],this.config).segmentGroup,e=this.processSegmentGroup(this.config,t,ti),i=new _i([],Object.freeze({}),Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,{},ti,this.rootComponentType,null,this.urlTree.root,-1,{}),n=new vi(i,e),r=new wi(this.url,n);return this.inheritParamsAndData(r._root),ae(r)}catch(t){return new Ht.a(function(e){return e.error(t)})}},t.prototype.inheritParamsAndData=function(t){var e=this,i=t.value,n=Z(i);i.params=Object.freeze(n.params),i.data=Object.freeze(n.data),t.children.forEach(function(t){return e.inheritParamsAndData(t)})},t.prototype.processSegmentGroup=function(t,e,i){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,i)},t.prototype.processChildren=function(t,e){var i=this,n=L(e,function(e,n){return i.processSegmentGroup(t,e,n)});return function(t){var e={};t.forEach(function(t){var i=e[t.value.outlet];if(i){var n=i.url.map(function(t){return t.toString()}).join("/"),r=t.value.url.map(function(t){return t.toString()}).join("/");throw new Error("Two segments cannot have the same outlet name: '"+n+"' and '"+r+"'.")}e[t.value.outlet]=t.value})}(n),function(t){t.sort(function(t,e){return t.value.outlet===ti?-1:e.value.outlet===ti?1:t.value.outlet.localeCompare(e.value.outlet)})}(n),n},t.prototype.processSegment=function(t,e,i,n){for(var r=0,o=t;r<o.length;r++){var s=o[r];try{return this.processSegmentAgainstRoute(s,e,i,n)}catch(t){if(!(t instanceof Ei))throw t}}if(this.noLeftoversInUrl(e,i,n))return[];throw new Ei},t.prototype.noLeftoversInUrl=function(t,e,i){return 0===e.length&&!t.children[i]},t.prototype.processSegmentAgainstRoute=function(t,e,i,n){if(t.redirectTo)throw new Ei;if((t.outlet||ti)!==n)throw new Ei;if("**"===t.path){var r=i.length>0?w(i).parameters:{},o=new _i(i,r,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,yt(t),n,t.component,t,dt(e),pt(e)+i.length,vt(t));return[new vi(o,[])]}var s=function(t,e,i){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||i.length>0))throw new Ei;return{consumedSegments:[],lastChild:0,parameters:{}}}var n=(e.matcher||v)(i,t,e);if(!n)throw new Ei;var r={};T(n.posParams,function(t,e){r[e]=t.path});var o=n.consumed.length>0?Object.assign({},r,n.consumed[n.consumed.length-1].parameters):r;return{consumedSegments:n.consumed,lastChild:n.consumed.length,parameters:o}}(e,t,i),a=s.consumedSegments,h=s.parameters,u=s.lastChild,c=i.slice(u),l=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),d=ft(e,a,c,l),p=d.segmentGroup,f=d.slicedSegments,m=new _i(a,h,Object.freeze(this.urlTree.queryParams),this.urlTree.fragment,yt(t),n,t.component,t,dt(e),pt(e)+a.length,vt(t));if(0===f.length&&p.hasChildren()){var g=this.processChildren(l,p);return[new vi(m,g)]}if(0===l.length&&0===f.length)return[new vi(m,[])];var y=this.processSegment(l,p,f,ti);return[new vi(m,y)]},t}(),Pi=function(){function t(){}return t.prototype.shouldDetach=function(t){},t.prototype.store=function(t,e){},t.prototype.shouldAttach=function(t){},t.prototype.retrieve=function(t){},t.prototype.shouldReuseRoute=function(t,e){},t}(),Mi=function(){function t(){}return t.prototype.shouldDetach=function(t){return!1},t.prototype.store=function(t,e){},t.prototype.shouldAttach=function(t){return!1},t.prototype.retrieve=function(t){return null},t.prototype.shouldReuseRoute=function(t,e){return t.routeConfig===e.routeConfig},t}(),Ai=new Bt.v("ROUTES"),Ri=function(){function t(t,e,i,n){this.loader=t,this.compiler=e,this.onLoadStartListener=i,this.onLoadEndListener=n}return t.prototype.load=function(t,e){var i=this;this.onLoadStartListener&&this.onLoadStartListener(e);var n=this.loadModuleFactory(e.loadChildren);return _e.a.call(n,function(n){i.onLoadEndListener&&i.onLoadEndListener(e);var r=n.create(t);return new ni(_(r.injector.get(Ai)),r)})},t.prototype.loadModuleFactory=function(t){var e=this;return"string"==typeof t?Ge(this.loader.load(t)):c.call(E(t()),function(t){return t instanceof Bt.C?ae(t):Ge(e.compiler.compileModuleAsync(t))})},t}(),Li=function(){function t(){}return t.prototype.shouldProcessUrl=function(t){},t.prototype.extract=function(t){},t.prototype.merge=function(t,e){},t}(),Oi=function(){function t(){}return t.prototype.shouldProcessUrl=function(t){return!0},t.prototype.extract=function(t){return t},t.prototype.merge=function(t,e){return t},t}(),Ii=function(){function t(t,e,i,n,r,o,s,a){var h=this;this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=i,this.location=n,this.config=a,this.navigations=new Ut(null),this.routerEvents=new kt.a,this.navigationId=0,this.errorHandler=bt,this.navigated=!1,this.hooks={beforePreactivation:xt,afterPreactivation:xt},this.urlHandlingStrategy=new Oi,this.routeReuseStrategy=new Mi;this.ngModule=r.get(Bt.E),this.resetConfig(a),this.currentUrlTree=new ri(new oi([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.configLoader=new Ri(o,s,function(t){return h.triggerEvent(new Ye(t))},function(t){return h.triggerEvent(new Ke(t))}),this.currentRouterState=K(this.currentUrlTree,this.rootComponentType),this.processNavigations()}return t.prototype.resetRootComponentType=function(t){this.rootComponentType=t,this.currentRouterState.root.component=this.rootComponentType},t.prototype.initialNavigation=function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})},t.prototype.setUpLocationChangeListener=function(){var t=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(Zone.current.wrap(function(e){var i=t.urlSerializer.parse(e.url),n="popstate"===e.type?"popstate":"hashchange";setTimeout(function(){t.scheduleNavigation(i,n,{replaceUrl:!0})},0)})))},Object.defineProperty(t.prototype,"routerState",{get:function(){return this.currentRouterState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this.serializeUrl(this.currentUrlTree)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){return this.routerEvents},enumerable:!0,configurable:!0}),t.prototype.triggerEvent=function(t){this.routerEvents.next(t)},t.prototype.resetConfig=function(t){b(t),this.config=t,this.navigated=!1},t.prototype.ngOnDestroy=function(){this.dispose()},t.prototype.dispose=function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)},t.prototype.createUrlTree=function(t,e){void 0===e&&(e={});var i=e.relativeTo,n=e.queryParams,r=e.fragment,o=e.preserveQueryParams,s=e.queryParamsHandling,a=e.preserveFragment;Object(Bt._5)()&&o&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var h=i||this.routerState.root,u=a?this.currentUrlTree.fragment:r,c=null;if(s)switch(s){case"merge":c=Object.assign({},this.currentUrlTree.queryParams,n);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=n||null}else c=o?this.currentUrlTree.queryParams:n||null;return nt(h,this.currentUrlTree,t,c,u)},t.prototype.navigateByUrl=function(t,e){void 0===e&&(e={skipLocationChange:!1});var i=t instanceof ri?t:this.parseUrl(t),n=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(n,"imperative",e)},t.prototype.navigate=function(t,e){return void 0===e&&(e={skipLocationChange:!1}),function(t){for(var e=0;e<t.length;e++){var i=t[e];if(null==i)throw new Error("The requested path contains "+i+" segment at index "+e)}}(t),"object"==typeof e.queryParams&&null!==e.queryParams&&(e.queryParams=this.removeEmptyProps(e.queryParams)),this.navigateByUrl(this.createUrlTree(t,e),e)},t.prototype.serializeUrl=function(t){return this.urlSerializer.serialize(t)},t.prototype.parseUrl=function(t){return this.urlSerializer.parse(t)},t.prototype.isActive=function(t,e){if(t instanceof ri)return C(this.currentUrlTree,t,e);var i=this.urlSerializer.parse(t);return C(this.currentUrlTree,i,e)},t.prototype.removeEmptyProps=function(t){return Object.keys(t).reduce(function(e,i){var n=t[i];return null!==n&&void 0!==n&&(e[i]=n),e},{})},t.prototype.processNavigations=function(){var t=this;s.call(this.navigations,function(e){return e?(t.executeScheduledNavigation(e),e.promise.catch(function(){})):ae(null)}).subscribe(function(){})},t.prototype.scheduleNavigation=function(t,e,i){var n=this.navigations.value;if(n&&"imperative"!==e&&"imperative"===n.source&&n.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(n&&"hashchange"==e&&"popstate"===n.source&&n.rawUrl.toString()===t.toString())return Promise.resolve(!0);var r=null,o=null,s=new Promise(function(t,e){r=t,o=e}),a=++this.navigationId;return this.navigations.next({id:a,source:e,rawUrl:t,extras:i,resolve:r,reject:o,promise:s}),s.catch(function(t){return Promise.reject(t)})},t.prototype.executeScheduledNavigation=function(t){var e=this,i=t.id,n=t.rawUrl,r=t.extras,o=t.resolve,s=t.reject,a=this.urlHandlingStrategy.extract(n),h=!this.navigated||a.toString()!==this.currentUrlTree.toString();h&&this.urlHandlingStrategy.shouldProcessUrl(n)?(this.routerEvents.next(new He(i,this.serializeUrl(a))),Promise.resolve().then(function(t){return e.runNavigate(a,n,!!r.skipLocationChange,!!r.replaceUrl,i,null)}).then(o,s)):h&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)?(this.routerEvents.next(new He(i,this.serializeUrl(a))),Promise.resolve().then(function(t){return e.runNavigate(a,n,!1,!1,i,K(a,e.rootComponentType).snapshot)}).then(o,s)):(this.rawUrlTree=n,o(null))},t.prototype.runNavigate=function(t,e,i,n,r,o){var s=this;return r!==this.navigationId?(this.location.go(this.urlSerializer.serialize(this.currentUrlTree)),this.routerEvents.next(new We(r,this.serializeUrl(t),"Navigation ID "+r+" is not equal to the current navigation id "+this.navigationId)),Promise.resolve(!1)):new Promise(function(a,h){var u;if(o)u=ae({appliedUrl:t,snapshot:o});else{var l=function(t,e,i,n,r){return new gi(t,e,i,n,r).apply()}(s.ngModule.injector,s.configLoader,s.urlSerializer,t,s.config);u=c.call(l,function(e){return _e.a.call(function(t,e,i,n){return new Ci(t,e,i,n).recognize()}(s.rootComponentType,s.config,e,s.serializeUrl(e)),function(i){return s.routerEvents.next(new qe(r,s.serializeUrl(t),s.serializeUrl(e),i)),{appliedUrl:e,snapshot:i}})})}var d,p,f=c.call(u,function(t){return _e.a.call(s.hooks.beforePreactivation(t.snapshot),function(){return t})}),m=_e.a.call(f,function(t){var e=t.appliedUrl,i=t.snapshot,n=s.ngModule.injector;return(d=new Di(i,s.currentRouterState.snapshot,n)).traverse(s.rootContexts),{appliedUrl:e,snapshot:i}}),g=c.call(m,function(e){var i=e.appliedUrl,n=e.snapshot;return s.navigationId!==r?ae(!1):(s.triggerEvent(new Ze(r,s.serializeUrl(t),i,n)),_e.a.call(d.checkGuards(),function(e){return s.triggerEvent(new Qe(r,s.serializeUrl(t),i,n,e)),{appliedUrl:i,snapshot:n,shouldActivate:e}}))}),y=c.call(g,function(e){return s.navigationId!==r?ae(!1):e.shouldActivate&&d.isActivating()?(s.triggerEvent(new Je(r,s.serializeUrl(t),e.appliedUrl,e.snapshot)),_e.a.call(d.resolveData(),function(){return s.triggerEvent(new $e(r,s.serializeUrl(t),e.appliedUrl,e.snapshot)),e})):ae(e)}),v=c.call(y,function(t){return _e.a.call(s.hooks.afterPreactivation(t.snapshot),function(){return t})}),b=_e.a.call(v,function(t){var e=t.appliedUrl,i=t.snapshot,n=t.shouldActivate;if(n){return{appliedUrl:e,state:function(t,e,i){var n=et(t,e._root,i?i._root:void 0);return new bi(n,e)}(s.routeReuseStrategy,i,s.currentRouterState),shouldActivate:n}}return{appliedUrl:e,state:null,shouldActivate:n}}),x=s.currentRouterState,_=s.currentUrlTree;b.forEach(function(t){var o=t.appliedUrl,a=t.state;if(t.shouldActivate&&r===s.navigationId){if(s.currentUrlTree=o,s.rawUrlTree=s.urlHandlingStrategy.merge(s.currentUrlTree,e),s.currentRouterState=a,!i){var h=s.urlSerializer.serialize(s.rawUrlTree);s.location.isCurrentPathEqualTo(h)||n?s.location.replaceState(h):s.location.go(h)}new Fi(s.routeReuseStrategy,a,x).activate(s.rootContexts),p=!0}else p=!1}).then(function(){p?(s.navigated=!0,s.routerEvents.next(new ze(r,s.serializeUrl(t),s.serializeUrl(s.currentUrlTree))),a(!0)):(s.resetUrlToCurrentUrlTree(),s.routerEvents.next(new We(r,s.serializeUrl(t),"")),a(!1))},function(i){if(function(t){return t[ii]}(i))s.resetUrlToCurrentUrlTree(),s.navigated=!0,s.routerEvents.next(new We(r,s.serializeUrl(t),i.message)),a(!1);else{s.routerEvents.next(new Xe(r,s.serializeUrl(t),i));try{a(s.errorHandler(i))}catch(t){h(t)}}s.currentRouterState=x,s.currentUrlTree=_,s.rawUrlTree=s.urlHandlingStrategy.merge(s.currentUrlTree,e),s.location.replaceState(s.serializeUrl(s.rawUrlTree))})})},t.prototype.resetUrlToCurrentUrlTree=function(){var t=this.urlSerializer.serialize(this.rawUrlTree);this.location.replaceState(t)},t}(),Bi=function(){function t(t){this.path=t}return Object.defineProperty(t.prototype,"route",{get:function(){return this.path[this.path.length-1]},enumerable:!0,configurable:!0}),t}(),ki=function(){return function(t,e){this.component=t,this.route=e}}(),Di=function(){function t(t,e,i){this.future=t,this.curr=e,this.moduleInjector=i,this.canActivateChecks=[],this.canDeactivateChecks=[]}return t.prototype.traverse=function(t){var e=this.future._root,i=this.curr?this.curr._root:null;this.traverseChildRoutes(e,i,t,[e.value])},t.prototype.checkGuards=function(){var t=this;if(!this.isDeactivating()&&!this.isActivating())return ae(!0);var e=this.runCanDeactivateChecks();return c.call(e,function(e){return e?t.runCanActivateChecks():ae(!1)})},t.prototype.resolveData=function(){var t=this;if(!this.isActivating())return ae(null);var e=se(this.canActivateChecks),i=s.call(e,function(e){return t.runResolve(e.route)});return(function(t,e){return arguments.length>=2?p(t,e)(this):p(t)(this)}).call(i,function(t,e){return t})},t.prototype.isDeactivating=function(){return 0!==this.canDeactivateChecks.length},t.prototype.isActivating=function(){return 0!==this.canActivateChecks.length},t.prototype.traverseChildRoutes=function(t,e,i,n){var r=this,o=wt(e);t.children.forEach(function(t){r.traverseRoutes(t,o[t.value.outlet],i,n.concat([t.value])),delete o[t.value.outlet]}),T(o,function(t,e){return r.deactivateRouteAndItsChildren(t,i.getContext(e))})},t.prototype.traverseRoutes=function(t,e,i,n){var r=t.value,o=e?e.value:null,s=i?i.getContext(t.value.outlet):null;if(o&&r._routeConfig===o._routeConfig){var a=this.shouldRunGuardsAndResolvers(o,r,r._routeConfig.runGuardsAndResolvers);if(a?this.canActivateChecks.push(new Bi(n)):(r.data=o.data,r._resolvedData=o._resolvedData),r.component?this.traverseChildRoutes(t,e,s?s.children:null,n):this.traverseChildRoutes(t,e,i,n),a){var h=s.outlet;this.canDeactivateChecks.push(new ki(h.component,o))}}else o&&this.deactivateRouteAndItsChildren(e,s),this.canActivateChecks.push(new Bi(n)),r.component?this.traverseChildRoutes(t,null,s?s.children:null,n):this.traverseChildRoutes(t,null,i,n)},t.prototype.shouldRunGuardsAndResolvers=function(t,e,i){switch(i){case"always":return!0;case"paramsOrQueryParamsChange":return!tt(t,e)||!x(t.queryParams,e.queryParams);case"paramsChange":default:return!tt(t,e)}},t.prototype.deactivateRouteAndItsChildren=function(t,e){var i=this,n=wt(t),r=t.value;T(n,function(t,n){r.component?e?i.deactivateRouteAndItsChildren(t,e.children.getContext(n)):i.deactivateRouteAndItsChildren(t,null):i.deactivateRouteAndItsChildren(t,e)}),r.component&&e&&e.outlet&&e.outlet.isActivated?this.canDeactivateChecks.push(new ki(e.outlet.component,r)):this.canDeactivateChecks.push(new ki(null,r))},t.prototype.runCanDeactivateChecks=function(){var t=this,e=se(this.canDeactivateChecks),i=c.call(e,function(e){return t.runCanDeactivate(e.component,e.route)});return a.call(i,function(t){return!0===t})},t.prototype.runCanActivateChecks=function(){var t=this,e=se(this.canActivateChecks),i=s.call(e,function(e){return S(se([t.runCanActivateChild(e.path),t.runCanActivate(e.route)]))});return a.call(i,function(t){return!0===t})},t.prototype.runCanActivate=function(t){var e=this,i=t._routeConfig?t._routeConfig.canActivate:null;if(!i||0===i.length)return ae(!0);return S(_e.a.call(se(i),function(i){var n,r=e.getToken(i,t);return n=r.canActivate?E(r.canActivate(t,e.future)):E(r(t,e.future)),h.call(n)}))},t.prototype.runCanActivateChild=function(t){var e=this,i=t[t.length-1],n=t.slice(0,t.length-1).reverse().map(function(t){return e.extractCanActivateChild(t)}).filter(function(t){return null!==t});return S(_e.a.call(se(n),function(t){return S(_e.a.call(se(t.guards),function(n){var r,o=e.getToken(n,t.node);return r=o.canActivateChild?E(o.canActivateChild(i,e.future)):E(o(i,e.future)),h.call(r)}))}))},t.prototype.extractCanActivateChild=function(t){var e=t._routeConfig?t._routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null},t.prototype.runCanDeactivate=function(t,e){var i=this,n=e&&e._routeConfig?e._routeConfig.canDeactivate:null;if(!n||0===n.length)return ae(!0);var r=c.call(se(n),function(n){var r,o=i.getToken(n,e);return r=o.canDeactivate?E(o.canDeactivate(t,e,i.curr,i.future)):E(o(t,e,i.curr,i.future)),h.call(r)});return a.call(r,function(t){return!0===t})},t.prototype.runResolve=function(t){var e=t._resolve;return _e.a.call(this.resolveNode(e,t),function(e){return t._resolvedData=e,t.data=Object.assign({},t.data,Z(t).resolve),null})},t.prototype.resolveNode=function(t,e){var i=this,n=Object.keys(t);if(0===n.length)return ae({});if(1===n.length){var r=n[0];return _e.a.call(this.getResolver(t[r],e),function(t){return e={},e[r]=t,e;var e})}var o={},s=c.call(se(n),function(n){return _e.a.call(i.getResolver(t[n],e),function(t){return o[n]=t,t})});return _e.a.call(u.call(s),function(){return o})},t.prototype.getResolver=function(t,e){var i=this.getToken(t,e);return i.resolve?E(i.resolve(e,this.future)):E(i(e,this.future))},t.prototype.getToken=function(t,e){var i=function(t){if(!t)return null;for(var e=t.parent;e;e=e.parent){var i=e._routeConfig;if(i&&i._loadedConfig)return i._loadedConfig}return null}(e);return(i?i.module.injector:this.moduleInjector).get(t)},t}(),Fi=function(){function t(t,e,i){this.routeReuseStrategy=t,this.futureState=e,this.currState=i}return t.prototype.activate=function(t){var e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),$(this.futureState.root),this.activateChildRoutes(e,i,t)},t.prototype.deactivateChildRoutes=function(t,e,i){var n=this,r=wt(e);t.children.forEach(function(t){var e=t.value.outlet;n.deactivateRoutes(t,r[e],i),delete r[e]}),T(r,function(t,e){n.deactivateRouteAndItsChildren(t,i)})},t.prototype.deactivateRoutes=function(t,e,i){var n=t.value,r=e?e.value:null;if(n===r)if(n.component){var o=i.getContext(n.outlet);o&&this.deactivateChildRoutes(t,e,o.children)}else this.deactivateChildRoutes(t,e,i);else r&&this.deactivateRouteAndItsChildren(e,i)},t.prototype.deactivateRouteAndItsChildren=function(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)},t.prototype.detachAndStoreRouteSubtree=function(t,e){var i=e.getContext(t.value.outlet);if(i&&i.outlet){var n=i.outlet.detach(),r=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:n,route:t,contexts:r})}},t.prototype.deactivateRouteAndOutlet=function(t,e){var i=this,n=e.getContext(t.value.outlet);if(n){var r=wt(t),o=t.value.component?n.children:e;T(r,function(t,e){return i.deactivateRouteAndItsChildren(t,o)}),n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated())}},t.prototype.activateChildRoutes=function(t,e,i){var n=this,r=wt(e);t.children.forEach(function(t){n.activateRoutes(t,r[t.value.outlet],i)})},t.prototype.activateRoutes=function(t,e,i){var n=t.value,r=e?e.value:null;if($(n),n===r)if(n.component){var o=i.getOrCreateContext(n.outlet);this.activateChildRoutes(t,e,o.children)}else this.activateChildRoutes(t,e,i);else if(n.component){o=i.getOrCreateContext(n.outlet);if(this.routeReuseStrategy.shouldAttach(n.snapshot)){var s=this.routeReuseStrategy.retrieve(n.snapshot);this.routeReuseStrategy.store(n.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),_t(s.route)}else{var a=function(t){for(var e=t.parent;e;e=e.parent){var i=e._routeConfig;if(i&&i._loadedConfig)return i._loadedConfig;if(i&&i.component)return null}return null}(n.snapshot),h=a?a.module.componentFactoryResolver:null;o.route=n,o.resolver=h,o.outlet&&o.outlet.activateWith(n,h),this.activateChildRoutes(t,null,o.children)}}else this.activateChildRoutes(t,null,i)},t}(),Ui=function(){function t(t,e,i,n,r){this.router=t,this.route=e,this.commands=[],null==i&&n.setAttribute(r.nativeElement,"tabindex","0")}return Object.defineProperty(t.prototype,"routerLink",{set:function(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveQueryParams",{set:function(t){Object(Bt._5)()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated!, use queryParamsHandling instead."),this.preserve=t},enumerable:!0,configurable:!0}),t.prototype.onClick=function(){var t={skipLocationChange:Tt(this.skipLocationChange),replaceUrl:Tt(this.replaceUrl)};return this.router.navigateByUrl(this.urlTree,t),!0},Object.defineProperty(t.prototype,"urlTree",{get:function(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:Tt(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:Tt(this.preserveFragment)})},enumerable:!0,configurable:!0}),t}();Ui.decorators=[{type:Bt.m,args:[{selector:":not(a)[routerLink]"}]}],Ui.ctorParameters=function(){return[{type:Ii},{type:xi},{type:void 0,decorators:[{type:Bt.h,args:["tabindex"]}]},{type:Bt.N},{type:Bt.n}]},Ui.propDecorators={queryParams:[{type:Bt.x}],fragment:[{type:Bt.x}],queryParamsHandling:[{type:Bt.x}],preserveFragment:[{type:Bt.x}],skipLocationChange:[{type:Bt.x}],replaceUrl:[{type:Bt.x}],routerLink:[{type:Bt.x}],preserveQueryParams:[{type:Bt.x}],onClick:[{type:Bt.s,args:["click"]}]};var Ni=function(){function t(t,e,i){var n=this;this.router=t,this.route=e,this.locationStrategy=i,this.commands=[],this.subscription=t.events.subscribe(function(t){t instanceof ze&&n.updateTargetUrlAndHref()})}return Object.defineProperty(t.prototype,"routerLink",{set:function(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveQueryParams",{set:function(t){Object(Bt._5)()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead."),this.preserve=t},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){this.updateTargetUrlAndHref()},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.onClick=function(t,e,i,n){if(0!==t||e||i||n)return!0;if("string"==typeof this.target&&"_self"!=this.target)return!0;var r={skipLocationChange:Tt(this.skipLocationChange),replaceUrl:Tt(this.replaceUrl)};return this.router.navigateByUrl(this.urlTree,r),!1},t.prototype.updateTargetUrlAndHref=function(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))},Object.defineProperty(t.prototype,"urlTree",{get:function(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:Tt(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:Tt(this.preserveFragment)})},enumerable:!0,configurable:!0}),t}();Ni.decorators=[{type:Bt.m,args:[{selector:"a[routerLink]"}]}],Ni.ctorParameters=function(){return[{type:Ii},{type:xi},{type:It.i}]},Ni.propDecorators={target:[{type:Bt.r,args:["attr.target"]},{type:Bt.x}],queryParams:[{type:Bt.x}],fragment:[{type:Bt.x}],queryParamsHandling:[{type:Bt.x}],preserveFragment:[{type:Bt.x}],skipLocationChange:[{type:Bt.x}],replaceUrl:[{type:Bt.x}],href:[{type:Bt.r}],routerLink:[{type:Bt.x}],preserveQueryParams:[{type:Bt.x}],onClick:[{type:Bt.s,args:["click",["$event.button","$event.ctrlKey","$event.metaKey","$event.shiftKey"]]}]};var Gi=function(){function t(t,e,i,n){var r=this;this.router=t,this.element=e,this.renderer=i,this.cdr=n,this.classes=[],this.active=!1,this.routerLinkActiveOptions={exact:!1},this.subscription=t.events.subscribe(function(t){t instanceof ze&&r.update()})}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.active},enumerable:!0,configurable:!0}),t.prototype.ngAfterContentInit=function(){var t=this;this.links.changes.subscribe(function(e){return t.update()}),this.linksWithHrefs.changes.subscribe(function(e){return t.update()}),this.update()},Object.defineProperty(t.prototype,"routerLinkActive",{set:function(t){var e=Array.isArray(t)?t:t.split(" ");this.classes=e.filter(function(t){return!!t})},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){this.update()},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.update=function(){var t=this;this.links&&this.linksWithHrefs&&this.router.navigated&&Promise.resolve().then(function(){var e=t.hasActiveLinks();t.active!==e&&(t.active=e,t.classes.forEach(function(i){e?t.renderer.addClass(t.element.nativeElement,i):t.renderer.removeClass(t.element.nativeElement,i)}))})},t.prototype.isLinkActive=function(t){var e=this;return function(i){return t.isActive(i.urlTree,e.routerLinkActiveOptions.exact)}},t.prototype.hasActiveLinks=function(){return this.links.some(this.isLinkActive(this.router))||this.linksWithHrefs.some(this.isLinkActive(this.router))},t}();Gi.decorators=[{type:Bt.m,args:[{selector:"[routerLinkActive]",exportAs:"routerLinkActive"}]}],Gi.ctorParameters=function(){return[{type:Ii},{type:Bt.n},{type:Bt.N},{type:Bt.i}]},Gi.propDecorators={links:[{type:Bt.l,args:[Ui,{descendants:!0}]}],linksWithHrefs:[{type:Bt.l,args:[Ni,{descendants:!0}]}],routerLinkActiveOptions:[{type:Bt.x}],routerLinkActive:[{type:Bt.x}]};var ji=function(){return function(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Vi,this.attachRef=null}}(),Vi=function(){function t(){this.contexts=new Map}return t.prototype.onChildOutletCreated=function(t,e){var i=this.getOrCreateContext(t);i.outlet=e,this.contexts.set(t,i)},t.prototype.onChildOutletDestroyed=function(t){var e=this.getContext(t);e&&(e.outlet=null)},t.prototype.onOutletDeactivated=function(){var t=this.contexts;return this.contexts=new Map,t},t.prototype.onOutletReAttached=function(t){this.contexts=t},t.prototype.getOrCreateContext=function(t){var e=this.getContext(t);return e||(e=new ji,this.contexts.set(t,e)),e},t.prototype.getContext=function(t){return this.contexts.get(t)||null},t}(),Hi=function(){function t(t,e,i,n,r){this.parentContexts=t,this.location=e,this.resolver=i,this.changeDetector=r,this.activated=null,this._activatedRoute=null,this.activateEvents=new Bt.p,this.deactivateEvents=new Bt.p,this.name=n||ti,t.onChildOutletCreated(this.name,this)}return t.prototype.ngOnDestroy=function(){this.parentContexts.onChildOutletDestroyed(this.name)},t.prototype.ngOnInit=function(){if(!this.activated){var t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}},Object.defineProperty(t.prototype,"locationInjector",{get:function(){return this.location.injector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"locationFactoryResolver",{get:function(){return this.resolver},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActivated",{get:function(){return!!this.activated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRoute",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRouteData",{get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}},enumerable:!0,configurable:!0}),t.prototype.detach=function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var t=this.activated;return this.activated=null,this._activatedRoute=null,t},t.prototype.attach=function(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)},t.prototype.deactivate=function(){if(this.activated){var t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}},t.prototype.activateWith=function(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;var i=t._futureSnapshot._routeConfig.component,n=(e=e||this.resolver).resolveComponentFactory(i),r=this.parentContexts.getOrCreateContext(this.name).children,o=new zi(t,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,o),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)},t}();Hi.decorators=[{type:Bt.m,args:[{selector:"router-outlet",exportAs:"outlet"}]}],Hi.ctorParameters=function(){return[{type:Vi},{type:Bt.Y},{type:Bt.k},{type:void 0,decorators:[{type:Bt.h,args:["name"]}]},{type:Bt.i}]},Hi.propDecorators={activateEvents:[{type:Bt.I,args:["activate"]}],deactivateEvents:[{type:Bt.I,args:["deactivate"]}]};var zi=function(){function t(t,e,i){this.route=t,this.childContexts=e,this.parent=i}return t.prototype.get=function(t,e){return t===xi?this.route:t===Vi?this.childContexts:this.parent.get(t,e)},t}(),Wi=function(){function t(){}return t.prototype.preload=function(t,e){},t}(),Xi=function(){function t(){}return t.prototype.preload=function(t,e){return f.call(e(),function(){return ae(null)})},t}(),qi=function(){function t(){}return t.prototype.preload=function(t,e){return ae(null)},t}(),Yi=function(){function t(t,e,i,n,r){this.router=t,this.injector=n,this.preloadingStrategy=r;this.loader=new Ri(e,i,function(e){return t.triggerEvent(new Ye(e))},function(e){return t.triggerEvent(new Ke(e))})}return t.prototype.setUpPreloading=function(){var t=this,e=(function(t,e){return Object(Ve.a)(t,e)(this)}).call(this.router.events,function(t){return t instanceof ze});this.subscription=s.call(e,function(){return t.preload()}).subscribe(function(){})},t.prototype.preload=function(){var t=this.injector.get(Bt.E);return this.processRoutes(t,this.router.config)},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.processRoutes=function(t,e){for(var i=[],n=0,r=e;n<r.length;n++){var o=r[n];if(o.loadChildren&&!o.canLoad&&o._loadedConfig){var s=o._loadedConfig;i.push(this.processRoutes(s.module,s.routes))}else o.loadChildren&&!o.canLoad?i.push(this.preloadConfig(t,o)):o.children&&i.push(this.processRoutes(t,o.children))}return g.call(se(i))},t.prototype.preloadConfig=function(t,e){var i=this;return this.preloadingStrategy.preload(e,function(){var n=i.loader.load(t.injector,e);return c.call(n,function(t){return e._loadedConfig=t,i.processRoutes(t.module,t.routes)})})},t}();Yi.decorators=[{type:Bt.u}],Yi.ctorParameters=function(){return[{type:Ii},{type:Bt.D},{type:Bt.j},{type:Bt.w},{type:Wi}]};var Ki=[Hi,Ui,Ni,Gi],Zi=new Bt.v("ROUTER_CONFIGURATION"),Qi=new Bt.v("ROUTER_FORROOT_GUARD"),Ji=[It.h,{provide:ai,useClass:hi},{provide:Ii,useFactory:Mt,deps:[Bt.g,ai,Vi,It.h,Bt.w,Bt.D,Bt.j,Ai,Zi,[Li,new Bt.H],[Pi,new Bt.H]]},Vi,{provide:xi,useFactory:At,deps:[Ii]},{provide:Bt.D,useClass:Bt.T},Yi,qi,Xi,{provide:Zi,useValue:{enableTracing:!1}}],$i=function(){function t(t,e){}return t.forRoot=function(e,i){return{ngModule:t,providers:[Ji,Pt(e),{provide:Qi,useFactory:Ct,deps:[[Ii,new Bt.H,new Bt.S]]},{provide:Zi,useValue:i||{}},{provide:It.i,useFactory:Et,deps:[It.p,[new Bt.t(It.a),new Bt.H],Zi]},{provide:Wi,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:qi},{provide:Bt.F,multi:!0,useFactory:St},[tn,{provide:Bt.d,multi:!0,useFactory:Rt,deps:[tn]},{provide:en,useFactory:Lt,deps:[tn]},{provide:Bt.b,multi:!0,useExisting:en}]]}},t.forChild=function(e){return{ngModule:t,providers:[Pt(e)]}},t}();$i.decorators=[{type:Bt.B,args:[{declarations:Ki,exports:Ki}]}],$i.ctorParameters=function(){return[{type:void 0,decorators:[{type:Bt.H},{type:Bt.t,args:[Qi]}]},{type:Ii,decorators:[{type:Bt.H}]}]};var tn=function(){function t(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new kt.a}return t.prototype.appInitializer=function(){var t=this;return this.injector.get(It.g,Promise.resolve(null)).then(function(){var e=null,i=new Promise(function(t){return e=t}),n=t.injector.get(Ii),r=t.injector.get(Zi);if(t.isLegacyDisabled(r)||t.isLegacyEnabled(r))e(!0);else if("disabled"===r.initialNavigation)n.setUpLocationChangeListener(),e(!0);else{if("enabled"!==r.initialNavigation)throw new Error("Invalid initialNavigation options: '"+r.initialNavigation+"'");n.hooks.afterPreactivation=function(){return t.initNavigation?ae(null):(t.initNavigation=!0,e(!0),t.resultOfPreactivationDone)},n.initialNavigation()}return i})},t.prototype.bootstrapListener=function(t){var e=this.injector.get(Zi),i=this.injector.get(Yi),n=this.injector.get(Ii),r=this.injector.get(Bt.g);t===r.components[0]&&(this.isLegacyEnabled(e)?n.initialNavigation():this.isLegacyDisabled(e)&&n.setUpLocationChangeListener(),i.setUpPreloading(),n.resetRootComponentType(r.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())},t.prototype.isLegacyEnabled=function(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation},t.prototype.isLegacyDisabled=function(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation},t}();tn.decorators=[{type:Bt.u}],tn.ctorParameters=function(){return[{type:Bt.w}]};var en=new Bt.v("Router Initializer");new Bt.X("4.4.6")},CIu0:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("/oeL"),r=i("1thS"),o=function(){function t(t,e){this._element=t,this._parent=e}return t.prototype.ngAfterViewInit=function(){this._parent.add(this._element.nativeElement),this.watchForHtmlChanges()},t.prototype.ngOnDestroy=function(){this._parent.remove(this._element.nativeElement)},t.prototype.watchForHtmlChanges=function(){if(MutationObserver=window.MutationObserver||window.WebKitMutationObserver,MutationObserver){var t=this;new MutationObserver(function(e,i){t._parent.layout()}).observe(this._element.nativeElement,{subtree:!0,childList:!0})}},t.ctorParameters=function(){return[{type:n.n},{type:r.a,decorators:[{type:n.t,args:[Object(n._3)(function(){return r.a})]}]}]},t}()},CPp0:function(t,e,i){"use strict";function n(t){if("string"!=typeof t)return t;switch(t.toUpperCase()){case"GET":return m.Get;case"POST":return m.Post;case"PUT":return m.Put;case"DELETE":return m.Delete;case"OPTIONS":return m.Options;case"HEAD":return m.Head;case"PATCH":return m.Patch}throw new Error('Invalid request method. The method "'+t+'" is not supported.')}function r(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}function o(){var t="object"==typeof window?window:{};return null===O&&(O=t[L]={}),O}function s(t,e){return t.createConnection(e).response}function a(t,e,i,n){var r=t;return e?r.merge(new H({method:e.method||i,url:e.url||n,search:e.search,params:e.params,headers:e.headers,body:e.body,withCredentials:e.withCredentials,responseType:e.responseType})):r.merge(new H({method:i,url:n}))}function h(){return new j}function u(t,e){return new Q(t,e)}i.d(e,"c",function(){return f}),i.d(e,"i",function(){return V}),i.d(e,"a",function(){return z}),i.d(e,"f",function(){return H}),i.d(e,"b",function(){return w}),i.d(e,"h",function(){return _}),i.d(e,"g",function(){return b}),i.d(e,"d",function(){return Q}),i.d(e,"e",function(){return $}),i.d(e,"j",function(){return S}),i.d(e,"k",function(){return h}),i.d(e,"l",function(){return u});var c=i("6Xbx"),l=i("/oeL"),d=i("AP4T"),p=i("fc+i"),f=function(){function t(){}return t.prototype.build=function(){return new XMLHttpRequest},t}();f.decorators=[{type:l.u}],f.ctorParameters=function(){return[]};var m={};m.Get=0,m.Post=1,m.Put=2,m.Delete=3,m.Options=4,m.Head=5,m.Patch=6,m[m.Get]="Get",m[m.Post]="Post",m[m.Put]="Put",m[m.Delete]="Delete",m[m.Options]="Options",m[m.Head]="Head",m[m.Patch]="Patch";var g={};g.Unsent=0,g.Open=1,g.HeadersReceived=2,g.Loading=3,g.Done=4,g.Cancelled=5,g[g.Unsent]="Unsent",g[g.Open]="Open",g[g.HeadersReceived]="HeadersReceived",g[g.Loading]="Loading",g[g.Done]="Done",g[g.Cancelled]="Cancelled";var y={};y.Basic=0,y.Cors=1,y.Default=2,y.Error=3,y.Opaque=4,y[y.Basic]="Basic",y[y.Cors]="Cors",y[y.Default]="Default",y[y.Error]="Error",y[y.Opaque]="Opaque";var v={};v.NONE=0,v.JSON=1,v.FORM=2,v.FORM_DATA=3,v.TEXT=4,v.BLOB=5,v.ARRAY_BUFFER=6,v[v.NONE]="NONE",v[v.JSON]="JSON",v[v.FORM]="FORM",v[v.FORM_DATA]="FORM_DATA",v[v.TEXT]="TEXT",v[v.BLOB]="BLOB",v[v.ARRAY_BUFFER]="ARRAY_BUFFER";var b={};b.Text=0,b.Json=1,b.ArrayBuffer=2,b.Blob=3,b[b.Text]="Text",b[b.Json]="Json",b[b.ArrayBuffer]="ArrayBuffer",b[b.Blob]="Blob";var x=function(){function t(e){var i=this;this._headers=new Map,this._normalizedNames=new Map,e&&(e instanceof t?e.forEach(function(t,e){t.forEach(function(t){return i.append(e,t)})}):Object.keys(e).forEach(function(t){var n=Array.isArray(e[t])?e[t]:[e[t]];i.delete(t),n.forEach(function(e){return i.append(t,e)})}))}return t.fromResponseHeaderString=function(e){var i=new t;return e.split("\n").forEach(function(t){var e=t.indexOf(":");if(e>0){var n=t.slice(0,e),r=t.slice(e+1).trim();i.set(n,r)}}),i},t.prototype.append=function(t,e){var i=this.getAll(t);null===i?this.set(t,e):i.push(e)},t.prototype.delete=function(t){var e=t.toLowerCase();this._normalizedNames.delete(e),this._headers.delete(e)},t.prototype.forEach=function(t){var e=this;this._headers.forEach(function(i,n){return t(i,e._normalizedNames.get(n),e._headers)})},t.prototype.get=function(t){var e=this.getAll(t);return null===e?null:e.length>0?e[0]:null},t.prototype.has=function(t){return this._headers.has(t.toLowerCase())},t.prototype.keys=function(){return Array.from(this._normalizedNames.values())},t.prototype.set=function(t,e){Array.isArray(e)?e.length&&this._headers.set(t.toLowerCase(),[e.join(",")]):this._headers.set(t.toLowerCase(),[e]),this.mayBeSetNormalizedName(t)},t.prototype.values=function(){return Array.from(this._headers.values())},t.prototype.toJSON=function(){var t=this,e={};return this._headers.forEach(function(i,n){var r=[];i.forEach(function(t){return r.push.apply(r,t.split(","))}),e[t._normalizedNames.get(n)]=r}),e},t.prototype.getAll=function(t){return this.has(t)?this._headers.get(t.toLowerCase())||null:null},t.prototype.entries=function(){throw new Error('"entries" method is not implemented on Headers class')},t.prototype.mayBeSetNormalizedName=function(t){var e=t.toLowerCase();this._normalizedNames.has(e)||this._normalizedNames.set(e,t)},t}(),_=function(){function t(t){void 0===t&&(t={});var e=t.body,i=t.status,n=t.headers,r=t.statusText,o=t.type,s=t.url;this.body=null!=e?e:null,this.status=null!=i?i:null,this.headers=null!=n?n:null,this.statusText=null!=r?r:null,this.type=null!=o?o:null,this.url=null!=s?s:null}return t.prototype.merge=function(e){return new t({body:e&&null!=e.body?e.body:this.body,status:e&&null!=e.status?e.status:this.status,headers:e&&null!=e.headers?e.headers:this.headers,statusText:e&&null!=e.statusText?e.statusText:this.statusText,type:e&&null!=e.type?e.type:this.type,url:e&&null!=e.url?e.url:this.url})},t}(),w=function(t){function e(){return t.call(this,{status:200,statusText:"Ok",type:y.Default,headers:new x})||this}return c.a(e,t),e}(_);w.decorators=[{type:l.u}],w.ctorParameters=function(){return[]};var T=function(){function t(){}return t.prototype.createConnection=function(t){},t}(),S=(function(){}(),function(){function t(){}return t.prototype.configureRequest=function(t){},t}()),E=function(t){return t>=200&&t<300},C=function(){function t(){}return t.prototype.encodeKey=function(t){return r(t)},t.prototype.encodeValue=function(t){return r(t)},t}(),P=function(){function t(t,e){void 0===t&&(t=""),void 0===e&&(e=new C),this.rawParams=t,this.queryEncoder=e,this.paramsMap=function(t){void 0===t&&(t="");var e=new Map;t.length>0&&t.split("&").forEach(function(t){var i=t.indexOf("="),n=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)],r=n[0],o=n[1],s=e.get(r)||[];s.push(o),e.set(r,s)});return e}(t)}return t.prototype.clone=function(){var e=new t("",this.queryEncoder);return e.appendAll(this),e},t.prototype.has=function(t){return this.paramsMap.has(t)},t.prototype.get=function(t){var e=this.paramsMap.get(t);return Array.isArray(e)?e[0]:null},t.prototype.getAll=function(t){return this.paramsMap.get(t)||[]},t.prototype.set=function(t,e){if(void 0!==e&&null!==e){var i=this.paramsMap.get(t)||[];i.length=0,i.push(e),this.paramsMap.set(t,i)}else this.delete(t)},t.prototype.setAll=function(t){var e=this;t.paramsMap.forEach(function(t,i){var n=e.paramsMap.get(i)||[];n.length=0,n.push(t[0]),e.paramsMap.set(i,n)})},t.prototype.append=function(t,e){if(void 0!==e&&null!==e){var i=this.paramsMap.get(t)||[];i.push(e),this.paramsMap.set(t,i)}},t.prototype.appendAll=function(t){var e=this;t.paramsMap.forEach(function(t,i){for(var n=e.paramsMap.get(i)||[],r=0;r<t.length;++r)n.push(t[r]);e.paramsMap.set(i,n)})},t.prototype.replaceAll=function(t){var e=this;t.paramsMap.forEach(function(t,i){var n=e.paramsMap.get(i)||[];n.length=0;for(var r=0;r<t.length;++r)n.push(t[r]);e.paramsMap.set(i,n)})},t.prototype.toString=function(){var t=this,e=[];return this.paramsMap.forEach(function(i,n){i.forEach(function(i){return e.push(t.queryEncoder.encodeKey(n)+"="+t.queryEncoder.encodeValue(i))})}),e.join("&")},t.prototype.delete=function(t){this.paramsMap.delete(t)},t}(),M=function(){function t(){}return t.prototype.json=function(){return"string"==typeof this._body?JSON.parse(this._body):this._body instanceof ArrayBuffer?JSON.parse(this.text()):this._body},t.prototype.text=function(t){if(void 0===t&&(t="legacy"),this._body instanceof P)return this._body.toString();if(this._body instanceof ArrayBuffer)switch(t){case"legacy":return String.fromCharCode.apply(null,new Uint16Array(this._body));case"iso-8859":return String.fromCharCode.apply(null,new Uint8Array(this._body));default:throw new Error("Invalid value for encodingHint: "+t)}return null==this._body?"":"object"==typeof this._body?JSON.stringify(this._body,null,2):this._body.toString()},t.prototype.arrayBuffer=function(){return this._body instanceof ArrayBuffer?this._body:function(t){for(var e=new Uint16Array(t.length),i=0,n=t.length;i<n;i++)e[i]=t.charCodeAt(i);return e.buffer}(this.text())},t.prototype.blob=function(){if(this._body instanceof Blob)return this._body;if(this._body instanceof ArrayBuffer)return new Blob([this._body]);throw new Error("The request body isn't either a blob or an array buffer")},t}(),A=function(t){function e(e){var i=t.call(this)||this;return i._body=e.body,i.status=e.status,i.ok=i.status>=200&&i.status<=299,i.statusText=e.statusText,i.headers=e.headers,i.type=e.type,i.url=e.url,i}return c.a(e,t),e.prototype.toString=function(){return"Response with status: "+this.status+" "+this.statusText+" for URL: "+this.url},e}(M),R=0,L="__ng_jsonp__",O=null,I=function(){function t(){}return t.prototype.build=function(t){var e=document.createElement("script");return e.src=t,e},t.prototype.nextRequestID=function(){return"__req"+R++},t.prototype.requestCallback=function(t){return L+"."+t+".finished"},t.prototype.exposeConnection=function(t,e){o()[t]=e},t.prototype.removeConnection=function(t){o()[t]=null},t.prototype.send=function(t){document.body.appendChild(t)},t.prototype.cleanup=function(t){t.parentNode&&t.parentNode.removeChild(t)},t}();I.decorators=[{type:l.u}],I.ctorParameters=function(){return[]};var B="JSONP injected script did not invoke callback.",k="JSONP requests must use GET request method.",D=function(t){function e(e,i,n){var r=t.call(this)||this;if(r._dom=i,r.baseResponseOptions=n,r._finished=!1,e.method!==m.Get)throw new TypeError(k);return r.request=e,r.response=new d.a(function(t){r.readyState=g.Loading;var o=r._id=i.nextRequestID();i.exposeConnection(o,r);var s=i.requestCallback(r._id),a=e.url;a.indexOf("=JSONP_CALLBACK&")>-1?a=a.replace("=JSONP_CALLBACK&","="+s+"&"):a.lastIndexOf("=JSONP_CALLBACK")===a.length-"=JSONP_CALLBACK".length&&(a=a.substring(0,a.length-"=JSONP_CALLBACK".length)+"="+s);var h=r._script=i.build(a),u=function(e){if(r.readyState!==g.Cancelled){if(r.readyState=g.Done,i.cleanup(h),!r._finished){var o=new _({body:B,type:y.Error,url:a});return n&&(o=n.merge(o)),void t.error(new A(o))}var s=new _({body:r._responseData,url:a});r.baseResponseOptions&&(s=r.baseResponseOptions.merge(s)),t.next(new A(s)),t.complete()}},c=function(e){if(r.readyState!==g.Cancelled){r.readyState=g.Done,i.cleanup(h);var o=new _({body:e.message,type:y.Error});n&&(o=n.merge(o)),t.error(new A(o))}};return h.addEventListener("load",u),h.addEventListener("error",c),i.send(h),function(){r.readyState=g.Cancelled,h.removeEventListener("load",u),h.removeEventListener("error",c),r._dom.cleanup(h)}}),r}return c.a(e,t),e.prototype.finished=function(t){this._finished=!0,this._dom.removeConnection(this._id),this.readyState!==g.Cancelled&&(this._responseData=t)},e}(function(){function t(){}return t.prototype.finished=function(t){},t}()),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c.a(e,t),e}(T),U=function(t){function e(e,i){var n=t.call(this)||this;return n._browserJSONP=e,n._baseResponseOptions=i,n}return c.a(e,t),e.prototype.createConnection=function(t){return new D(t,this._browserJSONP,this._baseResponseOptions)},e}(F);U.decorators=[{type:l.u}],U.ctorParameters=function(){return[{type:I},{type:_}]};var N=/^\)\]\}',?\n/,G=function(){function t(t,e,i){var n=this;this.request=t,this.response=new d.a(function(r){var o=e.build();o.open(m[t.method].toUpperCase(),t.url),null!=t.withCredentials&&(o.withCredentials=t.withCredentials);var s=function(){var e=1223===o.status?204:o.status,n=null;204!==e&&"string"==typeof(n="undefined"==typeof o.response?o.responseText:o.response)&&(n=n.replace(N,"")),0===e&&(e=n?200:0);var s=x.fromResponseHeaderString(o.getAllResponseHeaders()),a=function(t){return"responseURL"in t?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(o)||t.url,h=o.statusText||"OK",u=new _({body:n,status:e,headers:s,statusText:h,url:a});null!=i&&(u=i.merge(u));var c=new A(u);if(c.ok=E(e),c.ok)return r.next(c),void r.complete();r.error(c)},a=function(t){var e=new _({body:t,type:y.Error,status:o.status,statusText:o.statusText});null!=i&&(e=i.merge(e)),r.error(new A(e))};if(n.setDetectedContentType(t,o),null==t.headers&&(t.headers=new x),t.headers.has("Accept")||t.headers.append("Accept","application/json, text/plain, */*"),t.headers.forEach(function(t,e){return o.setRequestHeader(e,t.join(","))}),null!=t.responseType&&null!=o.responseType)switch(t.responseType){case b.ArrayBuffer:o.responseType="arraybuffer";break;case b.Json:o.responseType="json";break;case b.Text:o.responseType="text";break;case b.Blob:o.responseType="blob";break;default:throw new Error("The selected responseType is not supported")}return o.addEventListener("load",s),o.addEventListener("error",a),o.send(n.request.getBody()),function(){o.removeEventListener("load",s),o.removeEventListener("error",a),o.abort()}})}return t.prototype.setDetectedContentType=function(t,e){if(null==t.headers||null==t.headers.get("Content-Type"))switch(t.contentType){case v.NONE:break;case v.JSON:e.setRequestHeader("content-type","application/json");break;case v.FORM:e.setRequestHeader("content-type","application/x-www-form-urlencoded;charset=UTF-8");break;case v.TEXT:e.setRequestHeader("content-type","text/plain");break;case v.BLOB:var i=t.blob();i.type&&e.setRequestHeader("content-type",i.type)}},t}(),j=function(){function t(t,e){void 0===t&&(t="XSRF-TOKEN"),void 0===e&&(e="X-XSRF-TOKEN"),this._cookieName=t,this._headerName=e}return t.prototype.configureRequest=function(t){var e=Object(p.t)().getCookie(this._cookieName);e&&t.headers.set(this._headerName,e)},t}(),V=function(){function t(t,e,i){this._browserXHR=t,this._baseResponseOptions=e,this._xsrfStrategy=i}return t.prototype.createConnection=function(t){return this._xsrfStrategy.configureRequest(t),new G(t,this._browserXHR,this._baseResponseOptions)},t}();V.decorators=[{type:l.u}],V.ctorParameters=function(){return[{type:f},{type:_},{type:S}]};var H=function(){function t(t){void 0===t&&(t={});var e=t.method,i=t.headers,r=t.body,o=t.url,s=t.search,a=t.params,h=t.withCredentials,u=t.responseType;this.method=null!=e?n(e):null,this.headers=null!=i?i:null,this.body=null!=r?r:null,this.url=null!=o?o:null,this.params=this._mergeSearchParams(a||s),this.withCredentials=null!=h?h:null,this.responseType=null!=u?u:null}return Object.defineProperty(t.prototype,"search",{get:function(){return this.params},set:function(t){this.params=t},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){return new t({method:e&&null!=e.method?e.method:this.method,headers:e&&null!=e.headers?e.headers:new x(this.headers),body:e&&null!=e.body?e.body:this.body,url:e&&null!=e.url?e.url:this.url,params:e&&this._mergeSearchParams(e.params||e.search),withCredentials:e&&null!=e.withCredentials?e.withCredentials:this.withCredentials,responseType:e&&null!=e.responseType?e.responseType:this.responseType})},t.prototype._mergeSearchParams=function(t){return t?t instanceof P?t.clone():"string"==typeof t?new P(t):this._parseParams(t):this.params},t.prototype._parseParams=function(t){var e=this;void 0===t&&(t={});var i=new P;return Object.keys(t).forEach(function(n){var r=t[n];Array.isArray(r)?r.forEach(function(t){return e._appendParam(n,t,i)}):e._appendParam(n,r,i)}),i},t.prototype._appendParam=function(t,e,i){"string"!=typeof e&&(e=JSON.stringify(e)),i.append(t,e)},t}(),z=function(t){function e(){return t.call(this,{method:m.Get,headers:new x})||this}return c.a(e,t),e}(H);z.decorators=[{type:l.u}],z.ctorParameters=function(){return[]};var W=function(t){function e(e){var i=t.call(this)||this,r=e.url;i.url=e.url;var o=e.params||e.search;if(o){var s=void 0;if((s="object"!=typeof o||o instanceof P?o.toString():function(t){var e=new P;return Object.keys(t).forEach(function(i){var n=t[i];n&&Array.isArray(n)?n.forEach(function(t){return e.append(i,t.toString())}):e.append(i,n.toString())}),e}(o).toString()).length>0){var a="?";-1!=i.url.indexOf("?")&&(a="&"==i.url[i.url.length-1]?"":"&"),i.url=r+a+s}}return i._body=e.body,i.method=n(e.method),i.headers=new x(e.headers),i.contentType=i.detectContentType(),i.withCredentials=e.withCredentials,i.responseType=e.responseType,i}return c.a(e,t),e.prototype.detectContentType=function(){switch(this.headers.get("content-type")){case"application/json":return v.JSON;case"application/x-www-form-urlencoded":return v.FORM;case"multipart/form-data":return v.FORM_DATA;case"text/plain":case"text/html":return v.TEXT;case"application/octet-stream":return this._body instanceof Z?v.ARRAY_BUFFER:v.BLOB;default:return this.detectContentTypeFromBody()}},e.prototype.detectContentTypeFromBody=function(){return null==this._body?v.NONE:this._body instanceof P?v.FORM:this._body instanceof Y?v.FORM_DATA:this._body instanceof K?v.BLOB:this._body instanceof Z?v.ARRAY_BUFFER:this._body&&"object"==typeof this._body?v.JSON:v.TEXT},e.prototype.getBody=function(){switch(this.contentType){case v.JSON:case v.FORM:return this.text();case v.FORM_DATA:return this._body;case v.TEXT:return this.text();case v.BLOB:return this.blob();case v.ARRAY_BUFFER:return this.arrayBuffer();default:return null}},e}(M),X=function(){},q="object"==typeof window?window:X,Y=q.FormData||X,K=q.Blob||X,Z=q.ArrayBuffer||X,Q=function(){function t(t,e){this._backend=t,this._defaultOptions=e}return t.prototype.request=function(t,e){var i;if("string"==typeof t)i=s(this._backend,new W(a(this._defaultOptions,e,m.Get,t)));else{if(!(t instanceof W))throw new Error("First argument must be a url string or Request instance.");i=s(this._backend,t)}return i},t.prototype.get=function(t,e){return this.request(new W(a(this._defaultOptions,e,m.Get,t)))},t.prototype.post=function(t,e,i){return this.request(new W(a(this._defaultOptions.merge(new H({body:e})),i,m.Post,t)))},t.prototype.put=function(t,e,i){return this.request(new W(a(this._defaultOptions.merge(new H({body:e})),i,m.Put,t)))},t.prototype.delete=function(t,e){return this.request(new W(a(this._defaultOptions,e,m.Delete,t)))},t.prototype.patch=function(t,e,i){return this.request(new W(a(this._defaultOptions.merge(new H({body:e})),i,m.Patch,t)))},t.prototype.head=function(t,e){return this.request(new W(a(this._defaultOptions,e,m.Head,t)))},t.prototype.options=function(t,e){return this.request(new W(a(this._defaultOptions,e,m.Options,t)))},t}();Q.decorators=[{type:l.u}],Q.ctorParameters=function(){return[{type:T},{type:H}]};var J=function(t){function e(e,i){return t.call(this,e,i)||this}return c.a(e,t),e.prototype.request=function(t,e){if("string"==typeof t&&(t=new W(a(this._defaultOptions,e,m.Get,t))),!(t instanceof W))throw new Error("First argument must be a url string or Request instance.");if(t.method!==m.Get)throw new Error("JSONP requests must use GET request method.");return s(this._backend,t)},e}(Q);J.decorators=[{type:l.u}],J.ctorParameters=function(){return[{type:T},{type:H}]};var $=function(){return function(){}}();$.decorators=[{type:l.B,args:[{providers:[{provide:Q,useFactory:u,deps:[V,H]},f,{provide:H,useClass:z},{provide:_,useClass:w},V,{provide:S,useFactory:h}]}]}],$.ctorParameters=function(){return[]};var tt=function(){return function(){}}();tt.decorators=[{type:l.B,args:[{providers:[{provide:J,useFactory:function(t,e){return new J(t,e)},deps:[F,H]},I,{provide:H,useClass:z},{provide:_,useClass:w},{provide:F,useClass:U}]}]}],tt.ctorParameters=function(){return[]};new l.X("4.4.6")},ComB:function(t,e,i){var n,r;!function(o,s){"use strict";void 0===(r="function"==typeof(n=s)?n.call(e,i,e,t):n)||(t.exports=r)}(window,function(){"use strict";var t=function(){var t=window.Element.prototype;if(t.matches)return"matches";if(t.matchesSelector)return"matchesSelector";for(var e=["webkit","moz","ms","o"],i=0;i<e.length;i++){var n=e[i]+"MatchesSelector";if(t[n])return n}}();return function(e,i){return e[t](i)}})},"E9/g":function(t,e,i){"use strict";i.d(e,"a",function(){return h});var n=i("B1iP"),r=i("qLnt"),o=i("grVA"),s=i("V7AE"),a=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},h=function(t){function e(i,n,r){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=o.a;break;case 1:if(!i){this.destination=o.a;break}if("object"==typeof i){i instanceof e?(this.destination=i,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new u(this,i));break}default:this.syncErrorThrowable=!0,this.destination=new u(this,i,n,r)}}return a(e,t),e.prototype[s.a]=function(){return this},e.create=function(t,i,n){var r=new e(t,i,n);return r.syncErrorThrowable=!1,r},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this},e}(r.a),u=function(t){function e(e,i,r,s){t.call(this),this._parentSubscriber=e;var a,h=this;Object(n.a)(i)?a=i:i&&(a=i.next,r=i.error,s=i.complete,i!==o.a&&(h=Object.create(i),Object(n.a)(h.unsubscribe)&&this.add(h.unsubscribe.bind(h)),h.unsubscribe=this.unsubscribe.bind(this))),this._context=h,this._next=a,this._error=r,this._complete=s}return a(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber;if(this._error)e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!e.syncErrorThrowable)throw this.unsubscribe(),t;e.syncErrorValue=t,e.syncErrorThrown=!0,this.unsubscribe()}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var i=function(){return t._complete.call(t._context)};e.syncErrorThrowable?(this.__tryOrSetError(e,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){throw this.unsubscribe(),t}},e.prototype.__tryOrSetError=function(t,e,i){try{e.call(this._context,i)}catch(e){return t.syncErrorValue=e,t.syncErrorThrown=!0,!0}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(h)},"Ecq+":function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("AP4T"),r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(t){function e(e){t.call(this),this.scheduler=e}return r(e,t),e.create=function(t){return new e(t)},e.dispatch=function(t){t.subscriber.complete()},e.prototype._subscribe=function(t){var i=this.scheduler;if(i)return i.schedule(e.dispatch,0,{subscriber:t});t.complete()},e}(n.a)},ExCY:function(t,e,i){"use strict";function n(){}function r(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:n}e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return r(t)},e.b=r},FXUT:function(t,e,i){var n,r;!function(o,s){"use strict";n=[i("UcT7"),i("kUnS"),i("+51+"),i("ibk9")],void 0===(r=(function(t,e,i,n){return s(o,t,e,i,n)}).apply(e,n))||(t.exports=r)}(window,function(t,e,i,n,r){"use strict";function o(t,e){var i=n.getQueryElement(t);if(i){this.element=i,h&&(this.$element=h(this.element)),this.options=n.extend({},this.constructor.defaults),this.option(e);var r=++c;this.element.outlayerGUID=r,l[r]=this,this._create();this._getOption("initLayout")&&this.layout()}else a&&a.error("Bad element for "+this.constructor.namespace+": "+(i||t))}function s(t){function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}var a=t.console,h=t.jQuery,u=function(){},c=0,l={};o.namespace="outlayer",o.Item=r,o.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var d=o.prototype;n.extend(d,e.prototype),d.option=function(t){n.extend(this.options,t)},d._getOption=function(t){var e=this.constructor.compatOptions[t];return e&&void 0!==this.options[e]?this.options[e]:this.options[t]},o.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},d._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),n.extend(this.element.style,this.options.containerStyle);this._getOption("resize")&&this.bindResize()},d.reloadItems=function(){this.items=this._itemize(this.element.children)},d._itemize=function(t){for(var e=this._filterFindItemElements(t),i=this.constructor.Item,n=[],r=0;r<e.length;r++){var o=new i(e[r],this);n.push(o)}return n},d._filterFindItemElements=function(t){return n.filterFindElements(t,this.options.itemSelector)},d.getItemElements=function(){return this.items.map(function(t){return t.element})},d.layout=function(){this._resetLayout(),this._manageStamps();var t=this._getOption("layoutInstant"),e=void 0!==t?t:!this._isLayoutInited;this.layoutItems(this.items,e),this._isLayoutInited=!0},d._init=d.layout,d._resetLayout=function(){this.getSize()},d.getSize=function(){this.size=i(this.element)},d._getMeasurement=function(t,e){var n,r=this.options[t];r?("string"==typeof r?n=this.element.querySelector(r):r instanceof HTMLElement&&(n=r),this[t]=n?i(n)[e]:r):this[t]=0},d.layoutItems=function(t,e){t=this._getItemsForLayout(t),this._layoutItems(t,e),this._postLayout()},d._getItemsForLayout=function(t){return t.filter(function(t){return!t.isIgnored})},d._layoutItems=function(t,e){if(this._emitCompleteOnItems("layout",t),t&&t.length){var i=[];t.forEach(function(t){var n=this._getItemLayoutPosition(t);n.item=t,n.isInstant=e||t.isLayoutInstant,i.push(n)},this),this._processLayoutQueue(i)}},d._getItemLayoutPosition=function(){return{x:0,y:0}},d._processLayoutQueue=function(t){this.updateStagger(),t.forEach(function(t,e){this._positionItem(t.item,t.x,t.y,t.isInstant,e)},this)},d.updateStagger=function(){var t=this.options.stagger;if(null!==t&&void 0!==t)return this.stagger=function(t){if("number"==typeof t)return t;var e=t.match(/(^\d*\.?\d*)(\w*)/),i=e&&e[1],n=e&&e[2];return i.length?(i=parseFloat(i))*(p[n]||1):0}(t),this.stagger;this.stagger=0},d._positionItem=function(t,e,i,n,r){n?t.goTo(e,i):(t.stagger(r*this.stagger),t.moveTo(e,i))},d._postLayout=function(){this.resizeContainer()},d.resizeContainer=function(){if(this._getOption("resizeContainer")){var t=this._getContainerSize();t&&(this._setContainerMeasure(t.width,!0),this._setContainerMeasure(t.height,!1))}},d._getContainerSize=u,d._setContainerMeasure=function(t,e){if(void 0!==t){var i=this.size;i.isBorderBox&&(t+=e?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),t=Math.max(t,0),this.element.style[e?"width":"height"]=t+"px"}},d._emitCompleteOnItems=function(t,e){function i(){r.dispatchEvent(t+"Complete",null,[e])}function n(){++s==o&&i()}var r=this,o=e.length;if(e&&o){var s=0;e.forEach(function(e){e.once(t,n)})}else i()},d.dispatchEvent=function(t,e,i){var n=e?[e].concat(i):i;if(this.emitEvent(t,n),h)if(this.$element=this.$element||h(this.element),e){var r=h.Event(e);r.type=t,this.$element.trigger(r,i)}else this.$element.trigger(t,i)},d.ignore=function(t){var e=this.getItem(t);e&&(e.isIgnored=!0)},d.unignore=function(t){var e=this.getItem(t);e&&delete e.isIgnored},d.stamp=function(t){(t=this._find(t))&&(this.stamps=this.stamps.concat(t),t.forEach(this.ignore,this))},d.unstamp=function(t){(t=this._find(t))&&t.forEach(function(t){n.removeFrom(this.stamps,t),this.unignore(t)},this)},d._find=function(t){if(t)return"string"==typeof t&&(t=this.element.querySelectorAll(t)),t=n.makeArray(t)},d._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},d._getBoundingRect=function(){var t=this.element.getBoundingClientRect(),e=this.size;this._boundingRect={left:t.left+e.paddingLeft+e.borderLeftWidth,top:t.top+e.paddingTop+e.borderTopWidth,right:t.right-(e.paddingRight+e.borderRightWidth),bottom:t.bottom-(e.paddingBottom+e.borderBottomWidth)}},d._manageStamp=u,d._getElementOffset=function(t){var e=t.getBoundingClientRect(),n=this._boundingRect,r=i(t);return{left:e.left-n.left-r.marginLeft,top:e.top-n.top-r.marginTop,right:n.right-e.right-r.marginRight,bottom:n.bottom-e.bottom-r.marginBottom}},d.handleEvent=n.handleEvent,d.bindResize=function(){t.addEventListener("resize",this),this.isResizeBound=!0},d.unbindResize=function(){t.removeEventListener("resize",this),this.isResizeBound=!1},d.onresize=function(){this.resize()},n.debounceMethod(o,"onresize",100),d.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},d.needsResizeLayout=function(){var t=i(this.element);return this.size&&t&&t.innerWidth!==this.size.innerWidth},d.addItems=function(t){var e=this._itemize(t);return e.length&&(this.items=this.items.concat(e)),e},d.appended=function(t){var e=this.addItems(t);e.length&&(this.layoutItems(e,!0),this.reveal(e))},d.prepended=function(t){var e=this._itemize(t);if(e.length){var i=this.items.slice(0);this.items=e.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(e,!0),this.reveal(e),this.layoutItems(i)}},d.reveal=function(t){if(this._emitCompleteOnItems("reveal",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.reveal()})}},d.hide=function(t){if(this._emitCompleteOnItems("hide",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.hide()})}},d.revealItemElements=function(t){var e=this.getItems(t);this.reveal(e)},d.hideItemElements=function(t){var e=this.getItems(t);this.hide(e)},d.getItem=function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];if(i.element==t)return i}},d.getItems=function(t){var e=[];return(t=n.makeArray(t)).forEach(function(t){var i=this.getItem(t);i&&e.push(i)},this),e},d.remove=function(t){var e=this.getItems(t);this._emitCompleteOnItems("remove",e),e&&e.length&&e.forEach(function(t){t.remove(),n.removeFrom(this.items,t)},this)},d.destroy=function(){var t=this.element.style;t.height="",t.position="",t.width="",this.items.forEach(function(t){t.destroy()}),this.unbindResize();var e=this.element.outlayerGUID;delete l[e],delete this.element.outlayerGUID,h&&h.removeData(this.element,this.constructor.namespace)},o.data=function(t){var e=(t=n.getQueryElement(t))&&t.outlayerGUID;return e&&l[e]},o.create=function(t,e){var i=s(o);return i.defaults=n.extend({},o.defaults),n.extend(i.defaults,e),i.compatOptions=n.extend({},o.compatOptions),i.namespace=t,i.data=o.data,i.Item=s(r),n.htmlInit(i,t),h&&h.bridget&&h.bridget(t,i),i};var p={ms:1,s:1e3};return o.Item=r,o})},Fjvy:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=function(){function t(){}return Object.defineProperty(t,"defaultEasingLogic",{get:function(){return t._easingLogic},set:function(e){t._easingLogic=e},enumerable:!0,configurable:!0}),t._interval=10,t._minScrollDistance=2,t._defaultNamespace="default",t.defaultIsVerticalScrolling=!0,t._logLevel=2,t.defaultDuration=1250,t.defaultScrollOffset=0,t.defaultAdvancedInlineOffsetCalculation=!1,t._interruptEvents=["mousedown","wheel","DOMMouseScroll","mousewheel","keyup","touchmove"],t._interruptKeys=[33,34,35,36,38,40],t.defaultInterruptible=!0,t._easingLogic={ease:function(t,e,i,n){return i*t/n+e}},t}()},FzQ3:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("ZGtO"),r=function(){function t(t){this.meshCreator=t,this.textureLoader=new n.TextureLoader}return t.prototype.newInstance=function(t){var e=this.textureLoader.load("./assets/models/boxFloor.png");e.magFilter=n.NearestFilter,e.minFilter=n.LinearMipMapLinearFilter;var i=new n.MeshBasicMaterial({map:e});return this.meshCreator.createMesh("./assets/models/boxfloor.js",i,t,new n.Vector3(50,50,50))},t}();e.FloorFactory=r},GIol:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("ZGtO"),r=function(){function t(t){this.loader=t}return t.prototype.createMesh=function(t,e,i,r){var o=this;return new Promise(function(s){o.loader.load(t,function(t){var o=new n.Mesh(t,e);o.position.set(i.x,i.y,i.z),o.castShadow=!0,o.receiveShadow=!0,o.scale.set(r.x,r.y,r.z),s(o)})})},t}();e.MeshCreator=r},GQSG:function(t,e,i){"use strict";var n=i("AP4T"),r=i("dmC+");n.a.prototype.map=r.a},GtNu:function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i("6nA8"),o=i("RW+t"),s=i("939O"),a=i("T/xl"),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(r.State);e.ExtendedState=h;var u=function(t){function e(){return t.call(this)||this}return n(e,t),e.prototype.create=function(){this.skillPillGroup=new r.Group(this.game),this.setUpPhysics();var t=new s.WaterFactory(this.game);this.water=t.newInstance(300),this.game.stage.backgroundColor=16119285,this.game.scale.scaleMode=r.ScaleManager.RESIZE,this.game.tweens.frameBased=!0,this.graphics=this.game.add.graphics(0,0),this.skillPillFactory=new o.SkillPillFactory(this.game),this.mouseDragHandler=new a.MouseDragHandler(this.game),this.game.stateLoadedCallback()},e.prototype.resize=function(){this.water.setHeight()},e.prototype.update=function(){var t=this;this.graphics.clear(),this.water.update(),this.graphics.beginFill(2698028,.9),this.graphics.drawPolygon(this.water.points),this.graphics.endFill(),this.skillPillGroup.children.forEach(function(e){e.updatePhysics(t.water.getWaterLevel(e.position.x),t.water)})},e.prototype.setItemsArray=function(t){var e=this;t.forEach(function(t){var i=e.skillPillFactory.newInstance(100,100,t,100);e.game.add.existing(i),e.mouseDragHandler.sprites.push(i),e.skillPillGroup.add(i)})},e.prototype.setUpPhysics=function(){this.game.physics.startSystem(r.Physics.P2JS),this.game.physics.p2.gravity.y=1e3,this.game.physics.p2.restitution=.3},e}(h);e.MainState=u},K1Hx:function(t,e,i){"use strict";i.d(e,"a",function(){return u});var n=i("/oeL"),r=i("BkNc"),o=i("qbdv"),s=i("B8Mb"),a=i("8I79"),h=i("R1JD"),u=function(){function t(t,e,i){this.pageScrollService=t,this.router=e,this.pageScrollTarget=null,this.pageScrollHorizontal=null,this.pageScrollOffset=null,this.pageScrollDuration=null,this.pageScrollSpeed=null,this.pageScrollEasing=null,this.pageScrollAdjustHash=!1,this.pageScroll=null,this.pageScrollFinish=new n.p,this.document=i}return t.prototype.ngOnChanges=function(t){this.pageScrollInstance=void 0},t.prototype.ngOnDestroy=function(){this.pageScrollInstance&&this.pageScrollService.stop(this.pageScrollInstance)},t.prototype.generatePageScrollInstance=function(){return h.a.isUndefinedOrNull(this.pageScrollInstance)&&(this.pageScrollInstance=a.a.newInstance({document:this.document,scrollTarget:this.pageScrollTarget||this.href,scrollingViews:null,namespace:this.pageScroll,verticalScrolling:!this.pageScrollHorizontal,pageScrollOffset:this.pageScrollOffset,pageScrollInterruptible:this.pageScrollInterruptible,pageScrollEasingLogic:this.pageScrollEasing,pageScrollDuration:this.pageScrollDuration,pageScrollSpeed:this.pageScrollSpeed,pageScrollFinishListener:this.pageScrollFinish})),this.pageScrollInstance},t.prototype.pushRouterState=function(){this.pageScrollAdjustHash&&"string"==typeof this.pageScrollInstance.scrollTarget&&"#"===this.pageScrollInstance.scrollTarget.substr(0,1)&&this.router.navigate([],{fragment:this.pageScrollInstance.scrollTarget.substr(1),preserveQueryParams:!0})},t.prototype.scroll=function(){var t=this.generatePageScrollInstance();this.pushRouterState(),this.pageScrollService.start(t)},t.prototype.handleClick=function(t){var e=this;if(this.routerLink&&null!==this.router&&void 0!==this.router){var i=void 0;if(i="string"==typeof this.routerLink?this.router.parseUrl(this.routerLink):this.router.createUrlTree(this.routerLink),!this.router.isActive(i,!0)){var n=this.router.events.subscribe(function(t){t instanceof r.e?(n.unsubscribe(),setTimeout(function(){e.scroll()},0)):(t instanceof r.f||t instanceof r.d)&&n.unsubscribe()});return!1}}return this.scroll(),!1},t.decorators=[{type:n.m,args:[{selector:"[pageScroll]",host:{"(click)":"handleClick($event)"}}]}],t.ctorParameters=function(){return[{type:s.c},{type:r.n,decorators:[{type:n.H}]},{type:void 0,decorators:[{type:n.t,args:[o.d]}]}]},t.propDecorators={routerLink:[{type:n.x}],href:[{type:n.x}],pageScrollTarget:[{type:n.x}],pageScrollHorizontal:[{type:n.x}],pageScrollOffset:[{type:n.x}],pageScrollDuration:[{type:n.x}],pageScrollSpeed:[{type:n.x}],pageScrollEasing:[{type:n.x}],pageScrollInterruptible:[{type:n.x}],pageScrollAdjustHash:[{type:n.x}],pageScroll:[{type:n.x}],pageScrollFinish:[{type:n.I}]},t}()},K8Pk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("ZGtO"),r=function(){function t(t){this.meshCreator=t,this.textureLoader=new n.TextureLoader}return t.prototype.newInstance=function(){var t=this.textureLoader.load("./assets/models/baked.png");t.magFilter=n.NearestFilter,t.minFilter=n.LinearMipMapLinearFilter;var e=new n.MeshBasicMaterial({map:t});return this.meshCreator.createMesh("./assets/models/dm.js",e,new n.Vector3(0,0,0),new n.Vector3(50,50,50))},t}();e.DMFactory=r},Knxt:function(t,e,i){var n,r,o;!function(s,a){r=[i("FXUT"),i("kUnS")],void 0===(o="function"==typeof(n=a)?n.apply(e,r):n)||(t.exports=o)}(window,function(t,e){"use strict";var i=t.create("masonry");i.compatOptions.fitWidth="isFitWidth";var n=i.prototype;return n._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var t=0;t<this.cols;t++)this.colYs.push(0);this.maxY=0,this.horizontalColIndex=0},n.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var t=this.items[0],i=t&&t.element;this.columnWidth=i&&e(i).outerWidth||this.containerWidth}var n=this.columnWidth+=this.gutter,r=this.containerWidth+this.gutter,o=r/n,s=n-r%n,a=s&&s<1?"round":"floor";o=Math[a](o),this.cols=Math.max(o,1)},n.getContainerWidth=function(){var t=this._getOption("fitWidth")?this.element.parentNode:this.element,i=e(t);this.containerWidth=i&&i.innerWidth},n._getItemLayoutPosition=function(t){t.getSize();var e=t.size.outerWidth%this.columnWidth,i=e&&e<1?"round":"ceil",n=Math[i](t.size.outerWidth/this.columnWidth);n=Math.min(n,this.cols);for(var r=this[this.options.horizontalOrder?"_getHorizontalColPosition":"_getTopColPosition"](n,t),o={x:this.columnWidth*r.col,y:r.y},s=r.y+t.size.outerHeight,a=n+r.col,h=r.col;h<a;h++)this.colYs[h]=s;return o},n._getTopColPosition=function(t){var e=this._getTopColGroup(t),i=Math.min.apply(Math,e);return{col:e.indexOf(i),y:i}},n._getTopColGroup=function(t){if(t<2)return this.colYs;for(var e=[],i=this.cols+1-t,n=0;n<i;n++)e[n]=this._getColGroupY(n,t);return e},n._getColGroupY=function(t,e){if(e<2)return this.colYs[t];var i=this.colYs.slice(t,t+e);return Math.max.apply(Math,i)},n._getHorizontalColPosition=function(t,e){var i=this.horizontalColIndex%this.cols;i=t>1&&i+t>this.cols?0:i;var n=e.size.outerWidth&&e.size.outerHeight;return this.horizontalColIndex=n?i+t:this.horizontalColIndex,{col:i,y:this._getColGroupY(i,t)}},n._manageStamp=function(t){var i=e(t),n=this._getElementOffset(t),r=this._getOption("originLeft")?n.left:n.right,o=r+i.outerWidth,s=Math.floor(r/this.columnWidth);s=Math.max(0,s);var a=Math.floor(o/this.columnWidth);a-=o%this.columnWidth?0:1,a=Math.min(this.cols-1,a);for(var h=(this._getOption("originTop")?n.top:n.bottom)+i.outerHeight,u=s;u<=a;u++)this.colYs[u]=Math.max(h,this.colYs[u])},n._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var t={height:this.maxY};return this._getOption("fitWidth")&&(t.width=this._getContainerFitWidth()),t},n._getContainerFitWidth=function(){for(var t=0,e=this.cols;--e&&0===this.colYs[e];)t++;return(this.cols-t)*this.columnWidth-this.gutter},n.needsResizeLayout=function(){var t=this.containerWidth;return this.getContainerWidth(),t!=this.containerWidth},i})},LHF8:function(t,e,i){"use strict";var n=i("TO51"),r=i("AP4T"),o=i("E9/g"),s=i("qLnt"),a=i("RWQz"),h=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},u=function(t){function e(e,i){t.call(this),this.source=e,this.subjectFactory=i,this._refCount=0,this._isComplete=!1}return h(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new s.a).add(this.source.subscribe(new l(this.getSubject(),this))),t.closed?(this._connection=null,t=s.a.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return Object(a.a)()(this)},e}(r.a).prototype,c={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:u._subscribe},_isComplete:{value:u._isComplete,writable:!0},getSubject:{value:u.getSubject},connect:{value:u.connect},refCount:{value:u.refCount}},l=function(t){function e(e,i){t.call(this,e),this.connectable=i}return h(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(n.b);o.a;e.a=function(t,e){return function(i){var n;if(n="function"==typeof t?t:function(){return t},"function"==typeof e)return i.lift(new d(n,e));var r=Object.create(i,c);return r.source=i,r.subjectFactory=n,r}};var d=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var i=this.selector,n=this.subjectFactory(),r=i(n).subscribe(t);return r.add(e.subscribe(n)),r},t}()},LaOa:function(t,e,i){"use strict";e.a=function(t,e){return function(i){return i.lift(new o(t,e))}};var n=i("E9/g"),r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.predicate,this.thisArg))},t}(),s=function(t){function e(e,i,n){t.call(this,e),this.predicate=i,this.thisArg=n,this.count=0}return r(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(n.a)},MwgA:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},NGRF:function(t,e,i){"use strict";e.a=function(t){return null!=t&&"object"==typeof t}},Oryw:function(t,e,i){"use strict";i.d(e,"a",function(){return h});var n=i("AP4T"),r=i("8Ut3"),o=i("Ecq+"),s=i("3iOE"),a=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},h=function(t){function e(e,i){t.call(this),this.array=e,this.scheduler=i,i||1!==e.length||(this._isScalar=!0,this.value=e[0])}return a(e,t),e.create=function(t,i){return new e(t,i)},e.of=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];var n=t[t.length-1];Object(s.a)(n)?t.pop():n=null;var a=t.length;return a>1?new e(t,n):1===a?new r.a(t[0],n):new o.a(n)},e.dispatch=function(t){var e=t.array,i=t.index,n=t.count,r=t.subscriber;i>=n?r.complete():(r.next(e[i]),r.closed||(t.index=i+1,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.array,n=i.length,r=this.scheduler;if(r)return r.schedule(e.dispatch,0,{array:i,index:0,count:n,subscriber:t});for(var o=0;o<n&&!t.closed;o++)t.next(i[o]);t.complete()},e}(n.a)},QhQG:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("1thS"),r=i("CIu0"),o=(n.a,r.a,function(){return function(){}}())},R1JD:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=function(){function t(){}return t.isUndefinedOrNull=function(t){return"undefined"==typeof t||void 0===t||null===t},t.extractElementPosition=function(e,i){var n=e.body,r=e.documentElement,o=e.defaultView&&e.defaultView.pageYOffset||void 0,s=e.defaultView&&e.defaultView.pageXOffset||void 0,a=o||r.scrollTop||n.scrollTop,h=s||r.scrollLeft||n.scrollLeft,u=r.clientTop||n.clientTop||0,c=r.clientLeft||n.clientLeft||0;if(t.isUndefinedOrNull(i))return{top:a,left:h};var l=i.getBoundingClientRect(),d=l.top+a-u,p=l.left+h-c;return{top:Math.round(d),left:Math.round(p)}},t}()},"RW+t":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("skhl"),r=i("6LN+"),o=i("kJHF"),s=function(){function t(t){this.game=t,this.imageLoader=new r.ProxyImageLoader(t)}return t.prototype.newInstance=function(t,e,i,r){var s=new n.BuoyancyManager(.04,.9),a=new o.SkillPill(this.game,t,e,s);return this.imageLoader.load(i.name,i.image,function(t){a.loadTexture(t),a.scale.setTo(r/a.width),a.body.setRectangleFromSprite(a)}),a},t}();e.SkillPillFactory=s},RWQz:function(t,e,i){"use strict";e.a=function(){return function(t){return t.lift(new o(t))}};var n=i("E9/g"),r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var i=this.connectable;i._refCount++;var n=new s(t,i),r=e.subscribe(n);return n.closed||(n.connection=i.connect()),r},t}(),s=function(t){function e(e,i){t.call(this,e),this.connectable=i}return r(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var i=this.connection,n=t._connection;this.connection=null,!n||i&&n!==i||n.unsubscribe()}}else this.connection=null},e}(n.a)},Scch:function(t,e,i){"use strict";var n=i("/oeL"),r=i("lCxr"),o=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},s=function(){return function(){this.additionalAccountNames=[],this.userId=null,this.transport=""}}(),a=function(){function t(t){var e=this;this.angulartics2=t,this.dimensionsAndMetrics=[];var i=new s;this.angulartics2.settings.ga=o({},i,this.angulartics2.settings.ga),this.angulartics2.pageTrack.subscribe(function(t){return e.pageTrack(t.path)}),this.angulartics2.eventTrack.subscribe(function(t){return e.eventTrack(t.action,t.properties)}),this.angulartics2.exceptionTrack.subscribe(function(t){return e.exceptionTrack(t)}),this.angulartics2.setUsername.subscribe(function(t){return e.setUsername(t)}),this.angulartics2.setUserProperties.subscribe(function(t){return e.setUserProperties(t)}),this.angulartics2.userTimings.subscribe(function(t){return e.userTimings(t)})}return t.prototype.pageTrack=function(t){if("undefined"!=typeof _gaq&&_gaq){_gaq.push(["_trackPageview",t]);for(var e=0,i=this.angulartics2.settings.ga.additionalAccountNames;e<i.length;e++){var n=i[e];_gaq.push([n+"._trackPageview",t])}}if("undefined"!=typeof ga&&ga){this.angulartics2.settings.ga.userId&&ga("set","&uid",this.angulartics2.settings.ga.userId),ga("send","pageview",t);for(var r=0,o=this.angulartics2.settings.ga.additionalAccountNames;r<o.length;r++){n=o[r];ga(n+".send","pageview",t)}}},t.prototype.eventTrack=function(t,e){if(e&&e.category||((e=e||{}).category="Event"),e.value){var i=parseInt(e.value,10);e.value=isNaN(i)?0:i}if("undefined"!=typeof ga){var n={eventCategory:e.category,eventAction:t,eventLabel:e.label,eventValue:e.value,nonInteraction:e.noninteraction,page:e.page||location.hash.substring(1)||location.pathname,userId:this.angulartics2.settings.ga.userId,hitCallback:e.hitCallback};this.setDimensionsAndMetrics(e),this.angulartics2.settings.ga.transport?ga("send","event",n,{transport:this.angulartics2.settings.ga.transport}):ga("send","event",n);for(var r=0,o=this.angulartics2.settings.ga.additionalAccountNames;r<o.length;r++){var s=o[r];ga(s+".send","event",n)}}else"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent",e.category,t,e.label,e.value,e.noninteraction])},t.prototype.exceptionTrack=function(t){void 0===t.fatal&&(console.log('No "fatal" provided, sending with fatal=true'),t.fatal=!0),t.exDescription=t.description;var e={exFatal:t.fatal,exDescription:t.description};ga("send","exception",e)},t.prototype.userTimings=function(t){t&&t.timingCategory&&t.timingVar&&t.timingValue?"undefined"!=typeof ga&&ga("send","timing",t):console.error("Properties timingCategory, timingVar, and timingValue are required to be set.")},t.prototype.setUsername=function(t){this.angulartics2.settings.ga.userId=t},t.prototype.setUserProperties=function(t){this.setDimensionsAndMetrics(t)},t.prototype.setDimensionsAndMetrics=function(t){var e=this;"undefined"!=typeof ga&&(this.dimensionsAndMetrics.forEach(function(i){t.hasOwnProperty(i)||(ga("set",i,void 0),e.angulartics2.settings.ga.additionalAccountNames.forEach(function(t){ga(t+".set",i,void 0)}))}),this.dimensionsAndMetrics=[],Object.keys(t).forEach(function(i){0!==i.lastIndexOf("dimension",0)&&0!==i.lastIndexOf("metric",0)||(ga("set",i,t[i]),e.angulartics2.settings.ga.additionalAccountNames.forEach(function(e){ga(e+".set",i,t[i])}),e.dimensionsAndMetrics.push(i))}))},t.decorators=[{type:n.u}],t.ctorParameters=function(){return[{type:r.b}]},t}();i.d(e,!1,function(){return s}),i.d(e,"a",function(){return a})},"T/xl":function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e){var i=t.call(this)||this;return i.game=e,i.sprites=[],e.physics.p2.world.addBody(i),e.input.onDown.add(i.click,i),e.input.onUp.add(i.release,i),e.input.addMoveCallback(i.move,i),i}return n(e,t),e.prototype.click=function(t){var e=this.game.physics.p2.hitTest(t.position,this.sprites),i=[this.game.physics.p2.pxmi(t.position.x),this.game.physics.p2.pxmi(t.position.y)];if(e.length){var n=e[0],r=[0,0];n.toLocalFrame(r,i),this.mouseConstraint=this.game.physics.p2.createRevoluteConstraint(this,[0,0],n,[this.game.physics.p2.mpxi(r[0]),this.game.physics.p2.mpxi(r[1])])}},e.prototype.release=function(){this.game.physics.p2.removeConstraint(this.mouseConstraint)},e.prototype.move=function(t){this.position[0]=this.game.physics.p2.pxmi(t.position.x),this.position[1]=this.game.physics.p2.pxmi(t.position.y)},e}(p2.Body);e.MouseDragHandler=r},TO51:function(t,e,i){"use strict";i.d(e,"b",function(){return c}),i.d(e,"a",function(){return l});var n=i("AP4T"),r=i("E9/g"),o=i("qLnt"),s=i("Upor"),a=i("jaVc"),h=i("V7AE"),u=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},c=function(t){function e(e){t.call(this,e),this.destination=e}return u(e,t),e}(r.a),l=function(t){function e(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return u(e,t),e.prototype[h.a]=function(){return new c(this)},e.prototype.lift=function(t){var e=new d(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new s.a;if(!this.isStopped)for(var e=this.observers,i=e.length,n=e.slice(),r=0;r<i;r++)n[r].next(t)},e.prototype.error=function(t){if(this.closed)throw new s.a;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,i=e.length,n=e.slice(),r=0;r<i;r++)n[r].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new s.a;this.isStopped=!0;for(var t=this.observers,e=t.length,i=t.slice(),n=0;n<e;n++)i[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new s.a;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new s.a;return this.hasError?(t.error(this.thrownError),o.a.EMPTY):this.isStopped?(t.complete(),o.a.EMPTY):(this.observers.push(t),new a.a(this,t))},e.prototype.asObservable=function(){var t=new n.a;return t.source=this,t},e.create=function(t,e){return new d(t,e)},e}(n.a),d=function(t){function e(e,i){t.call(this),this.destination=e,this.source=i}return u(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):o.a.EMPTY},e}(l)},U89H:function(t,e,i){"use strict";i("K1Hx"),i("B8Mb");var n=i("Fjvy");i.d(e,"a",function(){return n.a});i("8I79"),i("R1JD"),i("XH7w")},URbD:function(t,e,i){"use strict";function n(){return new s.a}var r=i("LHF8"),o=i("RWQz"),s=i("TO51");e.a=function(){return function(t){return Object(o.a)()(Object(r.a)(n)(t))}(this)}},UcT7:function(t,e,i){var n,r;!function(o,s){void 0===(r="function"==typeof(n=s)?n.call(e,i,e,t):n)||(t.exports=r)}("undefined"!=typeof window&&window,function(){"use strict";function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{};return(i[t]=i[t]||{})[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){i=i.slice(0),e=e||[];for(var n=this._onceEvents&&this._onceEvents[t],r=0;r<i.length;r++){var o=i[r];n&&n[o]&&(this.off(t,o),delete n[o]),o.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t})},Upor:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=function(t){function e(){var e=t.call(this,"object unsubscribed");this.name=e.name="ObjectUnsubscribedError",this.stack=e.stack,this.message=e.message}return n(e,t),e}(Error)},V7AE:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i("xIGM").a.Symbol,r="function"==typeof n&&"function"==typeof n.for?n.for("rxSubscriber"):"@@rxSubscriber"},X3fp:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=function(t){var e=t.Symbol;if("function"==typeof e)return e.iterator||(e.iterator=e("iterator polyfill")),e.iterator;var i=t.Set;if(i&&"function"==typeof(new i)["@@iterator"])return"@@iterator";var n=t.Map;if(n)for(var r=Object.getOwnPropertyNames(n.prototype),o=0;o<r.length;++o){var s=r[o];if("entries"!==s&&"size"!==s&&n.prototype[s]===n.prototype.entries)return s}return"@@iterator"}(i("xIGM").a)},XH7w:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i("qbdv"),r=i("/oeL"),o=i("B8Mb"),s=i("K1Hx"),a=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:o.c,useClass:o.c}]}},t.decorators=[{type:r.B,args:[{imports:[n.c],declarations:[s.a],exports:[s.a],providers:[o.a]}]}],t.ctorParameters=function(){return[]},t}()},XOmO:function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i("6nA8"),o=i("GtNu"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(r.Game);e.ExtendedGame=s;var a=function(){function t(){}return t.prototype.run=function(t,e){this.game=new s(void 0,void 0,r.AUTO,t,o.MainState,!0),this.game.stateLoadedCallback=e},t.prototype.setItemsArray=function(t){var e=this.game.state.getCurrentState();e&&e.setItemsArray(t)},t}();e.Game=a},YRqN:function(t,e,i){"use strict";var n=i("E9/g"),r=i("AP4T"),o=function(){function t(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,i){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}},t.prototype.accept=function(t,e,i){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,i)},t.prototype.toObservable=function(){switch(this.kind){case"N":return r.a.of(this.value);case"E":return r.a.throw(this.error);case"C":return r.a.empty()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return"undefined"!=typeof e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();i.d(e,"a",function(){return a});var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=function(t){function e(e,i,n){void 0===n&&(n=0),t.call(this,e),this.scheduler=i,this.delay=n}return s(e,t),e.dispatch=function(t){var e=t.notification,i=t.destination;e.observe(i),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.add(this.scheduler.schedule(e.dispatch,this.delay,new h(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(o.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(o.createError(t))},e.prototype._complete=function(){this.scheduleMessage(o.createComplete())},e}(n.a),h=function(){return function(t,e){this.notification=t,this.destination=e}}()},Z0iT:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("ZGtO"),r=i("K8Pk"),o=i("FzQ3"),s=i("GIol"),a=function(){function t(){this.scene=new n.Scene,this.renderer=new n.WebGLRenderer({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=n.PCFSoftShadowMap,this.renderer.setClearColor(16777215,1);var t=new n.JSONLoader;this.addObjectsToScene(t)}return t.prototype.setSize=function(t,e){this.renderer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix()},t.prototype.run=function(t){var e=this;t.appendChild(this.renderer.domElement);var i=new n.Vector3(0,0,0),r=new n.Clock,o=function(){e.renderer.render(e.scene,e.camera),e.camera.position.x=248*Math.cos(.1*r.getElapsedTime()),e.camera.position.z=248*Math.sin(.1*r.getElapsedTime()),e.camera.lookAt(i),e.renderer.render(e.scene,e.camera),window.requestAnimationFrame(o)};o(),this.addListeners(this.renderer,this.camera)},t.prototype.tilt=function(t){this.camera.position.y=t},t.prototype.addObjectsToScene=function(t){this.createCamera(this.scene);var e=new s.MeshCreator(t);this.createFloor(this.scene,e),this.createDMObject(this.scene,e)},t.prototype.createFloor=function(t,e){new o.FloorFactory(e).newInstance(new n.Vector3(0,-375,0)).then(function(e){t.add(e)})},t.prototype.createDMObject=function(t,e){new r.DMFactory(e).newInstance().then(function(e){t.add(e)})},t.prototype.createLights=function(t){new n.AmbientLight(16777215,.3);var e=new n.DirectionalLight(8026746);e.position.set(-100,200,100),e.castShadow=!0,e.shadow.bias=1e-4,t.add(e)},t.prototype.createCamera=function(t){this.camera=new n.PerspectiveCamera(100),this.camera.near=.1,this.camera.far=2e4,this.camera.position.set(0,66,248),t.add(this.camera)},t.prototype.addListeners=function(t,e){window.addEventListener("resize",function(){var i=window.innerWidth,n=window.innerHeight;t.setSize(i,n),e.aspect=i/n,e.updateProjectionMatrix()})},t}();e.Stage=a},ZGtO:function(t,e,i){"use strict";function n(){}function r(t,e){this.x=t||0,this.y=e||0}function o(t,e,i,n,s,a,h,u,c,l){Object.defineProperty(this,"id",{value:$s++}),this.uuid=Js.generateUUID(),this.name="",this.image=void 0!==t?t:o.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:o.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:qo,this.wrapT=void 0!==n?n:qo,this.magFilter=void 0!==s?s:Jo,this.minFilter=void 0!==a?a:ts,this.anisotropy=void 0!==c?c:1,this.format=void 0!==h?h:ms,this.type=void 0!==u?u:es,this.offset=new r(0,0),this.repeat=new r(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:Vs,this.version=0,this.onUpdate=null}function s(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1}function a(t,e,i){this.uuid=Js.generateUUID(),this.width=t,this.height=e,this.scissor=new s(0,0,t,e),this.scissorTest=!1,this.viewport=new s(0,0,t,e),void 0===(i=i||{}).minFilter&&(i.minFilter=Jo),this.texture=new o(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function h(t,e,i){a.call(this,t,e,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function u(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1}function c(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function l(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function d(t,e,i,n,r,s,a,h,u,c,l,d){o.call(this,null,s,a,h,u,c,n,r,l,d),this.image={data:t,width:e,height:i},this.magFilter=void 0!==u?u:Ko,this.minFilter=void 0!==c?c:Ko,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function p(t,e,i,n,r,s,a,h,u,c){o.call(this,t=void 0!==t?t:[],e=void 0!==e?e:No,i,n,r,s,a,h,u,c),this.flipY=!1}function f(){this.seq=[],this.map={}}function m(t,e,i){var n=t[0];if(n<=0||n>0)return t;var r=e*i,o=ia[r];if(void 0===o&&(o=new Float32Array(r),ia[r]=o),0!==e){n.toArray(o,0);for(var s=1,a=0;s!==e;++s)a+=i,t[s].toArray(o,a)}return o}function g(t,e){var i=na[e];void 0===i&&(i=new Int32Array(e),na[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocTextureUnit();return i}function y(t,e){t.uniform1f(this.addr,e)}function v(t,e){t.uniform1i(this.addr,e)}function b(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function x(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function _(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function w(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function T(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(oa.set(e.elements),t.uniformMatrix3fv(this.addr,!1,oa))}function S(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(ra.set(e.elements),t.uniformMatrix4fv(this.addr,!1,ra))}function E(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTexture2D(e||ta,n)}function C(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTextureCube(e||ea,n)}function P(t,e){t.uniform2iv(this.addr,e)}function M(t,e){t.uniform3iv(this.addr,e)}function A(t,e){t.uniform4iv(this.addr,e)}function R(t,e){t.uniform1fv(this.addr,e)}function L(t,e){t.uniform1iv(this.addr,e)}function O(t,e){t.uniform2fv(this.addr,m(e,this.size,2))}function I(t,e){t.uniform3fv(this.addr,m(e,this.size,3))}function B(t,e){t.uniform4fv(this.addr,m(e,this.size,4))}function k(t,e){t.uniformMatrix2fv(this.addr,!1,m(e,this.size,4))}function D(t,e){t.uniformMatrix3fv(this.addr,!1,m(e,this.size,9))}function F(t,e){t.uniformMatrix4fv(this.addr,!1,m(e,this.size,16))}function U(t,e,i){var n=e.length,r=g(i,n);t.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTexture2D(e[o]||ta,r[o])}function N(t,e,i){var n=e.length,r=g(i,n);t.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTextureCube(e[o]||ea,r[o])}function G(t,e,i){this.id=t,this.addr=i,this.setValue=function(t){switch(t){case 5126:return y;case 35664:return b;case 35665:return x;case 35666:return _;case 35674:return w;case 35675:return T;case 35676:return S;case 35678:case 36198:return E;case 35680:return C;case 5124:case 35670:return v;case 35667:case 35671:return P;case 35668:case 35672:return M;case 35669:case 35673:return A}}(e.type)}function j(t,e,i){this.id=t,this.addr=i,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return R;case 35664:return O;case 35665:return I;case 35666:return B;case 35674:return k;case 35675:return D;case 35676:return F;case 35678:return U;case 35680:return N;case 5124:case 35670:return L;case 35667:case 35671:return P;case 35668:case 35672:return M;case 35669:case 35673:return A}}(e.type)}function V(t){this.id=t,f.call(this)}function H(t,e){t.seq.push(e),t.map[e.id]=e}function z(t,e,i){var n=t.name,r=n.length;for(sa.lastIndex=0;;){var o=sa.exec(n),s=sa.lastIndex,a=o[1],h="]"===o[2],u=o[3];if(h&&(a|=0),void 0===u||"["===u&&s+2===r){H(i,void 0===u?new G(a,t,e):new j(a,t,e));break}var c=i.map[a];void 0===c&&H(i,c=new V(a)),i=c}}function W(t,e,i){f.call(this),this.renderer=i;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;++r){var o=t.getActiveUniform(e,r),s=o.name;z(o,t.getUniformLocation(e,s),this)}}function X(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}function q(t,e){this.min=void 0!==t?t:new r(1/0,1/0),this.max=void 0!==e?e:new r(-1/0,-1/0)}function Y(t,e){function i(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),i=new Uint16Array([0,1,2,0,2,3]);n=p.createBuffer(),o=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,n),p.bufferData(p.ARRAY_BUFFER,e,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),p.bufferData(p.ELEMENT_ARRAY_BUFFER,i,p.STATIC_DRAW),l=p.createTexture(),d=p.createTexture(),f.bindTexture(p.TEXTURE_2D,l),p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),f.bindTexture(p.TEXTURE_2D,d),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),s={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},a=function(e){var i=p.createProgram(),n=p.createShader(p.FRAGMENT_SHADER),r=p.createShader(p.VERTEX_SHADER),o="precision "+t.getPrecision()+" float;\n";return p.shaderSource(n,o+e.fragmentShader),p.shaderSource(r,o+e.vertexShader),p.compileShader(n),p.compileShader(r),p.attachShader(i,n),p.attachShader(i,r),p.linkProgram(i),i}(s),h={vertex:p.getAttribLocation(a,"position"),uv:p.getAttribLocation(a,"uv")},u={renderType:p.getUniformLocation(a,"renderType"),map:p.getUniformLocation(a,"map"),occlusionMap:p.getUniformLocation(a,"occlusionMap"),opacity:p.getUniformLocation(a,"opacity"),color:p.getUniformLocation(a,"color"),scale:p.getUniformLocation(a,"scale"),rotation:p.getUniformLocation(a,"rotation"),screenPosition:p.getUniformLocation(a,"screenPosition")}}var n,o,s,a,h,u,l,d,p=t.context,f=t.state;this.render=function(s,m,g){if(0!==e.length){var y=new c,v=g.w/g.z,b=.5*g.z,x=.5*g.w,_=16/g.w,w=new r(_*v,_),T=new c(1,1,0),S=new r(1,1),E=new q;E.min.set(g.x,g.y),E.max.set(g.x+(g.z-16),g.y+(g.w-16)),void 0===a&&i(),p.useProgram(a),f.initAttributes(),f.enableAttribute(h.vertex),f.enableAttribute(h.uv),f.disableUnusedAttributes(),p.uniform1i(u.occlusionMap,0),p.uniform1i(u.map,1),p.bindBuffer(p.ARRAY_BUFFER,n),p.vertexAttribPointer(h.vertex,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(h.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),f.disable(p.CULL_FACE),f.buffers.depth.setMask(!1);for(var C=0,P=e.length;C<P;C++){_=16/g.w,w.set(_*v,_);var M=e[C];if(y.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),y.applyMatrix4(m.matrixWorldInverse),y.applyMatrix4(m.projectionMatrix),T.copy(y),S.x=g.x+T.x*b+b-8,S.y=g.y+T.y*x+x-8,!0===E.containsPoint(S)){f.activeTexture(p.TEXTURE0),f.bindTexture(p.TEXTURE_2D,null),f.activeTexture(p.TEXTURE1),f.bindTexture(p.TEXTURE_2D,l),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,S.x,S.y,16,16,0),p.uniform1i(u.renderType,0),p.uniform2f(u.scale,w.x,w.y),p.uniform3f(u.screenPosition,T.x,T.y,T.z),f.disable(p.BLEND),f.enable(p.DEPTH_TEST),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),f.activeTexture(p.TEXTURE0),f.bindTexture(p.TEXTURE_2D,d),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,S.x,S.y,16,16,0),p.uniform1i(u.renderType,1),f.disable(p.DEPTH_TEST),f.activeTexture(p.TEXTURE1),f.bindTexture(p.TEXTURE_2D,l),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),M.positionScreen.copy(T),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),p.uniform1i(u.renderType,2),f.enable(p.BLEND);for(var A=0,R=M.lensFlares.length;A<R;A++){var L=M.lensFlares[A];L.opacity>.001&&L.scale>.001&&(T.x=L.x,T.y=L.y,T.z=L.z,_=L.size*L.scale/g.w,w.x=_*v,w.y=_,p.uniform3f(u.screenPosition,T.x,T.y,T.z),p.uniform2f(u.scale,w.x,w.y),p.uniform1f(u.rotation,L.rotation),p.uniform1f(u.opacity,L.opacity),p.uniform3f(u.color,L.color.r,L.color.g,L.color.b),f.setBlending(L.blending,L.blendEquation,L.blendSrc,L.blendDst),t.setTexture2D(L.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}}f.enable(p.CULL_FACE),f.enable(p.DEPTH_TEST),f.buffers.depth.setMask(!0),t.resetGLState()}}}function K(t,e){function i(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),i=new Uint16Array([0,1,2,0,2,3]);r=p.createBuffer(),s=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,r),p.bufferData(p.ARRAY_BUFFER,e,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,s),p.bufferData(p.ELEMENT_ARRAY_BUFFER,i,p.STATIC_DRAW),a=function(){var e=p.createProgram(),i=p.createShader(p.VERTEX_SHADER),n=p.createShader(p.FRAGMENT_SHADER);return p.shaderSource(i,["precision "+t.getPrecision()+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),p.shaderSource(n,["precision "+t.getPrecision()+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),p.compileShader(i),p.compileShader(n),p.attachShader(e,i),p.attachShader(e,n),p.linkProgram(e),e}(),h={position:p.getAttribLocation(a,"position"),uv:p.getAttribLocation(a,"uv")},l={uvOffset:p.getUniformLocation(a,"uvOffset"),uvScale:p.getUniformLocation(a,"uvScale"),rotation:p.getUniformLocation(a,"rotation"),scale:p.getUniformLocation(a,"scale"),color:p.getUniformLocation(a,"color"),map:p.getUniformLocation(a,"map"),opacity:p.getUniformLocation(a,"opacity"),modelViewMatrix:p.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:p.getUniformLocation(a,"projectionMatrix"),fogType:p.getUniformLocation(a,"fogType"),fogDensity:p.getUniformLocation(a,"fogDensity"),fogNear:p.getUniformLocation(a,"fogNear"),fogFar:p.getUniformLocation(a,"fogFar"),fogColor:p.getUniformLocation(a,"fogColor"),alphaTest:p.getUniformLocation(a,"alphaTest")};var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=8,n.height=8;var u=n.getContext("2d");u.fillStyle="white",u.fillRect(0,0,8,8),(d=new o(n)).needsUpdate=!0}function n(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}var r,s,a,h,l,d,p=t.context,f=t.state,m=new c,g=new u,y=new c;this.render=function(o,u){if(0!==e.length){void 0===a&&i(),p.useProgram(a),f.initAttributes(),f.enableAttribute(h.position),f.enableAttribute(h.uv),f.disableUnusedAttributes(),f.disable(p.CULL_FACE),f.enable(p.BLEND),p.bindBuffer(p.ARRAY_BUFFER,r),p.vertexAttribPointer(h.position,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(h.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,s),p.uniformMatrix4fv(l.projectionMatrix,!1,u.projectionMatrix.elements),f.activeTexture(p.TEXTURE0),p.uniform1i(l.map,0);var c=0,v=0,b=o.fog;b?(p.uniform3f(l.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(p.uniform1f(l.fogNear,b.near),p.uniform1f(l.fogFar,b.far),p.uniform1i(l.fogType,1),c=1,v=1):b.isFogExp2&&(p.uniform1f(l.fogDensity,b.density),p.uniform1i(l.fogType,2),c=2,v=2)):(p.uniform1i(l.fogType,0),c=0,v=0);for(var x=0,_=e.length;x<_;x++){(T=e[x]).modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,T.matrixWorld),T.z=-T.modelViewMatrix.elements[14]}e.sort(n);var w=[];for(x=0,_=e.length;x<_;x++){var T,S=(T=e[x]).material;if(!1!==S.visible){T.onBeforeRender(t,o,u,void 0,S,void 0),p.uniform1f(l.alphaTest,S.alphaTest),p.uniformMatrix4fv(l.modelViewMatrix,!1,T.modelViewMatrix.elements),T.matrixWorld.decompose(m,g,y),w[0]=y.x,w[1]=y.y;var E=0;o.fog&&S.fog&&(E=v),c!==E&&(p.uniform1i(l.fogType,E),c=E),null!==S.map?(p.uniform2f(l.uvOffset,S.map.offset.x,S.map.offset.y),p.uniform2f(l.uvScale,S.map.repeat.x,S.map.repeat.y)):(p.uniform2f(l.uvOffset,0,0),p.uniform2f(l.uvScale,1,1)),p.uniform1f(l.opacity,S.opacity),p.uniform3f(l.color,S.color.r,S.color.g,S.color.b),p.uniform1f(l.rotation,S.rotation),p.uniform2fv(l.scale,w),f.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst,S.blendEquationAlpha,S.blendSrcAlpha,S.blendDstAlpha,S.premultipliedAlpha),f.buffers.depth.setTest(S.depthTest),f.buffers.depth.setMask(S.depthWrite),S.map?t.setTexture2D(S.map,0):t.setTexture2D(d,0),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),T.onAfterRender(t,o,u,void 0,S,void 0)}}f.enable(p.CULL_FACE),t.resetGLState()}}}function Z(){Object.defineProperty(this,"id",{value:da++}),this.uuid=Js.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=to,this.side=Wr,this.shading=Kr,this.vertexColors=Zr,this.opacity=1,this.transparent=!1,this.blendSrc=mo,this.blendDst=go,this.blendEquation=oo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Eo,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.needsUpdate=!0}function Q(t){Z.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function J(t){Z.call(this),this.type="MeshDepthMaterial",this.depthPacking=Zs,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function $(t,e){this.min=void 0!==t?t:new c(1/0,1/0,1/0),this.max=void 0!==e?e:new c(-1/0,-1/0,-1/0)}function tt(t,e){this.center=void 0!==t?t:new c,this.radius=void 0!==e?e:0}function et(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function it(t,e){this.normal=void 0!==t?t:new c(1,0,0),this.constant=void 0!==e?e:0}function nt(t,e,i,n,r,o){this.planes=[void 0!==t?t:new it,void 0!==e?e:new it,void 0!==i?i:new it,void 0!==n?n:new it,void 0!==r?r:new it,void 0!==o?o:new it]}function rt(t,e,i,n){function o(e,i,n,r){var o=e.geometry,s=null,a=T,h=e.customDepthMaterial;if(n&&(a=S,h=e.customDistanceMaterial),h)s=h;else{var u=!1;i.morphTargets&&(o&&o.isBufferGeometry?u=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0:o&&o.isGeometry&&(u=o.morphTargets&&o.morphTargets.length>0)),e.isSkinnedMesh&&!1===i.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var c=e.isSkinnedMesh&&i.skinning,l=0;u&&(l|=x),c&&(l|=_),s=a[l]}if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var d=s.uuid,p=i.uuid,f=E[d];void 0===f&&(f={},E[d]=f);var m=f[p];void 0===m&&(m=s.clone(),f[p]=m),s=m}s.visible=i.visible,s.wireframe=i.wireframe;var g=i.side;return F.renderSingleSided&&g==qr&&(g=Wr),F.renderReverseSided&&(g===Wr?g=Xr:g===Xr&&(g=Wr)),s.side=g,s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,n&&void 0!==s.uniforms.lightPos&&s.uniforms.lightPos.value.copy(r),s}function h(e,n,r,s){if(!1!==e.visible){if(e.layers.test(n.layers)&&(e.isMesh||e.isLine||e.isPoints)&&e.castShadow&&(!e.frustumCulled||p.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);var a=i.update(e),u=e.material;if(Array.isArray(u))for(var c=a.groups,l=0,d=c.length;l<d;l++){var f=c[l],m=u[f.materialIndex];if(m&&m.visible){var g=o(e,m,s,b);t.renderBufferDirect(r,null,a,g,e,f)}}else if(u.visible){g=o(e,u,s,b);t.renderBufferDirect(r,null,a,g,e,null)}}for(var y=e.children,v=0,x=y.length;v<x;v++)h(y[v],n,r,s)}}var u=t.context,d=t.state,p=new nt,f=new l,m=e.shadows,g=new r,y=new r(n.maxTextureSize,n.maxTextureSize),v=new c,b=new c,x=1,_=2,w=1+(x|_),T=new Array(w),S=new Array(w),E={},C=[new c(1,0,0),new c(-1,0,0),new c(0,0,1),new c(0,0,-1),new c(0,1,0),new c(0,-1,0)],P=[new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,0,1),new c(0,0,-1)],M=[new s,new s,new s,new s,new s,new s],A=new J;A.depthPacking=Qs,A.clipping=!0;for(var R=la.distanceRGBA,L=ua.clone(R.uniforms),O=0;O!==w;++O){var I=0!=(O&x),B=0!=(O&_),k=A.clone();k.morphTargets=I,k.skinning=B,T[O]=k;var D=new Q({defines:{USE_SHADOWMAP:""},uniforms:L,vertexShader:R.vertexShader,fragmentShader:R.fragmentShader,morphTargets:I,skinning:B,clipping:!0});S[O]=D}var F=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Hr,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(e,i){if(!1!==F.enabled&&(!1!==F.autoUpdate||!1!==F.needsUpdate)&&0!==m.length){d.disable(u.BLEND),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var n,r=0,o=m.length;r<o;r++){var s=m[r],c=s.shadow,l=s&&s.isPointLight;if(void 0!==c){var x=c.camera;if(g.copy(c.mapSize),g.min(y),l){var _=g.x,w=g.y;M[0].set(2*_,w,_,w),M[1].set(0,w,_,w),M[2].set(3*_,w,_,w),M[3].set(_,w,_,w),M[4].set(3*_,0,_,w),M[5].set(_,0,_,w),g.x*=4,g.y*=2}if(null===c.map){var T={minFilter:Ko,magFilter:Ko,format:ms};c.map=new a(g.x,g.y,T),c.map.texture.name=s.name+".shadowMap",x.updateProjectionMatrix()}c.isSpotLightShadow&&c.update(s);var S=c.map,E=c.matrix;b.setFromMatrixPosition(s.matrixWorld),x.position.copy(b),l?(n=6,E.makeTranslation(-b.x,-b.y,-b.z)):(n=1,v.setFromMatrixPosition(s.target.matrixWorld),x.lookAt(v),x.updateMatrixWorld(),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(x.projectionMatrix),E.multiply(x.matrixWorldInverse)),t.setRenderTarget(S),t.clear();for(var A=0;A<n;A++){if(l){v.copy(x.position),v.add(C[A]),x.up.copy(P[A]),x.lookAt(v),x.updateMatrixWorld();var R=M[A];d.viewport(R)}f.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),p.setFromMatrix(f),h(e,i,x,l)}}else console.warn("THREE.WebGLShadowMap:",s,"has no shadow.")}var L=t.getClearColor(),O=t.getClearAlpha();t.setClearColor(L,O),F.needsUpdate=!1}}}function ot(t){var e={};return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e[t.uuid]},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var n=e[i.uuid];n&&(t.deleteBuffer(n.buffer),delete e[i.uuid])},update:function(i,n){i.isInterleavedBufferAttribute&&(i=i.data);var r=e[i.uuid];void 0===r?e[i.uuid]=function(e,i){var n=e.array,r=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,o=t.createBuffer();t.bindBuffer(i,o),t.bufferData(i,n,r),e.onUploadCallback();var s=t.FLOAT;return n instanceof Float32Array?s=t.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?s=t.UNSIGNED_SHORT:n instanceof Int16Array?s=t.SHORT:n instanceof Uint32Array?s=t.UNSIGNED_INT:n instanceof Int32Array?s=t.INT:n instanceof Int8Array?s=t.BYTE:n instanceof Uint8Array&&(s=t.UNSIGNED_BYTE),{buffer:o,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(i,n):r.version<i.version&&(function(e,i,n){var r=i.array,o=i.updateRange;t.bindBuffer(n,e),!1===i.dynamic?t.bufferData(n,r,t.STATIC_DRAW):-1===o.count?t.bufferSubData(n,0,r):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1)}(r.buffer,i,n),r.version=i.version)}}}function st(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||st.DefaultOrder}function at(){this.mask=1}function ht(){Object.defineProperty(this,"id",{value:pa++}),this.uuid=Js.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ht.DefaultUp.clone();var t=new c,e=new st,i=new u,n=new c(1,1,1);e.onChange(function(){i.setFromEuler(e,!1)}),i.onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new l},normalMatrix:{value:new et}}),this.matrix=new l,this.matrixWorld=new l,this.matrixAutoUpdate=ht.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new at,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ut(){ht.call(this),this.type="Camera",this.matrixWorldInverse=new l,this.projectionMatrix=new l}function ct(t,e,i,n,r,o){ut.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function lt(t,e,i,n){ut.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function dt(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new c,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new X,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}function pt(){return fa++}function ft(){Object.defineProperty(this,"id",{value:pt()}),this.uuid=Js.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function mt(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=Js.generateUUID(),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function gt(t,e){mt.call(this,new Int8Array(t),e)}function yt(t,e){mt.call(this,new Uint8Array(t),e)}function vt(t,e){mt.call(this,new Uint8ClampedArray(t),e)}function bt(t,e){mt.call(this,new Int16Array(t),e)}function xt(t,e){mt.call(this,new Uint16Array(t),e)}function _t(t,e){mt.call(this,new Int32Array(t),e)}function wt(t,e){mt.call(this,new Uint32Array(t),e)}function Tt(t,e){mt.call(this,new Float32Array(t),e)}function St(t,e){mt.call(this,new Float64Array(t),e)}function Et(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ct(t){if(0===t.length)return-1/0;for(var e=t[0],i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}function Pt(){Object.defineProperty(this,"id",{value:pt()}),this.uuid=Js.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Mt(t,e,i,n,r,o){ft.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new At(t,e,i,n,r,o)),this.mergeVertices()}function At(t,e,i,n,r,o){function s(t,e,i,n,r,o,s,m,g,y,v){var b,x,_=o/g,w=s/y,T=o/2,S=s/2,E=m/2,C=g+1,P=y+1,M=0,A=0,R=new c;for(x=0;x<P;x++){var L=x*w-S;for(b=0;b<C;b++){var O=b*_-T;R[t]=O*n,R[e]=L*r,R[i]=E,u.push(R.x,R.y,R.z),R[t]=0,R[e]=0,R[i]=m>0?1:-1,l.push(R.x,R.y,R.z),d.push(b/g),d.push(1-x/y),M+=1}}for(x=0;x<y;x++)for(b=0;b<g;b++){var I=p+b+C*x,B=p+b+C*(x+1),k=p+(b+1)+C*(x+1),D=p+(b+1)+C*x;h.push(I,B,D),h.push(B,k,D),A+=6}a.addGroup(f,A,v),f+=A,p+=M}Pt.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};var a=this;n=Math.floor(n)||1,r=Math.floor(r)||1;var h=[],u=[],l=[],d=[],p=0,f=0;s("z","y","x",-1,-1,i,e,t,o=Math.floor(o)||1,r,0),s("z","y","x",1,-1,i,e,-t,o,r,1),s("x","z","y",1,1,t,i,e,n,o,2),s("x","z","y",1,-1,t,i,-e,n,o,3),s("x","y","z",1,-1,t,e,i,n,r,4),s("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(h),this.addAttribute("position",new Tt(u,3)),this.addAttribute("normal",new Tt(l,3)),this.addAttribute("uv",new Tt(d,2))}function Rt(t,e,i,n){ft.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new Lt(t,e,i,n)),this.mergeVertices()}function Lt(t,e,i,n){Pt.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};var r,o,s=t/2,a=e/2,h=Math.floor(i)||1,u=Math.floor(n)||1,c=h+1,l=u+1,d=t/h,p=e/u,f=[],m=[],g=[],y=[];for(o=0;o<l;o++){var v=o*p-a;for(r=0;r<c;r++){var b=r*d-s;m.push(b,-v,0),g.push(0,0,1),y.push(r/h),y.push(1-o/u)}}for(o=0;o<u;o++)for(r=0;r<h;r++){var x=r+c*o,_=r+c*(o+1),w=r+1+c*(o+1),T=r+1+c*o;f.push(x,_,T),f.push(_,w,T)}this.setIndex(f),this.addAttribute("position",new Tt(m,3)),this.addAttribute("normal",new Tt(g,3)),this.addAttribute("uv",new Tt(y,2))}function Ot(t){Z.call(this),this.type="MeshBasicMaterial",this.color=new X(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ro,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function It(t,e){this.origin=void 0!==t?t:new c,this.direction=void 0!==e?e:new c}function Bt(t,e){this.start=void 0!==t?t:new c,this.end=void 0!==e?e:new c}function kt(t,e,i){this.a=void 0!==t?t:new c,this.b=void 0!==e?e:new c,this.c=void 0!==i?i:new c}function Dt(t,e){ht.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Pt,this.material=void 0!==e?e:new Ot({color:16777215*Math.random()}),this.drawMode=Ns,this.updateMorphTargets()}function Ft(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Ut(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Nt(){var t={};return{get:function(e,i){var n=e.id+","+i.id,r=t[n];return void 0===r&&(r=new function(){var t=[],e=-1,i=[],n=-1;return{opaque:t,transparent:i,init:function(){e=-1,n=-1},push:function(r,o,s,a,h){var u,c;s.transparent?(u=i,c=++n):(u=t,c=++e);var l=u[c];l?(l.id=r.id,l.object=r,l.geometry=o,l.material=s,l.program=s.program,l.renderOrder=r.renderOrder,l.z=a,l.group=h):(l={id:r.id,object:r,geometry:o,material:s,program:s.program,renderOrder:r.renderOrder,z:a,group:h},u.push(l))},finish:function(){t.length=e+1,i.length=n+1},sort:function(){t.sort(Ft),i.sort(Ut)}}},t[n]=r),r},dispose:function(){t={}}}}function Gt(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(i)),n}function jt(t){switch(t){case Vs:return["Linear","( value )"];case Hs:return["sRGB","( value )"];case Ws:return["RGBE","( value )"];case qs:return["RGBM","( value, 7.0 )"];case Ys:return["RGBM","( value, 16.0 )"];case Ks:return["RGBD","( value, 256.0 )"];case zs:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function Vt(t,e){var i=jt(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Ht(t){return""!==t}function zt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Wt(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(t,e){var i=ca[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Wt(i)})}function Xt(t){return t.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,i,n){for(var r="",o=parseInt(e);o<parseInt(i);o++)r+=n.replace(/\[ i \]/g,"[ "+o+" ]");return r})}function qt(t,e,i,n,r){var o=t.context,s=i.extensions,a=i.defines,h=n.vertexShader,u=n.fragmentShader,c="SHADOWMAP_TYPE_BASIC";r.shadowMapType===Hr?c="SHADOWMAP_TYPE_PCF":r.shadowMapType===zr&&(c="SHADOWMAP_TYPE_PCF_SOFT");var l="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",p="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(i.envMap.mapping){case No:case Go:l="ENVMAP_TYPE_CUBE";break;case zo:case Wo:l="ENVMAP_TYPE_CUBE_UV";break;case jo:case Vo:l="ENVMAP_TYPE_EQUIREC";break;case Ho:l="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case Go:case Vo:d="ENVMAP_MODE_REFRACTION"}switch(i.combine){case Ro:p="ENVMAP_BLENDING_MULTIPLY";break;case Lo:p="ENVMAP_BLENDING_MIX";break;case Oo:p="ENVMAP_BLENDING_ADD"}}var f,m,g=t.gammaFactor>0?t.gammaFactor:1,y=function(t,e,i){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ht).join("\n")}(s,r,t.extensions),v=function(t){var e=[];for(var i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(a),b=o.createProgram();i.isRawShaderMaterial?(f=[v,"\n"].filter(Ht).join("\n"),m=[y,v,"\n"].filter(Ht).join("\n")):(f=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+n.name,v,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+d:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ht).join("\n"),m=[y,"precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+n.name,v,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"","#define GAMMA_FACTOR "+g,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+l:"",r.envMap?"#define "+d:"",r.envMap?"#define "+p:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(r.numClippingPlanes-r.numClipIntersection),r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",r.envMap&&t.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",r.toneMapping!==Io?"#define TONE_MAPPING":"",r.toneMapping!==Io?ca.tonemapping_pars_fragment:"",r.toneMapping!==Io?function(t,e){var i;switch(e){case Bo:i="Linear";break;case ko:i="Reinhard";break;case Do:i="Uncharted2";break;case Fo:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?ca.encodings_pars_fragment:"",r.mapEncoding?Vt("mapTexelToLinear",r.mapEncoding):"",r.envMapEncoding?Vt("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?Vt("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.outputEncoding?function(t,e){var i=jt(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Ht).join("\n")),h=zt(h=Wt(h),r),u=zt(u=Wt(u),r),i.isShaderMaterial||(h=Xt(h),u=Xt(u));var x=f+h,_=m+u,w=Gt(o,o.VERTEX_SHADER,x),T=Gt(o,o.FRAGMENT_SHADER,_);o.attachShader(b,w),o.attachShader(b,T),void 0!==i.index0AttributeName?o.bindAttribLocation(b,0,i.index0AttributeName):!0===r.morphTargets&&o.bindAttribLocation(b,0,"position"),o.linkProgram(b);var S=o.getProgramInfoLog(b),E=o.getShaderInfoLog(w),C=o.getShaderInfoLog(T),P=!0,M=!0;!1===o.getProgramParameter(b,o.LINK_STATUS)?(P=!1,console.error("THREE.WebGLProgram: shader error: ",o.getError(),"gl.VALIDATE_STATUS",o.getProgramParameter(b,o.VALIDATE_STATUS),"gl.getProgramInfoLog",S,E,C)):""!==S?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",S):""!==E&&""!==C||(M=!1),M&&(this.diagnostics={runnable:P,material:i,programLog:S,vertexShader:{log:E,prefix:f},fragmentShader:{log:C,prefix:m}}),o.deleteShader(w),o.deleteShader(T);var A;this.getUniforms=function(){return void 0===A&&(A=new W(o,b,t)),A};var R;return this.getAttributes=function(){return void 0===R&&(R=function(t,e,i){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var s=t.getActiveAttrib(e,o).name;n[s]=t.getAttribLocation(e,s)}return n}(o,b)),R},this.destroy=function(){o.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=ma++,this.code=e,this.usedTimes=1,this.program=b,this.vertexShader=w,this.fragmentShader=T,this}function Yt(t,e){function i(t,e){var i;return t?t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=t.texture.encoding):i=Vs,i===Vs&&e&&(i=zs),i}var n=[],r={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(n,o,s,a,h,u){var c=r[n.type],l=u.isSkinnedMesh?function(t){var i=t.skeleton.bones;if(e.floatVertexTextures)return 1024;var n=e.maxVertexUniforms,r=Math.floor((n-20)/4),o=Math.min(r,i.length);return o<i.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+i.length+" bones. This GPU supports "+o+"."),0):o}(u):0,d=t.getPrecision();null!==n.precision&&(d=e.getMaxPrecision(n.precision))!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",d,"instead.");var p=t.getRenderTarget();return{shaderID:c,precision:d,supportsVertexTextures:e.vertexTextures,outputEncoding:i(p?p.texture:null,t.gammaOutput),map:!!n.map,mapEncoding:i(n.map,t.gammaInput),envMap:!!n.envMap,envMapMode:n.envMap&&n.envMap.mapping,envMapEncoding:i(n.envMap,t.gammaInput),envMapCubeUV:!!n.envMap&&(n.envMap.mapping===zo||n.envMap.mapping===Wo),lightMap:!!n.lightMap,aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:i(n.emissiveMap,t.gammaInput),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,combine:n.combine,vertexColors:n.vertexColors,fog:!!s,useFog:n.fog,fogExp:s&&s.isFogExp2,flatShading:n.shading===Yr,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:e.logarithmicDepthBuffer,skinning:n.skinning&&l>0,maxBones:l,useVertexTexture:e.floatVertexTextures,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numClippingPlanes:a,numClipIntersection:h,dithering:n.dithering,shadowMapEnabled:t.shadowMap.enabled&&u.receiveShadow&&o.shadows.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:n.side===qr,flipSided:n.side===Xr,depthPacking:void 0!==n.depthPacking&&n.depthPacking}},this.getProgramCode=function(e,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);for(var s=0;s<o.length;s++)n.push(i[o[s]]);return n.push(e.onBeforeCompile.toString()),n.push(t.gammaOutput),n.join()},this.acquireProgram=function(e,i,r,o){for(var s,a=0,h=n.length;a<h;a++){var u=n[a];if(u.code===o){++(s=u).usedTimes;break}}return void 0===s&&(s=new qt(t,o,e,i,r),n.push(s)),s},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function Kt(t,e,i,n,r,o,s){function a(t,e){if(t.width>e||t.height>e){var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i);return n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function h(t){return Js.isPowerOfTwo(t.width)&&Js.isPowerOfTwo(t.height)}function u(t,e){return t.generateMipmaps&&e&&t.minFilter!==Ko&&t.minFilter!==Jo}function c(e){return e===Ko||e===Zo||e===Qo?t.NEAREST:t.LINEAR}function l(e){var i=e.target;i.removeEventListener("dispose",l),function(e){var i=n.get(e);if(e.image&&i.__image__webglTextureCube)t.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture)}n.remove(e)}(i),s.textures--}function d(e){var i=e.target;i.removeEventListener("dispose",d),function(e){var i=n.get(e),r=n.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var o=0;o<6;o++)t.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[o]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer);n.remove(e.texture),n.remove(e)}(i),s.textures--}function p(e,c){var d=n.get(e);if(e.version>0&&d.__version!==e.version){var p=e.image;if(void 0===p)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else{if(!1!==p.complete)return void function(e,n,c){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",l),e.__webglTexture=t.createTexture(),s.textures++);i.activeTexture(t.TEXTURE0+c),i.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment);var d=a(n.image,r.maxTextureSize);(function(t){return t.wrapS!==qo||t.wrapT!==qo||t.minFilter!==Ko&&t.minFilter!==Jo})(n)&&!1===h(d)&&(d=function(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.width=Js.nearestPowerOfTwo(t.width),e.height=Js.nearestPowerOfTwo(t.height),e.getContext("2d").drawImage(t,0,0,e.width,e.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}(d));var p=h(d),m=o(n.format),g=o(n.type);f(t.TEXTURE_2D,n,p);var y,b=n.mipmaps;if(n.isDepthTexture){var x=t.DEPTH_COMPONENT;if(n.type===as){if(!v)throw new Error("Float Depth Texture only supported in WebGL2.0");x=t.DEPTH_COMPONENT32F}else v&&(x=t.DEPTH_COMPONENT16);n.format===bs&&x===t.DEPTH_COMPONENT&&n.type!==rs&&n.type!==ss&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=rs,g=o(n.type)),n.format===xs&&(x=t.DEPTH_STENCIL,n.type!==ds&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=ds,g=o(n.type))),i.texImage2D(t.TEXTURE_2D,0,x,d.width,d.height,0,m,g,null)}else if(n.isDataTexture)if(b.length>0&&p){for(var _=0,w=b.length;_<w;_++)y=b[_],i.texImage2D(t.TEXTURE_2D,_,m,y.width,y.height,0,m,g,y.data);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,m,d.width,d.height,0,m,g,d.data);else if(n.isCompressedTexture)for(var _=0,w=b.length;_<w;_++)y=b[_],n.format!==ms&&n.format!==fs?i.getCompressedTextureFormats().indexOf(m)>-1?i.compressedTexImage2D(t.TEXTURE_2D,_,m,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(t.TEXTURE_2D,_,m,y.width,y.height,0,m,g,y.data);else if(b.length>0&&p){for(var _=0,w=b.length;_<w;_++)y=b[_],i.texImage2D(t.TEXTURE_2D,_,m,m,g,y);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,m,m,g,d);u(n,p)&&t.generateMipmap(t.TEXTURE_2D);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(d,e,c);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e)}}i.activeTexture(t.TEXTURE0+c),i.bindTexture(t.TEXTURE_2D,d.__webglTexture)}function f(i,s,a){var h;if(a?(t.texParameteri(i,t.TEXTURE_WRAP_S,o(s.wrapS)),t.texParameteri(i,t.TEXTURE_WRAP_T,o(s.wrapT)),t.texParameteri(i,t.TEXTURE_MAG_FILTER,o(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,o(s.minFilter))):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s.wrapS===qo&&s.wrapT===qo||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),t.texParameteri(i,t.TEXTURE_MAG_FILTER,c(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,c(s.minFilter)),s.minFilter!==Ko&&s.minFilter!==Jo&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),h=e.get("EXT_texture_filter_anisotropic")){if(s.type===as&&null===e.get("OES_texture_float_linear"))return;if(s.type===hs&&null===e.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function m(e,r,s,a){var h=o(r.texture.format),u=o(r.texture.type);i.texImage2D(a,0,h,r.width,r.height,0,h,u,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,s,a,n.get(r.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function g(e,i){t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):i.depthBuffer&&i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,i.width,i.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}function y(e){var i=n.get(e),r=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported!");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),p(i.depthTexture,0);var r=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===bs)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0);else{if(i.depthTexture.format!==xs)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0)}}(i.__webglFramebuffer,e)}else if(r){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=t.createRenderbuffer(),g(i.__webglDepthbuffer[o],e)}else t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),g(i.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}var v="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext;this.setTexture2D=p,this.setTextureCube=function(e,c){var d=n.get(e);if(6===e.image.length)if(e.version>0&&d.__version!==e.version){d.__image__webglTextureCube||(e.addEventListener("dispose",l),d.__image__webglTextureCube=t.createTexture(),s.textures++),i.activeTexture(t.TEXTURE0+c),i.bindTexture(t.TEXTURE_CUBE_MAP,d.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var p=e&&e.isCompressedTexture,m=e.image[0]&&e.image[0].isDataTexture,g=[],y=0;y<6;y++)g[y]=p||m?m?e.image[y].image:e.image[y]:a(e.image[y],r.maxCubemapSize);var v=h(g[0]),b=o(e.format),x=o(e.type);for(f(t.TEXTURE_CUBE_MAP,e,v),y=0;y<6;y++)if(p)for(var _,w=g[y].mipmaps,T=0,S=w.length;T<S;T++)_=w[T],e.format!==ms&&e.format!==fs?i.getCompressedTextureFormats().indexOf(b)>-1?i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+y,T,b,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+y,T,b,_.width,_.height,0,b,x,_.data);else m?i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,b,g[y].width,g[y].height,0,b,x,g[y].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,b,b,x,g[y]);u(e,v)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),d.__version=e.version,e.onUpdate&&e.onUpdate(e)}else i.activeTexture(t.TEXTURE0+c),i.bindTexture(t.TEXTURE_CUBE_MAP,d.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,r){i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,n.get(e).__webglTexture)},this.setupRenderTarget=function(e){var r=n.get(e),o=n.get(e.texture);e.addEventListener("dispose",d),o.__webglTexture=t.createTexture(),s.textures++;var a=!0===e.isWebGLRenderTargetCube,c=h(e);if(a){r.__webglFramebuffer=[];for(var l=0;l<6;l++)r.__webglFramebuffer[l]=t.createFramebuffer()}else r.__webglFramebuffer=t.createFramebuffer();if(a){for(i.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture),f(t.TEXTURE_CUBE_MAP,e.texture,c),l=0;l<6;l++)m(r.__webglFramebuffer[l],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+l);u(e.texture,c)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),i.bindTexture(t.TEXTURE_CUBE_MAP,null)}else i.bindTexture(t.TEXTURE_2D,o.__webglTexture),f(t.TEXTURE_2D,e.texture,c),m(r.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),u(e.texture,c)&&t.generateMipmap(t.TEXTURE_2D),i.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&y(e)},this.updateRenderTargetMipmap=function(e){var r=e.texture;if(u(r,h(e))){var o=e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(r).__webglTexture;i.bindTexture(o,s),t.generateMipmap(o),i.bindTexture(o,null)}}}function Zt(t){lt.call(this),this.cameras=t||[]}function Qt(t){function e(){return null===U?st:1}function i(){Bt.init(),Bt.scissor(z.copy(at).multiplyScalar(st)),Bt.viewport(Z.copy(ut).multiplyScalar(st))}function n(){F=null,V=null,j="",G=-1,Bt.reset()}function o(t){t.preventDefault(),n(),i(),kt.clear(),jt.clear()}function a(t){var e=t.target;e.removeEventListener("dispose",a),function(t){h(t),kt.remove(t)}(e)}function h(t){var e=kt.get(t).program;t.program=void 0,void 0!==e&&Vt.releaseProgram(e)}function u(t,e){return Math.abs(e[0])-Math.abs(t[0])}function p(t,e,i){if(t.visible){if(t.layers.test(e.layers))if(t.isLight)L.push(t);else if(t.isSprite)t.frustumCulled&&!dt.intersectsSprite(t)||B.push(t);else if(t.isLensFlare)k.push(t);else if(t.isImmediateRenderObject)i&&yt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(gt),O.push(t,null,t.material,yt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||dt.intersectsObject(t))){i&&yt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(gt);var n=jt.update(t),r=t.material;if(Array.isArray(r))for(var o=n.groups,s=0,a=o.length;s<a;s++){var h=o[s],u=r[h.materialIndex];u&&u.visible&&O.push(t,n,u,yt.z,h)}else r.visible&&O.push(t,n,r,yt.z,null)}var c=t.children;for(s=0,a=c.length;s<a;s++)p(c[s],e,i)}}function f(t,e,i,n){for(var r=0,o=t.length;r<o;r++){var s=t[r],a=s.object,h=s.geometry,u=void 0===n?s.material:n,c=s.group;if(i.isArrayCamera){H=i;for(var l=i.cameras,d=0,p=l.length;d<p;d++){var f=l[d];if(a.layers.test(f.layers)){var g=f.bounds,y=g.x*$,v=g.y*tt,b=g.z*$,x=g.w*tt;D.setViewport(y,v,b,x),D.setScissor(y,v,b,x),D.setScissorTest(!0),m(a,e,f,h,u,c)}}}else H=null,m(a,e,i,h,u,c)}}function m(t,e,i,n,r,o){if(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.onBeforeRender(D,e,i,n,r,o),t.isImmediateRenderObject){Bt.setMaterial(r);var s=y(i,e.fog,r,t);j="",function(t,e,i){t.render(function(t){D.renderBufferImmediate(t,e,i)})}(t,s,r)}else D.renderBufferDirect(i,e.fog,n,r,t,o);t.onAfterRender(D,e,i,n,r,o)}function g(t,e,i){var n=kt.get(t),r=Vt.getParameters(t,_t,e,pt.numPlanes,pt.numIntersection,i),o=Vt.getProgramCode(t,r),s=n.program,u=!0;if(void 0===s)t.addEventListener("dispose",a);else if(s.code!==o)h(t);else{if(void 0!==r.shaderID)return;u=!1}if(u){if(r.shaderID){var c=la[r.shaderID];n.shader={name:t.type,uniforms:ua.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader),s=Vt.acquireProgram(t,n.shader,r,o),n.program=s,t.program=s}var l=s.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var d=0;d<D.maxMorphTargets;d++)l["morphTarget"+d]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(d=0;d<D.maxMorphNormals;d++)l["morphNormal"+d]>=0&&t.numSupportedMorphNormals++}var p=n.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=pt.numPlanes,n.numIntersection=pt.numIntersection,p.clippingPlanes=pt.uniform),n.fog=e,n.lightsHash=_t.hash,t.lights&&(p.ambientLightColor.value=_t.ambient,p.directionalLights.value=_t.directional,p.spotLights.value=_t.spot,p.rectAreaLights.value=_t.rectArea,p.pointLights.value=_t.point,p.hemisphereLights.value=_t.hemi,p.directionalShadowMap.value=_t.directionalShadowMap,p.directionalShadowMatrix.value=_t.directionalShadowMatrix,p.spotShadowMap.value=_t.spotShadowMap,p.spotShadowMatrix.value=_t.spotShadowMatrix,p.pointShadowMap.value=_t.pointShadowMap,p.pointShadowMatrix.value=_t.pointShadowMatrix);var f=n.program.getUniforms(),m=W.seqWithValue(f.seq,p);n.uniformsList=m}function y(t,e,i,n){J=0;var r=kt.get(i);if(ft&&(mt||t!==V)){var o=t===V&&i.id===G;pt.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,r,o)}!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==e?i.needsUpdate=!0:i.lights&&r.lightsHash!==_t.hash?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===pt.numPlanes&&r.numIntersection===pt.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(g(i,e,n),i.needsUpdate=!1);var s=!1,a=!1,h=!1,u=r.program,c=u.getUniforms(),l=r.shader.uniforms;if(u.id!==F&&(Et.useProgram(u.program),F=u.id,s=!0,a=!0,h=!0),i.id!==G&&(G=i.id,a=!0),s||t!==V){if(c.setValue(Et,"projectionMatrix",t.projectionMatrix),It.logarithmicDepthBuffer&&c.setValue(Et,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),V!==(H||t)&&(V=H||t,a=!0,h=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var p=c.map.cameraPosition;void 0!==p&&p.setValue(Et,yt.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&c.setValue(Et,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){c.setOptional(Et,n,"bindMatrix"),c.setOptional(Et,n,"bindMatrixInverse");var f=n.skeleton;if(f){var m=f.bones;if(It.floatVertexTextures){if(void 0===f.boneTexture){var y=Math.sqrt(4*m.length);y=Js.nextPowerOfTwo(Math.ceil(y)),y=Math.max(y,4);var _=new Float32Array(y*y*4);_.set(f.boneMatrices);var w=new d(_,y,y,ms,as);f.boneMatrices=_,f.boneTexture=w,f.boneTextureSize=y}c.setValue(Et,"boneTexture",f.boneTexture),c.setValue(Et,"boneTextureSize",f.boneTextureSize)}else c.setOptional(Et,f,"boneMatrices")}}return a&&(c.setValue(Et,"toneMappingExposure",D.toneMappingExposure),c.setValue(Et,"toneMappingWhitePoint",D.toneMappingWhitePoint),i.lights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLights.needsUpdate=e,t.pointLights.needsUpdate=e,t.spotLights.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(l,h),e&&i.fog&&function(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(l,e),(i.isMeshBasicMaterial||i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.isMeshNormalMaterial||i.isMeshDepthMaterial)&&function(t,e){t.opacity.value=e.opacity,t.diffuse.value=e.color,e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity);t.map.value=e.map,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity);e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);var i;e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap);if(void 0!==i){i.isWebGLRenderTarget&&(i=i.texture);var n=i.offset,r=i.repeat;t.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio}(l,i),i.isLineBasicMaterial?v(l,i):i.isLineDashedMaterial?(v(l,i),function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(l,i)):i.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*st,t.scale.value=.5*tt,t.map.value=e.map,null!==e.map){var i=e.map.offset,n=e.map.repeat;t.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}}(l,i):i.isMeshLambertMaterial?function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(l,i):i.isMeshToonMaterial?function(t,e){b(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(l,i):i.isMeshPhongMaterial?b(l,i):i.isMeshPhysicalMaterial?function(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,x(t,e)}(l,i):i.isMeshStandardMaterial?x(l,i):i.isMeshDepthMaterial?i.displacementMap&&(l.displacementMap.value=i.displacementMap,l.displacementScale.value=i.displacementScale,l.displacementBias.value=i.displacementBias):i.isMeshNormalMaterial&&function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(l,i),void 0!==l.ltcMat&&(l.ltcMat.value=ha.LTC_MAT_TEXTURE),void 0!==l.ltcMag&&(l.ltcMag.value=ha.LTC_MAG_TEXTURE),W.upload(Et,r.uniformsList,l,D)),c.setValue(Et,"modelViewMatrix",n.modelViewMatrix),c.setValue(Et,"normalMatrix",n.normalMatrix),c.setValue(Et,"modelMatrix",n.matrixWorld),u}function v(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function b(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function x(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function _(t,e){var i,n,r,o,s,a,h,u,c=0,l=0,d=0,p=e.matrixWorldInverse,f=0,m=0,g=0,y=0,v=0;for(i=0,n=t.length;i<n;i++)if(r=t[i],s=r.color,a=r.intensity,h=r.distance,u=r.shadow&&r.shadow.map?r.shadow.map.texture:null,r.isAmbientLight)c+=s.r*a,l+=s.g*a,d+=s.b*a;else if(r.isDirectionalLight){(b=Ht.get(r)).color.copy(r.color).multiplyScalar(r.intensity),b.direction.setFromMatrixPosition(r.matrixWorld),yt.setFromMatrixPosition(r.target.matrixWorld),b.direction.sub(yt),b.direction.transformDirection(p),b.shadow=r.castShadow,r.castShadow&&(o=r.shadow,b.shadowBias=o.bias,b.shadowRadius=o.radius,b.shadowMapSize=o.mapSize),_t.directionalShadowMap[f]=u,_t.directionalShadowMatrix[f]=r.shadow.matrix,_t.directional[f]=b,f++}else if(r.isSpotLight){(b=Ht.get(r)).position.setFromMatrixPosition(r.matrixWorld),b.position.applyMatrix4(p),b.color.copy(s).multiplyScalar(a),b.distance=h,b.direction.setFromMatrixPosition(r.matrixWorld),yt.setFromMatrixPosition(r.target.matrixWorld),b.direction.sub(yt),b.direction.transformDirection(p),b.coneCos=Math.cos(r.angle),b.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),b.decay=0===r.distance?0:r.decay,b.shadow=r.castShadow,r.castShadow&&(o=r.shadow,b.shadowBias=o.bias,b.shadowRadius=o.radius,b.shadowMapSize=o.mapSize),_t.spotShadowMap[g]=u,_t.spotShadowMatrix[g]=r.shadow.matrix,_t.spot[g]=b,g++}else if(r.isRectAreaLight){(b=Ht.get(r)).color.copy(s).multiplyScalar(a/(r.width*r.height)),b.position.setFromMatrixPosition(r.matrixWorld),b.position.applyMatrix4(p),bt.identity(),vt.copy(r.matrixWorld),vt.premultiply(p),bt.extractRotation(vt),b.halfWidth.set(.5*r.width,0,0),b.halfHeight.set(0,.5*r.height,0),b.halfWidth.applyMatrix4(bt),b.halfHeight.applyMatrix4(bt),_t.rectArea[y]=b,y++}else if(r.isPointLight){(b=Ht.get(r)).position.setFromMatrixPosition(r.matrixWorld),b.position.applyMatrix4(p),b.color.copy(r.color).multiplyScalar(r.intensity),b.distance=r.distance,b.decay=0===r.distance?0:r.decay,b.shadow=r.castShadow,r.castShadow&&(o=r.shadow,b.shadowBias=o.bias,b.shadowRadius=o.radius,b.shadowMapSize=o.mapSize),_t.pointShadowMap[m]=u,_t.pointShadowMatrix[m]=r.shadow.matrix,_t.point[m]=b,m++}else if(r.isHemisphereLight){var b;(b=Ht.get(r)).direction.setFromMatrixPosition(r.matrixWorld),b.direction.transformDirection(p),b.direction.normalize(),b.skyColor.copy(r.color).multiplyScalar(a),b.groundColor.copy(r.groundColor).multiplyScalar(a),_t.hemi[v]=b,v++}_t.ambient[0]=c,_t.ambient[1]=l,_t.ambient[2]=d,_t.directional.length=f,_t.spot.length=g,_t.rectArea.length=y,_t.point.length=m,_t.hemi.length=v,_t.hash=f+","+m+","+g+","+y+","+v+","+_t.shadows.length}function w(t){var e;if(t===Xo)return Et.REPEAT;if(t===qo)return Et.CLAMP_TO_EDGE;if(t===Yo)return Et.MIRRORED_REPEAT;if(t===Ko)return Et.NEAREST;if(t===Zo)return Et.NEAREST_MIPMAP_NEAREST;if(t===Qo)return Et.NEAREST_MIPMAP_LINEAR;if(t===Jo)return Et.LINEAR;if(t===$o)return Et.LINEAR_MIPMAP_NEAREST;if(t===ts)return Et.LINEAR_MIPMAP_LINEAR;if(t===es)return Et.UNSIGNED_BYTE;if(t===us)return Et.UNSIGNED_SHORT_4_4_4_4;if(t===cs)return Et.UNSIGNED_SHORT_5_5_5_1;if(t===ls)return Et.UNSIGNED_SHORT_5_6_5;if(t===is)return Et.BYTE;if(t===ns)return Et.SHORT;if(t===rs)return Et.UNSIGNED_SHORT;if(t===os)return Et.INT;if(t===ss)return Et.UNSIGNED_INT;if(t===as)return Et.FLOAT;if(t===hs&&null!==(e=Rt.get("OES_texture_half_float")))return e.HALF_FLOAT_OES;if(t===ps)return Et.ALPHA;if(t===fs)return Et.RGB;if(t===ms)return Et.RGBA;if(t===gs)return Et.LUMINANCE;if(t===ys)return Et.LUMINANCE_ALPHA;if(t===bs)return Et.DEPTH_COMPONENT;if(t===xs)return Et.DEPTH_STENCIL;if(t===oo)return Et.FUNC_ADD;if(t===so)return Et.FUNC_SUBTRACT;if(t===ao)return Et.FUNC_REVERSE_SUBTRACT;if(t===co)return Et.ZERO;if(t===lo)return Et.ONE;if(t===po)return Et.SRC_COLOR;if(t===fo)return Et.ONE_MINUS_SRC_COLOR;if(t===mo)return Et.SRC_ALPHA;if(t===go)return Et.ONE_MINUS_SRC_ALPHA;if(t===yo)return Et.DST_ALPHA;if(t===vo)return Et.ONE_MINUS_DST_ALPHA;if(t===bo)return Et.DST_COLOR;if(t===xo)return Et.ONE_MINUS_DST_COLOR;if(t===_o)return Et.SRC_ALPHA_SATURATE;if((t===_s||t===ws||t===Ts||t===Ss)&&null!==(e=Rt.get("WEBGL_compressed_texture_s3tc"))){if(t===_s)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===ws)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Ts)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Ss)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((t===Es||t===Cs||t===Ps||t===Ms)&&null!==(e=Rt.get("WEBGL_compressed_texture_pvrtc"))){if(t===Es)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Cs)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Ps)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Ms)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===As&&null!==(e=Rt.get("WEBGL_compressed_texture_etc1")))return e.COMPRESSED_RGB_ETC1_WEBGL;if((t===ho||t===uo)&&null!==(e=Rt.get("EXT_blend_minmax"))){if(t===ho)return e.MIN_EXT;if(t===uo)return e.MAX_EXT}return t===ds&&null!==(e=Rt.get("WEBGL_depth_texture"))?e.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer",Br);var T=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),S=void 0!==t.context?t.context:null,E=void 0!==t.alpha&&t.alpha,C=void 0===t.depth||t.depth,P=void 0===t.stencil||t.stencil,M=void 0!==t.antialias&&t.antialias,A=void 0===t.premultipliedAlpha||t.premultipliedAlpha,R=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,L=[],O=null,I=new Float32Array(8),B=[],k=[];this.domElement=T,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Bo,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var D=this,F=null,U=null,N=null,G=-1,j="",V=null,H=null,z=new s,q=null,Z=new s,J=0,$=T.width,tt=T.height,st=1,at=new s(0,0,$,tt),ht=!1,ut=new s(0,0,$,tt),dt=new nt,pt=new function(){function t(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),i.numPlanes=r,i.numIntersection=0}function e(t,e,n,r){var o=null!==t?t.length:0,s=null;if(0!==o){if(s=u.value,!0!==r||null===s){var c=n+4*o,l=e.matrixWorldInverse;h.getNormalMatrix(l),(null===s||s.length<c)&&(s=new Float32Array(c));for(var d=0,p=n;d!==o;++d,p+=4)a.copy(t[d]).applyMatrix4(l,h),a.normal.toArray(s,p),s[p+3]=a.constant}u.value=s,u.needsUpdate=!0}return i.numPlanes=o,s}var i=this,n=null,r=0,o=!1,s=!1,a=new it,h=new et,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,s){var a=0!==t.length||i||0!==r||o;return o=i,n=e(t,s,0),r=t.length,a},this.beginShadows=function(){s=!0,e(null)},this.endShadows=function(){s=!1,t()},this.setState=function(i,a,h,c,l,d){if(!o||null===i||0===i.length||s&&!h)s?e(null):t();else{var p=s?0:r,f=4*p,m=l.clippingState||null;u.value=m,m=e(i,c,f,d);for(var g=0;g!==f;++g)m[g]=n[g];l.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=p}}},ft=!1,mt=!1,gt=new l,yt=new c,vt=new l,bt=new l,_t={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},Tt={geometries:0,textures:0},St={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:St,memory:Tt,programs:null};var Et;try{var Mt={alpha:E,depth:C,stencil:P,antialias:M,premultipliedAlpha:A,preserveDrawingBuffer:R};if(null===(Et=S||T.getContext("webgl",Mt)||T.getContext("experimental-webgl",Mt)))throw null!==T.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Et.getShaderPrecisionFormat&&(Et.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),T.addEventListener("webglcontextlost",o,!1)}catch(t){console.error("THREE.WebGLRenderer: "+t)}var Rt=new function(t){var e={};return{get:function(i){if(void 0!==e[i])return e[i];var n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=t.getExtension("WEBGL_compressed_texture_etc1");break;default:n=t.getExtension(i)}return null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),e[i]=n,n}}}(Et);Rt.get("WEBGL_depth_texture"),Rt.get("OES_texture_float"),Rt.get("OES_texture_float_linear"),Rt.get("OES_texture_half_float"),Rt.get("OES_texture_half_float_linear"),Rt.get("OES_standard_derivatives"),Rt.get("ANGLE_instanced_arrays"),Rt.get("OES_element_index_uint")&&(Pt.MaxIndex=4294967296);var It=new function(t,e,i){function n(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var r,o=void 0!==i.precision?i.precision:"highp",s=n(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var a=!0===i.logarithmicDepthBuffer&&!!e.get("EXT_frag_depth"),h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_TEXTURE_SIZE),l=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),d=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),f=t.getParameter(t.MAX_VARYING_VECTORS),m=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),g=u>0,y=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==r)return r;var i=e.get("EXT_texture_filter_anisotropic");return r=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:a,maxTextures:h,maxVertexTextures:u,maxTextureSize:c,maxCubemapSize:l,maxAttributes:d,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y}}(Et,Rt,t),Bt=new function(t,e,i){function n(e,i,n){var r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var s=0;s<n;s++)t.texImage2D(i+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return o}function r(e){!0!==b[e]&&(t.enable(e),b[e]=!0)}function o(e){!1!==b[e]&&(t.disable(e),b[e]=!1)}function a(e,n,s,a,h,u,c,l){e!==$r?r(t.BLEND):o(t.BLEND),e===ro||e===_&&l===M||(e===eo?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):e===io?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):e===no?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),_=e,M=l),e===ro?(h=h||n,u=u||s,c=c||a,n===w&&h===E||(t.blendEquationSeparate(i(n),i(h)),w=n,E=h),s===T&&a===S&&u===C&&c===P||(t.blendFuncSeparate(i(s),i(a),i(u),i(c)),T=s,S=a,C=u,P=c)):(w=null,T=null,S=null,E=null,C=null,P=null)}function h(e){A!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),A=e)}function u(e){e!==Dr?(r(t.CULL_FACE),e!==R&&(e===Fr?t.cullFace(t.BACK):e===Ur?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):o(t.CULL_FACE),R=e}function c(e,i,n){e?(r(t.POLYGON_OFFSET_FILL),O===i&&I===n||(t.polygonOffset(i,n),O=i,I=n)):o(t.POLYGON_OFFSET_FILL)}function l(e){void 0===e&&(e=t.TEXTURE0+k-1),U!==e&&(t.activeTexture(e),U=e)}var d=new function(){var e=!1,i=new s,n=null,r=new s;return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,o,s,a){!0===a&&(e*=s,n*=s,o*=s),i.set(e,n,o,s),!1===r.equals(i)&&(t.clearColor(e,n,o,s),r.copy(i))},reset:function(){e=!1,n=null,r.set(0,0,0,1)}}},p=new function(){var e=!1,i=null,n=null,s=null;return{setTest:function(e){e?r(t.DEPTH_TEST):o(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case wo:t.depthFunc(t.NEVER);break;case To:t.depthFunc(t.ALWAYS);break;case So:t.depthFunc(t.LESS);break;case Eo:t.depthFunc(t.LEQUAL);break;case Co:t.depthFunc(t.EQUAL);break;case Po:t.depthFunc(t.GEQUAL);break;case Mo:t.depthFunc(t.GREATER);break;case Ao:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){s!==e&&(t.clearDepth(e),s=e)},reset:function(){e=!1,i=null,n=null,s=null}}},f=new function(){var e=!1,i=null,n=null,s=null,a=null,h=null,u=null,c=null,l=null;return{setTest:function(e){e?r(t.STENCIL_TEST):o(t.STENCIL_TEST)},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,r){n===e&&s===i&&a===r||(t.stencilFunc(e,i,r),n=e,s=i,a=r)},setOp:function(e,i,n){h===e&&u===i&&c===n||(t.stencilOp(e,i,n),h=e,u=i,c=n)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,i=null,n=null,s=null,a=null,h=null,u=null,c=null,l=null}}},m=t.getParameter(t.MAX_VERTEX_ATTRIBS),g=new Uint8Array(m),y=new Uint8Array(m),v=new Uint8Array(m),b={},x=null,_=null,w=null,T=null,S=null,E=null,C=null,P=null,M=!1,A=null,R=null,L=null,O=null,I=null,B=null,k=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),D=parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),F=parseFloat(D)>=1,U=null,N={},G=new s,j=new s,V={};return V[t.TEXTURE_2D]=n(t.TEXTURE_2D,t.TEXTURE_2D,1),V[t.TEXTURE_CUBE_MAP]=n(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:d,depth:p,stencil:f},init:function(){d.setClear(0,0,0,1),p.setClear(1),f.setClear(0),r(t.DEPTH_TEST),p.setFunc(Eo),h(!1),u(Fr),r(t.CULL_FACE),r(t.BLEND),a(to)},initAttributes:function(){for(var t=0,e=g.length;t<e;t++)g[t]=0},enableAttribute:function(i){g[i]=1,0===y[i]&&(t.enableVertexAttribArray(i),y[i]=1),0!==v[i]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),v[i]=0)},enableAttributeAndDivisor:function(i,n){g[i]=1,0===y[i]&&(t.enableVertexAttribArray(i),y[i]=1),v[i]!==n&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,n),v[i]=n)},disableUnusedAttributes:function(){for(var e=0,i=y.length;e!==i;++e)y[e]!==g[e]&&(t.disableVertexAttribArray(e),y[e]=0)},enable:r,disable:o,getCompressedTextureFormats:function(){if(null===x&&(x=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var i=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<i.length;n++)x.push(i[n]);return x},setBlending:a,setMaterial:function(e){e.side===qr?o(t.CULL_FACE):r(t.CULL_FACE),h(e.side===Xr),!0===e.transparent?a(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):a($r),p.setFunc(e.depthFunc),p.setTest(e.depthTest),p.setMask(e.depthWrite),d.setMask(e.colorWrite),c(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:h,setCullFace:u,setLineWidth:function(e){e!==L&&(F&&t.lineWidth(e),L=e)},setPolygonOffset:c,getScissorTest:function(){return B},setScissorTest:function(e){B=e,e?r(t.SCISSOR_TEST):o(t.SCISSOR_TEST)},activeTexture:l,bindTexture:function(e,i){null===U&&l();var n=N[U];void 0===n&&(n={type:void 0,texture:void 0},N[U]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||V[e]),n.type=e,n.texture=i)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===G.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),G.copy(e))},viewport:function(e){!1===j.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),j.copy(e))},reset:function(){for(var e=0;e<y.length;e++)1===y[e]&&(t.disableVertexAttribArray(e),y[e]=0);b={},x=null,U=null,N={},_=null,A=null,R=null,d.reset(),p.reset(),f.reset()}}}(Et,Rt,w),kt=new function(){var t={};return{get:function(e){var i=e.uuid,n=t[i];return void 0===n&&(n={},t[i]=n),n},remove:function(e){delete t[e.uuid]},clear:function(){t={}}}},Ft=new Kt(Et,Rt,Bt,kt,It,w,Tt),Ut=new ot(Et),Gt=new function(t,e,i){function n(t){var s=t.target,a=r[s.id];null!==a.index&&e.remove(a.index);for(var h in a.attributes)e.remove(a.attributes[h]);s.removeEventListener("dispose",n),delete r[s.id];var u=o[s.id];u&&(e.remove(u),delete o[s.id]),(u=o[a.id])&&(e.remove(u),delete o[a.id]),i.geometries--}var r={},o={};return{get:function(t,e){var o=r[e.id];return o||(e.addEventListener("dispose",n),e.isBufferGeometry?o=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Pt).setFromObject(t)),o=e._bufferGeometry),r[e.id]=o,i.geometries++,o)},update:function(i){var n=i.index,r=i.attributes;null!==n&&e.update(n,t.ELEMENT_ARRAY_BUFFER);for(var o in r)e.update(r[o],t.ARRAY_BUFFER);var s=i.morphAttributes;for(var o in s)for(var a=s[o],h=0,u=a.length;h<u;h++)e.update(a[h],t.ARRAY_BUFFER)},getWireframeAttribute:function(i){var n=o[i.id];if(n)return n;var r=[],s=i.index,a=i.attributes;if(null!==s)for(var h=0,u=(p=s.array).length;h<u;h+=3){var c=p[h+0],l=p[h+1],d=p[h+2];r.push(c,l,l,d,d,c)}else{var p;for(h=0,u=(p=a.position.array).length/3-1;h<u;h+=3)c=h+0,l=h+1,d=h+2,r.push(c,l,l,d,d,c)}return n=new(Ct(r)>65535?wt:xt)(r,1),e.update(n,t.ELEMENT_ARRAY_BUFFER),o[i.id]=n,n}}}(Et,Ut,Tt),jt=new function(t,e,i){var n={};return{update:function(t){var r=i.frame,o=t.geometry,s=e.get(t,o);return n[s.id]!==r&&(o.isGeometry&&s.updateFromObject(t),e.update(s),n[s.id]=r),s},clear:function(){n={}}}}(Et,Gt,St),Vt=new Yt(this,It),Ht=new function(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var i;switch(e.type){case"DirectionalLight":i={direction:new c,color:new X,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r};break;case"SpotLight":i={position:new c,direction:new c,color:new X,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r};break;case"PointLight":i={position:new c,color:new X,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r};break;case"HemisphereLight":i={direction:new c,skyColor:new X,groundColor:new X};break;case"RectAreaLight":i={color:new X,position:new c,halfWidth:new c,halfHeight:new c}}return t[e.id]=i,i}}},zt=new Nt,Wt=new function(t,e,i,n){function r(t,i){e.buffers.color.setClear(t.r,t.g,t.b,i,n)}var o,s,a,h,u=new X(0),c=0;return{getClearColor:function(){return u},setClearColor:function(t,e){u.set(t),r(u,c=void 0!==e?e:1)},getClearAlpha:function(){return c},setClearAlpha:function(t){r(u,c=t)},render:function(e,n,l){var d=e.background;null===d?r(u,c):d&&d.isColor&&(r(d,1),l=!0),(t.autoClear||l)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),d&&d.isCubeTexture?(void 0===a&&(a=new lt,h=new Dt(new At(5,5,5),new Q({uniforms:la.cube.uniforms,vertexShader:la.cube.vertexShader,fragmentShader:la.cube.fragmentShader,side:Xr,depthTest:!1,depthWrite:!1,fog:!1}))),a.projectionMatrix.copy(n.projectionMatrix),a.matrixWorld.extractRotation(n.matrixWorld),a.matrixWorldInverse.getInverse(a.matrixWorld),h.material.uniforms.tCube.value=d,h.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,h.matrixWorld),i.update(h),t.renderBufferDirect(a,null,h.geometry,h.material,h,null)):d&&d.isTexture&&(void 0===o&&(o=new ct(-1,1,1,-1,0,1),s=new Dt(new Lt(2,2),new Ot({depthTest:!1,depthWrite:!1,fog:!1}))),s.material.map=d,i.update(s),t.renderBufferDirect(o,null,s.geometry,s.material,s,null))}}}(this,Bt,jt,A),Xt=new function(t){var e=this,i=null,n=null;"VRFrameData"in window&&(n=new window.VRFrameData);var r=new l,o=new l,a=new l,h=new lt;h.bounds=new s(0,0,.5,1),h.layers.enable(1);var u=new lt;u.bounds=new s(.5,0,.5,1),u.layers.enable(2);var c=new Zt([h,u]);c.layers.enable(1),c.layers.enable(2);var d,p;window.addEventListener("vrdisplaypresentchange",function(){if(i.isPresenting){var n=i.getEyeParameters("left"),r=n.renderWidth,o=n.renderHeight;p=t.getPixelRatio(),d=t.getSize(),t.setDrawingBufferSize(2*r,o,1)}else e.enabled&&t.setDrawingBufferSize(d.width,d.height,p)},!1),this.enabled=!1,this.standing=!1,this.getDevice=function(){return i},this.setDevice=function(t){void 0!==t&&(i=t)},this.getCamera=function(t){if(null===i)return t;i.depthNear=t.near,i.depthFar=t.far,i.getFrameData(n);var e=n.pose;null!==e.position?t.position.fromArray(e.position):t.position.set(0,0,0),null!==e.orientation&&t.quaternion.fromArray(e.orientation),t.updateMatrixWorld();var s=i.stageParameters;if(this.standing&&s&&(o.fromArray(s.sittingToStandingTransform),a.getInverse(o),t.matrixWorld.multiply(o),t.matrixWorldInverse.multiply(a)),!1===i.isPresenting)return t;c.matrixWorld.copy(t.matrixWorld),c.matrixWorldInverse.copy(t.matrixWorldInverse),h.matrixWorldInverse.fromArray(n.leftViewMatrix),u.matrixWorldInverse.fromArray(n.rightViewMatrix),this.standing&&s&&(h.matrixWorldInverse.multiply(a),u.matrixWorldInverse.multiply(a));var l=t.parent;null!==l&&(r.getInverse(l.matrixWorld),h.matrixWorldInverse.multiply(r),u.matrixWorldInverse.multiply(r)),h.matrixWorld.getInverse(h.matrixWorldInverse),u.matrixWorld.getInverse(u.matrixWorldInverse),h.projectionMatrix.fromArray(n.leftProjectionMatrix),u.projectionMatrix.fromArray(n.rightProjectionMatrix),c.projectionMatrix.copy(h.projectionMatrix);var d=i.getLayers();if(d.length){var p=d[0];null!==p.leftBounds&&4===p.leftBounds.length&&h.bounds.fromArray(p.leftBounds),null!==p.rightBounds&&4===p.rightBounds.length&&u.bounds.fromArray(p.rightBounds)}return c},this.getStandingMatrix=function(){return o},this.submitFrame=function(){i&&i.isPresenting&&i.submitFrame()}}(this);this.info.programs=Vt.programs;var qt=new function(t,e,i){var n;this.setMode=function(t){n=t},this.render=function(e,r){t.drawArrays(n,e,r),i.calls++,i.vertices+=r,n===t.TRIANGLES&&(i.faces+=r/3)},this.renderInstances=function(r,o,s){var a=e.get("ANGLE_instanced_arrays");if(null!==a){var h=r.attributes.position;h.isInterleavedBufferAttribute?(s=h.data.count,a.drawArraysInstancedANGLE(n,0,s,r.maxInstancedCount)):a.drawArraysInstancedANGLE(n,o,s,r.maxInstancedCount),i.calls++,i.vertices+=s*r.maxInstancedCount,n===t.TRIANGLES&&(i.faces+=r.maxInstancedCount*s/3)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(Et,Rt,St),Qt=new function(t,e,i){var n,r,o;this.setMode=function(t){n=t},this.setIndex=function(t){r=t.type,o=t.bytesPerElement},this.render=function(e,s){t.drawElements(n,s,r,e*o),i.calls++,i.vertices+=s,n===t.TRIANGLES&&(i.faces+=s/3)},this.renderInstances=function(s,a,h){var u=e.get("ANGLE_instanced_arrays");null!==u?(u.drawElementsInstancedANGLE(n,h,r,a*o,s.maxInstancedCount),i.calls++,i.vertices+=h*s.maxInstancedCount,n===t.TRIANGLES&&(i.faces+=s.maxInstancedCount*h/3)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(Et,Rt,St);i(),this.context=Et,this.capabilities=It,this.extensions=Rt,this.properties=kt,this.renderLists=zt,this.state=Bt,this.vr=Xt;var Jt=new rt(this,_t,jt,It);this.shadowMap=Jt;var $t=new K(this,B),te=new Y(this,k);this.getContext=function(){return Et},this.getContextAttributes=function(){return Et.getContextAttributes()},this.forceContextLoss=function(){var t=Rt.get("WEBGL_lose_context");t&&t.loseContext()},this.getMaxAnisotropy=function(){return It.getMaxAnisotropy()},this.getPrecision=function(){return It.precision},this.getPixelRatio=function(){return st},this.setPixelRatio=function(t){void 0!==t&&(st=t,this.setSize($,tt,!1))},this.getSize=function(){return{width:$,height:tt}},this.setSize=function(t,e,i){var n=Xt.getDevice();n&&n.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):($=t,tt=e,T.width=t*st,T.height=e*st,!1!==i&&(T.style.width=t+"px",T.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(){return{width:$*st,height:tt*st}},this.setDrawingBufferSize=function(t,e,i){$=t,tt=e,st=i,T.width=t*i,T.height=e*i,this.setViewport(0,0,t,e)},this.setViewport=function(t,e,i,n){ut.set(t,tt-e-n,i,n),Bt.viewport(Z.copy(ut).multiplyScalar(st))},this.setScissor=function(t,e,i,n){at.set(t,tt-e-n,i,n),Bt.scissor(z.copy(at).multiplyScalar(st))},this.setScissorTest=function(t){Bt.setScissorTest(ht=t)},this.getClearColor=Wt.getClearColor,this.setClearColor=Wt.setClearColor,this.getClearAlpha=Wt.getClearAlpha,this.setClearAlpha=Wt.setClearAlpha,this.clear=function(t,e,i){var n=0;(void 0===t||t)&&(n|=Et.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=Et.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=Et.STENCIL_BUFFER_BIT),Et.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,i,n){this.setRenderTarget(t),this.clear(e,i,n)},this.resetGLState=n,this.dispose=function(){T.removeEventListener("webglcontextlost",o,!1),zt.dispose()},this.renderBufferImmediate=function(t,e,i){Bt.initAttributes();var n=kt.get(t);t.hasPositions&&!n.position&&(n.position=Et.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=Et.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=Et.createBuffer()),t.hasColors&&!n.color&&(n.color=Et.createBuffer());var r=e.getAttributes();if(t.hasPositions&&(Et.bindBuffer(Et.ARRAY_BUFFER,n.position),Et.bufferData(Et.ARRAY_BUFFER,t.positionArray,Et.DYNAMIC_DRAW),Bt.enableAttribute(r.position),Et.vertexAttribPointer(r.position,3,Et.FLOAT,!1,0,0)),t.hasNormals){if(Et.bindBuffer(Et.ARRAY_BUFFER,n.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&i.shading===Yr)for(var o=0,s=3*t.count;o<s;o+=9){var a=t.normalArray,h=(a[o+0]+a[o+3]+a[o+6])/3,u=(a[o+1]+a[o+4]+a[o+7])/3,c=(a[o+2]+a[o+5]+a[o+8])/3;a[o+0]=h,a[o+1]=u,a[o+2]=c,a[o+3]=h,a[o+4]=u,a[o+5]=c,a[o+6]=h,a[o+7]=u,a[o+8]=c}Et.bufferData(Et.ARRAY_BUFFER,t.normalArray,Et.DYNAMIC_DRAW),Bt.enableAttribute(r.normal),Et.vertexAttribPointer(r.normal,3,Et.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(Et.bindBuffer(Et.ARRAY_BUFFER,n.uv),Et.bufferData(Et.ARRAY_BUFFER,t.uvArray,Et.DYNAMIC_DRAW),Bt.enableAttribute(r.uv),Et.vertexAttribPointer(Ut.uv,2,Et.FLOAT,!1,0,0)),t.hasColors&&i.vertexColors!==Zr&&(Et.bindBuffer(Et.ARRAY_BUFFER,n.color),Et.bufferData(Et.ARRAY_BUFFER,t.colorArray,Et.DYNAMIC_DRAW),Bt.enableAttribute(r.color),Et.vertexAttribPointer(r.color,3,Et.FLOAT,!1,0,0)),Bt.disableUnusedAttributes(),Et.drawArrays(Et.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,i,n,r,o,s){Bt.setMaterial(r);var a=y(t,i,r,o),h=n.id+"_"+a.id+"_"+(!0===r.wireframe),c=!1;h!==j&&(j=h,c=!0);var l=o.morphTargetInfluences;if(void 0!==l){for(var d=[],p=0,f=l.length;p<f;p++){var m=l[p];d.push([m,p])}d.sort(u),d.length>8&&(d.length=8);var g=n.morphAttributes;for(p=0,f=d.length;p<f;p++){m=d[p];if(I[p]=m[0],0!==m[0]){var v=m[1];!0===r.morphTargets&&g.position&&n.addAttribute("morphTarget"+p,g.position[v]),!0===r.morphNormals&&g.normal&&n.addAttribute("morphNormal"+p,g.normal[v])}else!0===r.morphTargets&&n.removeAttribute("morphTarget"+p),!0===r.morphNormals&&n.removeAttribute("morphNormal"+p)}p=d.length;for(var b=I.length;p<b;p++)I[p]=0;a.getUniforms().setValue(Et,"morphTargetInfluences",I),c=!0}v=n.index;var x=n.attributes.position,_=1;!0===r.wireframe&&(v=Gt.getWireframeAttribute(n),_=2);var w,T=qt;null!==v&&(w=Ut.get(v),(T=Qt).setIndex(w)),c&&(!function(t,e,i,n){if(i&&i.isInstancedBufferGeometry&&null===Rt.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===n&&(n=0),Bt.initAttributes();var r=i.attributes,o=e.getAttributes(),s=t.defaultAttributeValues;for(var a in o){var h=o[a];if(h>=0){var u=r[a];if(void 0!==u){var c=u.normalized,l=u.itemSize,d=Ut.get(u),p=d.buffer,f=d.type,m=d.bytesPerElement;if(u.isInterleavedBufferAttribute){var g=u.data,y=g.stride,v=u.offset;g&&g.isInstancedInterleavedBuffer?(Bt.enableAttributeAndDivisor(h,g.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=g.meshPerAttribute*g.count)):Bt.enableAttribute(h),Et.bindBuffer(Et.ARRAY_BUFFER,p),Et.vertexAttribPointer(h,l,f,c,y*m,(n*y+v)*m)}else u.isInstancedBufferAttribute?(Bt.enableAttributeAndDivisor(h,u.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=u.meshPerAttribute*u.count)):Bt.enableAttribute(h),Et.bindBuffer(Et.ARRAY_BUFFER,p),Et.vertexAttribPointer(h,l,f,c,0,n*l*m)}else if(void 0!==s){var b=s[a];if(void 0!==b)switch(b.length){case 2:Et.vertexAttrib2fv(h,b);break;case 3:Et.vertexAttrib3fv(h,b);break;case 4:Et.vertexAttrib4fv(h,b);break;default:Et.vertexAttrib1fv(h,b)}}}}Bt.disableUnusedAttributes()}}(r,a,n),null!==v&&Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,w.buffer));var S=0;null!==v?S=v.count:void 0!==x&&(S=x.count);var E=n.drawRange.start*_,C=n.drawRange.count*_,P=null!==s?s.start*_:0,M=null!==s?s.count*_:1/0,A=Math.max(E,P),R=Math.min(S,E+C,P+M)-1,L=Math.max(0,R-A+1);if(0!==L){if(o.isMesh)if(!0===r.wireframe)Bt.setLineWidth(r.wireframeLinewidth*e()),T.setMode(Et.LINES);else switch(o.drawMode){case Ns:T.setMode(Et.TRIANGLES);break;case Gs:T.setMode(Et.TRIANGLE_STRIP);break;case js:T.setMode(Et.TRIANGLE_FAN)}else if(o.isLine){var O=r.linewidth;void 0===O&&(O=1),Bt.setLineWidth(O*e()),o.isLineSegments?T.setMode(Et.LINES):o.isLineLoop?T.setMode(Et.LINE_LOOP):T.setMode(Et.LINE_STRIP)}else o.isPoints&&T.setMode(Et.POINTS);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&T.renderInstances(n,A,L):T.render(A,L)}},this.compile=function(t,e){L=[],t.traverse(function(t){t.isLight&&L.push(t)}),_(L,e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var i=0;i<e.material.length;i++)g(e.material[i],t.fog,e);else g(e.material,t.fog,e)})},this.animate=function(t){function e(){t(),(Xt.getDevice()||window).requestAnimationFrame(e)}(Xt.getDevice()||window).requestAnimationFrame(e)},this.render=function(t,e,i,n){if(e&&e.isCamera){j="",G=-1,V=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),Xt.enabled&&(e=Xt.getCamera(e)),gt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),dt.setFromMatrix(gt),L.length=0,B.length=0,k.length=0,mt=this.localClippingEnabled,ft=pt.init(this.clippingPlanes,mt,e),(O=zt.get(t,e)).init(),p(t,e,D.sortObjects),O.finish(),!0===D.sortObjects&&O.sort(),ft&&pt.beginShadows(),function(t){for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r.castShadow&&(_t.shadows[e]=r,e++)}_t.shadows.length=e}(L),Jt.render(t,e),_(L,e),ft&&pt.endShadows(),St.frame++,St.calls=0,St.vertices=0,St.faces=0,St.points=0,void 0===i&&(i=null),this.setRenderTarget(i),Wt.render(t,e,n);var r=O.opaque,o=O.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;r.length&&f(r,t,e,s),o.length&&f(o,t,e,s)}else r.length&&f(r,t,e),o.length&&f(o,t,e);$t.render(t,e),te.render(t,e,Z),i&&Ft.updateRenderTargetMipmap(i),Bt.buffers.depth.setTest(!0),Bt.buffers.depth.setMask(!0),Bt.buffers.color.setMask(!0),e.isArrayCamera&&D.setScissorTest(!1),Xt.enabled&&Xt.submitFrame()}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(t,e){Bt.setCullFace(t),Bt.setFlipSided(e===Gr)},this.allocTextureUnit=function(){var t=J;return t>=It.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+t+" texture units while this GPU supports only "+It.maxTextures),J+=1,t},this.setTexture2D=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTarget&&(t||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),Ft.setTexture2D(e,i)}}(),this.setTexture=function(){var t=!1;return function(e,i){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0),Ft.setTexture2D(e,i)}}(),this.setTextureCube=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?Ft.setTextureCube(e,i):Ft.setTextureCubeDynamic(e,i)}}(),this.getRenderTarget=function(){return U},this.setRenderTarget=function(t){U=t,t&&void 0===kt.get(t).__webglFramebuffer&&Ft.setupRenderTarget(t);var e,i=t&&t.isWebGLRenderTargetCube;if(t){var n=kt.get(t);e=i?n.__webglFramebuffer[t.activeCubeFace]:n.__webglFramebuffer,z.copy(t.scissor),q=t.scissorTest,Z.copy(t.viewport)}else e=null,z.copy(at).multiplyScalar(st),q=ht,Z.copy(ut).multiplyScalar(st);if(N!==e&&(Et.bindFramebuffer(Et.FRAMEBUFFER,e),N=e),Bt.scissor(z),Bt.setScissorTest(q),Bt.viewport(Z),i){var r=kt.get(t.texture);Et.framebufferTexture2D(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0,Et.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,i,n,r,o){if(t&&t.isWebGLRenderTarget){var s=kt.get(t).__webglFramebuffer;if(s){var a=!1;s!==N&&(Et.bindFramebuffer(Et.FRAMEBUFFER,s),a=!0);try{var h=t.texture,u=h.format,c=h.type;if(u!==ms&&w(u)!==Et.getParameter(Et.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===es||w(c)===Et.getParameter(Et.IMPLEMENTATION_COLOR_READ_TYPE)||c===as&&(Rt.get("OES_texture_float")||Rt.get("WEBGL_color_buffer_float"))||c===hs&&Rt.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Et.checkFramebufferStatus(Et.FRAMEBUFFER)===Et.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&Et.readPixels(e,i,n,r,w(u),w(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&Et.bindFramebuffer(Et.FRAMEBUFFER,N)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function Jt(t,e){this.name="",this.color=new X(t),this.density=void 0!==e?e:25e-5}function $t(t,e,i){this.name="",this.color=new X(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}function te(){ht.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function ee(t,e,i,n,r){ht.call(this),this.lensFlares=[],this.positionScreen=new c,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,i,n,r)}function ie(t){Z.call(this),this.type="SpriteMaterial",this.color=new X(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function ne(t){ht.call(this),this.type="Sprite",this.material=void 0!==t?t:new ie}function re(){ht.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function oe(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new l)}}function se(){ht.call(this),this.type="Bone"}function ae(t,e){Dt.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new l,this.bindMatrixInverse=new l;var i=new oe(this.initBones());this.bind(i,this.matrixWorld),this.normalizeSkinWeights()}function he(t){Z.call(this),this.type="LineBasicMaterial",this.color=new X(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function ue(t,e,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new ce(t,e);ht.call(this),this.type="Line",this.geometry=void 0!==t?t:new Pt,this.material=void 0!==e?e:new he({color:16777215*Math.random()})}function ce(t,e){ue.call(this,t,e),this.type="LineSegments"}function le(t,e){ue.call(this,t,e),this.type="LineLoop"}function de(t){Z.call(this),this.type="PointsMaterial",this.color=new X(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function pe(t,e){ht.call(this),this.type="Points",this.geometry=void 0!==t?t:new Pt,this.material=void 0!==e?e:new de({color:16777215*Math.random()})}function fe(){ht.call(this),this.type="Group"}function me(t,e,i,n,r,s,a,h,u){function c(){requestAnimationFrame(c),t.readyState>=t.HAVE_CURRENT_DATA&&(l.needsUpdate=!0)}o.call(this,t,e,i,n,r,s,a,h,u),this.generateMipmaps=!1;var l=this;c()}function ge(t,e,i,n,r,s,a,h,u,c,l,d){o.call(this,null,s,a,h,u,c,n,r,l,d),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function ye(t,e,i,n,r,s,a,h,u){o.call(this,t,e,i,n,r,s,a,h,u),this.needsUpdate=!0}function ve(t,e,i,n,r,s,a,h,u,c){if((c=void 0!==c?c:bs)!==bs&&c!==xs)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===bs&&(i=rs),void 0===i&&c===xs&&(i=ds),o.call(this,null,n,r,s,a,h,c,i,u),this.image={width:t,height:e},this.magFilter=void 0!==a?a:Ko,this.minFilter=void 0!==h?h:Ko,this.flipY=!1,this.generateMipmaps=!1}function be(t){Pt.call(this),this.type="WireframeGeometry";var e,i,n,r,o,s,a,h,u,l,d=[],p=[0,0],f={},m=["a","b","c"];if(t&&t.isGeometry){var g=t.faces;for(e=0,n=g.length;e<n;e++){var y=g[e];for(i=0;i<3;i++)a=y[m[i]],h=y[m[(i+1)%3]],p[0]=Math.min(a,h),p[1]=Math.max(a,h),void 0===f[u=p[0]+","+p[1]]&&(f[u]={index1:p[0],index2:p[1]})}for(u in f)s=f[u],l=t.vertices[s.index1],d.push(l.x,l.y,l.z),l=t.vertices[s.index2],d.push(l.x,l.y,l.z)}else if(t&&t.isBufferGeometry){var v,b,x,_,w,T,S;if(l=new c,null!==t.index){for(v=t.attributes.position,b=t.index,0===(x=t.groups).length&&(x=[{start:0,count:b.count,materialIndex:0}]),r=0,o=x.length;r<o;++r)for(e=w=(_=x[r]).start,n=w+_.count;e<n;e+=3)for(i=0;i<3;i++)a=b.getX(e+i),h=b.getX(e+(i+1)%3),p[0]=Math.min(a,h),p[1]=Math.max(a,h),void 0===f[u=p[0]+","+p[1]]&&(f[u]={index1:p[0],index2:p[1]});for(u in f)s=f[u],l.fromBufferAttribute(v,s.index1),d.push(l.x,l.y,l.z),l.fromBufferAttribute(v,s.index2),d.push(l.x,l.y,l.z)}else for(e=0,n=(v=t.attributes.position).count/3;e<n;e++)for(i=0;i<3;i++)T=3*e+i,l.fromBufferAttribute(v,T),d.push(l.x,l.y,l.z),S=3*e+(i+1)%3,l.fromBufferAttribute(v,S),d.push(l.x,l.y,l.z)}this.addAttribute("position",new Tt(d,3))}function xe(t,e,i){ft.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new _e(t,e,i)),this.mergeVertices()}function _e(t,e,i){Pt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};var n,r,o=[],s=[],a=[],h=[],u=new c,l=new c,d=new c,p=new c,f=new c,m=e+1;for(n=0;n<=i;n++){var g=n/i;for(r=0;r<=e;r++){var y=r/e;l=t(y,g,l),s.push(l.x,l.y,l.z),y-1e-5>=0?(d=t(y-1e-5,g,d),p.subVectors(l,d)):(d=t(y+1e-5,g,d),p.subVectors(d,l)),g-1e-5>=0?(d=t(y,g-1e-5,d),f.subVectors(l,d)):(d=t(y,g+1e-5,d),f.subVectors(d,l)),u.crossVectors(p,f).normalize(),a.push(u.x,u.y,u.z),h.push(y,g)}}for(n=0;n<i;n++)for(r=0;r<e;r++){var v=n*m+r,b=n*m+r+1,x=(n+1)*m+r+1,_=(n+1)*m+r;o.push(v,b,_),o.push(b,x,_)}this.setIndex(o),this.addAttribute("position",new Tt(s,3)),this.addAttribute("normal",new Tt(a,3)),this.addAttribute("uv",new Tt(h,2))}function we(t,e,i,n){ft.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},this.fromBufferGeometry(new Te(t,e,i,n)),this.mergeVertices()}function Te(t,e,i,n){function o(t){u.push(t.x,t.y,t.z)}function s(e,i){var n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function a(t,e,i,n){n<0&&1===t.x&&(l[e]=t.x-1),0===i.x&&0===i.z&&(l[e]=n/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}Pt.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},i=i||1;var u=[],l=[];!function(t){for(var i=new c,n=new c,r=new c,a=0;a<e.length;a+=3)s(e[a+0],i),s(e[a+1],n),s(e[a+2],r),function(t,e,i,n){var r,s,a=Math.pow(2,n),h=[];for(r=0;r<=a;r++){h[r]=[];var u=t.clone().lerp(i,r/a),c=e.clone().lerp(i,r/a),l=a-r;for(s=0;s<=l;s++)h[r][s]=0===s&&r===a?u:u.clone().lerp(c,s/l)}for(r=0;r<a;r++)for(s=0;s<2*(a-r)-1;s++){var d=Math.floor(s/2);s%2==0?(o(h[r][d+1]),o(h[r+1][d]),o(h[r][d])):(o(h[r][d+1]),o(h[r+1][d+1]),o(h[r+1][d]))}}(i,n,r,t)}(n=n||0),function(t){for(var e=new c,i=0;i<u.length;i+=3)e.x=u[i+0],e.y=u[i+1],e.z=u[i+2],e.normalize().multiplyScalar(t),u[i+0]=e.x,u[i+1]=e.y,u[i+2]=e.z}(i),function(){for(var t=new c,e=0;e<u.length;e+=3){t.x=u[e+0],t.y=u[e+1],t.z=u[e+2];var i=h(t)/2/Math.PI+.5,n=function(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}(t)/Math.PI+.5;l.push(i,1-n)}!function(){for(var t=new c,e=new c,i=new c,n=new c,o=new r,s=new r,d=new r,p=0,f=0;p<u.length;p+=9,f+=6){t.set(u[p+0],u[p+1],u[p+2]),e.set(u[p+3],u[p+4],u[p+5]),i.set(u[p+6],u[p+7],u[p+8]),o.set(l[f+0],l[f+1]),s.set(l[f+2],l[f+3]),d.set(l[f+4],l[f+5]),n.copy(t).add(e).add(i).divideScalar(3);var m=h(n);a(o,f+0,t,m),a(s,f+2,e,m),a(d,f+4,i,m)}}(),function(){for(var t=0;t<l.length;t+=6){var e=l[t+0],i=l[t+2],n=l[t+4],r=Math.max(e,i,n),o=Math.min(e,i,n);r>.9&&o<.1&&(e<.2&&(l[t+0]+=1),i<.2&&(l[t+2]+=1),n<.2&&(l[t+4]+=1))}}()}(),this.addAttribute("position",new Tt(u,3)),this.addAttribute("normal",new Tt(u.slice(),3)),this.addAttribute("uv",new Tt(l,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Se(t,e){ft.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ee(t,e)),this.mergeVertices()}function Ee(t,e){Te.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ce(t,e){ft.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Pe(t,e)),this.mergeVertices()}function Pe(t,e){Te.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Me(t,e){ft.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ae(t,e)),this.mergeVertices()}function Ae(t,e){var i=(1+Math.sqrt(5))/2;Te.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Re(t,e){ft.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Le(t,e)),this.mergeVertices()}function Le(t,e){var i=(1+Math.sqrt(5))/2,n=1/i;Te.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Oe(t,e,i,n,r,o){ft.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new Ie(t,e,i,n,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Ie(t,e,i,n,o){function s(r){var o=t.getPointAt(r/e),s=a.normals[r],h=a.binormals[r];for(u=0;u<=n;u++){var c=u/n*Math.PI*2,p=Math.sin(c),g=-Math.cos(c);d.x=g*s.x+p*h.x,d.y=g*s.y+p*h.y,d.z=g*s.z+p*h.z,d.normalize(),m.push(d.x,d.y,d.z),l.x=o.x+i*d.x,l.y=o.y+i*d.y,l.z=o.z+i*d.z,f.push(l.x,l.y,l.z)}}Pt.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:o},e=e||64,i=i||1,n=n||8,o=o||!1;var a=t.computeFrenetFrames(e,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var h,u,l=new c,d=new c,p=new r,f=[],m=[],g=[],y=[];!function(){for(h=0;h<e;h++)s(h);s(!1===o?e:0),function(){for(h=0;h<=e;h++)for(u=0;u<=n;u++)p.x=h/e,p.y=u/n,g.push(p.x,p.y)}(),function(){for(u=1;u<=e;u++)for(h=1;h<=n;h++){var t=(n+1)*(u-1)+(h-1),i=(n+1)*u+(h-1),r=(n+1)*u+h,o=(n+1)*(u-1)+h;y.push(t,i,o),y.push(i,r,o)}}()}(),this.setIndex(y),this.addAttribute("position",new Tt(f,3)),this.addAttribute("normal",new Tt(m,3)),this.addAttribute("uv",new Tt(g,2))}function Be(t,e,i,n,r,o,s){ft.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new ke(t,e,i,n,r,o)),this.mergeVertices()}function ke(t,e,i,n,r,o){function s(t,e,i,n,r){var o=Math.cos(t),s=Math.sin(t),a=i/e*t,h=Math.cos(a);r.x=n*(2+h)*.5*o,r.y=n*(2+h)*s*.5,r.z=n*Math.sin(a)*.5}Pt.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:o},t=t||100,e=e||40,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,o=o||3;var a,h,u=[],l=[],d=[],p=[],f=new c,m=new c,g=new c,y=new c,v=new c,b=new c,x=new c;for(a=0;a<=i;++a){var _=a/i*r*Math.PI*2;for(s(_,r,o,t,g),s(_+.01,r,o,t,y),b.subVectors(y,g),x.addVectors(y,g),v.crossVectors(b,x),x.crossVectors(v,b),v.normalize(),x.normalize(),h=0;h<=n;++h){var w=h/n*Math.PI*2,T=-e*Math.cos(w),S=e*Math.sin(w);f.x=g.x+(T*x.x+S*v.x),f.y=g.y+(T*x.y+S*v.y),f.z=g.z+(T*x.z+S*v.z),l.push(f.x,f.y,f.z),m.subVectors(f,g).normalize(),d.push(m.x,m.y,m.z),p.push(a/i),p.push(h/n)}}for(h=1;h<=i;h++)for(a=1;a<=n;a++){var E=(n+1)*(h-1)+(a-1),C=(n+1)*h+(a-1),P=(n+1)*h+a,M=(n+1)*(h-1)+a;u.push(E,C,M),u.push(C,P,M)}this.setIndex(u),this.addAttribute("position",new Tt(l,3)),this.addAttribute("normal",new Tt(d,3)),this.addAttribute("uv",new Tt(p,2))}function De(t,e,i,n,r){ft.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new Fe(t,e,i,n,r)),this.mergeVertices()}function Fe(t,e,i,n,r){Pt.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},t=t||100,e=e||40,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var o,s,a=[],h=[],u=[],l=[],d=new c,p=new c,f=new c;for(o=0;o<=i;o++)for(s=0;s<=n;s++){var m=s/n*r,g=o/i*Math.PI*2;p.x=(t+e*Math.cos(g))*Math.cos(m),p.y=(t+e*Math.cos(g))*Math.sin(m),p.z=e*Math.sin(g),h.push(p.x,p.y,p.z),d.x=t*Math.cos(m),d.y=t*Math.sin(m),f.subVectors(p,d).normalize(),u.push(f.x,f.y,f.z),l.push(s/n),l.push(o/i)}for(o=1;o<=i;o++)for(s=1;s<=n;s++){var y=(n+1)*o+s-1,v=(n+1)*(o-1)+s-1,b=(n+1)*(o-1)+s,x=(n+1)*o+s;a.push(y,v,x),a.push(v,b,x)}this.setIndex(a),this.addAttribute("position",new Tt(h,3)),this.addAttribute("normal",new Tt(u,3)),this.addAttribute("uv",new Tt(l,2))}function Ue(t,e){ft.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Ne(t,e)),this.mergeVertices()}function Ne(t,e){"undefined"!=typeof t&&(Pt.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function Ge(t,e){ft.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new je(t,e)),this.mergeVertices()}function je(t,e){var i=(e=e||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ft;var n=i.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Ne.call(this,n,e),this.type="TextBufferGeometry"}function Ve(t,e,i,n,r,o,s){ft.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new He(t,e,i,n,r,o,s)),this.mergeVertices()}function He(t,e,i,n,r,o,s){Pt.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:s},t=t||50,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var a,h,u=(o=void 0!==o?o:0)+(s=void 0!==s?s:Math.PI),l=0,d=[],p=new c,f=new c,m=[],g=[],y=[],v=[];for(h=0;h<=i;h++){var b=[],x=h/i;for(a=0;a<=e;a++){var _=a/e;p.x=-t*Math.cos(n+_*r)*Math.sin(o+x*s),p.y=t*Math.cos(o+x*s),p.z=t*Math.sin(n+_*r)*Math.sin(o+x*s),g.push(p.x,p.y,p.z),f.set(p.x,p.y,p.z).normalize(),y.push(f.x,f.y,f.z),v.push(_,1-x),b.push(l++)}d.push(b)}for(h=0;h<i;h++)for(a=0;a<e;a++){var w=d[h][a+1],T=d[h][a],S=d[h+1][a],E=d[h+1][a+1];(0!==h||o>0)&&m.push(w,T,E),(h!==i-1||u<Math.PI)&&m.push(T,S,E)}this.setIndex(m),this.addAttribute("position",new Tt(g,3)),this.addAttribute("normal",new Tt(y,3)),this.addAttribute("uv",new Tt(v,2))}function ze(t,e,i,n,r,o){ft.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new We(t,e,i,n,r,o)),this.mergeVertices()}function We(t,e,i,n,o,s){Pt.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:o,thetaLength:s},t=t||20,e=e||50,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var a,h,u,l=[],d=[],p=[],f=[],m=t,g=(e-t)/(n=void 0!==n?Math.max(1,n):1),y=new c,v=new r;for(h=0;h<=n;h++){for(u=0;u<=i;u++)a=o+u/i*s,y.x=m*Math.cos(a),y.y=m*Math.sin(a),d.push(y.x,y.y,y.z),p.push(0,0,1),v.x=(y.x/e+1)/2,v.y=(y.y/e+1)/2,f.push(v.x,v.y);m+=g}for(h=0;h<n;h++){var b=h*(i+1);for(u=0;u<i;u++){var x=a=u+b,_=a+i+1,w=a+i+2,T=a+1;l.push(x,_,T),l.push(_,w,T)}}this.setIndex(l),this.addAttribute("position",new Tt(d,3)),this.addAttribute("normal",new Tt(p,3)),this.addAttribute("uv",new Tt(f,2))}function Xe(t,e,i,n){ft.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},this.fromBufferGeometry(new qe(t,e,i,n)),this.mergeVertices()}function qe(t,e,i,n){Pt.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e)||12,i=i||0,n=n||2*Math.PI,n=Js.clamp(n,0,2*Math.PI);var o,s,a,h=[],u=[],l=[],d=1/e,p=new c,f=new r;for(s=0;s<=e;s++){var m=i+s*d*n,g=Math.sin(m),y=Math.cos(m);for(a=0;a<=t.length-1;a++)p.x=t[a].x*g,p.y=t[a].y,p.z=t[a].x*y,u.push(p.x,p.y,p.z),f.x=s/e,f.y=a/(t.length-1),l.push(f.x,f.y)}for(s=0;s<e;s++)for(a=0;a<t.length-1;a++){var v=o=a+s*t.length,b=o+t.length,x=o+t.length+1,_=o+1;h.push(v,b,_),h.push(b,x,_)}if(this.setIndex(h),this.addAttribute("position",new Tt(u,3)),this.addAttribute("uv",new Tt(l,2)),this.computeVertexNormals(),n===2*Math.PI){var w=this.attributes.normal.array,T=new c,S=new c,E=new c;for(o=e*t.length*3,s=0,a=0;s<t.length;s++,a+=3)T.x=w[a+0],T.y=w[a+1],T.z=w[a+2],S.x=w[o+a+0],S.y=w[o+a+1],S.z=w[o+a+2],E.addVectors(T,S).normalize(),w[a+0]=w[o+a+0]=E.x,w[a+1]=w[o+a+1]=E.y,w[a+2]=w[o+a+2]=E.z}}function Ye(t,e){ft.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Ke(t,e)),this.mergeVertices()}function Ke(t,e){function i(t){var i,a,u,c=r.length/3,l=t.extractPoints(e),d=l.shape,p=l.holes;if(!1===ga.isClockWise(d))for(d=d.reverse(),i=0,a=p.length;i<a;i++)u=p[i],!0===ga.isClockWise(u)&&(p[i]=u.reverse());var f=ga.triangulateShape(d,p);for(i=0,a=p.length;i<a;i++)u=p[i],d=d.concat(u);for(i=0,a=d.length;i<a;i++){var m=d[i];r.push(m.x,m.y,0),o.push(0,0,1),s.push(m.x,m.y)}for(i=0,a=f.length;i<a;i++){var g=f[i],y=g[0]+c,v=g[1]+c,b=g[2]+c;n.push(y,v,b),h+=3}}Pt.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var n=[],r=[],o=[],s=[],a=0,h=0;if(!1===Array.isArray(t))i(t);else for(var u=0;u<t.length;u++)i(t[u]),this.addGroup(a,h,u),a+=h,h=0;this.setIndex(n),this.addAttribute("position",new Tt(r,3)),this.addAttribute("normal",new Tt(o,3)),this.addAttribute("uv",new Tt(s,2))}function Ze(t,e){Pt.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var i,n,r,o,s=[],a=Math.cos(Js.DEG2RAD*e),h=[0,0],u={},c=["a","b","c"];t.isBufferGeometry?(o=new ft).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var l=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],g=0;g<3;g++)i=m[c[g]],n=m[c[(g+1)%3]],h[0]=Math.min(i,n),h[1]=Math.max(i,n),void 0===u[r=h[0]+","+h[1]]?u[r]={index1:h[0],index2:h[1],face1:p,face2:void 0}:u[r].face2=p;for(r in u){var y=u[r];if(void 0===y.face2||d[y.face1].normal.dot(d[y.face2].normal)<=a){var v=l[y.index1];s.push(v.x,v.y,v.z),v=l[y.index2],s.push(v.x,v.y,v.z)}}this.addAttribute("position",new Tt(s,3))}function Qe(t,e,i,n,r,o,s,a){ft.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new Je(t,e,i,n,r,o,s,a)),this.mergeVertices()}function Je(t,e,i,n,o,s,a,h){function u(i){var o,s,u,y=new r,x=new c,_=0,w=!0===i?t:e,T=!0===i?1:-1;for(s=g,o=1;o<=n;o++)p.push(0,v*T,0),f.push(0,T,0),m.push(.5,.5),g++;for(u=g,o=0;o<=n;o++){var S=o/n*h+a,E=Math.cos(S),C=Math.sin(S);x.x=w*C,x.y=v*T,x.z=w*E,p.push(x.x,x.y,x.z),f.push(0,T,0),y.x=.5*E+.5,y.y=.5*C*T+.5,m.push(y.x,y.y),g++}for(o=0;o<n;o++){var P=s+o,M=u+o;!0===i?d.push(M,M+1,P):d.push(M+1,M,P),_+=3}l.addGroup(b,_,!0===i?1:2),b+=_}Pt.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:h};var l=this;t=void 0!==t?t:20,e=void 0!==e?e:20,i=void 0!==i?i:100,n=Math.floor(n)||8,o=Math.floor(o)||1,s=void 0!==s&&s,a=void 0!==a?a:0,h=void 0!==h?h:2*Math.PI;var d=[],p=[],f=[],m=[],g=0,y=[],v=i/2,b=0;!function(){var r,s,u=new c,x=new c,_=0,w=(e-t)/i;for(s=0;s<=o;s++){var T=[],S=s/o,E=S*(e-t)+t;for(r=0;r<=n;r++){var C=r/n,P=C*h+a,M=Math.sin(P),A=Math.cos(P);x.x=E*M,x.y=-S*i+v,x.z=E*A,p.push(x.x,x.y,x.z),u.set(M,w,A).normalize(),f.push(u.x,u.y,u.z),m.push(C,1-S),T.push(g++)}y.push(T)}for(r=0;r<n;r++)for(s=0;s<o;s++){var R=y[s][r],L=y[s+1][r],O=y[s+1][r+1],I=y[s][r+1];d.push(R,L,I),d.push(L,O,I),_+=6}l.addGroup(b,_,0),b+=_}(),!1===s&&(t>0&&u(!0),e>0&&u(!1)),this.setIndex(d),this.addAttribute("position",new Tt(p,3)),this.addAttribute("normal",new Tt(f,3)),this.addAttribute("uv",new Tt(m,2))}function $e(t,e,i,n,r,o,s){Qe.call(this,0,t,e,i,n,r,o,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:s}}function ti(t,e,i,n,r,o,s){Je.call(this,0,t,e,i,n,r,o,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:s}}function ei(t,e,i,n){ft.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new ii(t,e,i,n)),this.mergeVertices()}function ii(t,e,i,n){Pt.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},t=t||50,e=void 0!==e?Math.max(3,e):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var o,s,a=[],h=[],u=[],l=[],d=new c,p=new r;for(h.push(0,0,0),u.push(0,0,1),l.push(.5,.5),s=0,o=3;s<=e;s++,o+=3){var f=i+s/e*n;d.x=t*Math.cos(f),d.y=t*Math.sin(f),h.push(d.x,d.y,d.z),u.push(0,0,1),p.x=(h[o]/t+1)/2,p.y=(h[o+1]/t+1)/2,l.push(p.x,p.y)}for(o=1;o<=e;o++)a.push(o,o+1,0);this.setIndex(a),this.addAttribute("position",new Tt(h,3)),this.addAttribute("normal",new Tt(u,3)),this.addAttribute("uv",new Tt(l,2))}function ni(t){Q.call(this,{uniforms:ua.merge([ha.lights,{opacity:{value:1}}]),vertexShader:ca.shadow_vert,fragmentShader:ca.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}}),this.setValues(t)}function ri(t){Q.call(this,t),this.type="RawShaderMaterial"}function oi(t){Z.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new X(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new X(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function si(t){oi.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function ai(t){Z.call(this),this.type="MeshPhongMaterial",this.color=new X(16777215),this.specular=new X(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new X(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ro,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function hi(t){ai.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function ui(t){Z.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ci(t){Z.call(this),this.type="MeshLambertMaterial",this.color=new X(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new X(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ro,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function li(t){Z.call(this),this.type="LineDashedMaterial",this.color=new X(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(t)}function di(t,e,i){var n=this,r=!1,o=0,s=0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){s++,!1===r&&void 0!==n.onStart&&n.onStart(t,o,s),r=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,s),o===s&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)}}function pi(t){this.manager=void 0!==t?t:xa}function fi(t){this.manager=void 0!==t?t:xa,this._parser=null}function mi(t){this.manager=void 0!==t?t:xa,this._parser=null}function gi(t){this.manager=void 0!==t?t:xa}function yi(t){this.manager=void 0!==t?t:xa}function vi(t){this.manager=void 0!==t?t:xa}function bi(t,e){ht.call(this),this.type="Light",this.color=new X(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function xi(t,e,i){bi.call(this,t,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ht.DefaultUp),this.updateMatrix(),this.groundColor=new X(e)}function _i(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new r(512,512),this.map=null,this.matrix=new l}function wi(){_i.call(this,new lt(50,1,.5,500))}function Ti(t,e,i,n,r,o){bi.call(this,t,e),this.type="SpotLight",this.position.copy(ht.DefaultUp),this.updateMatrix(),this.target=new ht,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new wi}function Si(t,e,i,n){bi.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new _i(new lt(90,1,.5,500))}function Ei(){_i.call(this,new ct(-5,5,5,-5,.5,500))}function Ci(t,e){bi.call(this,t,e),this.type="DirectionalLight",this.position.copy(ht.DefaultUp),this.updateMatrix(),this.target=new ht,this.shadow=new Ei}function Pi(t,e){bi.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Mi(t,e,i,n){bi.call(this,t,e),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function Ai(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function Ri(t,e,i,n){Ai.call(this,t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Li(t,e,i,n){Ai.call(this,t,e,i,n)}function Oi(t,e,i,n){Ai.call(this,t,e,i,n)}function Ii(t,e,i,n){if(void 0===t)throw new Error("track name is undefined");if(void 0===e||0===e.length)throw new Error("no keyframes in track named "+t);this.name=t,this.times=_a.convertArray(e,this.TimeBufferType),this.values=_a.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function Bi(t,e,i,n){Ii.call(this,t,e,i,n)}function ki(t,e,i,n){Ai.call(this,t,e,i,n)}function Di(t,e,i,n){Ii.call(this,t,e,i,n)}function Fi(t,e,i,n){Ii.call(this,t,e,i,n)}function Ui(t,e,i,n){Ii.call(this,t,e,i,n)}function Ni(t,e,i){Ii.call(this,t,e,i)}function Gi(t,e,i,n){Ii.call(this,t,e,i,n)}function ji(t,e,i,n){Ii.apply(this,arguments)}function Vi(t,e,i){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.uuid=Js.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Hi(t){this.manager=void 0!==t?t:xa,this.textures={}}function zi(t){this.manager=void 0!==t?t:xa}function Wi(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function Xi(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:xa,this.withCredentials=!1}function qi(t){this.manager=void 0!==t?t:xa,this.texturePath=""}function Yi(t,e,i,n,r){var o=.5*(n-e),s=.5*(r-i),a=t*t;return(2*i-2*n+o+s)*(t*a)+(-3*i+3*n-2*o-s)*a+o*t+i}function Ki(t,e,i,n){return function(t,e){var i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Zi(t,e,i,n,r){return function(t,e){var i=1-t;return i*i*i*e}(t,e)+function(t,e){var i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}function Qi(){this.arcLengthDivisions=200}function Ji(t,e){Qi.call(this),this.v1=t,this.v2=e}function $i(){Qi.call(this),this.curves=[],this.autoClose=!1}function tn(t,e,i,n,r,o,s,a){Qi.call(this),this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a||0}function en(t){Qi.call(this),this.points=void 0===t?[]:t}function nn(t,e,i,n){Qi.call(this),this.v0=t,this.v1=e,this.v2=i,this.v3=n}function rn(t,e,i){Qi.call(this),this.v0=t,this.v1=e,this.v2=i}function on(t){$i.call(this),this.currentPoint=new r,t&&this.fromPoints(t)}function sn(){on.apply(this,arguments),this.holes=[]}function an(){this.subPaths=[],this.currentPath=null}function hn(t){this.data=t}function un(t){this.manager=void 0!==t?t:xa}function cn(t){this.manager=void 0!==t?t:xa}function ln(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new lt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new lt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function dn(t,e,i){ht.call(this),this.type="CubeCamera";var n=new lt(90,1,t,e);n.up.set(0,-1,0),n.lookAt(new c(1,0,0)),this.add(n);var r=new lt(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new c(-1,0,0)),this.add(r);var o=new lt(90,1,t,e);o.up.set(0,0,1),o.lookAt(new c(0,1,0)),this.add(o);var s=new lt(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new c(0,-1,0)),this.add(s);var a=new lt(90,1,t,e);a.up.set(0,-1,0),a.lookAt(new c(0,0,1)),this.add(a);var u=new lt(90,1,t,e);u.up.set(0,-1,0),u.lookAt(new c(0,0,-1)),this.add(u);var l={format:fs,magFilter:Jo,minFilter:Jo};this.renderTarget=new h(i,i,l),this.renderTarget.texture.name="CubeCamera",this.updateCubeMap=function(t,e){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,t.render(e,n,i),i.activeCubeFace=1,t.render(e,r,i),i.activeCubeFace=2,t.render(e,o,i),i.activeCubeFace=3,t.render(e,s,i),i.activeCubeFace=4,t.render(e,a,i),i.texture.generateMipmaps=h,i.activeCubeFace=5,t.render(e,u,i),t.setRenderTarget(null)}}function pn(){ht.call(this),this.type="AudioListener",this.context=Aa.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function fn(t){ht.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function mn(t){fn.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function gn(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function yn(t,e,i){this.binding=t,this.valueSize=i;var n,r=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function vn(t,e,i){var n=i||bn.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function bn(t,e,i){this.path=e,this.parsedPath=i||bn.parseTrackName(e),this.node=bn.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function xn(t){this.uuid=Js.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function _n(t,e,i){this._mixer=t,this._clip=e,this._localRoot=i||null;for(var n=e.tracks,r=n.length,o=new Array(r),s={endingStart:Ds,endingEnd:Ds},a=0;a!==r;++a){var h=n[a].createInterpolant(null);o[a]=h,h.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ls,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function wn(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Tn(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function Sn(){Pt.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function En(t,e,i,n){this.uuid=Js.generateUUID(),this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}function Cn(t,e){this.uuid=Js.generateUUID(),this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function Pn(t,e,i){Cn.call(this,t,e),this.meshPerAttribute=i||1}function Mn(t,e,i){mt.call(this,t,e),this.meshPerAttribute=i||1}function An(t,e,i,n){this.ray=new It(t,e),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Rn(t,e){return t.distance-e.distance}function Ln(t,e,i,n){if(!1!==t.visible&&(t.raycast(e,i),!0===n))for(var r=t.children,o=0,s=r.length;o<s;o++)Ln(r[o],e,i,!0)}function On(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function In(t,e,i){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0,this}function Bn(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}function kn(t,e){Dt.call(this,t,e),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,n=i-1,r=i/1;this.createAnimation("__default",0,n,r),this.setAnimationWeight("__default",1)}function Dn(t){ht.call(this),this.material=t,this.render=function(t){}}function Fn(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16711680,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=3*a.faces.length:a&&a.isBufferGeometry&&(s=a.attributes.normal.count);var h=new Pt,u=new Tt(2*s*3,3);h.addAttribute("position",u),ce.call(this,h,new he({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Un(t){ht.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;for(var e=new Pt,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,r=1;n<32;n++,r++){var o=n/32*Math.PI*2,s=r/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}e.addAttribute("position",new Tt(i,3));var a=new he({fog:!1});this.cone=new ce(e,a),this.add(this.cone),this.update()}function Nn(t){var e=[];t&&t.isBone&&e.push(t);for(var i=0;i<t.children.length;i++)e.push.apply(e,Nn(t.children[i]));return e}function Gn(t){for(var e=Nn(t),i=new Pt,n=[],r=[],o=new X(0,0,1),s=new X(0,1,0),a=0;a<e.length;a++){var h=e[a];h.parent&&h.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}i.addAttribute("position",new Tt(n,3)),i.addAttribute("color",new Tt(r,3));var u=new he({vertexColors:Jr,depthTest:!1,depthWrite:!1,transparent:!0});ce.call(this,i,u),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.onBeforeRender()}function jn(t,e){this.light=t,this.light.updateMatrixWorld();var i=new He(e,4,2),n=new Ot({wireframe:!0,fog:!1});n.color.copy(this.light.color),Dt.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function Vn(t){ht.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;var e=new he({color:t.color}),i=new Pt;i.addAttribute("position",new mt(new Float32Array(15),3)),this.add(new ue(i,e)),this.update()}function Hn(t,e){ht.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;var i=new Pe(e);i.rotateY(.5*Math.PI);var n=new Ot({vertexColors:Jr,wireframe:!0}),r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.addAttribute("color",new mt(o,3)),this.add(new Dt(i,n)),this.update()}function zn(t,e,i,n){t=t||10,e=e||10,i=new X(void 0!==i?i:4473924),n=new X(void 0!==n?n:8947848);for(var r=e/2,o=t/e,s=t/2,a=[],h=[],u=0,c=0,l=-s;u<=e;u++,l+=o){a.push(-s,0,l,s,0,l),a.push(l,0,-s,l,0,s);var d=u===r?i:n;d.toArray(h,c),c+=3,d.toArray(h,c),c+=3,d.toArray(h,c),c+=3,d.toArray(h,c),c+=3}var p=new Pt;p.addAttribute("position",new Tt(a,3)),p.addAttribute("color",new Tt(h,3));var f=new he({vertexColors:Jr});ce.call(this,p,f)}function Wn(t,e,i,n,r,o){t=t||10,e=e||16,i=i||8,n=n||64,r=new X(void 0!==r?r:4473924),o=new X(void 0!==o?o:8947848);var s,a,h,u,c,l,d,p=[],f=[];for(u=0;u<=e;u++)h=u/e*(2*Math.PI),s=Math.sin(h)*t,a=Math.cos(h)*t,p.push(0,0,0),p.push(s,0,a),d=1&u?r:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(u=0;u<=i;u++)for(d=1&u?r:o,l=t-t/i*u,c=0;c<n;c++)h=c/n*(2*Math.PI),s=Math.sin(h)*l,a=Math.cos(h)*l,p.push(s,0,a),f.push(d.r,d.g,d.b),h=(c+1)/n*(2*Math.PI),s=Math.sin(h)*l,a=Math.cos(h)*l,p.push(s,0,a),f.push(d.r,d.g,d.b);var m=new Pt;m.addAttribute("position",new Tt(p,3)),m.addAttribute("color",new Tt(f,3));var g=new he({vertexColors:Jr});ce.call(this,m,g)}function Xn(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16776960,o=void 0!==n?n:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=a.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var h=new Pt,u=new Tt(2*s*3,3);h.addAttribute("position",u),ce.call(this,h,new he({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function qn(t,e){ht.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,void 0===e&&(e=1);var i=new Pt;i.addAttribute("position",new Tt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var n=new he({fog:!1});this.add(new ue(i,n)),(i=new Pt).addAttribute("position",new Tt([0,0,0,0,0,1],3)),this.add(new ue(i,n)),this.update()}function Yn(t){function e(t,e,n){i(t,n),i(e,n)}function i(t,e){o.push(0,0,0),s.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(o.length/3-1)}var n=new Pt,r=new he({color:16777215,vertexColors:Qr}),o=[],s=[],a={},h=new X(16755200),u=new X(16711680),c=new X(43775),l=new X(16777215),d=new X(3355443);e("n1","n2",h),e("n2","n4",h),e("n4","n3",h),e("n3","n1",h),e("f1","f2",h),e("f2","f4",h),e("f4","f3",h),e("f3","f1",h),e("n1","f1",h),e("n2","f2",h),e("n3","f3",h),e("n4","f4",h),e("p","n1",u),e("p","n2",u),e("p","n3",u),e("p","n4",u),e("u1","u2",c),e("u2","u3",c),e("u3","u1",c),e("c","t",l),e("p","c",d),e("cn1","cn2",d),e("cn3","cn4",d),e("cf1","cf2",d),e("cf3","cf4",d),n.addAttribute("position",new Tt(o,3)),n.addAttribute("color",new Tt(s,3)),ce.call(this,n,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Kn(t,e){this.object=t,void 0===e&&(e=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Pt;r.setIndex(new mt(i,1)),r.addAttribute("position",new mt(n,3)),ce.call(this,r,new he({color:e})),this.matrixAutoUpdate=!1,this.update()}function Zn(t,e,i,n,r,o){ht.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),void 0===Ra&&((Ra=new Pt).addAttribute("position",new Tt([0,0,0,0,1,0],3)),(La=new Je(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new ue(Ra,new he({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Dt(La,new Ot({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,o)}function Qn(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Pt;i.addAttribute("position",new Tt(e,3)),i.addAttribute("color",new Tt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new he({vertexColors:Jr});ce.call(this,i,n)}function Jn(){function t(t,o,s,a){e=t,i=s,n=-3*t+3*o-2*s-a,r=2*t-2*o+s+a}var e=0,i=0,n=0,r=0;return{initCatmullRom:function(e,i,n,r,o){t(i,n,o*(n-e),o*(r-i))},initNonuniformCatmullRom:function(e,i,n,r,o,s,a){var h=(i-e)/o-(n-e)/(o+s)+(n-i)/s,u=(n-i)/s-(r-i)/(s+a)+(r-n)/a;t(i,n,h*=s,u*=s)},calc:function(t){var o=t*t;return e+i*t+n*o+r*(o*t)}}}function $n(t){Qi.call(this),t.length<2&&console.warn("THREE.CatmullRomCurve3: Points array needs at least two entries."),this.points=t||[],this.closed=!1}function tr(t,e,i,n){Qi.call(this),this.v0=t,this.v1=e,this.v2=i,this.v3=n}function er(t,e,i){Qi.call(this),this.v0=t,this.v1=e,this.v2=i}function ir(t,e){Qi.call(this),this.v1=t,this.v2=e}function nr(t,e,i,n,r,o){tn.call(this,t,e,i,i,n,r,o)}function rr(t,e,i,n,r,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new dt(t,e,i,r,o,s)}function or(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function sr(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function ar(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new pe(t,e)}function hr(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new ne(t)}function ur(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new pe(t,e)}function cr(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new de(t)}function lr(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new de(t)}function dr(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new de(t)}function pr(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new c(t,e,i)}function fr(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new mt(t,e).setDynamic(!0)}function mr(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new gt(t,e)}function gr(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new yt(t,e)}function yr(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new vt(t,e)}function vr(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new bt(t,e)}function br(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xt(t,e)}function xr(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new _t(t,e)}function _r(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new wt(t,e)}function wr(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Tt(t,e)}function Tr(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new St(t,e)}function Sr(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),$n.call(this,t),this.type="catmullrom",this.closed=!0}function Er(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),$n.call(this,t),this.type="catmullrom"}function Cr(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),$n.call(this,t),this.type="catmullrom"}function Pr(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Kn(t,e)}function Mr(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ce(new Ze(t.geometry),new he({color:void 0!==e?e:16777215}))}function Ar(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ce(new be(t.geometry),new he({color:void 0!==e?e:16777215}))}function Rr(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new pi(t)}function Lr(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new mi(t)}function Or(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function Ir(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}Object.defineProperty(e,"__esModule",{value:!0}),i.d(e,"WebGLRenderTargetCube",function(){return h}),i.d(e,"WebGLRenderTarget",function(){return a}),i.d(e,"WebGLRenderer",function(){return Qt}),i.d(e,"ShaderLib",function(){return la}),i.d(e,"UniformsLib",function(){return ha}),i.d(e,"UniformsUtils",function(){return ua}),i.d(e,"ShaderChunk",function(){return ca}),i.d(e,"FogExp2",function(){return Jt}),i.d(e,"Fog",function(){return $t}),i.d(e,"Scene",function(){return te}),i.d(e,"LensFlare",function(){return ee}),i.d(e,"Sprite",function(){return ne}),i.d(e,"LOD",function(){return re}),i.d(e,"SkinnedMesh",function(){return ae}),i.d(e,"Skeleton",function(){return oe}),i.d(e,"Bone",function(){return se}),i.d(e,"Mesh",function(){return Dt}),i.d(e,"LineSegments",function(){return ce}),i.d(e,"LineLoop",function(){return le}),i.d(e,"Line",function(){return ue}),i.d(e,"Points",function(){return pe}),i.d(e,"Group",function(){return fe}),i.d(e,"VideoTexture",function(){return me}),i.d(e,"DataTexture",function(){return d}),i.d(e,"CompressedTexture",function(){return ge}),i.d(e,"CubeTexture",function(){return p}),i.d(e,"CanvasTexture",function(){return ye}),i.d(e,"DepthTexture",function(){return ve}),i.d(e,"Texture",function(){return o}),i.d(e,"CompressedTextureLoader",function(){return fi}),i.d(e,"DataTextureLoader",function(){return mi}),i.d(e,"CubeTextureLoader",function(){return yi}),i.d(e,"TextureLoader",function(){return vi}),i.d(e,"ObjectLoader",function(){return qi}),i.d(e,"MaterialLoader",function(){return Hi}),i.d(e,"BufferGeometryLoader",function(){return zi}),i.d(e,"DefaultLoadingManager",function(){return xa}),i.d(e,"LoadingManager",function(){return di}),i.d(e,"JSONLoader",function(){return Xi}),i.d(e,"ImageLoader",function(){return gi}),i.d(e,"FontLoader",function(){return un}),i.d(e,"FileLoader",function(){return pi}),i.d(e,"Loader",function(){return Wi}),i.d(e,"Cache",function(){return ba}),i.d(e,"AudioLoader",function(){return cn}),i.d(e,"SpotLightShadow",function(){return wi}),i.d(e,"SpotLight",function(){return Ti}),i.d(e,"PointLight",function(){return Si}),i.d(e,"RectAreaLight",function(){return Mi}),i.d(e,"HemisphereLight",function(){return xi}),i.d(e,"DirectionalLightShadow",function(){return Ei}),i.d(e,"DirectionalLight",function(){return Ci}),i.d(e,"AmbientLight",function(){return Pi}),i.d(e,"LightShadow",function(){return _i}),i.d(e,"Light",function(){return bi}),i.d(e,"StereoCamera",function(){return ln}),i.d(e,"PerspectiveCamera",function(){return lt}),i.d(e,"OrthographicCamera",function(){return ct}),i.d(e,"CubeCamera",function(){return dn}),i.d(e,"ArrayCamera",function(){return Zt}),i.d(e,"Camera",function(){return ut}),i.d(e,"AudioListener",function(){return pn}),i.d(e,"PositionalAudio",function(){return mn}),i.d(e,"AudioContext",function(){return Aa}),i.d(e,"AudioAnalyser",function(){return gn}),i.d(e,"Audio",function(){return fn}),i.d(e,"VectorKeyframeTrack",function(){return Bi}),i.d(e,"StringKeyframeTrack",function(){return Ui}),i.d(e,"QuaternionKeyframeTrack",function(){return Di}),i.d(e,"NumberKeyframeTrack",function(){return Fi}),i.d(e,"ColorKeyframeTrack",function(){return Gi}),i.d(e,"BooleanKeyframeTrack",function(){return Ni}),i.d(e,"PropertyMixer",function(){return yn}),i.d(e,"PropertyBinding",function(){return bn}),i.d(e,"KeyframeTrack",function(){return ji}),i.d(e,"AnimationUtils",function(){return _a}),i.d(e,"AnimationObjectGroup",function(){return xn}),i.d(e,"AnimationMixer",function(){return wn}),i.d(e,"AnimationClip",function(){return Vi}),i.d(e,"Uniform",function(){return Tn}),i.d(e,"InstancedBufferGeometry",function(){return Sn}),i.d(e,"BufferGeometry",function(){return Pt}),i.d(e,"GeometryIdCount",function(){return pt}),i.d(e,"Geometry",function(){return ft}),i.d(e,"InterleavedBufferAttribute",function(){return En}),i.d(e,"InstancedInterleavedBuffer",function(){return Pn}),i.d(e,"InterleavedBuffer",function(){return Cn}),i.d(e,"InstancedBufferAttribute",function(){return Mn}),i.d(e,"Face3",function(){return dt}),i.d(e,"Object3D",function(){return ht}),i.d(e,"Raycaster",function(){return An}),i.d(e,"Layers",function(){return at}),i.d(e,"EventDispatcher",function(){return n}),i.d(e,"Clock",function(){return On}),i.d(e,"QuaternionLinearInterpolant",function(){return ki}),i.d(e,"LinearInterpolant",function(){return Li}),i.d(e,"DiscreteInterpolant",function(){return Oi}),i.d(e,"CubicInterpolant",function(){return Ri}),i.d(e,"Interpolant",function(){return Ai}),i.d(e,"Triangle",function(){return kt}),i.d(e,"Math",function(){return Js}),i.d(e,"Spherical",function(){return In}),i.d(e,"Cylindrical",function(){return Bn}),i.d(e,"Plane",function(){return it}),i.d(e,"Frustum",function(){return nt}),i.d(e,"Sphere",function(){return tt}),i.d(e,"Ray",function(){return It}),i.d(e,"Matrix4",function(){return l}),i.d(e,"Matrix3",function(){return et}),i.d(e,"Box3",function(){return $}),i.d(e,"Box2",function(){return q}),i.d(e,"Line3",function(){return Bt}),i.d(e,"Euler",function(){return st}),i.d(e,"Vector4",function(){return s}),i.d(e,"Vector3",function(){return c}),i.d(e,"Vector2",function(){return r}),i.d(e,"Quaternion",function(){return u}),i.d(e,"Color",function(){return X}),i.d(e,"MorphBlendMesh",function(){return kn}),i.d(e,"ImmediateRenderObject",function(){return Dn}),i.d(e,"VertexNormalsHelper",function(){return Fn}),i.d(e,"SpotLightHelper",function(){return Un}),i.d(e,"SkeletonHelper",function(){return Gn}),i.d(e,"PointLightHelper",function(){return jn}),i.d(e,"RectAreaLightHelper",function(){return Vn}),i.d(e,"HemisphereLightHelper",function(){return Hn}),i.d(e,"GridHelper",function(){return zn}),i.d(e,"PolarGridHelper",function(){return Wn}),i.d(e,"FaceNormalsHelper",function(){return Xn}),i.d(e,"DirectionalLightHelper",function(){return qn}),i.d(e,"CameraHelper",function(){return Yn}),i.d(e,"BoxHelper",function(){return Kn}),i.d(e,"ArrowHelper",function(){return Zn}),i.d(e,"AxisHelper",function(){return Qn}),i.d(e,"CatmullRomCurve3",function(){return $n}),i.d(e,"CubicBezierCurve3",function(){return tr}),i.d(e,"QuadraticBezierCurve3",function(){return er}),i.d(e,"LineCurve3",function(){return ir}),i.d(e,"ArcCurve",function(){return nr}),i.d(e,"EllipseCurve",function(){return tn}),i.d(e,"SplineCurve",function(){return en}),i.d(e,"CubicBezierCurve",function(){return nn}),i.d(e,"QuadraticBezierCurve",function(){return rn}),i.d(e,"LineCurve",function(){return Ji}),i.d(e,"Shape",function(){return sn}),i.d(e,"Path",function(){return on}),i.d(e,"ShapePath",function(){return an}),i.d(e,"Font",function(){return hn}),i.d(e,"CurvePath",function(){return $i}),i.d(e,"Curve",function(){return Qi}),i.d(e,"ShapeUtils",function(){return ga}),i.d(e,"SceneUtils",function(){return Da}),i.d(e,"WireframeGeometry",function(){return be}),i.d(e,"ParametricGeometry",function(){return xe}),i.d(e,"ParametricBufferGeometry",function(){return _e}),i.d(e,"TetrahedronGeometry",function(){return Se}),i.d(e,"TetrahedronBufferGeometry",function(){return Ee}),i.d(e,"OctahedronGeometry",function(){return Ce}),i.d(e,"OctahedronBufferGeometry",function(){return Pe}),i.d(e,"IcosahedronGeometry",function(){return Me}),i.d(e,"IcosahedronBufferGeometry",function(){return Ae}),i.d(e,"DodecahedronGeometry",function(){return Re}),i.d(e,"DodecahedronBufferGeometry",function(){return Le}),i.d(e,"PolyhedronGeometry",function(){return we}),i.d(e,"PolyhedronBufferGeometry",function(){return Te}),i.d(e,"TubeGeometry",function(){return Oe}),i.d(e,"TubeBufferGeometry",function(){return Ie}),i.d(e,"TorusKnotGeometry",function(){return Be}),i.d(e,"TorusKnotBufferGeometry",function(){return ke}),i.d(e,"TorusGeometry",function(){return De}),i.d(e,"TorusBufferGeometry",function(){return Fe}),i.d(e,"TextGeometry",function(){return Ge}),i.d(e,"TextBufferGeometry",function(){return je}),i.d(e,"SphereGeometry",function(){return Ve}),i.d(e,"SphereBufferGeometry",function(){return He}),i.d(e,"RingGeometry",function(){return ze}),i.d(e,"RingBufferGeometry",function(){return We}),i.d(e,"PlaneGeometry",function(){return Rt}),i.d(e,"PlaneBufferGeometry",function(){return Lt}),i.d(e,"LatheGeometry",function(){return Xe}),i.d(e,"LatheBufferGeometry",function(){return qe}),i.d(e,"ShapeGeometry",function(){return Ye}),i.d(e,"ShapeBufferGeometry",function(){return Ke}),i.d(e,"ExtrudeGeometry",function(){return Ue}),i.d(e,"ExtrudeBufferGeometry",function(){return Ne}),i.d(e,"EdgesGeometry",function(){return Ze}),i.d(e,"ConeGeometry",function(){return $e}),i.d(e,"ConeBufferGeometry",function(){return ti}),i.d(e,"CylinderGeometry",function(){return Qe}),i.d(e,"CylinderBufferGeometry",function(){return Je}),i.d(e,"CircleGeometry",function(){return ei}),i.d(e,"CircleBufferGeometry",function(){return ii}),i.d(e,"BoxGeometry",function(){return Mt}),i.d(e,"BoxBufferGeometry",function(){return At}),i.d(e,"ShadowMaterial",function(){return ni}),i.d(e,"SpriteMaterial",function(){return ie}),i.d(e,"RawShaderMaterial",function(){return ri}),i.d(e,"ShaderMaterial",function(){return Q}),i.d(e,"PointsMaterial",function(){return de}),i.d(e,"MeshPhysicalMaterial",function(){return si}),i.d(e,"MeshStandardMaterial",function(){return oi}),i.d(e,"MeshPhongMaterial",function(){return ai}),i.d(e,"MeshToonMaterial",function(){return hi}),i.d(e,"MeshNormalMaterial",function(){return ui}),i.d(e,"MeshLambertMaterial",function(){return ci}),i.d(e,"MeshDepthMaterial",function(){return J}),i.d(e,"MeshBasicMaterial",function(){return Ot}),i.d(e,"LineDashedMaterial",function(){return li}),i.d(e,"LineBasicMaterial",function(){return he}),i.d(e,"Material",function(){return Z}),i.d(e,"Float64BufferAttribute",function(){return St}),i.d(e,"Float32BufferAttribute",function(){return Tt}),i.d(e,"Uint32BufferAttribute",function(){return wt}),i.d(e,"Int32BufferAttribute",function(){return _t}),i.d(e,"Uint16BufferAttribute",function(){return xt}),i.d(e,"Int16BufferAttribute",function(){return bt}),i.d(e,"Uint8ClampedBufferAttribute",function(){return vt}),i.d(e,"Uint8BufferAttribute",function(){return yt}),i.d(e,"Int8BufferAttribute",function(){return gt}),i.d(e,"BufferAttribute",function(){return mt}),i.d(e,"REVISION",function(){return Br}),i.d(e,"MOUSE",function(){return kr}),i.d(e,"CullFaceNone",function(){return Dr}),i.d(e,"CullFaceBack",function(){return Fr}),i.d(e,"CullFaceFront",function(){return Ur}),i.d(e,"CullFaceFrontBack",function(){return Nr}),i.d(e,"FrontFaceDirectionCW",function(){return Gr}),i.d(e,"FrontFaceDirectionCCW",function(){return jr}),i.d(e,"BasicShadowMap",function(){return Vr}),i.d(e,"PCFShadowMap",function(){return Hr}),i.d(e,"PCFSoftShadowMap",function(){return zr}),i.d(e,"FrontSide",function(){return Wr}),i.d(e,"BackSide",function(){return Xr}),i.d(e,"DoubleSide",function(){return qr}),i.d(e,"FlatShading",function(){return Yr}),i.d(e,"SmoothShading",function(){return Kr}),i.d(e,"NoColors",function(){return Zr}),i.d(e,"FaceColors",function(){return Qr}),i.d(e,"VertexColors",function(){return Jr}),i.d(e,"NoBlending",function(){return $r}),i.d(e,"NormalBlending",function(){return to}),i.d(e,"AdditiveBlending",function(){return eo}),i.d(e,"SubtractiveBlending",function(){return io}),i.d(e,"MultiplyBlending",function(){return no}),i.d(e,"CustomBlending",function(){return ro}),i.d(e,"AddEquation",function(){return oo}),i.d(e,"SubtractEquation",function(){return so}),i.d(e,"ReverseSubtractEquation",function(){return ao}),i.d(e,"MinEquation",function(){return ho}),i.d(e,"MaxEquation",function(){return uo}),i.d(e,"ZeroFactor",function(){return co}),i.d(e,"OneFactor",function(){return lo}),i.d(e,"SrcColorFactor",function(){return po}),i.d(e,"OneMinusSrcColorFactor",function(){return fo}),i.d(e,"SrcAlphaFactor",function(){return mo}),i.d(e,"OneMinusSrcAlphaFactor",function(){return go}),i.d(e,"DstAlphaFactor",function(){return yo}),i.d(e,"OneMinusDstAlphaFactor",function(){return vo}),i.d(e,"DstColorFactor",function(){return bo}),i.d(e,"OneMinusDstColorFactor",function(){return xo}),i.d(e,"SrcAlphaSaturateFactor",function(){return _o}),i.d(e,"NeverDepth",function(){return wo}),i.d(e,"AlwaysDepth",function(){return To}),i.d(e,"LessDepth",function(){return So}),i.d(e,"LessEqualDepth",function(){return Eo}),i.d(e,"EqualDepth",function(){return Co}),i.d(e,"GreaterEqualDepth",function(){return Po}),i.d(e,"GreaterDepth",function(){return Mo}),i.d(e,"NotEqualDepth",function(){return Ao}),i.d(e,"MultiplyOperation",function(){return Ro}),i.d(e,"MixOperation",function(){return Lo}),i.d(e,"AddOperation",function(){return Oo}),i.d(e,"NoToneMapping",function(){return Io}),i.d(e,"LinearToneMapping",function(){return Bo}),i.d(e,"ReinhardToneMapping",function(){return ko}),i.d(e,"Uncharted2ToneMapping",function(){return Do}),i.d(e,"CineonToneMapping",function(){return Fo}),i.d(e,"UVMapping",function(){return Uo}),i.d(e,"CubeReflectionMapping",function(){return No}),i.d(e,"CubeRefractionMapping",function(){return Go}),i.d(e,"EquirectangularReflectionMapping",function(){return jo}),i.d(e,"EquirectangularRefractionMapping",function(){return Vo}),i.d(e,"SphericalReflectionMapping",function(){return Ho}),i.d(e,"CubeUVReflectionMapping",function(){return zo}),i.d(e,"CubeUVRefractionMapping",function(){return Wo}),i.d(e,"RepeatWrapping",function(){return Xo}),i.d(e,"ClampToEdgeWrapping",function(){return qo}),i.d(e,"MirroredRepeatWrapping",function(){return Yo}),i.d(e,"NearestFilter",function(){return Ko}),i.d(e,"NearestMipMapNearestFilter",function(){return Zo}),i.d(e,"NearestMipMapLinearFilter",function(){return Qo}),i.d(e,"LinearFilter",function(){return Jo}),i.d(e,"LinearMipMapNearestFilter",function(){return $o}),i.d(e,"LinearMipMapLinearFilter",function(){return ts}),i.d(e,"UnsignedByteType",function(){return es}),i.d(e,"ByteType",function(){return is}),i.d(e,"ShortType",function(){return ns}),i.d(e,"UnsignedShortType",function(){return rs}),i.d(e,"IntType",function(){return os}),i.d(e,"UnsignedIntType",function(){return ss}),i.d(e,"FloatType",function(){return as}),i.d(e,"HalfFloatType",function(){return hs}),i.d(e,"UnsignedShort4444Type",function(){return us}),i.d(e,"UnsignedShort5551Type",function(){return cs}),i.d(e,"UnsignedShort565Type",function(){return ls}),i.d(e,"UnsignedInt248Type",function(){return ds}),i.d(e,"AlphaFormat",function(){return ps}),i.d(e,"RGBFormat",function(){return fs}),i.d(e,"RGBAFormat",function(){return ms}),i.d(e,"LuminanceFormat",function(){return gs}),i.d(e,"LuminanceAlphaFormat",function(){return ys}),i.d(e,"RGBEFormat",function(){return vs}),i.d(e,"DepthFormat",function(){return bs}),i.d(e,"DepthStencilFormat",function(){return xs}),i.d(e,"RGB_S3TC_DXT1_Format",function(){return _s}),i.d(e,"RGBA_S3TC_DXT1_Format",function(){return ws}),i.d(e,"RGBA_S3TC_DXT3_Format",function(){return Ts}),i.d(e,"RGBA_S3TC_DXT5_Format",function(){return Ss}),i.d(e,"RGB_PVRTC_4BPPV1_Format",function(){return Es}),i.d(e,"RGB_PVRTC_2BPPV1_Format",function(){return Cs}),i.d(e,"RGBA_PVRTC_4BPPV1_Format",function(){return Ps}),i.d(e,"RGBA_PVRTC_2BPPV1_Format",function(){return Ms}),i.d(e,"RGB_ETC1_Format",function(){return As}),i.d(e,"LoopOnce",function(){return Rs}),i.d(e,"LoopRepeat",function(){return Ls}),i.d(e,"LoopPingPong",function(){return Os}),i.d(e,"InterpolateDiscrete",function(){return Is}),i.d(e,"InterpolateLinear",function(){return Bs}),i.d(e,"InterpolateSmooth",function(){return ks}),i.d(e,"ZeroCurvatureEnding",function(){return Ds}),i.d(e,"ZeroSlopeEnding",function(){return Fs}),i.d(e,"WrapAroundEnding",function(){return Us}),i.d(e,"TrianglesDrawMode",function(){return Ns}),i.d(e,"TriangleStripDrawMode",function(){return Gs}),i.d(e,"TriangleFanDrawMode",function(){return js}),i.d(e,"LinearEncoding",function(){return Vs}),i.d(e,"sRGBEncoding",function(){return Hs}),i.d(e,"GammaEncoding",function(){return zs}),i.d(e,"RGBEEncoding",function(){return Ws}),i.d(e,"LogLuvEncoding",function(){return Xs}),i.d(e,"RGBM7Encoding",function(){return qs}),i.d(e,"RGBM16Encoding",function(){return Ys}),i.d(e,"RGBDEncoding",function(){return Ks}),i.d(e,"BasicDepthPacking",function(){return Zs}),i.d(e,"RGBADepthPacking",function(){return Qs}),i.d(e,"CubeGeometry",function(){return Mt}),i.d(e,"Face4",function(){return rr}),i.d(e,"LineStrip",function(){return Fa}),i.d(e,"LinePieces",function(){return Ua}),i.d(e,"MeshFaceMaterial",function(){return or}),i.d(e,"MultiMaterial",function(){return sr}),i.d(e,"PointCloud",function(){return ar}),i.d(e,"Particle",function(){return hr}),i.d(e,"ParticleSystem",function(){return ur}),i.d(e,"PointCloudMaterial",function(){return cr}),i.d(e,"ParticleBasicMaterial",function(){return lr}),i.d(e,"ParticleSystemMaterial",function(){return dr}),i.d(e,"Vertex",function(){return pr}),i.d(e,"DynamicBufferAttribute",function(){return fr}),i.d(e,"Int8Attribute",function(){return mr}),i.d(e,"Uint8Attribute",function(){return gr}),i.d(e,"Uint8ClampedAttribute",function(){return yr}),i.d(e,"Int16Attribute",function(){return vr}),i.d(e,"Uint16Attribute",function(){return br}),i.d(e,"Int32Attribute",function(){return xr}),i.d(e,"Uint32Attribute",function(){return _r}),i.d(e,"Float32Attribute",function(){return wr}),i.d(e,"Float64Attribute",function(){return Tr}),i.d(e,"ClosedSplineCurve3",function(){return Sr}),i.d(e,"SplineCurve3",function(){return Er}),i.d(e,"Spline",function(){return Cr}),i.d(e,"BoundingBoxHelper",function(){return Pr}),i.d(e,"EdgesHelper",function(){return Mr}),i.d(e,"WireframeHelper",function(){return Ar}),i.d(e,"XHRLoader",function(){return Rr}),i.d(e,"BinaryTextureLoader",function(){return Lr}),i.d(e,"GeometryUtils",function(){return Na}),i.d(e,"ImageUtils",function(){return Ga}),i.d(e,"Projector",function(){return Or}),i.d(e,"CanvasRenderer",function(){return Ir}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),Object.assign(n.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),n=0,r=i.length;n<r;n++)i[n].call(this,t)}}}});var Br="86",kr={LEFT:0,MIDDLE:1,RIGHT:2},Dr=0,Fr=1,Ur=2,Nr=3,Gr=0,jr=1,Vr=0,Hr=1,zr=2,Wr=0,Xr=1,qr=2,Yr=1,Kr=2,Zr=0,Qr=1,Jr=2,$r=0,to=1,eo=2,io=3,no=4,ro=5,oo=100,so=101,ao=102,ho=103,uo=104,co=200,lo=201,po=202,fo=203,mo=204,go=205,yo=206,vo=207,bo=208,xo=209,_o=210,wo=0,To=1,So=2,Eo=3,Co=4,Po=5,Mo=6,Ao=7,Ro=0,Lo=1,Oo=2,Io=0,Bo=1,ko=2,Do=3,Fo=4,Uo=300,No=301,Go=302,jo=303,Vo=304,Ho=305,zo=306,Wo=307,Xo=1e3,qo=1001,Yo=1002,Ko=1003,Zo=1004,Qo=1005,Jo=1006,$o=1007,ts=1008,es=1009,is=1010,ns=1011,rs=1012,os=1013,ss=1014,as=1015,hs=1016,us=1017,cs=1018,ls=1019,ds=1020,ps=1021,fs=1022,ms=1023,gs=1024,ys=1025,vs=ms,bs=1026,xs=1027,_s=2001,ws=2002,Ts=2003,Ss=2004,Es=2100,Cs=2101,Ps=2102,Ms=2103,As=2151,Rs=2200,Ls=2201,Os=2202,Is=2300,Bs=2301,ks=2302,Ds=2400,Fs=2401,Us=2402,Ns=0,Gs=1,js=2,Vs=3e3,Hs=3001,zs=3007,Ws=3002,Xs=3003,qs=3004,Ys=3005,Ks=3006,Zs=3200,Qs=3201,Js={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,i[r]=e[19===r?3&t|8:t]);return i.join("")}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Js.DEG2RAD},radToDeg:function(t){return t*Js.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}};Object.defineProperties(r.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(r.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new r,e=new r;return function(i,n){return t.set(i,i),e.set(n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*n+t.x,this.y=r*n+o*i+t.y,this}});var $s=0;o.DEFAULT_IMAGE=void 0,o.DEFAULT_MAPPING=Uo,Object.defineProperty(o.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(o.prototype,n.prototype,{constructor:o,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var e={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=Js.generateUUID()),void 0===t.images[i.uuid]&&(t.images[i.uuid]={uuid:i.uuid,url:function(t){var e;return void 0!==t.toDataURL?e=t:((e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height)),e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(i)}),e.image=i.uuid}return t.textures[this.uuid]=e,e},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===Uo){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||t.x>1)switch(this.wrapS){case Xo:t.x=t.x-Math.floor(t.x);break;case qo:t.x=t.x<0?0:1;break;case Yo:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Xo:t.y=t.y-Math.floor(t.y);break;case qo:t.y=t.y<0?0:1;break;case Yo:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.assign(s.prototype,{isVector4:!0,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*e+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*e+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*e+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,r,o=t.elements,s=o[0],a=o[4],h=o[8],u=o[1],c=o[5],l=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(a-u)<.01&&Math.abs(h-d)<.01&&Math.abs(l-p)<.01){if(Math.abs(a+u)<.1&&Math.abs(h+d)<.1&&Math.abs(l+p)<.1&&Math.abs(s+c+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(s+1)/2,g=(c+1)/2,y=(f+1)/2,v=(a+u)/4,b=(h+d)/4,x=(l+p)/4;return m>g&&m>y?m<.01?(i=0,n=.707106781,r=.707106781):(n=v/(i=Math.sqrt(m)),r=b/i):g>y?g<.01?(i=.707106781,n=0,r=.707106781):(i=v/(n=Math.sqrt(g)),r=x/n):y<.01?(i=.707106781,n=.707106781,r=0):(i=b/(r=Math.sqrt(y)),n=x/r),this.set(i,n,r,e),this}var _=Math.sqrt((p-l)*(p-l)+(h-d)*(h-d)+(u-a)*(u-a));return Math.abs(_)<.001&&(_=1),this.x=(p-l)/_,this.y=(h-d)/_,this.z=(u-a)/_,this.w=Math.acos((s+c+f-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(i,n){return void 0===t&&(t=new s,e=new s),t.set(i,i,i,i),e.set(n,n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),Object.assign(a.prototype,n.prototype,{isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.isWebGLRenderTargetCube=!0,Object.assign(u,{slerp:function(t,e,i,n){return i.copy(t).slerp(e,n)},slerpFlat:function(t,e,i,n,r,o,s){var a=i[n+0],h=i[n+1],u=i[n+2],c=i[n+3],l=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(c!==f||a!==l||h!==d||u!==p){var m=1-s,g=a*l+h*d+u*p+c*f,y=g>=0?1:-1,v=1-g*g;if(v>Number.EPSILON){var b=Math.sqrt(v),x=Math.atan2(b,g*y);m=Math.sin(m*x)/b,s=Math.sin(s*x)/b}var _=s*y;if(a=a*m+l*_,h=h*m+d*_,u=u*m+p*_,c=c*m+f*_,m===1-s){var w=1/Math.sqrt(a*a+h*h+u*u+c*c);a*=w,h*=w,u*=w,c*=w}}t[e]=a,t[e+1]=h,t[e+2]=u,t[e+3]=c}}),Object.defineProperties(u.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(u.prototype,{set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,n=t._y,r=t._z,o=t.order,s=Math.cos,a=Math.sin,h=s(i/2),u=s(n/2),c=s(r/2),l=a(i/2),d=a(n/2),p=a(r/2);return"XYZ"===o?(this._x=l*u*c+h*d*p,this._y=h*d*c-l*u*p,this._z=h*u*p+l*d*c,this._w=h*u*c-l*d*p):"YXZ"===o?(this._x=l*u*c+h*d*p,this._y=h*d*c-l*u*p,this._z=h*u*p-l*d*c,this._w=h*u*c+l*d*p):"ZXY"===o?(this._x=l*u*c-h*d*p,this._y=h*d*c+l*u*p,this._z=h*u*p+l*d*c,this._w=h*u*c-l*d*p):"ZYX"===o?(this._x=l*u*c-h*d*p,this._y=h*d*c+l*u*p,this._z=h*u*p-l*d*c,this._w=h*u*c+l*d*p):"YZX"===o?(this._x=l*u*c+h*d*p,this._y=h*d*c+l*u*p,this._z=h*u*p-l*d*c,this._w=h*u*c-l*d*p):"XZY"===o&&(this._x=l*u*c-h*d*p,this._y=h*d*c-l*u*p,this._z=h*u*p+l*d*c,this._w=h*u*c+l*d*p),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,n=i[0],r=i[4],o=i[8],s=i[1],a=i[5],h=i[9],u=i[2],c=i[6],l=i[10],d=n+a+l;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-h)*e,this._y=(o-u)*e,this._z=(s-r)*e):n>a&&n>l?(e=2*Math.sqrt(1+n-a-l),this._w=(c-h)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(o+u)/e):a>l?(e=2*Math.sqrt(1+a-n-l),this._w=(o-u)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(h+c)/e):(e=2*Math.sqrt(1+l-n-a),this._w=(s-r)/e,this._x=(o+u)/e,this._y=(h+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new c;return function(i,n){return void 0===e&&(e=new c),(t=i.dot(n)+1)<1e-6?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,o=t._w,s=e._x,a=e._y,h=e._z,u=e._w;return this._x=i*u+o*s+n*h-r*a,this._y=n*u+o*a+r*s-i*h,this._z=r*u+o*h+i*a-n*s,this._w=o*u-i*s-n*a-r*h,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,o=this._w,s=o*t._w+i*t._x+n*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var h=Math.atan2(a,s),u=Math.sin((1-e)*h)/a,c=Math.sin(e*h)/a;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=n*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(c.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new u;return function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new u;return function(e,i){return this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,o=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z,a=t.w,h=a*e+o*n-s*i,u=a*i+s*e-r*n,c=a*n+r*i-o*e,l=-r*e-o*i-s*n;return this.x=h*a+l*-r+u*-s-c*-o,this.y=u*a+l*-o+c*-r-h*-s,this.z=c*a+l*-s+h*-o-u*-r,this},project:function(){var t=new l;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new l;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new c,e=new c;return function(i,n){return t.set(i,i,i),e.set(n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-i*t.z,this.z=i*t.y-n*t.x,this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,o=e.x,s=e.y,a=e.z;return this.x=n*a-r*s,this.y=r*o-i*a,this.z=i*s-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new c;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new c;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(Js.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(l.prototype,{isMatrix4:!0,set:function(t,e,i,n,r,o,s,a,h,u,c,l,d,p,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=h,g[6]=u,g[10]=c,g[14]=l,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new l).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(){var t=new c;return function(e){var i=this.elements,n=e.elements,r=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),s=1/t.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,n=t.y,r=t.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(n),h=Math.sin(n),u=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var l=o*u,d=o*c,p=s*u,f=s*c;e[0]=a*u,e[4]=-a*c,e[8]=h,e[1]=d+p*h,e[5]=l-f*h,e[9]=-s*a,e[2]=f-l*h,e[6]=p+d*h,e[10]=o*a}else if("YXZ"===t.order){var m=a*u,g=a*c,y=h*u,v=h*c;e[0]=m+v*s,e[4]=y*s-g,e[8]=o*h,e[1]=o*c,e[5]=o*u,e[9]=-s,e[2]=g*s-y,e[6]=v+m*s,e[10]=o*a}else if("ZXY"===t.order){m=a*u,g=a*c,y=h*u,v=h*c;e[0]=m-v*s,e[4]=-o*c,e[8]=y+g*s,e[1]=g+y*s,e[5]=o*u,e[9]=v-m*s,e[2]=-o*h,e[6]=s,e[10]=o*a}else if("ZYX"===t.order){l=o*u,d=o*c,p=s*u,f=s*c;e[0]=a*u,e[4]=p*h-d,e[8]=l*h+f,e[1]=a*c,e[5]=f*h+l,e[9]=d*h-p,e[2]=-h,e[6]=s*a,e[10]=o*a}else if("YZX"===t.order){var b=o*a,x=o*h,_=s*a,w=s*h;e[0]=a*u,e[4]=w-b*c,e[8]=_*c+x,e[1]=c,e[5]=o*u,e[9]=-s*u,e[2]=-h*u,e[6]=x*c+_,e[10]=b-w*c}else if("XZY"===t.order){b=o*a,x=o*h,_=s*a,w=s*h;e[0]=a*u,e[4]=-c,e[8]=h*u,e[1]=b*c+w,e[5]=o*u,e[9]=x*c-_,e[2]=_*c-x,e[6]=s*u,e[10]=w*c+b}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t._x,n=t._y,r=t._z,o=t._w,s=i+i,a=n+n,h=r+r,u=i*s,c=i*a,l=i*h,d=n*a,p=n*h,f=r*h,m=o*s,g=o*a,y=o*h;return e[0]=1-(d+f),e[4]=c-y,e[8]=l+g,e[1]=c+y,e[5]=1-(u+f),e[9]=p-m,e[2]=l-g,e[6]=p+m,e[10]=1-(u+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new c,e=new c,i=new c;return function(n,r,o){var s=this.elements;return i.subVectors(n,r),0===i.lengthSq()&&(i.z=1),i.normalize(),t.crossVectors(o,i),0===t.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),t.crossVectors(o,i)),t.normalize(),e.crossVectors(i,t),s[0]=t.x,s[4]=e.x,s[8]=i.x,s[1]=t.y,s[5]=e.y,s[9]=i.y,s[2]=t.z,s[6]=e.z,s[10]=i.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,o=i[0],s=i[4],a=i[8],h=i[12],u=i[1],c=i[5],l=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],y=i[3],v=i[7],b=i[11],x=i[15],_=n[0],w=n[4],T=n[8],S=n[12],E=n[1],C=n[5],P=n[9],M=n[13],A=n[2],R=n[6],L=n[10],O=n[14],I=n[3],B=n[7],k=n[11],D=n[15];return r[0]=o*_+s*E+a*A+h*I,r[4]=o*w+s*C+a*R+h*B,r[8]=o*T+s*P+a*L+h*k,r[12]=o*S+s*M+a*O+h*D,r[1]=u*_+c*E+l*A+d*I,r[5]=u*w+c*C+l*R+d*B,r[9]=u*T+c*P+l*L+d*k,r[13]=u*S+c*M+l*O+d*D,r[2]=p*_+f*E+m*A+g*I,r[6]=p*w+f*C+m*R+g*B,r[10]=p*T+f*P+m*L+g*k,r[14]=p*S+f*M+m*O+g*D,r[3]=y*_+v*E+b*A+x*I,r[7]=y*w+v*C+b*R+x*B,r[11]=y*T+v*P+b*L+x*k,r[15]=y*S+v*M+b*O+x*D,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new c;return function(e){for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],o=t[1],s=t[5],a=t[9],h=t[13],u=t[2],c=t[6],l=t[10],d=t[14];return t[3]*(+r*a*c-n*h*c-r*s*l+i*h*l+n*s*d-i*a*d)+t[7]*(+e*a*d-e*h*l+r*o*l-n*o*d+n*h*u-r*a*u)+t[11]*(+e*h*c-e*s*d-r*o*c+i*o*d+r*s*u-i*h*u)+t[15]*(-n*s*u-e*a*c+e*s*l+n*o*c-i*o*l+i*a*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],o=n[1],s=n[2],a=n[3],h=n[4],u=n[5],c=n[6],l=n[7],d=n[8],p=n[9],f=n[10],m=n[11],g=n[12],y=n[13],v=n[14],b=n[15],x=p*v*l-y*f*l+y*c*m-u*v*m-p*c*b+u*f*b,_=g*f*l-d*v*l-g*c*m+h*v*m+d*c*b-h*f*b,w=d*y*l-g*p*l+g*u*m-h*y*m-d*u*b+h*p*b,T=g*p*c-d*y*c-g*u*f+h*y*f+d*u*v-h*p*v,S=r*x+o*_+s*w+a*T;if(0===S){var E="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(!0===e)throw new Error(E);return console.warn(E),this.identity()}var C=1/S;return i[0]=x*C,i[1]=(y*f*a-p*v*a-y*s*m+o*v*m+p*s*b-o*f*b)*C,i[2]=(u*v*a-y*c*a+y*s*l-o*v*l-u*s*b+o*c*b)*C,i[3]=(p*c*a-u*f*a-p*s*l+o*f*l+u*s*m-o*c*m)*C,i[4]=_*C,i[5]=(d*v*a-g*f*a+g*s*m-r*v*m-d*s*b+r*f*b)*C,i[6]=(g*c*a-h*v*a-g*s*l+r*v*l+h*s*b-r*c*b)*C,i[7]=(h*f*a-d*c*a+d*s*l-r*f*l-h*s*m+r*c*m)*C,i[8]=w*C,i[9]=(g*p*a-d*y*a-g*o*m+r*y*m+d*o*b-r*p*b)*C,i[10]=(h*y*a-g*u*a+g*o*l-r*y*l-h*o*b+r*u*b)*C,i[11]=(d*u*a-h*p*a-d*o*l+r*p*l+h*o*m-r*u*m)*C,i[12]=T*C,i[13]=(d*y*s-g*p*s+g*o*f-r*y*f-d*o*v+r*p*v)*C,i[14]=(g*u*s-h*y*s-g*o*c+r*y*c+h*o*v-r*u*v)*C,i[15]=(h*p*s-d*u*s+d*o*c-r*p*c-h*o*f+r*u*f)*C,this},scale:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,o=t.x,s=t.y,a=t.z,h=r*o,u=r*s;return this.set(h*o+i,h*s-n*a,h*a+n*s,0,h*s+n*a,u*s+i,u*a-n*o,0,h*a-n*s,u*a+n*o,r*a*a+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:function(){var t=new c,e=new l;return function(i,n,r){var o=this.elements,s=t.set(o[0],o[1],o[2]).length(),a=t.set(o[4],o[5],o[6]).length(),h=t.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],e.copy(this);var u=1/s,c=1/a,l=1/h;return e.elements[0]*=u,e.elements[1]*=u,e.elements[2]*=u,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=l,e.elements[9]*=l,e.elements[10]*=l,n.setFromRotationMatrix(e),r.x=s,r.y=a,r.z=h,this}}(),makePerspective:function(t,e,i,n,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*r/(e-t),h=2*r/(i-n),u=(e+t)/(e-t),c=(i+n)/(i-n),l=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=h,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=l,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,i,n,r,o){var s=this.elements,a=1/(e-t),h=1/(i-n),u=1/(o-r),c=(e+t)*a,l=(i+n)*h,d=(o+r)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*h,s[9]=0,s[13]=-l,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),(d.prototype=Object.create(o.prototype)).constructor=d,d.prototype.isDataTexture=!0,(p.prototype=Object.create(o.prototype)).constructor=p,p.prototype.isCubeTexture=!0,Object.defineProperty(p.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var ta=new o,ea=new p,ia=[],na=[],ra=new Float32Array(16),oa=new Float32Array(9);V.prototype.setValue=function(t,e){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var o=i[n];o.setValue(t,e[o.id])}};var sa=/([\w\d_]+)(\])?(\[|\.)?/g;W.prototype.setValue=function(t,e,i){var n=this.map[e];void 0!==n&&n.setValue(t,i,this.renderer)},W.prototype.setOptional=function(t,e,i){var n=e[i];void 0!==n&&this.setValue(t,i,n)},W.upload=function(t,e,i,n){for(var r=0,o=e.length;r!==o;++r){var s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}},W.seqWithValue=function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var o=t[n];o.id in e&&i.push(o)}return i};var aa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(X.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,n){if(e=Js.euclideanModulo(e,1),i=Js.clamp(i,0,1),n=Js.clamp(n,0,1),0===i)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+i):n+i-n*i,o=2*n-r;this.r=t(o,r,e+1/3),this.g=t(o,r,e),this.b=t(o,r,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(n[1])/360,a=parseInt(n[2],10)/100,h=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(s,a,h)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u=(c=i[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(t&&t.length>0){var c;void 0!==(c=aa[t])?this.setHex(c):console.warn("THREE.Color: Unknown color "+t)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,i,n=t||{h:0,s:0,l:0},r=this.r,o=this.g,s=this.b,a=Math.max(r,o,s),h=Math.min(r,o,s),u=(h+a)/2;if(h===a)e=0,i=0;else{var c=a-h;switch(i=u<=.5?c/(a+h):c/(2-a-h),a){case r:e=(o-s)/c+(o<s?6:0);break;case o:e=(s-r)/c+2;break;case s:e=(r-o)/c+4}e/=6}return n.h=e,n.s=i,n.l=u,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){var n=this.getHSL();return n.h+=t,n.s+=e,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var ha={common:{diffuse:{value:new X(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new s(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new r(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new X(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new X(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new s(0,0,1,1)}}},ua={merge:function(t){for(var e={},i=0;i<t.length;i++){var n=this.clone(t[i]);for(var r in n)e[r]=n[r]}return e},clone:function(t){var e={};for(var i in t){e[i]={};for(var n in t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}},ca={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = asin( flipNormal * reflectVec.y ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"},la={basic:{uniforms:ua.merge([ha.common,ha.aomap,ha.lightmap,ha.fog]),vertexShader:ca.meshbasic_vert,fragmentShader:ca.meshbasic_frag},lambert:{uniforms:ua.merge([ha.common,ha.aomap,ha.lightmap,ha.emissivemap,ha.fog,ha.lights,{emissive:{value:new X(0)}}]),vertexShader:ca.meshlambert_vert,fragmentShader:ca.meshlambert_frag},phong:{uniforms:ua.merge([ha.common,ha.aomap,ha.lightmap,ha.emissivemap,ha.bumpmap,ha.normalmap,ha.displacementmap,ha.gradientmap,ha.fog,ha.lights,{emissive:{value:new X(0)},specular:{value:new X(1118481)},shininess:{value:30}}]),vertexShader:ca.meshphong_vert,fragmentShader:ca.meshphong_frag},standard:{uniforms:ua.merge([ha.common,ha.aomap,ha.lightmap,ha.emissivemap,ha.bumpmap,ha.normalmap,ha.displacementmap,ha.roughnessmap,ha.metalnessmap,ha.fog,ha.lights,{emissive:{value:new X(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ca.meshphysical_vert,fragmentShader:ca.meshphysical_frag},points:{uniforms:ua.merge([ha.points,ha.fog]),vertexShader:ca.points_vert,fragmentShader:ca.points_frag},dashed:{uniforms:ua.merge([ha.common,ha.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ca.linedashed_vert,fragmentShader:ca.linedashed_frag},depth:{uniforms:ua.merge([ha.common,ha.displacementmap]),vertexShader:ca.depth_vert,fragmentShader:ca.depth_frag},normal:{uniforms:ua.merge([ha.common,ha.bumpmap,ha.normalmap,ha.displacementmap,{opacity:{value:1}}]),vertexShader:ca.normal_vert,fragmentShader:ca.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ca.cube_vert,fragmentShader:ca.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:ca.equirect_vert,fragmentShader:ca.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new c}},vertexShader:ca.distanceRGBA_vert,fragmentShader:ca.distanceRGBA_frag}};la.physical={uniforms:ua.merge([la.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ca.meshphysical_vert,fragmentShader:ca.meshphysical_frag},Object.assign(q.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new r;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){var e=t||new r;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new r;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return(e||new r).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return(e||new r).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new r;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var da=0;Object.assign(Z.prototype,n.prototype,{isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i){var n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]="overdraw"===e?Number(i):i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){function e(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}var i=void 0===t;i&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==to&&(n.blending=this.blending),this.shading!==Kr&&(n.shading=this.shading),this.side!==Wr&&(n.side=this.side),this.vertexColors!==Zr&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),n.skinning=this.skinning,n.morphTargets=this.morphTargets,n.dithering=this.dithering,i){var r=e(t.textures),o=e(t.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.shading=t.shading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,i=null;if(null!==e){var n=e.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Q.prototype=Object.create(Z.prototype)).constructor=Q,Q.prototype.isShaderMaterial=!0,Q.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ua.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Q.prototype.toJSON=function(t){var e=Z.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},(J.prototype=Object.create(Z.prototype)).constructor=J,J.prototype.isMeshDepthMaterial=!0,J.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Object.assign($.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0,a=0,h=t.length;a<h;a+=3){var u=t[a],c=t[a+1],l=t[a+2];u<e&&(e=u),c<i&&(i=c),l<n&&(n=l),u>r&&(r=u),c>o&&(o=c),l>s&&(s=l)}return this.min.set(e,i,n),this.max.set(r,o,s),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0,a=0,h=t.count;a<h;a++){var u=t.getX(a),c=t.getY(a),l=t.getZ(a);u<e&&(e=u),c<i&&(i=c),l<n&&(n=l),u>r&&(r=u),c>o&&(o=c),l>s&&(s=l)}return this.min.set(e,i,n),this.max.set(r,o,s),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new c;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){var e=t||new c;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new c;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t=new c;return function(e){var i=this;return e.updateMatrixWorld(!0),e.traverse(function(e){var n,r,o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(n=0,r=s.length;n<r;n++)t.copy(s[n]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(n=0,r=a.count;n<r;n++)t.fromBufferAttribute(a,n).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}}),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new c).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new c;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant},clampPoint:function(t,e){return(e||new c).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new c;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new c;return function(e){var i=e||new tt;return this.getCenter(i.center),i.radius=.5*this.getSize(t).length(),i}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new c,new c,new c,new c,new c,new c,new c,new c];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(tt.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new $;return function(e,i){var n=this.center;void 0!==i?n.copy(i):t.setFromPoints(e).getCenter(n);for(var r=0,o=0,s=e.length;o<s;o++)r=Math.max(r,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),n=e||new c;return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){var e=t||new $;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(et.prototype,{isMatrix3:!0,set:function(t,e,i,n,r,o,s,a,h){var u=this.elements;return u[0]=t,u[1]=n,u[2]=s,u[3]=e,u[4]=r,u[5]=a,u[6]=i,u[7]=o,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new c;return function(e){for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix3(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,o=i[0],s=i[3],a=i[6],h=i[1],u=i[4],c=i[7],l=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],y=n[1],v=n[4],b=n[7],x=n[2],_=n[5],w=n[8];return r[0]=o*f+s*y+a*x,r[3]=o*m+s*v+a*_,r[6]=o*g+s*b+a*w,r[1]=h*f+u*y+c*x,r[4]=h*m+u*v+c*_,r[7]=h*g+u*b+c*w,r[2]=l*f+d*y+p*x,r[5]=l*m+d*v+p*_,r[8]=l*g+d*b+p*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8];return e*o*u-e*s*h-i*r*u+i*s*a+n*r*h-n*o*a},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var i=t.elements,n=this.elements,r=i[0],o=i[1],s=i[2],a=i[3],h=i[4],u=i[5],c=i[6],l=i[7],d=i[8],p=d*h-u*l,f=u*c-d*a,m=l*a-h*c,g=r*p+o*f+s*m;if(0===g){var y="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(!0===e)throw new Error(y);return console.warn(y),this.identity()}var v=1/g;return n[0]=p*v,n[1]=(s*l-d*o)*v,n[2]=(u*o-s*h)*v,n[3]=f*v,n[4]=(d*r-s*c)*v,n[5]=(s*a-u*r)*v,n[6]=m*v,n[7]=(o*c-l*r)*v,n[8]=(h*r-o*a)*v,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}}),Object.assign(it.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new c,e=new c;return function(i,n,r){var o=t.subVectors(r,n).cross(e.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t);return(e||new c).copy(this.normal).multiplyScalar(i)},intersectLine:function(){var t=new c;return function(e,i){var n=i||new c,r=e.delta(t),o=this.normal.dot(r);if(0!==o){var s=-(e.start.dot(this.normal)+this.constant)/o;if(!(s<0||s>1))return n.copy(r).multiplyScalar(s).add(e.start)}else if(0===this.distanceToPoint(e.start))return n.copy(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new c).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new c,e=new et;return function(i,n){var r=this.coplanarPoint(t).applyMatrix4(i),o=n||e.getNormalMatrix(i),s=this.normal.applyMatrix3(o).normalize();return this.constant=-r.dot(s),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(nt.prototype,{set:function(t,e,i,n,r,o){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],h=i[5],u=i[6],c=i[7],l=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return e[0].setComponents(s-n,c-a,f-l,v-m).normalize(),e[1].setComponents(s+n,c+a,f+l,v+m).normalize(),e[2].setComponents(s+r,c+h,f+d,v+g).normalize(),e[3].setComponents(s-r,c-h,f-d,v-g).normalize(),e[4].setComponents(s-o,c-u,f-p,v-y).normalize(),e[5].setComponents(s+o,c+u,f+p,v+y).normalize(),this},intersectsObject:function(){var t=new tt;return function(e){var i=e.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),t.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new tt;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(i)<n)return!1}return!0},intersectsBox:function(){var t=new c,e=new c;return function(i){for(var n=this.planes,r=0;r<6;r++){var o=n[r];t.x=o.normal.x>0?i.min.x:i.max.x,e.x=o.normal.x>0?i.max.x:i.min.x,t.y=o.normal.y>0?i.min.y:i.max.y,e.y=o.normal.y>0?i.max.y:i.min.y,t.z=o.normal.z>0?i.min.z:i.max.z,e.z=o.normal.z>0?i.max.z:i.min.z;var s=o.distanceToPoint(t),a=o.distanceToPoint(e);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}),st.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],st.DefaultOrder="XYZ",Object.defineProperties(st.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(st.prototype,{isEuler:!0,set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=Js.clamp,r=t.elements,o=r[0],s=r[4],a=r[8],h=r[1],u=r[5],c=r[9],l=r[2],d=r[6],p=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-l,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(h,o))):"ZYX"===e?(this._y=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-s,u))):"YZX"===e?(this._z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===e?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new l;return function(e,i,n){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new u;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new c(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(at.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var pa=0;ht.DefaultUp=new c(0,1,0),ht.DefaultMatrixAutoUpdate=!0,Object.assign(ht.prototype,n.prototype,{isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new u;return function(e,i){return t.setFromAxisAngle(e,i),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new c(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new c(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new c(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new c;return function(e,i){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(i)),this}}(),translateX:function(){var t=new c(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new c(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new c(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new l;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new l;return function(e){this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var i=this.children.indexOf(t);return-1!==i&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){var e=t||new c;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new c,e=new c;return function(i){var n=i||new u;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,n,e),n}}(),getWorldRotation:function(){var t=new u;return function(e){var i=e||new st;return this.getWorldQuaternion(t),i.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new c,e=new u;return function(i){var n=i||new c;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,n),n}}(),getWorldDirection:function(){var t=new u;return function(e){var i=e||new c;return this.getWorldQuaternion(t),i.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},toJSON:function(t){function e(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}function i(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}var n=void 0===t||""===t,r={};n&&(t={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),o.matrix=this.matrix.toArray(),void 0!==this.geometry&&(o.geometry=e(t.geometries,this.geometry)),void 0!==this.material)if(Array.isArray(this.material)){for(var s=[],a=0,h=this.material.length;a<h;a++)s.push(e(t.materials,this.material[a]));o.material=s}else o.material=e(t.materials,this.material);if(this.children.length>0){o.children=[];for(a=0;a<this.children.length;a++)o.children.push(this.children[a].toJSON(t).object)}if(n){var u=i(t.geometries),c=i(t.materials),l=i(t.textures),d=i(t.images);u.length>0&&(r.geometries=u),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),d.length>0&&(r.images=d)}return r.object=o,r},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i=0;i<t.children.length;i++){var n=t.children[i];this.add(n.clone())}return this}}),ut.prototype=Object.assign(Object.create(ht.prototype),{constructor:ut,isCamera:!0,copy:function(t,e){return ht.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new u;return function(e){var i=e||new c;return this.getWorldQuaternion(t),i.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){ht.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ct.prototype=Object.assign(Object.create(ut.prototype),{constructor:ct,isOrthographicCamera:!0,copy:function(t,e){return ut.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,n,r,o){this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,o=i+t,s=n+e,a=n-e;if(null!==this.view){var h=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,l=(this.top-this.bottom)/this.view.height;o=(r+=c*(this.view.offsetX/h))+c*(this.view.width/h),a=(s-=l*(this.view.offsetY/u))-l*(this.view.height/u)}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far)},toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),lt.prototype=Object.assign(Object.create(ut.prototype),{constructor:lt,isPerspectiveCamera:!0,copy:function(t,e){return ut.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*Js.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Js.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Js.RAD2DEG*Math.atan(Math.tan(.5*Js.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,o){this.aspect=t/e,this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Js.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==o){var s=o.fullWidth,a=o.fullHeight;r+=o.offsetX*n/s,e-=o.offsetY*i/a,n*=o.width/s,i*=o.height/a}var h=this.filmOffset;0!==h&&(r+=t*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far)},toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Object.assign(dt.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var fa=0;Object.assign(ft.prototype,n.prototype,{isGeometry:!0,applyMatrix:function(t){for(var e=(new et).getNormalMatrix(t),i=0,n=this.vertices.length;i<n;i++){this.vertices[i].applyMatrix4(t)}for(i=0,n=this.faces.length;i<n;i++){var r=this.faces[i];r.normal.applyMatrix3(e).normalize();for(var o=0,s=r.vertexNormals.length;o<s;o++)r.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new l;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new l;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new l;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new l;return function(e,i,n){return t.makeTranslation(e,i,n),this.applyMatrix(t),this}}(),scale:function(){var t=new l;return function(e,i,n){return t.makeScale(e,i,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new ht;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){function e(t,e,n,r){var o=new dt(t,e,n,void 0!==a?[d[t].clone(),d[e].clone(),d[n].clone()]:[],void 0!==h?[i.colors[t].clone(),i.colors[e].clone(),i.colors[n].clone()]:[],r);i.faces.push(o),void 0!==u&&i.faceVertexUvs[0].push([p[t].clone(),p[e].clone(),p[n].clone()]),void 0!==l&&i.faceVertexUvs[1].push([f[t].clone(),f[e].clone(),f[n].clone()])}var i=this,n=null!==t.index?t.index.array:void 0,o=t.attributes,s=o.position.array,a=void 0!==o.normal?o.normal.array:void 0,h=void 0!==o.color?o.color.array:void 0,u=void 0!==o.uv?o.uv.array:void 0,l=void 0!==o.uv2?o.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var d=[],p=[],f=[],m=0,g=0;m<s.length;m+=3,g+=2)i.vertices.push(new c(s[m],s[m+1],s[m+2])),void 0!==a&&d.push(new c(a[m],a[m+1],a[m+2])),void 0!==h&&i.colors.push(new X(h[m],h[m+1],h[m+2])),void 0!==u&&p.push(new r(u[g],u[g+1])),void 0!==l&&f.push(new r(l[g],l[g+1]));var y=t.groups;if(y.length>0)for(m=0;m<y.length;m++)for(var v=y[m],b=v.start,x=(g=b,b+v.count);g<x;g+=3)void 0!==n?e(n[g],n[g+1],n[g+2],v.materialIndex):e(g,g+1,g+2,v.materialIndex);else if(void 0!==n)for(m=0;m<n.length;m+=3)e(n[m],n[m+1],n[m+2]);else for(m=0;m<s.length/3;m+=3)e(m,m+1,m+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,n=new l;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new c,e=new c,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];t.subVectors(a,s),e.subVectors(o,s),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var e,i,n,r,o,s;for(s=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)s[e]=new c;if(t){var a,h,u,l=new c,d=new c;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],a=this.vertices[o.a],h=this.vertices[o.b],u=this.vertices[o.c],l.subVectors(u,h),d.subVectors(a,h),l.cross(d),s[o.a].add(l),s[o.b].add(l),s[o.c].add(l)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)s[(o=this.faces[n]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(e=0,i=this.vertices.length;e<i;e++)s[e].normalize();for(n=0,r=this.faces.length;n<r;n++){var p=(o=this.faces[n]).vertexNormals;3===p.length?(p[0].copy(s[o.a]),p[1].copy(s[o.b]),p[2].copy(s[o.c])):(p[0]=s[o.a].clone(),p[1]=s[o.b].clone(),p[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(i=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for((r=this.faces[i]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var o=new ft;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s=this.morphNormals[t].faceNormals,a=this.morphNormals[t].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)u=new c,l={a:new c,b:new c,c:new c},s.push(u),a.push(l)}var h=this.morphNormals[t];o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals();var u,l;for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],u=h.faceNormals[i],l=h.vertexNormals[i],u.copy(r.normal),l.a.copy(r.vertexNormals[0]),l.b.copy(r.vertexNormals[1]),l.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var t=0,e=this.vertices,i=0,n=e.length;i<n;i++)i>0&&(t+=e[i].distanceTo(e[i-1])),this.lineDistances[i]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new tt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(t&&t.isGeometry){var n,r=this.vertices.length,o=this.vertices,s=t.vertices,a=this.faces,h=t.faces,u=this.faceVertexUvs[0],c=t.faceVertexUvs[0],l=this.colors,d=t.colors;void 0===i&&(i=0),void 0!==e&&(n=(new et).getNormalMatrix(e));for(var p=0,f=s.length;p<f;p++){var m=s[p].clone();void 0!==e&&m.applyMatrix4(e),o.push(m)}for(p=0,f=d.length;p<f;p++)l.push(d[p].clone());for(p=0,f=h.length;p<f;p++){var g,y,v,b=h[p],x=b.vertexNormals,_=b.vertexColors;(g=new dt(b.a+r,b.b+r,b.c+r)).normal.copy(b.normal),void 0!==n&&g.normal.applyMatrix3(n).normalize();for(var w=0,T=x.length;w<T;w++)y=x[w].clone(),void 0!==n&&y.applyMatrix3(n).normalize(),g.vertexNormals.push(y);g.color.copy(b.color);for(w=0,T=_.length;w<T;w++)v=_[w],g.vertexColors.push(v.clone());g.materialIndex=b.materialIndex+i,a.push(g)}for(p=0,f=c.length;p<f;p++){var S=c[p],E=[];if(void 0!==S){for(w=0,T=S.length;w<T;w++)E.push(S[w].clone());u.push(E)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,i,n,r,o,s,a,h={},u=[],c=[],l=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)t=this.vertices[i],void 0===h[e=Math.round(t.x*l)+"_"+Math.round(t.y*l)+"_"+Math.round(t.z*l)]?(h[e]=i,u.push(this.vertices[i]),c[i]=u.length-1):c[i]=c[h[e]];var d=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=c[r.a],r.b=c[r.b],r.c=c[r.c],o=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(i);break}}for(i=d.length-1;i>=0;i--){var f=d[i];for(this.faces.splice(f,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,r,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===e&&(n=[]),s&&s.length===e&&(r=[]);for(i=0;i<e;i++){var a=t[i]._id;n&&n.push(o[a]),r&&r.push(s[a])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){function t(t,e,i){return i?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==d[e]?d[e]:(d[e]=l.length/3,l.push(t.x,t.y,t.z),d[e])}function i(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==f[e]?f[e]:(f[e]=p.length,p.push(t.getHex()),f[e])}function n(t){var e=t.x.toString()+t.y.toString();return void 0!==g[e]?g[e]:(g[e]=m.length/2,m.push(t.x,t.y),g[e])}var r={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var s in o)void 0!==o[s]&&(r[s]=o[s]);return r}for(var a=[],h=0;h<this.vertices.length;h++){var u=this.vertices[h];a.push(u.x,u.y,u.z)}var c=[],l=[],d={},p=[],f={},m=[],g={};for(h=0;h<this.faces.length;h++){var y=this.faces[h],v=void 0!==this.faceVertexUvs[0][h],b=y.normal.length()>0,x=y.vertexNormals.length>0,_=1!==y.color.r||1!==y.color.g||1!==y.color.b,w=y.vertexColors.length>0,T=0;if(T=t(T,0,0),T=t(T,1,!0),T=t(T,2,!1),T=t(T,3,v),T=t(T,4,b),T=t(T,5,x),T=t(T,6,_),T=t(T,7,w),c.push(T),c.push(y.a,y.b,y.c),c.push(y.materialIndex),v){var S=this.faceVertexUvs[0][h];c.push(n(S[0]),n(S[1]),n(S[2]))}if(b&&c.push(e(y.normal)),x){var E=y.vertexNormals;c.push(e(E[0]),e(E[1]),e(E[2]))}if(_&&c.push(i(y.color)),w){var C=y.vertexColors;c.push(i(C[0]),i(C[1]),i(C[2]))}}return r.data={},r.data.vertices=a,r.data.normals=l,p.length>0&&(r.data.colors=p),m.length>0&&(r.data.uvs=[m]),r.data.faces=c,r},clone:function(){return(new ft).copy(this)},copy:function(t){var e,i,n,r,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var a=t.vertices;for(e=0,i=a.length;e<i;e++)this.vertices.push(a[e].clone());var h=t.colors;for(e=0,i=h.length;e<i;e++)this.colors.push(h[e].clone());var u=t.faces;for(e=0,i=u.length;e<i;e++)this.faces.push(u[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,r=c.length;n<r;n++){var l=c[n],d=[];for(o=0,s=l.length;o<s;o++){var p=l[o];d.push(p.clone())}this.faceVertexUvs[e].push(d)}}var f=t.morphTargets;for(e=0,i=f.length;e<i;e++){var m={};if(m.name=f[e].name,void 0!==f[e].vertices)for(m.vertices=[],n=0,r=f[e].vertices.length;n<r;n++)m.vertices.push(f[e].vertices[n].clone());if(void 0!==f[e].normals)for(m.normals=[],n=0,r=f[e].normals.length;n<r;n++)m.normals.push(f[e].normals[n].clone());this.morphTargets.push(m)}var g=t.morphNormals;for(e=0,i=g.length;e<i;e++){var y={};if(void 0!==g[e].vertexNormals)for(y.vertexNormals=[],n=0,r=g[e].vertexNormals.length;n<r;n++){var v=g[e].vertexNormals[n],b={};b.a=v.a.clone(),b.b=v.b.clone(),b.c=v.c.clone(),y.vertexNormals.push(b)}if(void 0!==g[e].faceNormals)for(y.faceNormals=[],n=0,r=g[e].faceNormals.length;n<r;n++)y.faceNormals.push(g[e].faceNormals[n].clone());this.morphNormals.push(y)}var x=t.skinWeights;for(e=0,i=x.length;e<i;e++)this.skinWeights.push(x[e].clone());var _=t.skinIndices;for(e=0,i=_.length;e<i;e++)this.skinIndices.push(_[e].clone());var w=t.lineDistances;for(e=0,i=w.length;e<i;e++)this.lineDistances.push(w[e]);var T=t.boundingBox;null!==T&&(this.boundingBox=T.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(mt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(mt.prototype,{isBufferAttribute:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new X),e[i++]=o.r,e[i++]=o.g,e[i++]=o.b}return this},copyIndicesArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];e[i++]=o.a,e[i++]=o.b,e[i++]=o.c}return this},copyVector2sArray:function(t){for(var e=this.array,i=0,n=0,o=t.length;n<o;n++){var s=t[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new r),e[i++]=s.x,e[i++]=s.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new c),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new s),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z,e[i++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(gt.prototype=Object.create(mt.prototype)).constructor=gt,(yt.prototype=Object.create(mt.prototype)).constructor=yt,(vt.prototype=Object.create(mt.prototype)).constructor=vt,(bt.prototype=Object.create(mt.prototype)).constructor=bt,(xt.prototype=Object.create(mt.prototype)).constructor=xt,(_t.prototype=Object.create(mt.prototype)).constructor=_t,(wt.prototype=Object.create(mt.prototype)).constructor=wt,(Tt.prototype=Object.create(mt.prototype)).constructor=Tt,(St.prototype=Object.create(mt.prototype)).constructor=St,Object.assign(Et.prototype,{computeGroups:function(t){for(var e,i=[],n=void 0,r=t.faces,o=0;o<r.length;o++){var s=r[o];s.materialIndex!==n&&(n=s.materialIndex,void 0!==e&&(e.count=3*o-e.start,i.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e,i=t.faces,n=t.vertices,o=t.faceVertexUvs,s=o[0]&&o[0].length>0,a=o[1]&&o[1].length>0,h=t.morphTargets,u=h.length;if(u>0){e=[];for(var c=0;c<u;c++)e[c]=[];this.morphTargets.position=e}var l,d=t.morphNormals,p=d.length;if(p>0){l=[];for(c=0;c<p;c++)l[c]=[];this.morphTargets.normal=l}var f=t.skinIndices,m=t.skinWeights,g=f.length===n.length,y=m.length===n.length;for(c=0;c<i.length;c++){var v=i[c];this.vertices.push(n[v.a],n[v.b],n[v.c]);var b=v.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{var x=v.normal;this.normals.push(x,x,x)}var _=v.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===s){void 0!==(T=o[0][c])?this.uvs.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new r,new r,new r))}if(!0===a){var T;void 0!==(T=o[1][c])?this.uvs2.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new r,new r,new r))}for(var S=0;S<u;S++){var E=h[S].vertices;e[S].push(E[v.a],E[v.b],E[v.c])}for(S=0;S<p;S++){var C=d[S].vertexNormals[c];l[S].push(C.a,C.b,C.c)}g&&this.skinIndices.push(f[v.a],f[v.b],f[v.c]),y&&this.skinWeights.push(m[v.a],m[v.b],m[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}}),Pt.MaxIndex=65535,Object.assign(Pt.prototype,n.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Ct(t)>65535?wt:xt)(t,1):this.index=t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new mt(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){(new et).getNormalMatrix(t).applyToBufferAttribute(i),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new l;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new l;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new l;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new l;return function(e,i,n){return t.makeTranslation(e,i,n),this.applyMatrix(t),this}}(),scale:function(){var t=new l;return function(e,i,n){return t.makeScale(e,i,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new ht;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new Tt(3*e.vertices.length,3),n=new Tt(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new Tt(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var i=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(i=void 0,e.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate,i.normalsNeedUpdate=e.normalsNeedUpdate,i.colorsNeedUpdate=e.colorsNeedUpdate,i.uvsNeedUpdate=e.uvsNeedUpdate,i.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=i}var n;return!0===e.verticesNeedUpdate&&(void 0!==(n=this.attributes.position)&&(n.copyVector3sArray(e.vertices),n.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(void 0!==(n=this.attributes.normal)&&(n.copyVector3sArray(e.normals),n.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(void 0!==(n=this.attributes.color)&&(n.copyColorsArray(e.colors),n.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(void 0!==(n=this.attributes.uv)&&(n.copyVector2sArray(e.uvs),n.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(void 0!==(n=this.attributes.lineDistance)&&(n.copyArray(e.lineDistances),n.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Et).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new mt(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new mt(i,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new mt(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new mt(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new mt(o,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var s=new(Ct(t.indices)>65535?Uint32Array:Uint16Array)(3*t.indices.length);this.setIndex(new mt(s,1).copyIndicesArray(t.indices))}this.groups=t.groups;for(var a in t.morphTargets){for(var h=[],u=t.morphTargets[a],c=0,l=u.length;c<l;c++){var d=u[c],p=new Tt(3*d.length,3);h.push(p.copyVector3sArray(d))}this.morphAttributes[a]=h}if(t.skinIndices.length>0){var f=new Tt(4*t.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var m=new Tt(4*t.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new $,e=new c;return function(){null===this.boundingSphere&&(this.boundingSphere=new tt);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;t.setFromBufferAttribute(i),t.getCenter(n);for(var r=0,o=0,s=i.count;o<s;o++)e.x=i.getX(o),e.y=i.getY(o),e.z=i.getZ(o),r=Math.max(r,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new mt(new Float32Array(n.length),3));else for(var r=e.normal.array,o=0,s=r.length;o<s;o++)r[o]=0;var a,h,u,l=e.normal.array,d=new c,p=new c,f=new c,m=new c,g=new c;if(t){var y=t.array;0===i.length&&this.addGroup(0,y.length);for(var v=0,b=i.length;v<b;++v){var x=i[v],_=x.start;for(o=_,s=_+x.count;o<s;o+=3)a=3*y[o+0],h=3*y[o+1],u=3*y[o+2],d.fromArray(n,a),p.fromArray(n,h),f.fromArray(n,u),m.subVectors(f,p),g.subVectors(d,p),m.cross(g),l[a]+=m.x,l[a+1]+=m.y,l[a+2]+=m.z,l[h]+=m.x,l[h+1]+=m.y,l[h+2]+=m.z,l[u]+=m.x,l[u+1]+=m.y,l[u+2]+=m.z}}else for(o=0,s=n.length;o<s;o+=9)d.fromArray(n,o),p.fromArray(n,o+3),f.fromArray(n,o+6),m.subVectors(f,p),g.subVectors(d,p),m.cross(g),l[o]=m.x,l[o+1]=m.y,l[o+2]=m.z,l[o+3]=m.x,l[o+4]=m.y,l[o+5]=m.z,l[o+6]=m.x,l[o+7]=m.y,l[o+8]=m.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0);var i=this.attributes;for(var n in i)if(void 0!==t.attributes[n])for(var r=i[n].array,o=t.attributes[n],s=o.array,a=0,h=o.itemSize*e;a<s.length;a++,h++)r[h]=s[a];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t,e,i,n,r=this.attributes.normal,o=0,s=r.count;o<s;o++)t=r.getX(o),e=r.getY(o),i=r.getZ(o),n=1/Math.sqrt(t*t+e*e+i*i),r.setXYZ(o,t*n,e*n,i*n)},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Pt,e=this.index.array,i=this.attributes;for(var n in i){for(var r=i[n],o=r.array,s=r.itemSize,a=new o.constructor(e.length*s),h=0,u=0,c=0,l=e.length;c<l;c++){h=e[c]*s;for(var d=0;d<s;d++)a[u++]=o[h++]}t.addAttribute(n,new mt(a,s))}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var r=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:r}}var o=this.attributes;for(var i in o){var s=o[i];r=Array.prototype.slice.call(s.array);t.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:r,normalized:s.normalized}}var a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));var h=this.boundingSphere;return null!==h&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t},clone:function(){return(new Pt).copy(this)},copy:function(t){var e,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var o=t.attributes;for(e in o){var s=o[e];this.addAttribute(e,s.clone())}var a=t.morphAttributes;for(e in a){var h=[],u=a[e];for(i=0,n=u.length;i<n;i++)h.push(u[i].clone());this.morphAttributes[e]=h}var c=t.groups;for(i=0,n=c.length;i<n;i++){var l=c[i];this.addGroup(l.start,l.count,l.materialIndex)}var d=t.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=t.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Mt.prototype=Object.create(ft.prototype)).constructor=Mt,(At.prototype=Object.create(Pt.prototype)).constructor=At,(Rt.prototype=Object.create(ft.prototype)).constructor=Rt,(Lt.prototype=Object.create(Pt.prototype)).constructor=Lt,(Ot.prototype=Object.create(Z.prototype)).constructor=Ot,Ot.prototype.isMeshBasicMaterial=!0,Ot.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},Object.assign(It.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new c).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new c;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var i=e||new c;i.subVectors(t,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new c;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new c,e=new c,i=new c;return function(n,r,o,s){t.copy(n).add(r).multiplyScalar(.5),e.copy(r).sub(n).normalize(),i.copy(this.origin).sub(t);var a,h,u,c,l=.5*n.distanceTo(r),d=-this.direction.dot(e),p=i.dot(this.direction),f=-i.dot(e),m=i.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(a=d*f-p,h=d*p-f,c=l*g,a>=0)if(h>=-c)if(h<=c){var y=1/g;u=(a*=y)*(a+d*(h*=y)+2*p)+h*(d*a+h+2*f)+m}else h=l,u=-(a=Math.max(0,-(d*h+p)))*a+h*(h+2*f)+m;else h=-l,u=-(a=Math.max(0,-(d*h+p)))*a+h*(h+2*f)+m;else h<=-c?u=-(a=Math.max(0,-(-d*l+p)))*a+(h=a>0?-l:Math.min(Math.max(-l,-f),l))*(h+2*f)+m:h<=c?(a=0,u=(h=Math.min(Math.max(-l,-f),l))*(h+2*f)+m):u=-(a=Math.max(0,-(d*l+p)))*a+(h=a>0?l:Math.min(Math.max(-l,-f),l))*(h+2*f)+m;else h=d>0?-l:l,u=-(a=Math.max(0,-(d*h+p)))*a+h*(h+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(e).multiplyScalar(h).add(t),u}}(),intersectSphere:function(){var t=new c;return function(e,i){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),r=t.dot(t)-n*n,o=e.radius*e.radius;if(r>o)return null;var s=Math.sqrt(o-r),a=n-s,h=n+s;return a<0&&h<0?null:a<0?this.at(h,i):this.at(a,i)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var i,n,r,o,s,a,h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,l=this.origin;return h>=0?(i=(t.min.x-l.x)*h,n=(t.max.x-l.x)*h):(i=(t.max.x-l.x)*h,n=(t.min.x-l.x)*h),u>=0?(r=(t.min.y-l.y)*u,o=(t.max.y-l.y)*u):(r=(t.max.y-l.y)*u,o=(t.min.y-l.y)*u),i>o||r>n?null:((r>i||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),c>=0?(s=(t.min.z-l.z)*c,a=(t.max.z-l.z)*c):(s=(t.max.z-l.z)*c,a=(t.min.z-l.z)*c),i>a||s>n?null:((s>i||i!=i)&&(i=s),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))},intersectsBox:function(){var t=new c;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new c,e=new c,i=new c,n=new c;return function(r,o,s,a,h){e.subVectors(o,r),i.subVectors(s,r),n.crossVectors(e,i);var u,c=this.direction.dot(n);if(c>0){if(a)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}t.subVectors(this.origin,r);var l=u*this.direction.dot(i.crossVectors(t,i));if(l<0)return null;var d=u*this.direction.dot(e.cross(t));if(d<0)return null;if(l+d>c)return null;var p=-u*t.dot(n);return p<0?null:this.at(p/c,h)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Bt.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return(t||new c).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new c).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new c;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new c,e=new c;return function(i,n){t.subVectors(i,this.start),e.subVectors(this.end,this.start);var r=e.dot(e),o=e.dot(t)/r;return n&&(o=Js.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,e,i){var n=this.closestPointToPointParameter(t,e),r=i||new c;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(kt,{normal:function(){var t=new c;return function(e,i,n,r){var o=r||new c;o.subVectors(n,i),t.subVectors(e,i),o.cross(t);var s=o.lengthSq();return s>0?o.multiplyScalar(1/Math.sqrt(s)):o.set(0,0,0)}}(),barycoordFromPoint:function(){var t=new c,e=new c,i=new c;return function(n,r,o,s,a){t.subVectors(s,r),e.subVectors(o,r),i.subVectors(n,r);var h=t.dot(t),u=t.dot(e),l=t.dot(i),d=e.dot(e),p=e.dot(i),f=h*d-u*u,m=a||new c;if(0===f)return m.set(-2,-1,-1);var g=1/f,y=(d*l-u*p)*g,v=(h*p-u*l)*g;return m.set(1-y-v,v,y)}}(),containsPoint:function(){var t=new c;return function(e,i,n,r){var o=kt.barycoordFromPoint(e,i,n,r,t);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}()}),Object.assign(kt.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new c,e=new c;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new c).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return kt.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new it).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return kt.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return kt.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:function(){var t=new it,e=[new Bt,new Bt,new Bt],i=new c,n=new c;return function(r,o){var s=o||new c,a=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(r,i),!0===this.containsPoint(i))s.copy(i);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var h=0;h<e.length;h++){e[h].closestPointToPoint(i,!0,n);var u=i.distanceToSquared(n);u<a&&(a=u,s.copy(n))}}return s}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Dt.prototype=Object.assign(Object.create(ht.prototype),{constructor:Dt,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return ht.prototype.copy.call(this,t),this.drawMode=t.drawMode,this},updateMorphTargets:function(){var t,e,i,n=this.geometry;if(n.isBufferGeometry){var r=n.morphAttributes,o=Object.keys(r);if(o.length>0){var s=r[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)i=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}else{var a=n.morphTargets;if(void 0!==a&&a.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)i=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}},raycast:function(){function t(t,e,i,n,r,o,s){return kt.barycoordFromPoint(t,e,i,n,v),r.multiplyScalar(v.x),o.multiplyScalar(v.y),s.multiplyScalar(v.z),r.add(o).add(s),r.clone()}function e(t,e,i,n,r,o,s){var a=t.material;if(null===(a.side===Xr?i.intersectTriangle(o,r,n,!0,s):i.intersectTriangle(n,r,o,a.side!==qr,s)))return null;x.copy(s),x.applyMatrix4(t.matrixWorld);var h=e.ray.origin.distanceTo(x);return h<e.near||h>e.far?null:{distance:h,point:x.clone(),object:t}}function i(i,n,r,o,s,c,l,d){a.fromBufferAttribute(o,c),h.fromBufferAttribute(o,l),u.fromBufferAttribute(o,d);var p=e(i,n,r,a,h,u,b);return p&&(s&&(m.fromBufferAttribute(s,c),g.fromBufferAttribute(s,l),y.fromBufferAttribute(s,d),p.uv=t(b,a,h,u,m,g,y)),p.face=new dt(c,l,d,kt.normal(a,h,u)),p.faceIndex=c),p}var n=new l,o=new It,s=new tt,a=new c,h=new c,u=new c,d=new c,p=new c,f=new c,m=new r,g=new r,y=new r,v=new c,b=new c,x=new c;return function(r,c){var l=this.geometry,v=this.material,x=this.matrixWorld;if(void 0!==v&&(null===l.boundingSphere&&l.computeBoundingSphere(),s.copy(l.boundingSphere),s.applyMatrix4(x),!1!==r.ray.intersectsSphere(s)&&(n.getInverse(x),o.copy(r.ray).applyMatrix4(n),null===l.boundingBox||!1!==o.intersectsBox(l.boundingBox)))){var _;if(l.isBufferGeometry){var w,T,S,E,C,P=l.index,M=l.attributes.position,A=l.attributes.uv;if(null!==P)for(E=0,C=P.count;E<C;E+=3)w=P.getX(E),T=P.getX(E+1),S=P.getX(E+2),(_=i(this,r,o,M,A,w,T,S))&&(_.faceIndex=Math.floor(E/3),c.push(_));else for(E=0,C=M.count;E<C;E+=3)(_=i(this,r,o,M,A,w=E,T=E+1,S=E+2))&&(_.index=w,c.push(_))}else if(l.isGeometry){var R,L,O,I,B=Array.isArray(v),k=l.vertices,D=l.faces,F=l.faceVertexUvs[0];F.length>0&&(I=F);for(var U=0,N=D.length;U<N;U++){var G=D[U],j=B?v[G.materialIndex]:v;if(void 0!==j){if(R=k[G.a],L=k[G.b],O=k[G.c],!0===j.morphTargets){var V=l.morphTargets,H=this.morphTargetInfluences;a.set(0,0,0),h.set(0,0,0),u.set(0,0,0);for(var z=0,W=V.length;z<W;z++){var X=H[z];if(0!==X){var q=V[z].vertices;a.addScaledVector(d.subVectors(q[G.a],R),X),h.addScaledVector(p.subVectors(q[G.b],L),X),u.addScaledVector(f.subVectors(q[G.c],O),X)}}a.add(R),h.add(L),u.add(O),R=a,L=h,O=u}if(_=e(this,r,o,R,L,O,b)){if(I&&I[U]){var Y=I[U];m.copy(Y[0]),g.copy(Y[1]),y.copy(Y[2]),_.uv=t(b,R,L,O,m,g,y)}_.face=G,_.faceIndex=U,c.push(_)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ma=0;Zt.prototype=Object.assign(Object.create(lt.prototype),{constructor:Zt,isArrayCamera:!0}),Jt.prototype.isFogExp2=!0,Jt.prototype.clone=function(){return new Jt(this.color.getHex(),this.density)},Jt.prototype.toJSON=function(t){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},$t.prototype.isFog=!0,$t.prototype.clone=function(){return new $t(this.color.getHex(),this.near,this.far)},$t.prototype.toJSON=function(t){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},te.prototype=Object.assign(Object.create(ht.prototype),{constructor:te,copy:function(t,e){return ht.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),ee.prototype=Object.assign(Object.create(ht.prototype),{constructor:ee,isLensFlare:!0,copy:function(t){ht.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,i=t.lensFlares.length;e<i;e++)this.lensFlares.push(t.lensFlares[e]);return this},add:function(t,e,i,n,r,o){void 0===e&&(e=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new X(16777215)),void 0===n&&(n=to),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:r,blending:n})},updateLensFlares:function(){var t,e,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(t=0;t<i;t++)(e=this.lensFlares[t]).x=this.positionScreen.x+n*e.distance,e.y=this.positionScreen.y+r*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)}}),(ie.prototype=Object.create(Z.prototype)).constructor=ie,ie.prototype.isSpriteMaterial=!0,ie.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},ne.prototype=Object.assign(Object.create(ht.prototype),{constructor:ne,isSprite:!0,raycast:function(){var t=new c,e=new c,i=new c;return function(n,r){e.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(e,t),i.setFromMatrixScale(this.matrixWorld);var o=i.x*i.y/4;if(!(e.distanceToSquared(t)>o)){var s=n.ray.origin.distanceTo(t);s<n.near||s>n.far||r.push({distance:s,point:t.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),re.prototype=Object.assign(Object.create(ht.prototype),{constructor:re,copy:function(t){ht.prototype.copy.call(this,t,!1);for(var e=t.levels,i=0,n=e.length;i<n;i++){var r=e[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var i=this.levels,n=0;n<i.length&&!(e<i[n].distance);n++);i.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object},raycast:function(){var t=new c;return function(e,i){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,i)}}(),update:function(){var t=new c,e=new c;return function(i){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(i.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var r=t.distanceTo(e);n[0].object.visible=!0;for(var o=1,s=n.length;o<s&&r>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<s;o++)n[o].object.visible=!1}}}(),toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);e.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var o=i[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Object.assign(oe.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new l;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){var t,e,i;for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new l,e=new l;return function(){for(var i=this.bones,n=this.boneInverses,r=this.boneMatrices,o=this.boneTexture,s=0,a=i.length;s<a;s++){var h=i[s]?i[s].matrixWorld:e;t.multiplyMatrices(h,n[s]),t.toArray(r,16*s)}void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new oe(this.bones,this.boneInverses)}}),se.prototype=Object.assign(Object.create(ht.prototype),{constructor:se,isBone:!0}),ae.prototype=Object.assign(Object.create(Dt.prototype),{constructor:ae,isSkinnedMesh:!0,initBones:function(){var t,e,i,n,r=[];if(this.geometry&&void 0!==this.geometry.bones){for(i=0,n=this.geometry.bones.length;i<n;i++)e=this.geometry.bones[i],t=new se,r.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(i=0,n=this.geometry.bones.length;i<n;i++)-1!==(e=this.geometry.bones[i]).parent&&null!==e.parent&&void 0!==r[e.parent]?r[e.parent].add(r[i]):this.add(r[i])}return this.updateMatrixWorld(!0),r},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var i=this.geometry.skinWeights[e];(t=1/i.lengthManhattan())!==1/0?i.multiplyScalar(t):i.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new s,r=this.geometry.attributes.skinWeight;for(e=0;e<r.count;e++)n.x=r.getX(e),n.y=r.getY(e),n.z=r.getZ(e),n.w=r.getW(e),(t=1/n.lengthManhattan())!==1/0?n.multiplyScalar(t):n.set(1,0,0,0),r.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){Dt.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(he.prototype=Object.create(Z.prototype)).constructor=he,he.prototype.isLineBasicMaterial=!0,he.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},ue.prototype=Object.assign(Object.create(ht.prototype),{constructor:ue,isLine:!0,raycast:function(){var t=new l,e=new It,i=new tt;return function(n,r){var o=n.linePrecision,s=o*o,a=this.geometry,h=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(h),!1!==n.ray.intersectsSphere(i)){t.getInverse(h),e.copy(n.ray).applyMatrix4(t);var u=new c,l=new c,d=new c,p=new c,f=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var m=a.index,g=a.attributes.position.array;if(null!==m)for(var y=m.array,v=0,b=y.length-1;v<b;v+=f){var x=y[v],_=y[v+1];u.fromArray(g,3*x),l.fromArray(g,3*_);if(!(e.distanceSqToSegment(u,l,p,d)>s)){p.applyMatrix4(this.matrixWorld);(S=n.ray.origin.distanceTo(p))<n.near||S>n.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(v=0,b=g.length/3-1;v<b;v+=f){u.fromArray(g,3*v),l.fromArray(g,3*v+3);if(!(e.distanceSqToSegment(u,l,p,d)>s)){p.applyMatrix4(this.matrixWorld);(S=n.ray.origin.distanceTo(p))<n.near||S>n.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else if(a.isGeometry){var w=a.vertices,T=w.length;for(v=0;v<T-1;v+=f){if(!(e.distanceSqToSegment(w[v],w[v+1],p,d)>s)){p.applyMatrix4(this.matrixWorld);var S;(S=n.ray.origin.distanceTo(p))<n.near||S>n.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ce.prototype=Object.assign(Object.create(ue.prototype),{constructor:ce,isLineSegments:!0}),le.prototype=Object.assign(Object.create(ue.prototype),{constructor:le,isLineLoop:!0}),(de.prototype=Object.create(Z.prototype)).constructor=de,de.prototype.isPointsMaterial=!0,de.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},pe.prototype=Object.assign(Object.create(ht.prototype),{constructor:pe,isPoints:!0,raycast:function(){var t=new l,e=new It,i=new tt;return function(n,r){function o(t,i){var o=e.distanceSqToPoint(t);if(o<d){var a=e.closestPointToPoint(t);a.applyMatrix4(h);var u=n.ray.origin.distanceTo(a);if(u<n.near||u>n.far)return;r.push({distance:u,distanceToRay:Math.sqrt(o),point:a.clone(),index:i,face:null,object:s})}}var s=this,a=this.geometry,h=this.matrixWorld,u=n.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(h),i.radius+=u,!1!==n.ray.intersectsSphere(i)){t.getInverse(h),e.copy(n.ray).applyMatrix4(t);var l=u/((this.scale.x+this.scale.y+this.scale.z)/3),d=l*l,p=new c;if(a.isBufferGeometry){var f=a.index,m=a.attributes.position.array;if(null!==f)for(var g=f.array,y=0,v=g.length;y<v;y++){var b=g[y];p.fromArray(m,3*b),o(p,b)}else{y=0;for(var x=m.length/3;y<x;y++)p.fromArray(m,3*y),o(p,y)}}else{var _=a.vertices;for(y=0,x=_.length;y<x;y++)o(_[y],y)}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),fe.prototype=Object.assign(Object.create(ht.prototype),{constructor:fe}),(me.prototype=Object.create(o.prototype)).constructor=me,(ge.prototype=Object.create(o.prototype)).constructor=ge,ge.prototype.isCompressedTexture=!0,(ye.prototype=Object.create(o.prototype)).constructor=ye,(ve.prototype=Object.create(o.prototype)).constructor=ve,ve.prototype.isDepthTexture=!0,(be.prototype=Object.create(Pt.prototype)).constructor=be,(xe.prototype=Object.create(ft.prototype)).constructor=xe,(_e.prototype=Object.create(Pt.prototype)).constructor=_e,(we.prototype=Object.create(ft.prototype)).constructor=we,(Te.prototype=Object.create(Pt.prototype)).constructor=Te,(Se.prototype=Object.create(ft.prototype)).constructor=Se,(Ee.prototype=Object.create(Te.prototype)).constructor=Ee,(Ce.prototype=Object.create(ft.prototype)).constructor=Ce,(Pe.prototype=Object.create(Te.prototype)).constructor=Pe,(Me.prototype=Object.create(ft.prototype)).constructor=Me,(Ae.prototype=Object.create(Te.prototype)).constructor=Ae,(Re.prototype=Object.create(ft.prototype)).constructor=Re,(Le.prototype=Object.create(Te.prototype)).constructor=Le,(Oe.prototype=Object.create(ft.prototype)).constructor=Oe,(Ie.prototype=Object.create(Pt.prototype)).constructor=Ie,(Be.prototype=Object.create(ft.prototype)).constructor=Be,(ke.prototype=Object.create(Pt.prototype)).constructor=ke,(De.prototype=Object.create(ft.prototype)).constructor=De,(Fe.prototype=Object.create(Pt.prototype)).constructor=Fe;var ga={area:function(t){for(var e=t.length,i=0,n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},triangulate:function(){function t(t,e,i,n,r,o){var s,a,h,u,c,l,d,p,f;if(a=t[o[e]].x,h=t[o[e]].y,u=t[o[i]].x,c=t[o[i]].y,l=t[o[n]].x,d=t[o[n]].y,(u-a)*(d-h)-(c-h)*(l-a)<=0)return!1;var m,g,y,v,b,x,_,w,T,S,E,C,P,M,A;for(m=l-u,g=d-c,y=a-l,v=h-d,b=u-a,x=c-h,s=0;s<r;s++)if(p=t[o[s]].x,f=t[o[s]].y,!(p===a&&f===h||p===u&&f===c||p===l&&f===d)&&(_=p-a,w=f-h,T=p-u,S=f-c,E=p-l,C=f-d,A=m*S-g*T,P=b*w-x*_,M=y*C-v*E,A>=-Number.EPSILON&&M>=-Number.EPSILON&&P>=-Number.EPSILON))return!1;return!0}return function(e,i){var n=e.length;if(n<3)return null;var r,o,s,a=[],h=[],u=[];if(ga.area(e)>0)for(o=0;o<n;o++)h[o]=o;else for(o=0;o<n;o++)h[o]=n-1-o;var c=n,l=2*c;for(o=c-1;c>2;){if(l--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),i?u:a;if(r=o,c<=r&&(r=0),o=r+1,c<=o&&(o=0),s=o+1,c<=s&&(s=0),t(e,r,o,s,c,h)){var d,p,f,m,g;for(d=h[r],p=h[o],f=h[s],a.push([e[d],e[p],e[f]]),u.push([h[r],h[o],h[s]]),m=o,g=o+1;g<c;m++,g++)h[m]=h[g];l=2*--c}}return i?u:a}}(),triangulateShape:function(t,e){function i(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function n(t,e,i){return t.x!==e.x?t.x<e.x?t.x<=i.x&&i.x<=e.x:e.x<=i.x&&i.x<=t.x:t.y<e.y?t.y<=i.y&&i.y<=e.y:e.y<=i.y&&i.y<=t.y}function r(t,e,i,r,o){var s=e.x-t.x,a=e.y-t.y,h=r.x-i.x,u=r.y-i.y,c=t.x-i.x,l=t.y-i.y,d=a*h-s*u,p=a*c-s*l;if(Math.abs(d)>Number.EPSILON){var f;if(d>0){if(p<0||p>d)return[];if((f=u*c-h*l)<0||f>d)return[]}else{if(p>0||p<d)return[];if((f=u*c-h*l)>0||f<d)return[]}if(0===f)return!o||0!==p&&p!==d?[t]:[];if(f===d)return!o||0!==p&&p!==d?[e]:[];if(0===p)return[i];if(p===d)return[r];var m=f/d;return[{x:t.x+m*s,y:t.y+m*a}]}if(0!==p||u*c!=h*l)return[];var g=0===s&&0===a,y=0===h&&0===u;if(g&&y)return t.x!==i.x||t.y!==i.y?[]:[t];if(g)return n(i,r,t)?[t]:[];if(y)return n(t,e,i)?[i]:[];var v,b,x,_,w,T,S,E;return 0!==s?(t.x<e.x?(v=t,x=t.x,b=e,_=e.x):(v=e,x=e.x,b=t,_=t.x),i.x<r.x?(w=i,S=i.x,T=r,E=r.x):(w=r,S=r.x,T=i,E=i.x)):(t.y<e.y?(v=t,x=t.y,b=e,_=e.y):(v=e,x=e.y,b=t,_=t.y),i.y<r.y?(w=i,S=i.y,T=r,E=r.y):(w=r,S=r.y,T=i,E=i.y)),x<=S?_<S?[]:_===S?o?[]:[w]:_<=E?[w,b]:[w,T]:x>E?[]:x===E?o?[]:[v]:_<=E?[v,b]:[v,T]}function o(t,e,i,n){var r=e.x-t.x,o=e.y-t.y,s=i.x-t.x,a=i.y-t.y,h=n.x-t.x,u=n.y-t.y,c=r*a-o*s,l=r*u-o*h;if(Math.abs(c)>Number.EPSILON){var d=h*a-u*s;return c>0?l>=0&&d>=0:l>=0||d>=0}return l>0}i(t),e.forEach(i);for(var s,a,h,u,c,l,d={},p=t.concat(),f=0,m=e.length;f<m;f++)Array.prototype.push.apply(p,e[f]);for(s=0,a=p.length;s<a;s++)void 0!==d[c=p[s].x+":"+p[s].y]&&console.warn("THREE.ShapeUtils: Duplicate point",c,s),d[c]=s;var g=function(t,e){function i(t,e){var i=v.length-1,n=t-1;n<0&&(n=i);var r=t+1;r>i&&(r=0);var s=o(v[t],v[n],v[r],a[e]);if(!s)return!1;var h=a.length-1,u=e-1;u<0&&(u=h);var c=e+1;return c>h&&(c=0),!!(s=o(a[e],a[u],a[c],v[t]))}function n(t,e){var i,n;for(i=0;i<v.length;i++)if(n=i+1,n%=v.length,r(t,e,v[i],v[n],!0).length>0)return!0;return!1}function s(t,i){var n,o,s,a;for(n=0;n<b.length;n++)for(o=e[b[n]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,r(t,i,o[s],o[a],!0).length>0)return!0;return!1}for(var a,h,u,c,l,d,p,f,m,g,y,v=t.concat(),b=[],x=[],_=0,w=e.length;_<w;_++)b.push(_);for(var T=0,S=2*b.length;b.length>0;){if(--S<0){console.log("Infinite Loop! Holes left:"+b.length+", Probably Hole outside Shape!");break}for(u=T;u<v.length;u++){for(c=v[u],h=-1,_=0;_<b.length;_++)if(d=b[_],p=c.x+":"+c.y+":"+d,void 0===x[p]){a=e[d];for(var E=0;E<a.length;E++)if(l=a[E],i(u,E)&&!n(c,l)&&!s(c,l)){h=E,b.splice(_,1),f=v.slice(0,u+1),m=v.slice(u),g=a.slice(h),y=a.slice(0,h+1),v=f.concat(g).concat(y).concat(m),T=u;break}if(h>=0)break;x[p]=!0}if(h>=0)break}}return v}(t,e),y=ga.triangulate(g,!1);for(s=0,a=y.length;s<a;s++)for(u=y[s],h=0;h<3;h++)void 0!==(l=d[c=u[h].x+":"+u[h].y])&&(u[h]=l);return y.concat()},isClockWise:function(t){return ga.area(t)<0}};(Ue.prototype=Object.create(ft.prototype)).constructor=Ue,(Ne.prototype=Object.create(Pt.prototype)).constructor=Ne,Ne.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],i=this.getAttribute("uv"),n=i?Array.prototype.slice.call(i.array):[],r=this.index;return{position:e,uv:n,index:r?Array.prototype.slice.call(r.array):[]}},Ne.prototype.addShapeList=function(t,e){var i=t.length;e.arrays=this.getArrays();for(var n=0;n<i;n++){var r=t[n];this.addShape(r,e)}this.setIndex(e.arrays.index),this.addAttribute("position",new Tt(e.arrays.position,3)),this.addAttribute("uv",new Tt(e.arrays.uv,2))},Ne.prototype.addShape=function(t,e){function i(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}function n(t,e,i){var n,o,s,a=t.x-e.x,h=t.y-e.y,u=i.x-t.x,c=i.y-t.y,l=a*a+h*h,d=a*c-h*u;if(Math.abs(d)>Number.EPSILON){var p=Math.sqrt(l),f=Math.sqrt(u*u+c*c),m=e.x-h/p,g=e.y+a/p,y=((i.x-c/f-m)*c-(i.y+u/f-g)*u)/(a*c-h*u),v=(n=m+a*y-t.x)*n+(o=g+h*y-t.y)*o;if(v<=2)return new r(n,o);s=Math.sqrt(v/2)}else{var b=!1;a>Number.EPSILON?u>Number.EPSILON&&(b=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(b=!0):Math.sign(h)===Math.sign(c)&&(b=!0),b?(n=-h,o=a,s=Math.sqrt(l)):(n=a,o=h,s=Math.sqrt(l/2))}return new r(n/s,o/s)}function o(t,e){var i,n;for(K=t.length;--K>=0;){i=K,(n=K-1)<0&&(n=t.length-1);var r=0,o=P+2*S;for(r=0;r<o;r++){var s=X*r,a=X*(r+1);!function(t,e,i,n,r,o,s,a,c){h(t),h(e),h(n),h(e),h(i),h(n);var l=y.length/3,d=R.generateSideWallUV(B,y,l-6,l-3,l-2,l-1);u(d[0]),u(d[1]),u(d[3]),u(d[1]),u(d[2]),u(d[3])}(e+i+s,e+n+s,e+n+a,e+i+a)}}}function s(t,e,i){x.push(t),x.push(e),x.push(i)}function a(t,e,i){h(t),h(e),h(i);var n=y.length/3,r=R.generateTopUV(B,y,n-3,n-2,n-1);u(r[0]),u(r[1]),u(r[2])}function h(t){v.push(y.length/3),y.push(x[3*t+0]),y.push(x[3*t+1]),y.push(x[3*t+2])}function u(t){b.push(t.x),b.push(t.y)}var l,d,p,f,m,g=e.arrays?e.arrays:this.getArrays(),y=g.position,v=g.index,b=g.uv,x=[],_=void 0!==e.amount?e.amount:100,w=void 0!==e.bevelThickness?e.bevelThickness:6,T=void 0!==e.bevelSize?e.bevelSize:w-2,S=void 0!==e.bevelSegments?e.bevelSegments:3,E=void 0===e.bevelEnabled||e.bevelEnabled,C=void 0!==e.curveSegments?e.curveSegments:12,P=void 0!==e.steps?e.steps:1,M=e.extrudePath,A=!1,R=void 0!==e.UVGenerator?e.UVGenerator:Ue.WorldUVGenerator;M&&(l=M.getSpacedPoints(P),A=!0,E=!1,d=void 0!==e.frames?e.frames:M.computeFrenetFrames(P,!1),p=new c,f=new c,m=new c),E||(S=0,w=0,T=0);var L,O,I,B=this,k=t.extractPoints(C),D=k.shape,F=k.holes;if(!ga.isClockWise(D))for(D=D.reverse(),O=0,I=F.length;O<I;O++)L=F[O],ga.isClockWise(L)&&(F[O]=L.reverse());var U=ga.triangulateShape(D,F),N=D;for(O=0,I=F.length;O<I;O++)L=F[O],D=D.concat(L);for(var G,j,V,H,z,W,X=D.length,q=U.length,Y=[],K=0,Z=N.length,Q=Z-1,J=K+1;K<Z;K++,Q++,J++)Q===Z&&(Q=0),J===Z&&(J=0),Y[K]=n(N[K],N[Q],N[J]);var $,tt=[],et=Y.concat();for(O=0,I=F.length;O<I;O++){for(L=F[O],$=[],K=0,Q=(Z=L.length)-1,J=K+1;K<Z;K++,Q++,J++)Q===Z&&(Q=0),J===Z&&(J=0),$[K]=n(L[K],L[Q],L[J]);tt.push($),et=et.concat($)}for(G=0;G<S;G++){for(V=G/S,H=w*Math.cos(V*Math.PI/2),j=T*Math.sin(V*Math.PI/2),K=0,Z=N.length;K<Z;K++)s((z=i(N[K],Y[K],j)).x,z.y,-H);for(O=0,I=F.length;O<I;O++)for(L=F[O],$=tt[O],K=0,Z=L.length;K<Z;K++)s((z=i(L[K],$[K],j)).x,z.y,-H)}for(j=T,K=0;K<X;K++)z=E?i(D[K],et[K],j):D[K],A?(f.copy(d.normals[0]).multiplyScalar(z.x),p.copy(d.binormals[0]).multiplyScalar(z.y),m.copy(l[0]).add(f).add(p),s(m.x,m.y,m.z)):s(z.x,z.y,0);var it;for(it=1;it<=P;it++)for(K=0;K<X;K++)z=E?i(D[K],et[K],j):D[K],A?(f.copy(d.normals[it]).multiplyScalar(z.x),p.copy(d.binormals[it]).multiplyScalar(z.y),m.copy(l[it]).add(f).add(p),s(m.x,m.y,m.z)):s(z.x,z.y,_/P*it);for(G=S-1;G>=0;G--){for(V=G/S,H=w*Math.cos(V*Math.PI/2),j=T*Math.sin(V*Math.PI/2),K=0,Z=N.length;K<Z;K++)s((z=i(N[K],Y[K],j)).x,z.y,_+H);for(O=0,I=F.length;O<I;O++)for(L=F[O],$=tt[O],K=0,Z=L.length;K<Z;K++)z=i(L[K],$[K],j),A?s(z.x,z.y+l[P-1].y,l[P-1].x+H):s(z.x,z.y,_+H)}!function(){var t=y.length/3;if(E){var i=0,n=X*i;for(K=0;K<q;K++)a((W=U[K])[2]+n,W[1]+n,W[0]+n);for(n=X*(i=P+2*S),K=0;K<q;K++)a((W=U[K])[0]+n,W[1]+n,W[2]+n)}else{for(K=0;K<q;K++)a((W=U[K])[2],W[1],W[0]);for(K=0;K<q;K++)a((W=U[K])[0]+X*P,W[1]+X*P,W[2]+X*P)}B.addGroup(t,y.length/3-t,void 0!==e.material?e.material:0)}(),function(){var t=y.length/3,i=0;for(o(N,i),i+=N.length,O=0,I=F.length;O<I;O++)o(L=F[O],i),i+=L.length;B.addGroup(t,y.length/3-t,void 0!==e.extrudeMaterial?e.extrudeMaterial:1)}(),e.arrays||(this.setIndex(v),this.addAttribute("position",new Tt(y,3)),this.addAttribute("uv",new Tt(e.arrays.uv,2)))},Ue.WorldUVGenerator={generateTopUV:function(t,e,i,n,o){var s=e[3*i],a=e[3*i+1],h=e[3*n],u=e[3*n+1],c=e[3*o],l=e[3*o+1];return[new r(s,a),new r(h,u),new r(c,l)]},generateSideWallUV:function(t,e,i,n,o,s){var a=e[3*i],h=e[3*i+1],u=e[3*i+2],c=e[3*n],l=e[3*n+1],d=e[3*n+2],p=e[3*o],f=e[3*o+1],m=e[3*o+2],g=e[3*s],y=e[3*s+1],v=e[3*s+2];return Math.abs(h-l)<.01?[new r(a,1-u),new r(c,1-d),new r(p,1-m),new r(g,1-v)]:[new r(h,1-u),new r(l,1-d),new r(f,1-m),new r(y,1-v)]}},(Ge.prototype=Object.create(ft.prototype)).constructor=Ge,(je.prototype=Object.create(Ne.prototype)).constructor=je,(Ve.prototype=Object.create(ft.prototype)).constructor=Ve,(He.prototype=Object.create(Pt.prototype)).constructor=He,(ze.prototype=Object.create(ft.prototype)).constructor=ze,(We.prototype=Object.create(Pt.prototype)).constructor=We,(Xe.prototype=Object.create(ft.prototype)).constructor=Xe,(qe.prototype=Object.create(Pt.prototype)).constructor=qe,(Ye.prototype=Object.create(ft.prototype)).constructor=Ye,(Ke.prototype=Object.create(Pt.prototype)).constructor=Ke,(Ze.prototype=Object.create(Pt.prototype)).constructor=Ze,(Qe.prototype=Object.create(ft.prototype)).constructor=Qe,(Je.prototype=Object.create(Pt.prototype)).constructor=Je,($e.prototype=Object.create(Qe.prototype)).constructor=$e,(ti.prototype=Object.create(Je.prototype)).constructor=ti,(ei.prototype=Object.create(ft.prototype)).constructor=ei,(ii.prototype=Object.create(Pt.prototype)).constructor=ii;var ya=Object.freeze({WireframeGeometry:be,ParametricGeometry:xe,ParametricBufferGeometry:_e,TetrahedronGeometry:Se,TetrahedronBufferGeometry:Ee,OctahedronGeometry:Ce,OctahedronBufferGeometry:Pe,IcosahedronGeometry:Me,IcosahedronBufferGeometry:Ae,DodecahedronGeometry:Re,DodecahedronBufferGeometry:Le,PolyhedronGeometry:we,PolyhedronBufferGeometry:Te,TubeGeometry:Oe,TubeBufferGeometry:Ie,TorusKnotGeometry:Be,TorusKnotBufferGeometry:ke,TorusGeometry:De,TorusBufferGeometry:Fe,TextGeometry:Ge,TextBufferGeometry:je,SphereGeometry:Ve,SphereBufferGeometry:He,RingGeometry:ze,RingBufferGeometry:We,PlaneGeometry:Rt,PlaneBufferGeometry:Lt,LatheGeometry:Xe,LatheBufferGeometry:qe,ShapeGeometry:Ye,ShapeBufferGeometry:Ke,ExtrudeGeometry:Ue,ExtrudeBufferGeometry:Ne,EdgesGeometry:Ze,ConeGeometry:$e,ConeBufferGeometry:ti,CylinderGeometry:Qe,CylinderBufferGeometry:Je,CircleGeometry:ei,CircleBufferGeometry:ii,BoxGeometry:Mt,BoxBufferGeometry:At});(ni.prototype=Object.create(Q.prototype)).constructor=ni,ni.prototype.isShadowMaterial=!0,(ri.prototype=Object.create(Q.prototype)).constructor=ri,ri.prototype.isRawShaderMaterial=!0,(oi.prototype=Object.create(Z.prototype)).constructor=oi,oi.prototype.isMeshStandardMaterial=!0,oi.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(si.prototype=Object.create(oi.prototype)).constructor=si,si.prototype.isMeshPhysicalMaterial=!0,si.prototype.copy=function(t){return oi.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},(ai.prototype=Object.create(Z.prototype)).constructor=ai,ai.prototype.isMeshPhongMaterial=!0,ai.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(hi.prototype=Object.create(ai.prototype)).constructor=hi,hi.prototype.isMeshToonMaterial=!0,hi.prototype.copy=function(t){return ai.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},(ui.prototype=Object.create(Z.prototype)).constructor=ui,ui.prototype.isMeshNormalMaterial=!0,ui.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(ci.prototype=Object.create(Z.prototype)).constructor=ci,ci.prototype.isMeshLambertMaterial=!0,ci.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(li.prototype=Object.create(Z.prototype)).constructor=li,li.prototype.isLineDashedMaterial=!0,li.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var va=Object.freeze({ShadowMaterial:ni,SpriteMaterial:ie,RawShaderMaterial:ri,ShaderMaterial:Q,PointsMaterial:de,MeshPhysicalMaterial:si,MeshStandardMaterial:oi,MeshPhongMaterial:ai,MeshToonMaterial:hi,MeshNormalMaterial:ui,MeshLambertMaterial:ci,MeshDepthMaterial:J,MeshBasicMaterial:Ot,LineDashedMaterial:li,LineBasicMaterial:he,Material:Z}),ba={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},xa=new di;Object.assign(pi.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,o=ba.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;var s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var a=s[1],h=!!s[2],u=s[3];u=window.decodeURIComponent(u),h&&(u=window.atob(u));try{var c,l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":c=new ArrayBuffer(u.length);for(var d=new Uint8Array(c),p=0;p<u.length;p++)d[p]=u.charCodeAt(p);"blob"===l&&(c=new Blob([c],{type:a}));break;case"document":var f=new DOMParser;c=f.parseFromString(u,a);break;case"json":c=JSON.parse(u);break;default:c=u}window.setTimeout(function(){e&&e(c),r.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},0)}}else{var m=new XMLHttpRequest;m.open("GET",t,!0),m.addEventListener("load",function(i){var o=i.target.response;ba.add(t,o),200===this.status?(e&&e(o),r.manager.itemEnd(t)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),e&&e(o),r.manager.itemEnd(t)):(n&&n(i),r.manager.itemEnd(t),r.manager.itemError(t))},!1),void 0!==i&&m.addEventListener("progress",function(t){i(t)},!1),m.addEventListener("error",function(e){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var g in this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return r.manager.itemStart(t),m},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(fi.prototype,{load:function(t,e,i,n){function r(r){h.load(t[r],function(t){var i=o._parser(t,!0);s[r]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(u+=1)&&(1===i.mipmapCount&&(a.minFilter=Jo),a.format=i.format,a.needsUpdate=!0,e&&e(a))},i,n)}var o=this,s=[],a=new ge;a.image=s;var h=new pi(this.manager);if(h.setPath(this.path),h.setResponseType("arraybuffer"),Array.isArray(t))for(var u=0,c=0,l=t.length;c<l;++c)r(c);else h.load(t,function(t){var i=o._parser(t,!0);if(i.isCubemap)for(var n=i.mipmaps.length/i.mipmapCount,r=0;r<n;r++){s[r]={mipmaps:[]};for(var h=0;h<i.mipmapCount;h++)s[r].mipmaps.push(i.mipmaps[r*i.mipmapCount+h]),s[r].format=i.format,s[r].width=i.width,s[r].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=Jo),a.format=i.format,a.needsUpdate=!0,e&&e(a)},i,n);return a},setPath:function(t){return this.path=t,this}}),Object.assign(mi.prototype,{load:function(t,e,i,n){var r=this,o=new d,s=new pi(this.manager);return s.setResponseType("arraybuffer"),s.load(t,function(t){var i=r._parser(t);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:qo,o.wrapT=void 0!==i.wrapT?i.wrapT:qo,o.magFilter=void 0!==i.magFilter?i.magFilter:Jo,o.minFilter=void 0!==i.minFilter?i.minFilter:ts,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=Jo),o.needsUpdate=!0,e&&e(o,i))},i,n),o}}),Object.assign(gi.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,o=ba.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",function(){ba.add(t,this),e&&e(this),r.manager.itemEnd(t)},!1),s.addEventListener("error",function(e){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(t),s.src=t,s},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(yi.prototype,{load:function(t,e,i,n){function r(i){s.load(t[i],function(t){o.images[i]=t,6===++a&&(o.needsUpdate=!0,e&&e(o))},void 0,n)}var o=new p,s=new gi(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);for(var a=0,h=0;h<t.length;++h)r(h);return o},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(vi.prototype,{load:function(t,e,i,n){var r=new gi(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);var s=new o;return s.image=r.load(t,function(){var i=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);s.format=i?fs:ms,s.needsUpdate=!0,void 0!==e&&e(s)},i,n),s},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),bi.prototype=Object.assign(Object.create(ht.prototype),{constructor:bi,isLight:!0,copy:function(t){return ht.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),xi.prototype=Object.assign(Object.create(bi.prototype),{constructor:xi,isHemisphereLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(_i.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),wi.prototype=Object.assign(Object.create(_i.prototype),{constructor:wi,isSpotLightShadow:!0,update:function(t){var e=this.camera,i=2*Js.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix())}}),Ti.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ti,isSpotLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Si.prototype=Object.assign(Object.create(bi.prototype),{constructor:Si,isPointLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Ei.prototype=Object.assign(Object.create(_i.prototype),{constructor:Ei}),Ci.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ci,isDirectionalLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Pi.prototype=Object.assign(Object.create(bi.prototype),{constructor:Pi,isAmbientLight:!0}),Mi.prototype=Object.assign(Object.create(bi.prototype),{constructor:Mi,isRectAreaLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=bi.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});var _a={arraySlice:function(t,e,i){return _a.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,i=new Array(e),n=0;n!==e;++n)i[n]=n;return i.sort(function(e,i){return t[e]-t[i]}),i},sortedArray:function(t,e,i){for(var n=t.length,r=new t.constructor(n),o=0,s=0;s!==n;++o)for(var a=i[o]*e,h=0;h!==e;++h)r[s++]=t[a+h];return r},flattenJSON:function(t,e,i,n){for(var r=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[r++];if(void 0!==o){var s=o[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[n])&&(e.push(o.time),i.push.apply(i,s)),o=t[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[n])&&(e.push(o.time),s.toArray(i,i.length)),o=t[r++]}while(void 0!==o);else do{void 0!==(s=o[n])&&(e.push(o.time),i.push(s)),o=t[r++]}while(void 0!==o)}}};Object.assign(Ai.prototype,{evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{var o;i:{n:if(!(t<n)){for(var s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}o=e.length;break i}if(t>=r)break t;var a=e[1];t<a&&(i=2,r=a);for(s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}o=i,i=0}for(;i<o;){var h=i+o>>>1;t<e[h]?o=h:i=h+1}if(n=e[i],void 0===(r=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n,o=0;o!==n;++o)e[o]=i[r+o];return e},interpolate_:function(t,e,i,n){throw new Error("call to abstract method")},intervalChanged_:function(t,e,i){}}),Object.assign(Ai.prototype,{beforeStart_:Ai.prototype.copySampleValue_,afterEnd_:Ai.prototype.copySampleValue_}),Ri.prototype=Object.assign(Object.create(Ai.prototype),{constructor:Ri,DefaultSettings_:{endingStart:Ds,endingEnd:Ds},intervalChanged_:function(t,e,i){var n=this.parameterPositions,r=t-2,o=t+1,s=n[r],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case Fs:r=t,s=2*e-i;break;case Us:s=e+n[r=n.length-2]-n[r+1];break;default:r=t,s=i}if(void 0===a)switch(this.getSettings_().endingEnd){case Fs:o=t,a=2*i-e;break;case Us:o=1,a=i+n[1]-n[0];break;default:o=t-1,a=e}var h=.5*(i-e),u=this.valueSize;this._weightPrev=h/(e-s),this._weightNext=h/(a-i),this._offsetPrev=r*u,this._offsetNext=o*u},interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,h=a-s,u=this._offsetPrev,c=this._offsetNext,l=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,g=-l*m+2*l*f-l*p,y=(1+l)*m+(-1.5-2*l)*f+(-.5+l)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f,x=0;x!==s;++x)r[x]=g*o[u+x]+y*o[h+x]+v*o[a+x]+b*o[c+x];return r}}),Li.prototype=Object.assign(Object.create(Ai.prototype),{constructor:Li,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,h=a-s,u=(i-e)/(n-e),c=1-u,l=0;l!==s;++l)r[l]=o[h+l]*c+o[a+l]*u;return r}}),Oi.prototype=Object.assign(Object.create(Ai.prototype),{constructor:Oi,interpolate_:function(t,e,i,n){return this.copySampleValue_(t-1)}});var wa;wa={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Bs,InterpolantFactoryMethodDiscrete:function(t){return new Oi(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Li(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Ri(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Is:e=this.InterpolantFactoryMethodDiscrete;break;case Bs:e=this.InterpolantFactoryMethodLinear;break;case ks:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrackPrototype:",i)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Is;case this.InterpolantFactoryMethodLinear:return Bs;case this.InterpolantFactoryMethodSmooth:return ks}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<t;)++r;for(;-1!==o&&i[o]>e;)--o;if(++o,0!==r||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);var s=this.getValueSize();this.times=_a.arraySlice(i,r,o),this.values=_a.arraySlice(this.values,r*s,o*s)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrackPrototype: Invalid value size in track.",this),t=!1);var i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrackPrototype: Track is empty.",this),t=!1);for(var o=null,s=0;s!==r;s++){var a=i[s];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrackPrototype: Time is not a valid number.",this,s,a),t=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrackPrototype: Out of order keys.",this,s,a,o),t=!1;break}o=a}if(void 0!==n&&_a.isTypedArray(n)){s=0;for(var h=n.length;s!==h;++s){var u=n[s];if(isNaN(u)){console.error("THREE.KeyframeTrackPrototype: Value is not a valid number.",this,s,u),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),n=this.getInterpolation()===ks,r=1,o=t.length-1,s=1;s<o;++s){var a=!1,h=t[s];if(h!==t[s+1]&&(1!==s||h!==h[0]))if(n)a=!0;else for(var u=s*i,c=u-i,l=u+i,d=0;d!==i;++d){var p=e[u+d];if(p!==e[c+d]||p!==e[l+d]){a=!0;break}}if(a){if(s!==r){t[r]=t[s];var f=s*i,m=r*i;for(d=0;d!==i;++d)e[m+d]=e[f+d]}++r}}if(o>0){t[r]=t[o];for(f=o*i,m=r*i,d=0;d!==i;++d)e[m+d]=e[f+d];++r}return r!==t.length&&(this.times=_a.arraySlice(t,0,r),this.values=_a.arraySlice(e,0,r*i)),this}},Bi.prototype=Object.assign(Object.create(wa),{constructor:Bi,ValueTypeName:"vector"}),ki.prototype=Object.assign(Object.create(Ai.prototype),{constructor:ki,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,h=(i-e)/(n-e),c=a+s;a!==c;a+=4)u.slerpFlat(r,0,o,a-s,o,a,h);return r}}),Di.prototype=Object.assign(Object.create(wa),{constructor:Di,ValueTypeName:"quaternion",DefaultInterpolation:Bs,InterpolantFactoryMethodLinear:function(t){return new ki(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Fi.prototype=Object.assign(Object.create(wa),{constructor:Fi,ValueTypeName:"number"}),Ui.prototype=Object.assign(Object.create(wa),{constructor:Ui,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Is,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ni.prototype=Object.assign(Object.create(wa),{constructor:Ni,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Is,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Gi.prototype=Object.assign(Object.create(wa),{constructor:Gi,ValueTypeName:"color"}),ji.prototype=wa,wa.constructor=ji,Object.assign(ji,{parse:function(t){if(void 0===t.type)throw new Error("track type undefined, can not parse");var e=ji._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var i=[],n=[];_a.flattenJSON(t.keys,i,n,"value"),t.times=i,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,i=t.constructor;if(void 0!==i.toJSON)e=i.toJSON(t);else{e={name:t.name,times:_a.convertArray(t.times,Array),values:_a.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Fi;case"vector":case"vector2":case"vector3":case"vector4":return Bi;case"color":return Gi;case"quaternion":return Di;case"bool":case"boolean":return Ni;case"string":return Ui}throw new Error("Unsupported typeName: "+t)}}),Object.assign(Vi,{parse:function(t){for(var e=[],i=t.tracks,n=1/(t.fps||1),r=0,o=i.length;r!==o;++r)e.push(ji.parse(i[r]).scale(n));return new Vi(t.name,t.duration,e)},toJSON:function(t){for(var e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e},r=0,o=i.length;r!==o;++r)e.push(ji.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(t,e,i,n){for(var r=e.length,o=[],s=0;s<r;s++){var a=[],h=[];a.push((s+r-1)%r,s,(s+1)%r),h.push(0,1,0);var u=_a.getKeyframeOrder(a);a=_a.sortedArray(a,1,u),h=_a.sortedArray(h,1,u),n||0!==a[0]||(a.push(r),h.push(h[0])),o.push(new Fi(".morphTargetInfluences["+e[s].name+"]",a,h).scale(1/i))}return new Vi(t,-1,o)},findByName:function(t,e){var i=t;if(!Array.isArray(t)){var n=t;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,o=0,s=t.length;o<s;o++){var a=t[o],h=a.name.match(r);if(h&&h.length>1){var u=n[l=h[1]];u||(n[l]=u=[]),u.push(a)}}var c=[];for(var l in n)c.push(Vi.CreateFromMorphTargetSequence(l,n[l],e,i));return c},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(t,e,i,n,r){if(0!==i.length){var o=[],s=[];_a.flattenJSON(i,o,s,n),0!==o.length&&r.push(new t(e,o,s))}},n=[],r=t.name||"default",o=t.length||-1,s=t.fps||30,a=t.hierarchy||[],h=0;h<a.length;h++){var u=a[h].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},l=0;l<u.length;l++)if(u[l].morphTargets)for(var d=0;d<u[l].morphTargets.length;d++)c[u[l].morphTargets[d]]=-1;for(var p in c){var f=[],m=[];for(d=0;d!==u[l].morphTargets.length;++d){var g=u[l];f.push(g.time),m.push(g.morphTarget===p?1:0)}n.push(new Fi(".morphTargetInfluence["+p+"]",f,m))}o=c.length*(s||1)}else{var y=".bones["+e[h].name+"]";i(Bi,y+".position",u,"pos",n),i(Di,y+".quaternion",u,"rot",n),i(Bi,y+".scale",u,"scl",n)}}if(0===n.length)return null;return new Vi(r,o,n)}}),Object.assign(Vi.prototype,{resetDuration:function(){for(var t=0,e=0,i=this.tracks.length;e!==i;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),Object.assign(Hi.prototype,{load:function(t,e,i,n){var r=this;new pi(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},setTextures:function(t){this.textures=t},parse:function(t){function e(t){return void 0===i[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),i[t]}var i=this.textures,n=new va[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.shading&&(n.shading=t.shading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=e(t.map)),void 0!==t.alphaMap&&(n.alphaMap=e(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=e(t.normalMap)),void 0!==t.normalScale){var o=t.normalScale;!1===Array.isArray(o)&&(o=[o,o]),n.normalScale=(new r).fromArray(o)}return void 0!==t.displacementMap&&(n.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=e(t.specularMap)),void 0!==t.envMap&&(n.envMap=e(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=e(t.gradientMap)),n}}),Object.assign(zi.prototype,{load:function(t,e,i,n){var r=this;new pi(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},parse:function(t){var e=new Pt,i=t.data.index;if(void 0!==i){var n=new Ta[i.type](i.array);e.setIndex(new mt(n,1))}var r=t.data.attributes;for(var o in r){var s=r[o];n=new Ta[s.type](s.array);e.addAttribute(o,new mt(n,s.itemSize,s.normalized))}var a=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==a)for(var h=0,u=a.length;h!==u;++h){var l=a[h];e.addGroup(l.start,l.count,l.materialIndex)}var d=t.data.boundingSphere;if(void 0!==d){var p=new c;void 0!==d.center&&p.fromArray(d.center),e.boundingSphere=new tt(p,d.radius)}return e}});var Ta={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Wi.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,i=0,n=e.length;i<n;i+=2){var r=e[i],o=e[i+1];if(r.test(t))return o}return null}},Object.assign(Wi.prototype,{crossOrigin:void 0,extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(t,e,i){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e,i);return n},createMaterial:function(){var t={NoBlending:$r,NormalBlending:to,AdditiveBlending:eo,SubtractiveBlending:io,MultiplyBlending:no,CustomBlending:ro},e=new X,i=new vi,n=new Hi;return function(r,o,s){function a(t,e,n,r,a){var u,c=o+t,l=Wi.Handlers.get(c);null!==l?u=l.load(c):(i.setCrossOrigin(s),u=i.load(c)),void 0!==e&&(u.repeat.fromArray(e),1!==e[0]&&(u.wrapS=Xo),1!==e[1]&&(u.wrapT=Xo)),void 0!==n&&u.offset.fromArray(n),void 0!==r&&("repeat"===r[0]&&(u.wrapS=Xo),"mirror"===r[0]&&(u.wrapS=Yo),"repeat"===r[1]&&(u.wrapT=Xo),"mirror"===r[1]&&(u.wrapT=Yo)),void 0!==a&&(u.anisotropy=a);var d=Js.generateUUID();return h[d]=u,d}var h={},u={uuid:Js.generateUUID(),type:"MeshLambertMaterial"};for(var c in r){var l=r[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":u.name=l;break;case"blending":u.blending=t[l];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",c,"is no longer supported.");break;case"colorDiffuse":u.color=e.fromArray(l).getHex();break;case"colorSpecular":u.specular=e.fromArray(l).getHex();break;case"colorEmissive":u.emissive=e.fromArray(l).getHex();break;case"specularCoef":u.shininess=l;break;case"shading":"basic"===l.toLowerCase()&&(u.type="MeshBasicMaterial"),"phong"===l.toLowerCase()&&(u.type="MeshPhongMaterial"),"standard"===l.toLowerCase()&&(u.type="MeshStandardMaterial");break;case"mapDiffuse":u.map=a(l,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":u.emissiveMap=a(l,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":u.lightMap=a(l,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":u.aoMap=a(l,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":u.bumpMap=a(l,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":u.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":u.normalMap=a(l,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":u.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":u.specularMap=a(l,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":u.metalnessMap=a(l,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":u.roughnessMap=a(l,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":u.alphaMap=a(l,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":u.side=Xr;break;case"doubleSided":u.side=qr;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),u.opacity=l;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":u[c]=l;break;case"vertexColors":!0===l&&(u.vertexColors=Jr),"face"===l&&(u.vertexColors=Qr);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,l)}}return"MeshBasicMaterial"===u.type&&delete u.emissive,"MeshPhongMaterial"!==u.type&&delete u.specular,u.opacity<1&&(u.transparent=!0),n.setTextures(h),n.parse(u)}}()}),Object.assign(Xi.prototype,{load:function(t,e,i,n){var r=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Wi.prototype.extractUrlBase(t),s=new pi(this.manager);s.setWithCredentials(this.withCredentials),s.load(t,function(i){var n=JSON.parse(i),s=n.metadata;if(void 0!==s){var a=s.type;if(void 0!==a){if("object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.")}}var h=r.parse(n,o);e(h.geometry,h.materials)},i,n)},setTexturePath:function(t){this.texturePath=t},parse:function(){return function(t,e){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var i=new ft;if(function(t,e){function i(t,e){return t&1<<e}var n,o,s,a,h,u,l,d,p,f,m,g,y,v,b,x,_,w,T,S,E,C,P,M,A,R=t.faces,L=t.vertices,O=t.normals,I=t.colors,B=t.scale,k=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&k++;for(n=0;n<k;n++)e.faceVertexUvs[n]=[]}for(a=0,h=L.length;a<h;)(w=new c).x=L[a++]*B,w.y=L[a++]*B,w.z=L[a++]*B,e.vertices.push(w);for(a=0,h=R.length;a<h;)if(f=R[a++],m=i(f,0),g=i(f,1),y=i(f,3),v=i(f,4),b=i(f,5),x=i(f,6),_=i(f,7),m){if(S=new dt,S.a=R[a],S.b=R[a+1],S.c=R[a+3],E=new dt,E.a=R[a+1],E.b=R[a+2],E.c=R[a+3],a+=4,g&&(p=R[a++],S.materialIndex=p,E.materialIndex=p),s=e.faces.length,y)for(n=0;n<k;n++)for(M=t.uvs[n],e.faceVertexUvs[n][s]=[],e.faceVertexUvs[n][s+1]=[],o=0;o<4;o++)A=new r(M[2*(d=R[a++])],M[2*d+1]),2!==o&&e.faceVertexUvs[n][s].push(A),0!==o&&e.faceVertexUvs[n][s+1].push(A);if(v&&(l=3*R[a++],S.normal.set(O[l++],O[l++],O[l]),E.normal.copy(S.normal)),b)for(n=0;n<4;n++)l=3*R[a++],P=new c(O[l++],O[l++],O[l]),2!==n&&S.vertexNormals.push(P),0!==n&&E.vertexNormals.push(P);if(x&&(C=I[u=R[a++]],S.color.setHex(C),E.color.setHex(C)),_)for(n=0;n<4;n++)C=I[u=R[a++]],2!==n&&S.vertexColors.push(new X(C)),0!==n&&E.vertexColors.push(new X(C));e.faces.push(S),e.faces.push(E)}else{if(T=new dt,T.a=R[a++],T.b=R[a++],T.c=R[a++],g&&(p=R[a++],T.materialIndex=p),s=e.faces.length,y)for(n=0;n<k;n++)for(M=t.uvs[n],e.faceVertexUvs[n][s]=[],o=0;o<3;o++)A=new r(M[2*(d=R[a++])],M[2*d+1]),e.faceVertexUvs[n][s].push(A);if(v&&(l=3*R[a++],T.normal.set(O[l++],O[l++],O[l])),b)for(n=0;n<3;n++)l=3*R[a++],P=new c(O[l++],O[l++],O[l]),T.vertexNormals.push(P);if(x&&(u=R[a++],T.color.setHex(I[u])),_)for(n=0;n<3;n++)u=R[a++],T.vertexColors.push(new X(I[u]));e.faces.push(T)}}(t,i),function(t,e){var i=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,r=t.skinWeights.length;n<r;n+=i){var o=t.skinWeights[n],a=i>1?t.skinWeights[n+1]:0,h=i>2?t.skinWeights[n+2]:0,u=i>3?t.skinWeights[n+3]:0;e.skinWeights.push(new s(o,a,h,u))}if(t.skinIndices)for(n=0,r=t.skinIndices.length;n<r;n+=i){var c=t.skinIndices[n],l=i>1?t.skinIndices[n+1]:0,d=i>2?t.skinIndices[n+2]:0,p=i>3?t.skinIndices[n+3]:0;e.skinIndices.push(new s(c,l,d,p))}e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,i),function(t,e){var i=t.scale;if(void 0!==t.morphTargets)for(var n=0,r=t.morphTargets.length;n<r;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var o=e.morphTargets[n].vertices,s=t.morphTargets[n].vertices,a=0,h=s.length;a<h;a+=3){var u=new c;u.x=s[a]*i,u.y=s[a+1]*i,u.z=s[a+2]*i,o.push(u)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var l=e.faces,d=t.morphColors[0].colors;for(n=0,r=l.length;n<r;n++)l[n].color.fromArray(d,3*n)}}(t,i),function(t,e){var i=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var r=0;r<n.length;r++){var o=Vi.parseAnimation(n[r],e.bones);o&&i.push(o)}if(e.morphTargets){var s=Vi.CreateClipsFromMorphTargetSequences(e.morphTargets,10);i=i.concat(s)}i.length>0&&(e.animations=i)}(t,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===t.materials||0===t.materials.length)return{geometry:i};return{geometry:i,materials:Wi.prototype.initMaterials(t.materials,e,this.crossOrigin)}}}()}),Object.assign(qi.prototype,{load:function(t,e,i,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var r=this;new pi(r.manager).load(t,function(i){var o=null;try{o=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?r.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead.")},i,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var i=this.parseGeometries(t.geometries),n=this.parseImages(t.images,function(){void 0!==e&&e(s)}),r=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,r),s=this.parseObject(t.object,i,o);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseGeometries:function(t){var e={};if(void 0!==t)for(var i=new Xi,n=new zi,r=0,o=t.length;r<o;r++){var s,a=t[r];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new ya[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new ya[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new ya[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new ya[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new ya[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new ya[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":s=new ya[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new ya[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new ya[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new ya[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new ya[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"BufferGeometry":s=n.parse(a);break;case"Geometry":s=i.parse(a,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),e[a.uuid]=s}return e},parseMaterials:function(t,e){var i={};if(void 0!==t){var n=new Hi;n.setTextures(e);for(var r=0,o=t.length;r<o;r++){var s=t[r];if("MultiMaterial"===s.type){for(var a=[],h=0;h<s.materials.length;h++)a.push(n.parse(s.materials[h]));i[s.uuid]=a}else i[s.uuid]=n.parse(s)}}return i},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var n=Vi.parse(t[i]);e.push(n)}return e},parseImages:function(t,e){function i(t){return n.manager.itemStart(t),o.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemEnd(t),n.manager.itemError(t)})}var n=this,r={};if(void 0!==t&&t.length>0){var o=new gi(new di(e));o.setCrossOrigin(this.crossOrigin);for(var s=0,a=t.length;s<a;s++){var h=t[s],u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:n.texturePath+h.url;r[h.uuid]=i(u)}}return r},parseTextures:function(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var r=0,s=t.length;r<s;r++){var a=t[r];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var h=new o(e[a.image]);h.needsUpdate=!0,h.uuid=a.uuid,void 0!==a.name&&(h.name=a.name),void 0!==a.mapping&&(h.mapping=i(a.mapping,Sa)),void 0!==a.offset&&h.offset.fromArray(a.offset),void 0!==a.repeat&&h.repeat.fromArray(a.repeat),void 0!==a.wrap&&(h.wrapS=i(a.wrap[0],Ea),h.wrapT=i(a.wrap[1],Ea)),void 0!==a.minFilter&&(h.minFilter=i(a.minFilter,Ca)),void 0!==a.magFilter&&(h.magFilter=i(a.magFilter,Ca)),void 0!==a.anisotropy&&(h.anisotropy=a.anisotropy),void 0!==a.flipY&&(h.flipY=a.flipY),n[a.uuid]=h}return n},parseObject:function(){var t=new l;return function(e,i,n){function r(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),i[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],i=0,r=t.length;i<r;i++){var o=t[i];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}var s;switch(e.type){case"Scene":s=new te,void 0!==e.background&&Number.isInteger(e.background)&&(s.background=new X(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new $t(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new Jt(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new lt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new ct(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":s=new Pi(e.color,e.intensity);break;case"DirectionalLight":s=new Ci(e.color,e.intensity);break;case"PointLight":s=new Si(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new Mi(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Ti(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new xi(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=r(e.geometry),h=o(e.material);s=a.bones&&a.bones.length>0?new ae(a,h):new Dt(a,h);break;case"LOD":s=new re;break;case"Line":s=new ue(r(e.geometry),o(e.material),e.mode);break;case"LineLoop":s=new le(r(e.geometry),o(e.material));break;case"LineSegments":s=new ce(r(e.geometry),o(e.material));break;case"PointCloud":case"Points":s=new pe(r(e.geometry),o(e.material));break;case"Sprite":s=new ne(o(e.material));break;case"Group":s=new fe;break;default:s=new ht}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(t.fromArray(e.matrix),t.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.children)for(var u in e.children)s.add(this.parseObject(e.children[u],i,n));if("LOD"===e.type)for(var c=e.levels,l=0;l<c.length;l++){var d=c[l];void 0!==(u=s.getObjectByProperty("uuid",d.object))&&s.addLevel(u,d.distance)}return s}}()});var Sa={UVMapping:Uo,CubeReflectionMapping:No,CubeRefractionMapping:Go,EquirectangularReflectionMapping:jo,EquirectangularRefractionMapping:Vo,SphericalReflectionMapping:Ho,CubeUVReflectionMapping:zo,CubeUVRefractionMapping:Wo},Ea={RepeatWrapping:Xo,ClampToEdgeWrapping:qo,MirroredRepeatWrapping:Yo},Ca={NearestFilter:Ko,NearestMipMapNearestFilter:Zo,NearestMipMapLinearFilter:Qo,LinearFilter:Jo,LinearMipMapNearestFilter:$o,LinearMipMapLinearFilter:ts};Object.assign(Qi.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=t;i++)o+=(e=this.getPoint(i/t)).distanceTo(r),n.push(o),r=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i,n=this.getLengths(),r=0,o=n.length;i=e||t*n[o-1];for(var s,a=0,h=o-1;a<=h;)if(r=Math.floor(a+(h-a)/2),(s=n[r]-i)<0)a=r+1;else{if(!(s>0)){h=r;break}h=r-1}if(r=h,n[r]===i)return r/(o-1);var u=n[r];return(r+(i-u)/(n[r+1]-u))/(o-1)},getTangent:function(t){var e=t-1e-4,i=t+1e-4;e<0&&(e=0),i>1&&(i=1);var n=this.getPoint(e);return this.getPoint(i).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var i,n,r,o=new c,s=[],a=[],h=[],u=new c,d=new l;for(i=0;i<=t;i++)n=i/t,s[i]=this.getTangentAt(n),s[i].normalize();a[0]=new c,h[0]=new c;var p=Number.MAX_VALUE,f=Math.abs(s[0].x),m=Math.abs(s[0].y),g=Math.abs(s[0].z);for(f<=p&&(p=f,o.set(1,0,0)),m<=p&&(p=m,o.set(0,1,0)),g<=p&&o.set(0,0,1),u.crossVectors(s[0],o).normalize(),a[0].crossVectors(s[0],u),h[0].crossVectors(s[0],a[0]),i=1;i<=t;i++)a[i]=a[i-1].clone(),h[i]=h[i-1].clone(),u.crossVectors(s[i-1],s[i]),u.length()>Number.EPSILON&&(u.normalize(),r=Math.acos(Js.clamp(s[i-1].dot(s[i]),-1,1)),a[i].applyMatrix4(d.makeRotationAxis(u,r))),h[i].crossVectors(s[i],a[i]);if(!0===e)for(r=Math.acos(Js.clamp(a[0].dot(a[t]),-1,1)),r/=t,s[0].dot(u.crossVectors(a[0],a[t]))>0&&(r=-r),i=1;i<=t;i++)a[i].applyMatrix4(d.makeRotationAxis(s[i],r*i)),h[i].crossVectors(s[i],a[i]);return{tangents:s,normals:a,binormals:h}}}),(Ji.prototype=Object.create(Qi.prototype)).constructor=Ji,Ji.prototype.isLineCurve=!0,Ji.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},Ji.prototype.getPointAt=function(t){return this.getPoint(t)},Ji.prototype.getTangent=function(t){return this.v2.clone().sub(this.v1).normalize()},$i.prototype=Object.assign(Object.create(Qi.prototype),{constructor:$i,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Ji(e,t))},getPoint:function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=e){var r=i[n]-e,o=this.curves[n],s=o.getLength(),a=0===s?0:1-r/s;return o.getPointAt(a)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],n=0,r=this.curves;n<r.length;n++)for(var o=r[n],s=o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s),h=0;h<a.length;h++){var u=a[h];e&&e.equals(u)||(i.push(u),e=u)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},createPointsGeometry:function(t){var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){for(var e=new ft,i=0,n=t.length;i<n;i++){var r=t[i];e.vertices.push(new c(r.x,r.y,r.z||0))}return e}}),(tn.prototype=Object.create(Qi.prototype)).constructor=tn,tn.prototype.isEllipseCurve=!0,tn.prototype.getPoint=function(t){for(var e=2*Math.PI,i=this.aEndAngle-this.aStartAngle,n=Math.abs(i)<Number.EPSILON;i<0;)i+=e;for(;i>e;)i-=e;i<Number.EPSILON&&(i=n?0:e),!0!==this.aClockwise||n||(i===e?i=-e:i-=e);var o=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(o),a=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),c=s-this.aX,l=a-this.aY;s=c*h-l*u+this.aX,a=c*u+l*h+this.aY}return new r(s,a)},(en.prototype=Object.create(Qi.prototype)).constructor=en,en.prototype.isSplineCurve=!0,en.prototype.getPoint=function(t){var e=this.points,i=(e.length-1)*t,n=Math.floor(i),o=i-n,s=e[0===n?n:n-1],a=e[n],h=e[n>e.length-2?e.length-1:n+1],u=e[n>e.length-3?e.length-1:n+2];return new r(Yi(o,s.x,a.x,h.x,u.x),Yi(o,s.y,a.y,h.y,u.y))},(nn.prototype=Object.create(Qi.prototype)).constructor=nn,nn.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,o=this.v3;return new r(Zi(t,e.x,i.x,n.x,o.x),Zi(t,e.y,i.y,n.y,o.y))},(rn.prototype=Object.create(Qi.prototype)).constructor=rn,rn.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new r(Ki(t,e.x,i.x,n.x),Ki(t,e.y,i.y,n.y))};var Pa=Object.assign(Object.create($i.prototype),{fromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var i=new Ji(this.currentPoint.clone(),new r(t,e));this.curves.push(i),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,i,n){var o=new rn(this.currentPoint.clone(),new r(t,e),new r(i,n));this.curves.push(o),this.currentPoint.set(i,n)},bezierCurveTo:function(t,e,i,n,o,s){var a=new nn(this.currentPoint.clone(),new r(t,e),new r(i,n),new r(o,s));this.curves.push(a),this.currentPoint.set(o,s)},splineThru:function(t){var e=new en([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,i,n,r,o){var s=this.currentPoint.x,a=this.currentPoint.y;this.absarc(t+s,e+a,i,n,r,o)},absarc:function(t,e,i,n,r,o){this.absellipse(t,e,i,i,n,r,o)},ellipse:function(t,e,i,n,r,o,s,a){var h=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(t+h,e+u,i,n,r,o,s,a)},absellipse:function(t,e,i,n,r,o,s,a){var h=new tn(t,e,i,n,r,o,s,a);if(this.curves.length>0){var u=h.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(h);var c=h.getPoint(1);this.currentPoint.copy(c)}});on.prototype=Pa,Pa.constructor=on,sn.prototype=Object.assign(Object.create(Pa),{constructor:sn,getPointsHoles:function(t){for(var e=[],i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractAllPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},extractPoints:function(t){return this.extractAllPoints(t)}}),Object.assign(an.prototype,{moveTo:function(t,e){this.currentPath=new on,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){this.currentPath.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,o){this.currentPath.bezierCurveTo(t,e,i,n,r,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function i(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i],o=new sn;o.curves=r.curves,e.push(o)}return e}function n(t,e){for(var i=e.length,n=!1,r=i-1,o=0;o<i;r=o++){var s=e[r],a=e[o],h=a.x-s.x,u=a.y-s.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(s=e[o],h=-h,a=e[r],u=-u),t.y<s.y||t.y>a.y)continue;if(t.y===s.y){if(t.x===s.x)return!0}else{var c=u*(t.x-s.x)-h*(t.y-s.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(t.y!==s.y)continue;if(a.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=a.x)return!0}}return n}var r=ga.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return i(o);var s,a,h,u=[];if(1===o.length)return a=o[0],h=new sn,h.curves=a.curves,u.push(h),u;var c=!r(o[0].getPoints());c=t?!c:c;var l,d=[],p=[],f=[],m=0;p[m]=void 0,f[m]=[];for(var g=0,y=o.length;g<y;g++)s=r(l=(a=o[g]).getPoints()),(s=t?!s:s)?(!c&&p[m]&&m++,p[m]={s:new sn,p:l},p[m].s.curves=a.curves,c&&m++,f[m]=[]):f[m].push({h:a,p:l[0]});if(!p[0])return i(o);if(p.length>1){for(var v=!1,b=[],x=0,_=p.length;x<_;x++)d[x]=[];for(x=0,_=p.length;x<_;x++)for(var w=f[x],T=0;T<w.length;T++){for(var S=w[T],E=!0,C=0;C<p.length;C++)n(S.p,p[C].p)&&(x!==C&&b.push({froms:x,tos:C,hole:T}),E?(E=!1,d[C].push(S)):v=!0);E&&d[x].push(S)}b.length>0&&(v||(f=d))}g=0;for(var P,M=p.length;g<M;g++){h=p[g].s,u.push(h);for(var A=0,R=(P=f[g]).length;A<R;A++)h.holes.push(P[A].h)}return u}}),Object.assign(hn.prototype,{isFont:!0,generateShapes:function(t,e,i){void 0===e&&(e=100),void 0===i&&(i=4);for(var n=this.data,r=function(t){for(var r=String(t).split(""),o=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=0,h=0,u=[],c=0;c<r.length;c++){var l=r[c];if("\n"===l)a=0,h-=s;else{var d=function(t,e,r,o){var s=n.glyphs[t]||n.glyphs["?"];if(s){var a,h,u,c,l,d,p,f,m,g,y,v=new an,b=[];if(s.o)for(var x=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),_=0,w=x.length;_<w;){var T=x[_++];switch(T){case"m":a=x[_++]*e+r,h=x[_++]*e+o,v.moveTo(a,h);break;case"l":a=x[_++]*e+r,h=x[_++]*e+o,v.lineTo(a,h);break;case"q":if(u=x[_++]*e+r,c=x[_++]*e+o,p=x[_++]*e+r,f=x[_++]*e+o,v.quadraticCurveTo(p,f,u,c),y=b[b.length-1]){l=y.x,d=y.y;for(var S=1;S<=i;S++){var E=S/i;Ki(E,l,p,u),Ki(E,d,f,c)}}break;case"b":if(u=x[_++]*e+r,c=x[_++]*e+o,p=x[_++]*e+r,f=x[_++]*e+o,m=x[_++]*e+r,g=x[_++]*e+o,v.bezierCurveTo(p,f,m,g,u,c),y=b[b.length-1]){l=y.x,d=y.y;for(var S=1;S<=i;S++){var E=S/i;Zi(E,l,p,m,u),Zi(E,d,f,g,c)}}}}return{offsetX:s.ha*e,path:v}}}(l,o,a,h);a+=d.offsetX,u.push(d.path)}}return u}(t),o=[],s=0,a=r.length;s<a;s++)Array.prototype.push.apply(o,r[s].toShapes());return o}}),Object.assign(un.prototype,{load:function(t,e,i,n){var r=this;new pi(this.manager).load(t,function(t){var i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}var n=r.parse(i);e&&e(n)},i,n)},parse:function(t){return new hn(t)}});var Ma,Aa={getContext:function(){return void 0===Ma&&(Ma=new(window.AudioContext||window.webkitAudioContext)),Ma},setContext:function(t){Ma=t}};Object.assign(cn.prototype,{load:function(t,e,i,n){var r=new pi(this.manager);r.setResponseType("arraybuffer"),r.load(t,function(t){Aa.getContext().decodeAudioData(t,function(t){e(t)})},i,n)}}),Object.assign(ln.prototype,{update:function(){var t,e,i,n,r,o,s,a,h=new l,u=new l;return function(c){if(t!==this||e!==c.focus||i!==c.fov||n!==c.aspect*this.aspect||r!==c.near||o!==c.far||s!==c.zoom||a!==this.eyeSep){t=this,e=c.focus,i=c.fov,n=c.aspect*this.aspect,r=c.near,o=c.far,s=c.zoom;var l,d,p=c.projectionMatrix.clone(),f=(a=this.eyeSep/2)*r/e,m=r*Math.tan(Js.DEG2RAD*i*.5)/s;u.elements[12]=-a,h.elements[12]=a,l=-m*n+f,d=m*n+f,p.elements[0]=2*r/(d-l),p.elements[8]=(d+l)/(d-l),this.cameraL.projectionMatrix.copy(p),l=-m*n-f,d=m*n-f,p.elements[0]=2*r/(d-l),p.elements[8]=(d+l)/(d-l),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(h)}}()}),(dn.prototype=Object.create(ht.prototype)).constructor=dn,pn.prototype=Object.assign(Object.create(ht.prototype),{constructor:pn,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new c,e=new u,i=new c,n=new c;return function(r){ht.prototype.updateMatrixWorld.call(this,r);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(t,e,i),n.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z))}}()}),fn.prototype=Object.assign(Object.create(ht.prototype),{constructor:fn,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),t.start(0,this.startTime),this.isPlaying=!0,this.source=t,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),mn.prototype=Object.assign(Object.create(fn.prototype),{constructor:mn,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new c;return function(e){ht.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),Object.assign(gn.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}}),Object.assign(yn.prototype,{accumulate:function(t,e){var i=this.buffer,n=this.valueSize,r=t*n+n,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==n;++s)i[r+s]=i[s];o=e}else{var a=e/(o+=e);this._mixBufferRegion(i,r,0,a,n)}this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,r<1){var s=3*e;this._mixBufferRegion(i,n,s,1-r,e)}for(var a=e,h=e+e;a!==h;++a)if(i[a]!==i[a+e]){o.setValue(i,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,i=this.valueSize,n=3*i;t.getValue(e,n);for(var r=i,o=n;r!==o;++r)e[r]=e[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,i,n,r){if(n>=.5)for(var o=0;o!==r;++o)t[e+o]=t[i+o]},_slerp:function(t,e,i,n){u.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,n,r){for(var o=1-n,s=0;s!==r;++s){var a=e+s;t[a]=t[a]*o+t[i+s]*n}}}),Object.assign(vn.prototype,{getValue:function(t,e){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}),Object.assign(bn,{Composite:vn,create:function(t,e,i){return t&&t.isAnimationObjectGroup?new bn.Composite(t,e,i):new bn(t,e,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:function(){var t=new RegExp("^"+/((?:[\w-]+[\/:])*)/.source+/([\w-\.]+)?/.source+/(?:\.([\w-]+)(?:\[(.+)\])?)?/.source+/\.([\w-]+)(?:\[(.+)\])?/.source+"$"),e=["material","materials","bones"];return function(i){var n=t.exec(i);if(!n)throw new Error("PropertyBinding: Cannot parse trackName: "+i);var r={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){var s=r.nodeName.substring(o+1);-1!==e.indexOf(s)&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=s)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return r}}(),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var i=function(t){for(var i=0;i<t.bones.length;i++){var n=t.bones[i];if(n.name===e)return n}return null}(t.skeleton);if(i)return i}if(t.children){var n=function(t){for(var i=0;i<t.length;i++){var r=t[i];if(r.name===e||r.uuid===e)return r;var o=n(r.children);if(o)return o}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(bn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)t[e++]=i[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.node[this.propertyName]=t[e]},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;if(t||(t=bn.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var a=t[n];if(void 0!==a){var h=this.Versioning.None;void 0!==t.needsUpdate?(h=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(h=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var u=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(t.geometry.morphAttributes.position[s].name===r){r=s;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(t.geometry.morphTargets[s].name===r){r=s;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][h]}else{var c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(bn.prototype,{_getValue_unbound:bn.prototype.getValue,_setValue_unbound:bn.prototype.setValue}),Object.assign(xn.prototype,{isAnimationObjectGroup:!0,add:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._paths,s=this._parsedPaths,a=this._bindings,h=a.length,u=0,c=arguments.length;u!==c;++u){var l=arguments[u],d=l.uuid,p=r[d],f=void 0;if(void 0===p){p=i++,r[d]=p,e.push(l);for(var m=0,g=h;m!==g;++m)a[m].push(new bn(l,o[m],s[m]))}else if(p<n){f=e[p];var y=--n,v=e[y];r[v.uuid]=p,e[p]=v,r[d]=y,e[y]=l;for(m=0,g=h;m!==g;++m){var b=a[m],x=b[y],_=b[p];b[p]=x,void 0===_&&(_=new bn(l,o[m],s[m])),b[y]=_}}else e[p]!==f&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(t){for(var e=this._objects,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,s=0,a=arguments.length;s!==a;++s){var h=arguments[s],u=h.uuid,c=n[u];if(void 0!==c&&c>=i){var l=i++,d=e[l];n[d.uuid]=c,e[c]=d,n[u]=l,e[l]=h;for(var p=0,f=o;p!==f;++p){var m=r[p],g=m[l],y=m[c];m[c]=g,m[l]=y}}}this.nCachedObjects_=i},uncache:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._bindings,s=o.length,a=0,h=arguments.length;a!==h;++a){var u=arguments[a].uuid,c=r[u];if(void 0!==c)if(delete r[u],c<n){var l=--n,d=e[l],p=e[v=--i];r[d.uuid]=c,e[c]=d,r[p.uuid]=l,e[l]=p,e.pop();for(var f=0,m=s;f!==m;++f){var g=(b=o[f])[l],y=b[v];b[c]=g,b[l]=y,b.pop()}}else{var v;r[(p=e[v=--i]).uuid]=c,e[c]=p,e.pop();for(f=0,m=s;f!==m;++f){var b;(b=o[f])[c]=b[v],b.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,n=i[t],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,s=this._parsedPaths,a=this._objects,h=a.length,u=this.nCachedObjects_,c=new Array(h);n=r.length,i[t]=n,o.push(t),s.push(e),r.push(c);for(var l=u,d=a.length;l!==d;++l){var p=a[l];c[l]=new bn(p,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];e[t[s]]=i,o[i]=a,o.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}}),Object.assign(_n.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){var n=this._clip.duration,r=t._clip.duration,o=r/n,s=n/r;t.warp(1,o,e),this.warp(s,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,h=o.sampleValues;return a[0]=r,a[1]=r+i,h[0]=t/s,h[1]=e/s,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,n){if(this.enabled){var r=this._startTime;if(null!==r){var o=(t-r)*i;if(o<0||0===i)return;this._startTime=null,e=i*o}e*=this._updateTimeScale(t);var s=this._updateTime(e),a=this._updateWeight(t);if(a>0)for(var h=this._interpolants,u=this._propertyBindings,c=0,l=h.length;c!==l;++c)h[c].evaluate(s),u[c].accumulate(n,a)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(n===Rs){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=i)e=i;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=n===Os;if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=i||e<0){var s=Math.floor(e/i);e-=i*s,r+=Math.abs(s);var a=this.repetitions-r;if(a<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(0===a){var h=t<0;this._setEndings(h,!h,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1==(1&r))return this.time=e,i-e}return this.time=e,e},_setEndings:function(t,e,i){var n=this._interpolantSettings;i?(n.endingStart=Fs,n.endingEnd=Fs):(n.endingStart=t?this.zeroSlopeAtStart?Fs:Ds:Us,n.endingEnd=e?this.zeroSlopeAtEnd?Fs:Ds:Us)},_scheduleFading:function(t,e,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=e,s[1]=r+t,a[1]=i,this}}),Object.assign(wn.prototype,n.prototype,{_bindAction:function(t,e){var i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,o=t._propertyBindings,s=t._interpolants,a=i.uuid,h=this._bindingsByRootAndName,u=h[a];void 0===u&&(u={},h[a]=u);for(var c=0;c!==r;++c){var l=n[c],d=l.name,p=u[d];if(void 0!==p)o[c]=p;else{if(void 0!==(p=o[c])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}var f=e&&e._propertyBindings[c].binding.parsedPath;++(p=new yn(bn.create(i,d,f),l.ValueTypeName,l.getValueSize())).referenceCount,this._addInactiveBinding(p,a,d),o[c]=p}s[c].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}for(var r=t._propertyBindings,o=0,s=r.length;o!==s;++o){var a=r[o];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){var n=this._actions,r=this._actionsByClip,o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{var s=o.knownActions;t._byClipCacheIndex=s.length,s.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,h=a[a.length-1],u=t._byClipCacheIndex;h._byClipCacheIndex=u,a[u]=h,a.pop(),t._byClipCacheIndex=null;delete s.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_addInactiveBinding:function(t,e,i){var n=this._bindingsByRootAndName,r=n[e],o=this._bindings;void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,s=o[n],a=e[e.length-1],h=t._cacheIndex;a._cacheIndex=h,e[h]=a,e.pop(),delete s[r];t:{for(var u in s)break t;delete o[n]}},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return void 0===i&&((i=new Li(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?Vi.findByName(i,t):t,o=null!==r?r.uuid:t,s=this._actionsByClip[o],a=null;if(void 0!==s){var h=s.actionByRoot[n];if(void 0!==h)return h;a=s.knownActions[0],null===r&&(r=a._clip)}if(null===r)return null;var u=new _n(this,r,e);return this._bindAction(u,a),this._addInactiveAction(u,o,n),u},existingAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?Vi.findByName(i,t):t,o=r?r.uuid:t,s=this._actionsByClip[o];return void 0!==s?s.actionByRoot[n]||null:null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==e;++r)t[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1,s=0;s!==i;++s){e[s]._update(n,t,r,o)}var a=this._bindings,h=this._nActiveBindings;for(s=0;s!==h;++s)a[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var o=r.knownActions,s=0,a=o.length;s!==a;++s){var h=o[s];this._deactivateAction(h);var u=h._cacheIndex,c=e[e.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,c._cacheIndex=u,e[u]=c,e.pop(),this._removeInactiveBindingsForAction(h)}delete n[i]}},uncacheRoot:function(t){var e=t.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var s in o){var a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(t,e){var i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),Tn.prototype.clone=function(){return new Tn(void 0===this.value.clone?this.value:this.value.clone())},Sn.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Sn,isInstancedBufferGeometry:!0,addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:i})},copy:function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var i=t.attributes;for(var n in i){var r=i[n];this.addAttribute(n,r.clone())}for(var o=t.groups,s=0,a=o.length;s<a;s++){var h=o[s];this.addGroup(h.start,h.count,h.materialIndex)}return this}}),Object.defineProperties(En.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(En.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}}),Object.defineProperty(Cn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Cn.prototype,{isInterleavedBuffer:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Pn.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Pn,isInstancedInterleavedBuffer:!0,copy:function(t){return Cn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Mn.prototype=Object.assign(Object.create(mt.prototype),{constructor:Mn,isInstancedBufferAttribute:!0,copy:function(t){return mt.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(An.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e){var i=[];return Ln(t,this,i,e),i.sort(Rn),i},intersectObjects:function(t,e){var i=[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=t.length;n<r;n++)Ln(t[n],this,i,e);return i.sort(Rn),i}}),Object.assign(On.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Object.assign(In.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Js.clamp(t.y/this.radius,-1,1))),this}}),Object.assign(Bn.prototype,{set:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),(kn.prototype=Object.create(Dt.prototype)).constructor=kn,kn.prototype.createAnimation=function(t,e,i,n){var r={start:e,end:i,length:i-e+1,fps:n,duration:(i-e)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=r,this.animationsList.push(r)},kn.prototype.autoCreateAnimations=function(t){for(var e,i=/([a-z]+)_?(\d+)/i,n={},r=this.geometry,o=0,s=r.morphTargets.length;o<s;o++){var a=r.morphTargets[o].name.match(i);if(a&&a.length>1){n[h=a[1]]||(n[h]={start:1/0,end:-1/0});o<(u=n[h]).start&&(u.start=o),o>u.end&&(u.end=o),e||(e=h)}}for(var h in n){var u=n[h];this.createAnimation(h,u.start,u.end,t)}this.firstAnimation=e},kn.prototype.setAnimationDirectionForward=function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},kn.prototype.setAnimationDirectionBackward=function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},kn.prototype.setAnimationFPS=function(t,e){var i=this.animationsMap[t];i&&(i.fps=e,i.duration=(i.end-i.start)/i.fps)},kn.prototype.setAnimationDuration=function(t,e){var i=this.animationsMap[t];i&&(i.duration=e,i.fps=(i.end-i.start)/i.duration)},kn.prototype.setAnimationWeight=function(t,e){var i=this.animationsMap[t];i&&(i.weight=e)},kn.prototype.setAnimationTime=function(t,e){var i=this.animationsMap[t];i&&(i.time=e)},kn.prototype.getAnimationTime=function(t){var e=0,i=this.animationsMap[t];return i&&(e=i.time),e},kn.prototype.getAnimationDuration=function(t){var e=-1,i=this.animationsMap[t];return i&&(e=i.duration),e},kn.prototype.playAnimation=function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("THREE.MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},kn.prototype.stopAnimation=function(t){var e=this.animationsMap[t];e&&(e.active=!1)},kn.prototype.update=function(t){for(var e=0,i=this.animationsList.length;e<i;e++){var n=this.animationsList[e];if(n.active){var r=n.duration/n.length;n.time+=n.direction*t,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.start+Js.clamp(Math.floor(n.time/r),0,n.length-1),s=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var a=n.time%r/r;n.directionBackwards&&(a=1-a),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=a*s,this.morphTargetInfluences[n.lastFrame]=(1-a)*s):this.morphTargetInfluences[n.currentFrame]=s}}},(Dn.prototype=Object.create(ht.prototype)).constructor=Dn,Dn.prototype.isImmediateRenderObject=!0,(Fn.prototype=Object.create(ce.prototype)).constructor=Fn,Fn.prototype.update=function(){var t=new c,e=new c,i=new et;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,h=s.faces,u=0,c=0,l=h.length;c<l;c++)for(var d=h[c],p=0,f=d.vertexNormals.length;p<f;p++){var m=a[d[n[p]]],g=d.vertexNormals[p];t.copy(m).applyMatrix4(r),e.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),u+=1,o.setXYZ(u,e.x,e.y,e.z),u+=1}else if(s&&s.isBufferGeometry){var y=s.attributes.position,v=s.attributes.normal;for(u=0,p=0,f=y.count;p<f;p++)t.set(y.getX(p),y.getY(p),y.getZ(p)).applyMatrix4(r),e.set(v.getX(p),v.getY(p),v.getZ(p)),e.applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),u+=1,o.setXYZ(u,e.x,e.y,e.z),u+=1}o.needsUpdate=!0}}(),(Un.prototype=Object.create(ht.prototype)).constructor=Un,Un.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Un.prototype.update=function(){var t=new c,e=new c;return function(){this.light.updateMatrixWorld();var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),this.cone.material.color.copy(this.light.color)}}(),(Gn.prototype=Object.create(ce.prototype)).constructor=Gn,Gn.prototype.onBeforeRender=function(){var t=new c,e=new l,i=new l;return function(){var n=this.bones,r=this.geometry,o=r.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var s=0,a=0;s<n.length;s++){var h=n[s];h.parent&&h.parent.isBone&&(e.multiplyMatrices(i,h.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(a,t.x,t.y,t.z),e.multiplyMatrices(i,h.parent.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(a+1,t.x,t.y,t.z),a+=2)}r.getAttribute("position").needsUpdate=!0}}(),(jn.prototype=Object.create(Dt.prototype)).constructor=jn,jn.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},jn.prototype.update=function(){this.material.color.copy(this.light.color)},(Vn.prototype=Object.create(ht.prototype)).constructor=Vn,Vn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Vn.prototype.update=function(){var t=this.children[0];t.material.color.copy(this.light.color);var e=.5*this.light.width,i=.5*this.light.height,n=t.geometry.attributes.position,r=n.array;r[0]=e,r[1]=-i,r[2]=0,r[3]=e,r[4]=i,r[5]=0,r[6]=-e,r[7]=i,r[8]=0,r[9]=-e,r[10]=-i,r[11]=0,r[12]=e,r[13]=-i,r[14]=0,n.needsUpdate=!0},(Hn.prototype=Object.create(ht.prototype)).constructor=Hn,Hn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Hn.prototype.update=function(){var t=new c,e=new X,i=new X;return function(){var n=this.children[0],r=n.geometry.getAttribute("color");e.copy(this.light.color),i.copy(this.light.groundColor);for(var o=0,s=r.count;o<s;o++){var a=o<s/2?e:i;r.setXYZ(o,a.r,a.g,a.b)}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate()),r.needsUpdate=!0}}(),(zn.prototype=Object.create(ce.prototype)).constructor=zn,(Wn.prototype=Object.create(ce.prototype)).constructor=Wn,(Xn.prototype=Object.create(ce.prototype)).constructor=Xn,Xn.prototype.update=function(){var t=new c,e=new c,i=new et;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,h=0,u=0,c=a.length;u<c;u++){var l=a[u],d=l.normal;t.copy(s[l.a]).add(s[l.b]).add(s[l.c]).divideScalar(3).applyMatrix4(n),e.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),r.setXYZ(h,t.x,t.y,t.z),h+=1,r.setXYZ(h,e.x,e.y,e.z),h+=1}r.needsUpdate=!0}}(),(qn.prototype=Object.create(ht.prototype)).constructor=qn,qn.prototype.dispose=function(){var t=this.children[0],e=this.children[1];t.geometry.dispose(),t.material.dispose(),e.geometry.dispose(),e.material.dispose()},qn.prototype.update=function(){var t=new c,e=new c,i=new c;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(e,t);var n=this.children[0],r=this.children[1];n.lookAt(i),n.material.color.copy(this.light.color),r.lookAt(i),r.scale.z=i.length()}}(),(Yn.prototype=Object.create(ce.prototype)).constructor=Yn,Yn.prototype.update=function(){function t(t,o,s,a){n.set(o,s,a).unproject(r);var h=i[t];if(void 0!==h)for(var u=e.getAttribute("position"),c=0,l=h.length;c<l;c++)u.setXYZ(h[c],n.x,n.y,n.z)}var e,i,n=new c,r=new ut;return function(){e=this.geometry,i=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),t("c",0,0,-1),t("t",0,0,1),t("n1",-1,-1,-1),t("n2",1,-1,-1),t("n3",-1,1,-1),t("n4",1,1,-1),t("f1",-1,-1,1),t("f2",1,-1,1),t("f3",-1,1,1),t("f4",1,1,1),t("u1",.7,1.1,-1),t("u2",-.7,1.1,-1),t("u3",0,2,-1),t("cf1",-1,0,1),t("cf2",1,0,1),t("cf3",0,-1,1),t("cf4",0,1,1),t("cn1",-1,0,-1),t("cn2",1,0,-1),t("cn3",0,-1,-1),t("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),(Kn.prototype=Object.create(ce.prototype)).constructor=Kn,Kn.prototype.update=function(){var t=new $;return function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var i=t.min,n=t.max,r=this.geometry.attributes.position,o=r.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=i.x,o[4]=n.y,o[5]=n.z,o[6]=i.x,o[7]=i.y,o[8]=n.z,o[9]=n.x,o[10]=i.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=i.z,o[15]=i.x,o[16]=n.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=n.x,o[22]=i.y,o[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Kn.prototype.setFromObject=function(t){return this.object=t,this.update(),this};var Ra,La;(Zn.prototype=Object.create(ht.prototype)).constructor=Zn,Zn.prototype.setDirection=function(){var t,e=new c;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(i.z,0,-i.x).normalize(),t=Math.acos(i.y),this.quaternion.setFromAxisAngle(e,t))}}(),Zn.prototype.setLength=function(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()},Zn.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(Qn.prototype=Object.create(ce.prototype)).constructor=Qn;var Oa=new c,Ia=new Jn,Ba=new Jn,ka=new Jn;($n.prototype=Object.create(Qi.prototype)).constructor=$n,$n.prototype.getPoint=function(t){var e=this.points,i=e.length,n=(i-(this.closed?0:1))*t,r=Math.floor(n),o=n-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/e.length)+1)*e.length:0===o&&r===i-1&&(r=i-2,o=1);var s,a,h,u;if(this.closed||r>0?s=e[(r-1)%i]:(Oa.subVectors(e[0],e[1]).add(e[0]),s=Oa),a=e[r%i],h=e[(r+1)%i],this.closed||r+2<i?u=e[(r+2)%i]:(Oa.subVectors(e[i-1],e[i-2]).add(e[i-1]),u=Oa),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var l="chordal"===this.type?.5:.25,d=Math.pow(s.distanceToSquared(a),l),p=Math.pow(a.distanceToSquared(h),l),f=Math.pow(h.distanceToSquared(u),l);p<1e-4&&(p=1),d<1e-4&&(d=p),f<1e-4&&(f=p),Ia.initNonuniformCatmullRom(s.x,a.x,h.x,u.x,d,p,f),Ba.initNonuniformCatmullRom(s.y,a.y,h.y,u.y,d,p,f),ka.initNonuniformCatmullRom(s.z,a.z,h.z,u.z,d,p,f)}else if("catmullrom"===this.type){var m=void 0!==this.tension?this.tension:.5;Ia.initCatmullRom(s.x,a.x,h.x,u.x,m),Ba.initCatmullRom(s.y,a.y,h.y,u.y,m),ka.initCatmullRom(s.z,a.z,h.z,u.z,m)}return new c(Ia.calc(o),Ba.calc(o),ka.calc(o))},(tr.prototype=Object.create(Qi.prototype)).constructor=tr,tr.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,r=this.v3;return new c(Zi(t,e.x,i.x,n.x,r.x),Zi(t,e.y,i.y,n.y,r.y),Zi(t,e.z,i.z,n.z,r.z))},(er.prototype=Object.create(Qi.prototype)).constructor=er,er.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new c(Ki(t,e.x,i.x,n.x),Ki(t,e.y,i.y,n.y),Ki(t,e.z,i.z,n.z))},(ir.prototype=Object.create(Qi.prototype)).constructor=ir,ir.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=new c;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e},(nr.prototype=Object.create(tn.prototype)).constructor=nr;var Da={createMultiMaterialObject:function(t,e){for(var i=new fe,n=0,r=e.length;n<r;n++)i.add(new Dt(t,e[n]));return i},detach:function(t,e,i){t.applyMatrix(e.matrixWorld),e.remove(t),i.add(t)},attach:function(t,e,i){t.applyMatrix((new l).getInverse(i.matrixWorld)),e.remove(t),i.add(t)}},Fa=0,Ua=1;Qi.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Qi.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Sr.prototype=Object.create($n.prototype),Er.prototype=Object.create($n.prototype),Cr.prototype=Object.create($n.prototype),Object.assign(Cr.prototype,{initFromArray:function(t){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(t){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(t){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),zn.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Gn.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(q.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign($.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Bt.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Js.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(et.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(l.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new c),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,n,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,o)}}),it.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},u.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(It.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(sn.prototype,{extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ue(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ye(this,t)}}),Object.assign(r.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(c.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,i){return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(s.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),ft.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(ht.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)}}),Object.defineProperties(ht.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(re.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(oe.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Qi.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),lt.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(bi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(mt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(Pt.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Pt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Tn.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Z.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new X}}}),Object.defineProperties(ai.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Q.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Qt.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(Qt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=t}}}),Object.defineProperties(rt.prototype,{cullFace:{get:function(){return this.renderReverseSided?Ur:Fr},set:function(t){var e=t!==Fr;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+e+"."),this.renderReverseSided=e}}}),Object.defineProperties(a.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),fn.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new cn).load(t,function(t){e.setBuffer(t)}),this},gn.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var Na={merge:function(t,e,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,i)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},Ga={crossOrigin:void 0,loadTexture:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new vi;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},loadTextureCube:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new yi;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}}},bbdN:function(t,e,i){var n,r=r||function(t){"use strict";if(!("undefined"==typeof t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=function(){return t.URL||t.webkitURL||t},i=t.document.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in i,r=/constructor/i.test(t.HTMLElement)||t.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},a=function(t){setTimeout(function(){"string"==typeof t?e().revokeObjectURL(t):t.remove()},4e4)},h=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},u=function(u,c,l){l||(u=h(u));var d,p=this,f="application/octet-stream"===u.type,m=function(){!function(t,e,i){for(var n=(e=[].concat(e)).length;n--;){var r=t["on"+e[n]];if("function"==typeof r)try{r.call(t,i||t)}catch(t){s(t)}}}(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,n)return d=e().createObjectURL(u),void setTimeout(function(){i.href=d,i.download=c,function(t){var e=new MouseEvent("click");t.dispatchEvent(e)}(i),m(),a(d),p.readyState=p.DONE});!function(){if((o||f&&r)&&t.FileReader){var i=new FileReader;return i.onloadend=function(){var e=o?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,p.readyState=p.DONE,m()},i.readAsDataURL(u),void(p.readyState=p.INIT)}d||(d=e().createObjectURL(u)),f?t.location.href=d:t.open(d,"_blank")||(t.location.href=d);p.readyState=p.DONE,m(),a(d)}()},c=u.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=h(t)),navigator.msSaveOrOpenBlob(t,e)}:(c.abort=function(){},c.readyState=c.INIT=0,c.WRITING=1,c.DONE=2,c.error=c.onwritestart=c.onprogress=c.onwrite=c.onabort=c.onerror=c.onwriteend=null,function(t,e,i){return new u(t,e||t.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof t&&t.exports?t.exports.saveAs=r:null!==i("MwgA")&&null!==i("f8Ud")&&(void 0===(n=(function(){return r}).call(e,i,e,t))||(t.exports=n))},bywS:function(t,e,i){"use strict";function n(t){return t}var r=i("wP3s");e.a=function(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),Object(r.a)(n,null,t)}},"dmC+":function(t,e,i){"use strict";var n=i("E9/g"),r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.project,this.thisArg))},t}(),s=function(t){function e(e,i,n){t.call(this,e),this.project=i,this.count=0,this.thisArg=n||this}return r(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(n.a);e.a=function(t,e){return function(t,e){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new o(t,e))}}(t,e)(this)}},f8Ud:function(t,e){(function(e){t.exports=e}).call(e,{})},fRUx:function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},"fc+i":function(t,e,i){"use strict";function n(){return T}function r(){return!!window.history.pushState}function o(t,e){U||(w._18.ng=U=w._18.ng||{}),U[t]=e}function s(t){return Object(w._4)(t)}function a(t,e){var i=(t||[]).concat(e||[]);return o(G,s),o(j,Object.assign({},N,function(t){return t.reduce(function(t,e){return t[e.name]=e.token,t},{})}(i||[]))),function(){return s}}function h(t,e,i){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?h(t,r,i):(r=r.replace(Z,t),i.push(r))}return i}function u(t){return function(e){!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}function c(t,e){if(t.charCodeAt(0)===et)throw new Error("Found the synthetic "+e+" "+t+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}function l(t){return(t=String(t)).match(dt)||t.match(pt)?t:(Object(w._5)()&&n().log("WARNING: sanitizing unsafe URL value "+t+" (see http://g.co/ng/security#xss)"),"unsafe:"+t)}function d(t){for(var e={},i=0,n=t.split(",");i<n.length;i++){e[n[i]]=!0}return e}function p(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i={},n=0,r=t;n<r.length;n++){var o=r[n];for(var s in o)o.hasOwnProperty(s)&&(i[s]=!0)}return i}function f(t,e){if(e&&mt.contains(t,e))throw new Error("Failed to sanitize html because the element is clobbered: "+mt.getOuterHTML(t));return e}function m(t){return t.replace(/&/g,"&amp;").replace(Mt,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(At,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function g(t){mt.attributeMap(t).forEach(function(e,i){"xmlns:ns1"!==i&&0!==i.indexOf("ns1:")||mt.removeAttribute(t,i)});for(var e=0,i=mt.childNodesAsList(t);e<i.length;e++){var n=i[e];mt.isElementNode(n)&&g(n)}}function y(t,e){try{var i=function(){if(ft)return ft;var t=(mt=n()).createElement("template");if("content"in t)return t;var e=mt.createHtmlDocument();if(null==(ft=mt.querySelector(e,"body"))){var i=mt.createElement("html",e);ft=mt.createElement("body",e),mt.appendChild(i,ft),mt.appendChild(e,i)}return ft}(),r=e?String(e):"",o=5,s=r;do{if(0===o)throw new Error("Failed to sanitize html because the input is unstable");o--,r=s,mt.setInnerHTML(i,r),t.documentMode&&g(i),s=mt.getInnerHTML(i)}while(r!==s);for(var a=new Pt,h=a.sanitizeChildren(mt.getTemplateContent(i)||i),u=mt.getTemplateContent(i)||i,c=0,l=mt.childNodesAsList(u);c<l.length;c++){var d=l[c];mt.removeChild(u,d)}return Object(w._5)()&&a.sanitizedSomething&&mt.log("WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss)."),h}catch(t){throw ft=null,t}}function v(){return new w.o}i.d(e,"a",function(){return Ht}),i.d(e,"j",function(){return Vt}),i.d(e,"g",function(){return I}),i.d(e,"i",function(){return F}),i.d(e,"h",function(){return V}),i.d(e,"c",function(){return z}),i.d(e,"d",function(){return W}),i.d(e,"e",function(){return st}),i.d(e,"f",function(){return at}),i.d(e,"b",function(){return Ot}),i.d(e,"t",function(){return n}),i.d(e,"l",function(){return $}),i.d(e,"k",function(){return rt}),i.d(e,"n",function(){return ht}),i.d(e,"o",function(){return lt}),i.d(e,"m",function(){return Y}),i.d(e,"p",function(){return q}),i.d(e,"q",function(){return v}),i.d(e,"r",function(){return a}),i.d(e,"s",function(){return It});var b,x=i("6Xbx"),_=i("qbdv"),w=i("/oeL"),T=null,S=function(t){function e(){var e=t.call(this)||this;e._animationPrefix=null,e._transitionEnd=null;try{var i=e.createElement("div",document);if(null!=e.getStyle(i,"animationName"))e._animationPrefix="";else for(var n=["Webkit","Moz","O","ms"],r=0;r<n.length;r++)if(null!=e.getStyle(i,n[r]+"AnimationName")){e._animationPrefix="-"+n[r].toLowerCase()+"-";break}var o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(o).forEach(function(t){null!=e.getStyle(i,t)&&(e._transitionEnd=o[t])})}catch(t){e._animationPrefix=null,e._transitionEnd=null}return e}return x.a(e,t),e.prototype.getDistributedNodes=function(t){return t.getDistributedNodes()},e.prototype.resolveAndSetHref=function(t,e,i){t.href=null==i?e:e+"/../"+i},e.prototype.supportsDOMEvents=function(){return!0},e.prototype.supportsNativeShadowDOM=function(){return"function"==typeof document.body.createShadowRoot},e.prototype.getAnimationPrefix=function(){return this._animationPrefix?this._animationPrefix:""},e.prototype.getTransitionEnd=function(){return this._transitionEnd?this._transitionEnd:""},e.prototype.supportsAnimation=function(){return null!=this._animationPrefix&&null!=this._transitionEnd},e}(function(){function t(){this.resourceLoaderType=null}return t.prototype.hasProperty=function(t,e){},t.prototype.setProperty=function(t,e,i){},t.prototype.getProperty=function(t,e){},t.prototype.invoke=function(t,e,i){},t.prototype.logError=function(t){},t.prototype.log=function(t){},t.prototype.logGroup=function(t){},t.prototype.logGroupEnd=function(){},Object.defineProperty(t.prototype,"attrToPropMap",{get:function(){return this._attrToPropMap},set:function(t){this._attrToPropMap=t},enumerable:!0,configurable:!0}),t.prototype.contains=function(t,e){},t.prototype.parse=function(t){},t.prototype.querySelector=function(t,e){},t.prototype.querySelectorAll=function(t,e){},t.prototype.on=function(t,e,i){},t.prototype.onAndCancel=function(t,e,i){},t.prototype.dispatchEvent=function(t,e){},t.prototype.createMouseEvent=function(t){},t.prototype.createEvent=function(t){},t.prototype.preventDefault=function(t){},t.prototype.isPrevented=function(t){},t.prototype.getInnerHTML=function(t){},t.prototype.getTemplateContent=function(t){},t.prototype.getOuterHTML=function(t){},t.prototype.nodeName=function(t){},t.prototype.nodeValue=function(t){},t.prototype.type=function(t){},t.prototype.content=function(t){},t.prototype.firstChild=function(t){},t.prototype.nextSibling=function(t){},t.prototype.parentElement=function(t){},t.prototype.childNodes=function(t){},t.prototype.childNodesAsList=function(t){},t.prototype.clearNodes=function(t){},t.prototype.appendChild=function(t,e){},t.prototype.removeChild=function(t,e){},t.prototype.replaceChild=function(t,e,i){},t.prototype.remove=function(t){},t.prototype.insertBefore=function(t,e,i){},t.prototype.insertAllBefore=function(t,e,i){},t.prototype.insertAfter=function(t,e,i){},t.prototype.setInnerHTML=function(t,e){},t.prototype.getText=function(t){},t.prototype.setText=function(t,e){},t.prototype.getValue=function(t){},t.prototype.setValue=function(t,e){},t.prototype.getChecked=function(t){},t.prototype.setChecked=function(t,e){},t.prototype.createComment=function(t){},t.prototype.createTemplate=function(t){},t.prototype.createElement=function(t,e){},t.prototype.createElementNS=function(t,e,i){},t.prototype.createTextNode=function(t,e){},t.prototype.createScriptTag=function(t,e,i){},t.prototype.createStyleElement=function(t,e){},t.prototype.createShadowRoot=function(t){},t.prototype.getShadowRoot=function(t){},t.prototype.getHost=function(t){},t.prototype.getDistributedNodes=function(t){},t.prototype.clone=function(t){},t.prototype.getElementsByClassName=function(t,e){},t.prototype.getElementsByTagName=function(t,e){},t.prototype.classList=function(t){},t.prototype.addClass=function(t,e){},t.prototype.removeClass=function(t,e){},t.prototype.hasClass=function(t,e){},t.prototype.setStyle=function(t,e,i){},t.prototype.removeStyle=function(t,e){},t.prototype.getStyle=function(t,e){},t.prototype.hasStyle=function(t,e,i){},t.prototype.tagName=function(t){},t.prototype.attributeMap=function(t){},t.prototype.hasAttribute=function(t,e){},t.prototype.hasAttributeNS=function(t,e,i){},t.prototype.getAttribute=function(t,e){},t.prototype.getAttributeNS=function(t,e,i){},t.prototype.setAttribute=function(t,e,i){},t.prototype.setAttributeNS=function(t,e,i,n){},t.prototype.removeAttribute=function(t,e){},t.prototype.removeAttributeNS=function(t,e,i){},t.prototype.templateAwareRoot=function(t){},t.prototype.createHtmlDocument=function(){},t.prototype.getBoundingClientRect=function(t){},t.prototype.getTitle=function(t){},t.prototype.setTitle=function(t,e){},t.prototype.elementMatches=function(t,e){},t.prototype.isTemplateElement=function(t){},t.prototype.isTextNode=function(t){},t.prototype.isCommentNode=function(t){},t.prototype.isElementNode=function(t){},t.prototype.hasShadowRoot=function(t){},t.prototype.isShadowRoot=function(t){},t.prototype.importIntoDoc=function(t){},t.prototype.adoptNode=function(t){},t.prototype.getHref=function(t){},t.prototype.getEventKey=function(t){},t.prototype.resolveAndSetHref=function(t,e,i){},t.prototype.supportsDOMEvents=function(){},t.prototype.supportsNativeShadowDOM=function(){},t.prototype.getGlobalEventTarget=function(t,e){},t.prototype.getHistory=function(){},t.prototype.getLocation=function(){},t.prototype.getBaseHref=function(t){},t.prototype.resetBaseElement=function(){},t.prototype.getUserAgent=function(){},t.prototype.setData=function(t,e,i){},t.prototype.getComputedStyle=function(t){},t.prototype.getData=function(t,e){},t.prototype.supportsWebAnimation=function(){},t.prototype.performanceNow=function(){},t.prototype.getAnimationPrefix=function(){},t.prototype.getTransitionEnd=function(){},t.prototype.supportsAnimation=function(){},t.prototype.supportsCookies=function(){},t.prototype.getCookie=function(t){},t.prototype.setCookie=function(t,e){},t}()),E={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},C={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},P={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};w._18.Node&&(b=w._18.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))});var M,A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x.a(e,t),e.prototype.parse=function(t){throw new Error("parse not implemented")},e.makeCurrent=function(){!function(t){T||(T=t)}(new e)},e.prototype.hasProperty=function(t,e){return e in t},e.prototype.setProperty=function(t,e,i){t[e]=i},e.prototype.getProperty=function(t,e){return t[e]},e.prototype.invoke=function(t,e,i){t[e].apply(t,i)},e.prototype.logError=function(t){window.console&&(console.error?console.error(t):console.log(t))},e.prototype.log=function(t){window.console&&window.console.log&&window.console.log(t)},e.prototype.logGroup=function(t){window.console&&window.console.group&&window.console.group(t)},e.prototype.logGroupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},Object.defineProperty(e.prototype,"attrToPropMap",{get:function(){return E},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return b.call(t,e)},e.prototype.querySelector=function(t,e){return t.querySelector(e)},e.prototype.querySelectorAll=function(t,e){return t.querySelectorAll(e)},e.prototype.on=function(t,e,i){t.addEventListener(e,i,!1)},e.prototype.onAndCancel=function(t,e,i){return t.addEventListener(e,i,!1),function(){t.removeEventListener(e,i,!1)}},e.prototype.dispatchEvent=function(t,e){t.dispatchEvent(e)},e.prototype.createMouseEvent=function(t){var e=document.createEvent("MouseEvent");return e.initEvent(t,!0,!0),e},e.prototype.createEvent=function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!0),e},e.prototype.preventDefault=function(t){t.preventDefault(),t.returnValue=!1},e.prototype.isPrevented=function(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue},e.prototype.getInnerHTML=function(t){return t.innerHTML},e.prototype.getTemplateContent=function(t){return"content"in t&&t instanceof HTMLTemplateElement?t.content:null},e.prototype.getOuterHTML=function(t){return t.outerHTML},e.prototype.nodeName=function(t){return t.nodeName},e.prototype.nodeValue=function(t){return t.nodeValue},e.prototype.type=function(t){return t.type},e.prototype.content=function(t){return this.hasProperty(t,"content")?t.content:t},e.prototype.firstChild=function(t){return t.firstChild},e.prototype.nextSibling=function(t){return t.nextSibling},e.prototype.parentElement=function(t){return t.parentNode},e.prototype.childNodes=function(t){return t.childNodes},e.prototype.childNodesAsList=function(t){for(var e=t.childNodes,i=new Array(e.length),n=0;n<e.length;n++)i[n]=e[n];return i},e.prototype.clearNodes=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},e.prototype.appendChild=function(t,e){t.appendChild(e)},e.prototype.removeChild=function(t,e){t.removeChild(e)},e.prototype.replaceChild=function(t,e,i){t.replaceChild(e,i)},e.prototype.remove=function(t){return t.parentNode&&t.parentNode.removeChild(t),t},e.prototype.insertBefore=function(t,e,i){t.insertBefore(i,e)},e.prototype.insertAllBefore=function(t,e,i){i.forEach(function(i){return t.insertBefore(i,e)})},e.prototype.insertAfter=function(t,e,i){t.insertBefore(i,e.nextSibling)},e.prototype.setInnerHTML=function(t,e){t.innerHTML=e},e.prototype.getText=function(t){return t.textContent},e.prototype.setText=function(t,e){t.textContent=e},e.prototype.getValue=function(t){return t.value},e.prototype.setValue=function(t,e){t.value=e},e.prototype.getChecked=function(t){return t.checked},e.prototype.setChecked=function(t,e){t.checked=e},e.prototype.createComment=function(t){return document.createComment(t)},e.prototype.createTemplate=function(t){var e=document.createElement("template");return e.innerHTML=t,e},e.prototype.createElement=function(t,e){return void 0===e&&(e=document),e.createElement(t)},e.prototype.createElementNS=function(t,e,i){return void 0===i&&(i=document),i.createElementNS(t,e)},e.prototype.createTextNode=function(t,e){return void 0===e&&(e=document),e.createTextNode(t)},e.prototype.createScriptTag=function(t,e,i){void 0===i&&(i=document);var n=i.createElement("SCRIPT");return n.setAttribute(t,e),n},e.prototype.createStyleElement=function(t,e){void 0===e&&(e=document);var i=e.createElement("style");return this.appendChild(i,this.createTextNode(t)),i},e.prototype.createShadowRoot=function(t){return t.createShadowRoot()},e.prototype.getShadowRoot=function(t){return t.shadowRoot},e.prototype.getHost=function(t){return t.host},e.prototype.clone=function(t){return t.cloneNode(!0)},e.prototype.getElementsByClassName=function(t,e){return t.getElementsByClassName(e)},e.prototype.getElementsByTagName=function(t,e){return t.getElementsByTagName(e)},e.prototype.classList=function(t){return Array.prototype.slice.call(t.classList,0)},e.prototype.addClass=function(t,e){t.classList.add(e)},e.prototype.removeClass=function(t,e){t.classList.remove(e)},e.prototype.hasClass=function(t,e){return t.classList.contains(e)},e.prototype.setStyle=function(t,e,i){t.style[e]=i},e.prototype.removeStyle=function(t,e){t.style[e]=""},e.prototype.getStyle=function(t,e){return t.style[e]},e.prototype.hasStyle=function(t,e,i){var n=this.getStyle(t,e)||"";return i?n==i:n.length>0},e.prototype.tagName=function(t){return t.tagName},e.prototype.attributeMap=function(t){for(var e=new Map,i=t.attributes,n=0;n<i.length;n++){var r=i[n];e.set(r.name,r.value)}return e},e.prototype.hasAttribute=function(t,e){return t.hasAttribute(e)},e.prototype.hasAttributeNS=function(t,e,i){return t.hasAttributeNS(e,i)},e.prototype.getAttribute=function(t,e){return t.getAttribute(e)},e.prototype.getAttributeNS=function(t,e,i){return t.getAttributeNS(e,i)},e.prototype.setAttribute=function(t,e,i){t.setAttribute(e,i)},e.prototype.setAttributeNS=function(t,e,i,n){t.setAttributeNS(e,i,n)},e.prototype.removeAttribute=function(t,e){t.removeAttribute(e)},e.prototype.removeAttributeNS=function(t,e,i){t.removeAttributeNS(e,i)},e.prototype.templateAwareRoot=function(t){return this.isTemplateElement(t)?this.content(t):t},e.prototype.createHtmlDocument=function(){return document.implementation.createHTMLDocument("fakeTitle")},e.prototype.getBoundingClientRect=function(t){try{return t.getBoundingClientRect()}catch(t){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}},e.prototype.getTitle=function(t){return document.title},e.prototype.setTitle=function(t,e){document.title=e||""},e.prototype.elementMatches=function(t,e){return t instanceof HTMLElement&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))},e.prototype.isTemplateElement=function(t){return t instanceof HTMLElement&&"TEMPLATE"==t.nodeName},e.prototype.isTextNode=function(t){return t.nodeType===Node.TEXT_NODE},e.prototype.isCommentNode=function(t){return t.nodeType===Node.COMMENT_NODE},e.prototype.isElementNode=function(t){return t.nodeType===Node.ELEMENT_NODE},e.prototype.hasShadowRoot=function(t){return null!=t.shadowRoot&&t instanceof HTMLElement},e.prototype.isShadowRoot=function(t){return t instanceof DocumentFragment},e.prototype.importIntoDoc=function(t){return document.importNode(this.templateAwareRoot(t),!0)},e.prototype.adoptNode=function(t){return document.adoptNode(t)},e.prototype.getHref=function(t){return t.href},e.prototype.getEventKey=function(t){var e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&P.hasOwnProperty(e)&&(e=P[e]))}return C[e]||e},e.prototype.getGlobalEventTarget=function(t,e){return"window"===e?window:"document"===e?document:"body"===e?document.body:null},e.prototype.getHistory=function(){return window.history},e.prototype.getLocation=function(){return window.location},e.prototype.getBaseHref=function(t){var e=R||(R=document.querySelector("base"))?R.getAttribute("href"):null;return null==e?null:function(t){return M||(M=document.createElement("a")),M.setAttribute("href",t),"/"===M.pathname.charAt(0)?M.pathname:"/"+M.pathname}(e)},e.prototype.resetBaseElement=function(){R=null},e.prototype.getUserAgent=function(){return window.navigator.userAgent},e.prototype.setData=function(t,e,i){this.setAttribute(t,"data-"+e,i)},e.prototype.getData=function(t,e){return this.getAttribute(t,"data-"+e)},e.prototype.getComputedStyle=function(t){return getComputedStyle(t)},e.prototype.supportsWebAnimation=function(){return"function"==typeof Element.prototype.animate},e.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},e.prototype.supportsCookies=function(){return!0},e.prototype.getCookie=function(t){return Object(_.r)(document.cookie,t)},e.prototype.setCookie=function(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)},e}(S),R=null,L=_.d,O=function(t){function e(e){var i=t.call(this)||this;return i._doc=e,i._init(),i}return x.a(e,t),e.prototype._init=function(){this._location=n().getLocation(),this._history=n().getHistory()},Object.defineProperty(e.prototype,"location",{get:function(){return this._location},enumerable:!0,configurable:!0}),e.prototype.getBaseHrefFromDOM=function(){return n().getBaseHref(this._doc)},e.prototype.onPopState=function(t){n().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)},e.prototype.onHashChange=function(t){n().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)},Object.defineProperty(e.prototype,"pathname",{get:function(){return this._location.pathname},set:function(t){this._location.pathname=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return this._location.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this._location.hash},enumerable:!0,configurable:!0}),e.prototype.pushState=function(t,e,i){r()?this._history.pushState(t,e,i):this._location.hash=i},e.prototype.replaceState=function(t,e,i){r()?this._history.replaceState(t,e,i):this._location.hash=i},e.prototype.forward=function(){this._history.forward()},e.prototype.back=function(){this._history.back()},e}(_.p);O.decorators=[{type:w.u}],O.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]}]};var I=function(){function t(t){this._doc=t,this._dom=n()}return t.prototype.addTag=function(t,e){return void 0===e&&(e=!1),t?this._getOrCreateElement(t,e):null},t.prototype.addTags=function(t,e){var i=this;return void 0===e&&(e=!1),t?t.reduce(function(t,n){return n&&t.push(i._getOrCreateElement(n,e)),t},[]):[]},t.prototype.getTag=function(t){return t?this._dom.querySelector(this._doc,"meta["+t+"]"):null},t.prototype.getTags=function(t){if(!t)return[];var e=this._dom.querySelectorAll(this._doc,"meta["+t+"]");return e?[].slice.call(e):[]},t.prototype.updateTag=function(t,e){if(!t)return null;e=e||this._parseSelector(t);var i=this.getTag(e);return i?this._setMetaElementAttributes(t,i):this._getOrCreateElement(t,!0)},t.prototype.removeTag=function(t){this.removeTagElement(this.getTag(t))},t.prototype.removeTagElement=function(t){t&&this._dom.remove(t)},t.prototype._getOrCreateElement=function(t,e){if(void 0===e&&(e=!1),!e){var i=this._parseSelector(t),n=this.getTag(i);if(n&&this._containsAttributes(t,n))return n}var r=this._dom.createElement("meta");this._setMetaElementAttributes(t,r);var o=this._dom.getElementsByTagName(this._doc,"head")[0];return this._dom.appendChild(o,r),r},t.prototype._setMetaElementAttributes=function(t,e){var i=this;return Object.keys(t).forEach(function(n){return i._dom.setAttribute(e,n,t[n])}),e},t.prototype._parseSelector=function(t){var e=t.name?"name":"property";return e+'="'+t[e]+'"'},t.prototype._containsAttributes=function(t,e){var i=this;return Object.keys(t).every(function(n){return i._dom.getAttribute(e,n)===t[n]})},t}();I.decorators=[{type:w.u}],I.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]}]};var B=new w.v("TRANSITION_ID"),k=[{provide:w.d,useFactory:function(t,e,i){return function(){i.get(w.e).donePromise.then(function(){var i=n();Array.prototype.slice.apply(i.querySelectorAll(e,"style[ng-transition]")).filter(function(e){return i.getAttribute(e,"ng-transition")===t}).forEach(function(t){return i.remove(t)})})}},deps:[B,L,w.w],multi:!0}],D=function(){function t(){}return t.init=function(){Object(w._7)(new t)},t.prototype.addToWindow=function(t){w._18.getAngularTestability=function(e,i){void 0===i&&(i=!0);var n=t.findTestabilityInTree(e,i);if(null==n)throw new Error("Could not find testability for element.");return n},w._18.getAllAngularTestabilities=function(){return t.getAllTestabilities()},w._18.getAllAngularRootElements=function(){return t.getAllRootElements()};w._18.frameworkStabilizers||(w._18.frameworkStabilizers=[]),w._18.frameworkStabilizers.push(function(t){var e=w._18.getAllAngularTestabilities(),i=e.length,n=!1,r=function(e){n=n||e,0==--i&&t(n)};e.forEach(function(t){t.whenStable(r)})})},t.prototype.findTestabilityInTree=function(t,e,i){if(null==e)return null;var r=t.getTestability(e);return null!=r?r:i?n().isShadowRoot(e)?this.findTestabilityInTree(t,n().getHost(e),!0):this.findTestabilityInTree(t,n().parentElement(e),!0):null},t}(),F=function(){function t(t){this._doc=t}return t.prototype.getTitle=function(){return n().getTitle(this._doc)},t.prototype.setTitle=function(t){n().setTitle(this._doc,t)},t}();F.decorators=[{type:w.u}],F.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]}]};var U,N={ApplicationRef:w.g,NgZone:w.G},G="probe",j="coreTokens",V=function(){return function(t,e){this.name=t,this.token=e}}(),H=[{provide:w.d,useFactory:a,deps:[[V,new w.H],[w.F,new w.H]],multi:!0}],z=new w.v("EventManagerPlugins"),W=function(){function t(t,e){var i=this;this._zone=e,this._eventNameToPlugin=new Map,t.forEach(function(t){return t.manager=i}),this._plugins=t.slice().reverse()}return t.prototype.addEventListener=function(t,e,i){return this._findPluginFor(e).addEventListener(t,e,i)},t.prototype.addGlobalEventListener=function(t,e,i){return this._findPluginFor(e).addGlobalEventListener(t,e,i)},t.prototype.getZone=function(){return this._zone},t.prototype._findPluginFor=function(t){var e=this._eventNameToPlugin.get(t);if(e)return e;for(var i=this._plugins,n=0;n<i.length;n++){var r=i[n];if(r.supports(t))return this._eventNameToPlugin.set(t,r),r}throw new Error("No event manager plugin found for event "+t)},t}();W.decorators=[{type:w.u}],W.ctorParameters=function(){return[{type:Array,decorators:[{type:w.t,args:[z]}]},{type:w.G}]};var X=function(){function t(t){this._doc=t}return t.prototype.supports=function(t){},t.prototype.addEventListener=function(t,e,i){},t.prototype.addGlobalEventListener=function(t,e,i){var r=n().getGlobalEventTarget(this._doc,t);if(!r)throw new Error("Unsupported event target "+r+" for event "+e);return this.addEventListener(r,e,i)},t}(),q=function(){function t(){this._stylesSet=new Set}return t.prototype.addStyles=function(t){var e=this,i=new Set;t.forEach(function(t){e._stylesSet.has(t)||(e._stylesSet.add(t),i.add(t))}),this.onStylesAdded(i)},t.prototype.onStylesAdded=function(t){},t.prototype.getAllStyles=function(){return Array.from(this._stylesSet)},t}();q.decorators=[{type:w.u}],q.ctorParameters=function(){return[]};var Y=function(t){function e(e){var i=t.call(this)||this;return i._doc=e,i._hostNodes=new Set,i._styleNodes=new Set,i._hostNodes.add(e.head),i}return x.a(e,t),e.prototype._addStylesToHost=function(t,e){var i=this;t.forEach(function(t){var n=i._doc.createElement("style");n.textContent=t,i._styleNodes.add(e.appendChild(n))})},e.prototype.addHost=function(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)},e.prototype.removeHost=function(t){this._hostNodes.delete(t)},e.prototype.onStylesAdded=function(t){var e=this;this._hostNodes.forEach(function(i){return e._addStylesToHost(t,i)})},e.prototype.ngOnDestroy=function(){this._styleNodes.forEach(function(t){return n().remove(t)})},e}(q);Y.decorators=[{type:w.u}],Y.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]}]};var K={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Z=/%COMP%/g,Q="_nghost-%COMP%",J="_ngcontent-%COMP%",$=function(){function t(t,e){this.eventManager=t,this.sharedStylesHost=e,this.rendererByCompId=new Map,this.defaultRenderer=new tt(t)}return t.prototype.createRenderer=function(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case w.Z.Emulated:var i=this.rendererByCompId.get(e.id);return i||(i=new it(this.eventManager,this.sharedStylesHost,e),this.rendererByCompId.set(e.id,i)),i.applyToHost(t),i;case w.Z.Native:return new nt(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){var n=h(e.id,e.styles,[]);this.sharedStylesHost.addStyles(n),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}},t.prototype.begin=function(){},t.prototype.end=function(){},t}();$.decorators=[{type:w.u}],$.ctorParameters=function(){return[{type:W},{type:Y}]};var tt=function(){function t(t){this.eventManager=t,this.data=Object.create(null)}return t.prototype.destroy=function(){},t.prototype.createElement=function(t,e){return e?document.createElementNS(K[e],t):document.createElement(t)},t.prototype.createComment=function(t){return document.createComment(t)},t.prototype.createText=function(t){return document.createTextNode(t)},t.prototype.appendChild=function(t,e){t.appendChild(e)},t.prototype.insertBefore=function(t,e,i){t&&t.insertBefore(e,i)},t.prototype.removeChild=function(t,e){t&&t.removeChild(e)},t.prototype.selectRootElement=function(t){var e="string"==typeof t?document.querySelector(t):t;if(!e)throw new Error('The selector "'+t+'" did not match any elements');return e.textContent="",e},t.prototype.parentNode=function(t){return t.parentNode},t.prototype.nextSibling=function(t){return t.nextSibling},t.prototype.setAttribute=function(t,e,i,n){if(n){e=n+":"+e;var r=K[n];r?t.setAttributeNS(r,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)},t.prototype.removeAttribute=function(t,e,i){if(i){var n=K[i];n?t.removeAttributeNS(n,e):t.removeAttribute(i+":"+e)}else t.removeAttribute(e)},t.prototype.addClass=function(t,e){t.classList.add(e)},t.prototype.removeClass=function(t,e){t.classList.remove(e)},t.prototype.setStyle=function(t,e,i,n){n&w.P.DashCase?t.style.setProperty(e,i,n&w.P.Important?"important":""):t.style[e]=i},t.prototype.removeStyle=function(t,e,i){i&w.P.DashCase?t.style.removeProperty(e):t.style[e]=""},t.prototype.setProperty=function(t,e,i){c(e,"property"),t[e]=i},t.prototype.setValue=function(t,e){t.nodeValue=e},t.prototype.listen=function(t,e,i){return c(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,u(i)):this.eventManager.addEventListener(t,e,u(i))},t}(),et="@".charCodeAt(0),it=function(t){function e(e,i,n){var r=t.call(this,e)||this;r.component=n;var o=h(n.id,n.styles,[]);return i.addStyles(o),r.contentAttr=function(t){return J.replace(Z,t)}(n.id),r.hostAttr=function(t){return Q.replace(Z,t)}(n.id),r}return x.a(e,t),e.prototype.applyToHost=function(e){t.prototype.setAttribute.call(this,e,this.hostAttr,"")},e.prototype.createElement=function(e,i){var n=t.prototype.createElement.call(this,e,i);return t.prototype.setAttribute.call(this,n,this.contentAttr,""),n},e}(tt),nt=function(t){function e(e,i,n,r){var o=t.call(this,e)||this;o.sharedStylesHost=i,o.hostEl=n,o.component=r,o.shadowRoot=n.createShadowRoot(),o.sharedStylesHost.addHost(o.shadowRoot);for(var s=h(r.id,r.styles,[]),a=0;a<s.length;a++){var u=document.createElement("style");u.textContent=s[a],o.shadowRoot.appendChild(u)}return o}return x.a(e,t),e.prototype.nodeOrShadowRoot=function(t){return t===this.hostEl?this.shadowRoot:t},e.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},e.prototype.appendChild=function(e,i){return t.prototype.appendChild.call(this,this.nodeOrShadowRoot(e),i)},e.prototype.insertBefore=function(e,i,n){return t.prototype.insertBefore.call(this,this.nodeOrShadowRoot(e),i,n)},e.prototype.removeChild=function(e,i){return t.prototype.removeChild.call(this,this.nodeOrShadowRoot(e),i)},e.prototype.parentNode=function(e){return this.nodeOrShadowRoot(t.prototype.parentNode.call(this,this.nodeOrShadowRoot(e)))},e}(tt),rt=function(t){function e(e){return t.call(this,e)||this}return x.a(e,t),e.prototype.supports=function(t){return!0},e.prototype.addEventListener=function(t,e,i){return t.addEventListener(e,i,!1),function(){return t.removeEventListener(e,i,!1)}},e}(X);rt.decorators=[{type:w.u}],rt.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]}]};var ot={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},st=new w.v("HammerGestureConfig"),at=function(){function t(){this.events=[],this.overrides={}}return t.prototype.buildHammer=function(t){var e=new Hammer(t);e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0});for(var i in this.overrides)e.get(i).set(this.overrides[i]);return e},t}();at.decorators=[{type:w.u}],at.ctorParameters=function(){return[]};var ht=function(t){function e(e,i){var n=t.call(this,e)||this;return n._config=i,n}return x.a(e,t),e.prototype.supports=function(t){if(!ot.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t))return!1;if(!window.Hammer)throw new Error("Hammer.js is not loaded, can not bind "+t+" event");return!0},e.prototype.addEventListener=function(t,e,i){var n=this,r=this.manager.getZone();return e=e.toLowerCase(),r.runOutsideAngular(function(){var o=n._config.buildHammer(t),s=function(t){r.runGuarded(function(){i(t)})};return o.on(e,s),function(){return o.off(e,s)}})},e.prototype.isCustomEvent=function(t){return this._config.events.indexOf(t)>-1},e}(X);ht.decorators=[{type:w.u}],ht.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]},{type:at,decorators:[{type:w.t,args:[st]}]}]};var ut=["alt","control","meta","shift"],ct={alt:function(t){return t.altKey},control:function(t){return t.ctrlKey},meta:function(t){return t.metaKey},shift:function(t){return t.shiftKey}},lt=function(t){function e(e){return t.call(this,e)||this}return x.a(e,t),e.prototype.supports=function(t){return null!=e.parseEventName(t)},e.prototype.addEventListener=function(t,i,r){var o=e.parseEventName(i),s=e.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return n().onAndCancel(t,o.domEventName,s)})},e.parseEventName=function(t){var i=t.toLowerCase().split("."),n=i.shift();if(0===i.length||"keydown"!==n&&"keyup"!==n)return null;var r=e._normalizeKey(i.pop()),o="";if(ut.forEach(function(t){var e=i.indexOf(t);e>-1&&(i.splice(e,1),o+=t+".")}),o+=r,0!=i.length||0===r.length)return null;var s={};return s.domEventName=n,s.fullKey=o,s},e.getEventFullKey=function(t){var e="",i=n().getEventKey(t);return" "===(i=i.toLowerCase())?i="space":"."===i&&(i="dot"),ut.forEach(function(n){if(n!=i){(0,ct[n])(t)&&(e+=n+".")}}),e+=i},e.eventCallback=function(t,i,n){return function(r){e.getEventFullKey(r)===t&&n.runGuarded(function(){return i(r)})}},e._normalizeKey=function(t){switch(t){case"esc":return"escape";default:return t}},e}(X);lt.decorators=[{type:w.u}],lt.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]}]};var dt=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,pt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i,ft=null,mt=null,gt=d("area,br,col,hr,img,wbr"),yt=d("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),vt=d("rp,rt"),bt=p(vt,yt),xt=p(yt,d("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),_t=p(vt,d("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),wt=p(gt,xt,_t,bt),Tt=d("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),St=d("srcset"),Et=d("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Ct=p(Tt,St,Et),Pt=function(){function t(){this.sanitizedSomething=!1,this.buf=[]}return t.prototype.sanitizeChildren=function(t){for(var e=t.firstChild;e;)if(mt.isElementNode(e)?this.startElement(e):mt.isTextNode(e)?this.chars(mt.nodeValue(e)):this.sanitizedSomething=!0,mt.firstChild(e))e=mt.firstChild(e);else for(;e;){mt.isElementNode(e)&&this.endElement(e);var i=f(e,mt.nextSibling(e));if(i){e=i;break}e=f(e,mt.parentElement(e))}return this.buf.join("")},t.prototype.startElement=function(t){var e=this,i=mt.nodeName(t).toLowerCase();wt.hasOwnProperty(i)?(this.buf.push("<"),this.buf.push(i),mt.attributeMap(t).forEach(function(t,i){var n=i.toLowerCase();Ct.hasOwnProperty(n)?(Tt[n]&&(t=l(t)),St[n]&&(t=function(t){return(t=String(t)).split(",").map(function(t){return l(t.trim())}).join(", ")}(t)),e.buf.push(" "),e.buf.push(i),e.buf.push('="'),e.buf.push(m(t)),e.buf.push('"')):e.sanitizedSomething=!0}),this.buf.push(">")):this.sanitizedSomething=!0},t.prototype.endElement=function(t){var e=mt.nodeName(t).toLowerCase();wt.hasOwnProperty(e)&&!gt.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))},t.prototype.chars=function(t){this.buf.push(m(t))},t}(),Mt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,At=/([^\#-~ |!])/g,Rt=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Lt=/^url\(([^)]+)\)$/,Ot=function(){function t(){}return t.prototype.sanitize=function(t,e){},t.prototype.bypassSecurityTrustHtml=function(t){},t.prototype.bypassSecurityTrustStyle=function(t){},t.prototype.bypassSecurityTrustScript=function(t){},t.prototype.bypassSecurityTrustUrl=function(t){},t.prototype.bypassSecurityTrustResourceUrl=function(t){},t}(),It=function(t){function e(e){var i=t.call(this)||this;return i._doc=e,i}return x.a(e,t),e.prototype.sanitize=function(t,e){if(null==e)return null;switch(t){case w.R.NONE:return e;case w.R.HTML:return e instanceof kt?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),y(this._doc,String(e)));case w.R.STYLE:return e instanceof Dt?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";var e=t.match(Lt);return e&&l(e[1])===e[1]||t.match(Rt)&&function(t){for(var e=!0,i=!0,n=0;n<t.length;n++){var r=t.charAt(n);"'"===r&&i?e=!e:'"'===r&&e&&(i=!i)}return e&&i}(t)?t:(Object(w._5)()&&n().log("WARNING: sanitizing unsafe style value "+t+" (see http://g.co/ng/security#xss)."),"unsafe")}(e));case w.R.SCRIPT:if(e instanceof Ft)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case w.R.URL:return e instanceof Nt||e instanceof Ut?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),l(String(e)));case w.R.RESOURCE_URL:if(e instanceof Nt)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext "+t+" (see http://g.co/ng/security#xss)")}},e.prototype.checkNotSafeValue=function(t,e){if(t instanceof Bt)throw new Error("Required a safe "+e+", got a "+t.getTypeName()+" (see http://g.co/ng/security#xss)")},e.prototype.bypassSecurityTrustHtml=function(t){return new kt(t)},e.prototype.bypassSecurityTrustStyle=function(t){return new Dt(t)},e.prototype.bypassSecurityTrustScript=function(t){return new Ft(t)},e.prototype.bypassSecurityTrustUrl=function(t){return new Ut(t)},e.prototype.bypassSecurityTrustResourceUrl=function(t){return new Nt(t)},e}(Ot);It.decorators=[{type:w.u}],It.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[L]}]}]};var Bt=function(){function t(t){this.changingThisBreaksApplicationSecurity=t}return t.prototype.getTypeName=function(){},t.prototype.toString=function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"},t}(),kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x.a(e,t),e.prototype.getTypeName=function(){return"HTML"},e}(Bt),Dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x.a(e,t),e.prototype.getTypeName=function(){return"Style"},e}(Bt),Ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x.a(e,t),e.prototype.getTypeName=function(){return"Script"},e}(Bt),Ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x.a(e,t),e.prototype.getTypeName=function(){return"URL"},e}(Bt),Nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x.a(e,t),e.prototype.getTypeName=function(){return"ResourceURL"},e}(Bt),Gt=[{provide:w.J,useValue:_.q},{provide:w.K,useValue:function(){A.makeCurrent(),D.init()},multi:!0},{provide:_.p,useClass:O},{provide:L,useFactory:function(){return document},deps:[]}],jt=[{provide:w.Q,useExisting:Ot},{provide:Ot,useClass:It}],Vt=Object(w._1)(w._6,"browser",Gt),Ht=function(){function t(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return t.withServerTransition=function(e){return{ngModule:t,providers:[{provide:w.c,useValue:e.appId},{provide:B,useExisting:w.c},k]}},t}();Ht.decorators=[{type:w.B,args:[{providers:[jt,{provide:w.o,useFactory:v,deps:[]},{provide:z,useClass:rt,multi:!0},{provide:z,useClass:lt,multi:!0},{provide:z,useClass:ht,multi:!0},{provide:st,useClass:at},$,{provide:w.O,useExisting:$},{provide:q,useExisting:Y},Y,w.W,W,H,I,F],exports:[_.c,w.f]}]}],Ht.ctorParameters=function(){return[{type:Ht,decorators:[{type:w.H},{type:w.S}]}]};var zt="undefined"!=typeof window&&window||{},Wt=function(){return function(t,e){this.msPerTick=t,this.numTicks=e}}();(function(){function t(t){this.appRef=t.injector.get(w.g)}t.prototype.timeChangeDetection=function(t){var e=t&&t.record,i=null!=zt.console.profile;e&&i&&zt.console.profile("Change Detection");for(var r=n().performanceNow(),o=0;o<5||n().performanceNow()-r<500;)this.appRef.tick(),o++;var s=n().performanceNow();e&&i&&zt.console.profileEnd("Change Detection");var a=(s-r)/o;return zt.console.log("ran "+o+" change detection cycles"),zt.console.log(a.toFixed(2)+" ms per check"),new Wt(a,o)}})(),function(){function t(){}t.all=function(){return function(t){return!0}},t.css=function(t){return function(e){return null!=e.nativeElement&&n().elementMatches(e.nativeElement,t)}},t.directive=function(t){return function(e){return-1!==e.providerTokens.indexOf(t)}}}(),new w.X("4.4.6")},grVA:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n={closed:!0,next:function(t){},error:function(t){throw t},complete:function(){}}},ibk9:function(t,e,i){var n,r,o;!function(s,a){r=[i("UcT7"),i("kUnS")],void 0===(o="function"==typeof(n=a)?n.apply(e,r):n)||(t.exports=o)}(window,function(t,e){"use strict";function i(t,e){t&&(this.element=t,this.layout=e,this.position={x:0,y:0},this._create())}var n=document.documentElement.style,r="string"==typeof n.transition?"transition":"WebkitTransition",o="string"==typeof n.transform?"transform":"WebkitTransform",s={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[r],a={transform:o,transition:r,transitionDuration:r+"Duration",transitionProperty:r+"Property",transitionDelay:r+"Delay"},h=i.prototype=Object.create(t.prototype);h.constructor=i,h._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},h.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},h.getSize=function(){this.size=e(this.element)},h.css=function(t){var e=this.element.style;for(var i in t){e[a[i]||i]=t[i]}},h.getPosition=function(){var t=getComputedStyle(this.element),e=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),n=t[e?"left":"right"],r=t[i?"top":"bottom"],o=parseFloat(n),s=parseFloat(r),a=this.layout.size;-1!=n.indexOf("%")&&(o=o/100*a.width),-1!=r.indexOf("%")&&(s=s/100*a.height),o=isNaN(o)?0:o,s=isNaN(s)?0:s,o-=e?a.paddingLeft:a.paddingRight,s-=i?a.paddingTop:a.paddingBottom,this.position.x=o,this.position.y=s},h.layoutPosition=function(){var t=this.layout.size,e={},i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop"),r=i?"paddingLeft":"paddingRight",o=i?"left":"right",s=i?"right":"left",a=this.position.x+t[r];e[o]=this.getXValue(a),e[s]="";var h=n?"paddingTop":"paddingBottom",u=n?"top":"bottom",c=n?"bottom":"top",l=this.position.y+t[h];e[u]=this.getYValue(l),e[c]="",this.css(e),this.emitEvent("layout",[this])},h.getXValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!e?t/this.layout.size.width*100+"%":t+"px"},h.getYValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&e?t/this.layout.size.height*100+"%":t+"px"},h._transitionTo=function(t,e){this.getPosition();var i=this.position.x,n=this.position.y,r=t==this.position.x&&e==this.position.y;if(this.setPosition(t,e),!r||this.isTransitioning){var o=t-i,s=e-n,a={};a.transform=this.getTranslate(o,s),this.transition({to:a,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})}else this.layoutPosition()},h.getTranslate=function(t,e){var i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop");return t=i?t:-t,e=n?e:-e,"translate3d("+t+"px, "+e+"px, 0)"},h.goTo=function(t,e){this.setPosition(t,e),this.layoutPosition()},h.moveTo=h._transitionTo,h.setPosition=function(t,e){this.position.x=parseFloat(t),this.position.y=parseFloat(e)},h._nonTransition=function(t){this.css(t.to),t.isCleaning&&this._removeStyles(t.to);for(var e in t.onTransitionEnd)t.onTransitionEnd[e].call(this)},h.transition=function(t){if(parseFloat(this.layout.options.transitionDuration)){var e=this._transn;for(var i in t.onTransitionEnd)e.onEnd[i]=t.onTransitionEnd[i];for(i in t.to)e.ingProperties[i]=!0,t.isCleaning&&(e.clean[i]=!0);if(t.from){this.css(t.from);this.element.offsetHeight;null}this.enableTransition(t.to),this.css(t.to),this.isTransitioning=!0}else this._nonTransition(t)};var u="opacity,"+function(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}(o);h.enableTransition=function(){if(!this.isTransitioning){var t=this.layout.options.transitionDuration;t="number"==typeof t?t+"ms":t,this.css({transitionProperty:u,transitionDuration:t,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(s,this,!1)}},h.onwebkitTransitionEnd=function(t){this.ontransitionend(t)},h.onotransitionend=function(t){this.ontransitionend(t)};var c={"-webkit-transform":"transform"};h.ontransitionend=function(t){if(t.target===this.element){var e=this._transn,i=c[t.propertyName]||t.propertyName;if(delete e.ingProperties[i],function(t){for(var e in t)return!1;return!0}(e.ingProperties)&&this.disableTransition(),i in e.clean&&(this.element.style[t.propertyName]="",delete e.clean[i]),i in e.onEnd){e.onEnd[i].call(this),delete e.onEnd[i]}this.emitEvent("transitionEnd",[this])}},h.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(s,this,!1),this.isTransitioning=!1},h._removeStyles=function(t){var e={};for(var i in t)e[i]="";this.css(e)};var l={transitionProperty:"",transitionDuration:"",transitionDelay:""};return h.removeTransitionStyles=function(){this.css(l)},h.stagger=function(t){t=isNaN(t)?0:t,this.staggerDelay=t+"ms"},h.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},h.remove=function(){r&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),this.hide()):this.removeElem()},h.reveal=function(){delete this.isHidden,this.css({display:""});var t=this.layout.options,e={};e[this.getHideRevealTransitionEndProperty("visibleStyle")]=this.onRevealTransitionEnd,this.transition({from:t.hiddenStyle,to:t.visibleStyle,isCleaning:!0,onTransitionEnd:e})},h.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},h.getHideRevealTransitionEndProperty=function(t){var e=this.layout.options[t];if(e.opacity)return"opacity";for(var i in e)return i},h.hide=function(){this.isHidden=!0,this.css({display:""});var t=this.layout.options,e={};e[this.getHideRevealTransitionEndProperty("hiddenStyle")]=this.onHideTransitionEnd,this.transition({from:t.visibleStyle,to:t.hiddenStyle,isCleaning:!0,onTransitionEnd:e})},h.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},h.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},i})},iej6:function(t,e,i){"use strict";var n=i("AP4T"),r=i("TO51"),o=i("LHF8");n.a.prototype.publish=function(t){return function(t){return t?Object(o.a)(function(){return new r.a},t):Object(o.a)(new r.a)}(t)(this)}},ivSB:function(t,e,i){"use strict";function n(t,e,i){return function(t,e,i){return function(n){return n.lift(new a(t,e,i))}}(t,e,i)(this)}var r=i("AP4T"),o=i("E9/g"),s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=function(){function t(t,e,i){this.nextOrObserver=t,this.error=e,this.complete=i}return t.prototype.call=function(t,e){return e.subscribe(new h(t,this.nextOrObserver,this.error,this.complete))},t}(),h=function(t){function e(e,i,n,r){t.call(this,e);var s=new o.a(i,n,r);s.syncErrorThrowable=!0,this.add(s),this.safeSubscriber=s}return s(e,t),e.prototype._next=function(t){var e=this.safeSubscriber;e.next(t),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.next(t)},e.prototype._error=function(t){var e=this.safeSubscriber;e.error(t),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.error(t)},e.prototype._complete=function(){var t=this.safeSubscriber;t.complete(),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.complete()},e}(o.a);r.a.prototype.do=n,r.a.prototype._do=n},jaVc:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("qLnt"),r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(t){function e(e,i){t.call(this),this.subject=e,this.subscriber=i,this.closed=!1}return r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var i=e.indexOf(this.subscriber);-1!==i&&e.splice(i,1)}}},e}(n.a)},kJHF:function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e,i,n,r){var o=t.call(this,e,i,n)||this;return o.buoyancyManager=r,o.inWater=!1,o.game.physics.p2.enable(o),o.body.angularVelocity=8*Math.random()-4,o}return n(e,t),e.prototype.updatePhysics=function(t,e){t&&this.buoyancyManager.applyAABBBuoyancyForces(this.body,t);var i=this.game.height-e.Height;this.y>i&&!this.inWater&&e.splash(this.x,this.body.velocity.y/10),this.y<i&&this.inWater&&e.splash(this.x,this.body.velocity.y/10),this.inWater=this.y>i},e}(i("6nA8").Sprite);e.SkillPill=r},kQVV:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=function(t){return t&&"number"==typeof t.length}},kUnS:function(t,e,i){var n;!function(r,o){"use strict";void 0===(n=(function(){return o()}).call(e,i,e,t))||(t.exports=n)}(window,function(){"use strict";function t(t){var e=parseFloat(t);return-1==t.indexOf("%")&&!isNaN(e)&&e}function e(t){var e=getComputedStyle(t);return e||r("Style returned "+e+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),e}function i(r){if(function(){if(!a){a=!0;var r=document.createElement("div");r.style.width="200px",r.style.padding="1px 2px 3px 4px",r.style.borderStyle="solid",r.style.borderWidth="1px 2px 3px 4px",r.style.boxSizing="border-box";var o=document.body||document.documentElement;o.appendChild(r);var s=e(r);i.isBoxSizeOuter=n=200==t(s.width),o.removeChild(r)}}(),"string"==typeof r&&(r=document.querySelector(r)),r&&"object"==typeof r&&r.nodeType){var h=e(r);if("none"==h.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;e<s;e++)t[o[e]]=0;return t}();var u={};u.width=r.offsetWidth,u.height=r.offsetHeight;for(var c=u.isBorderBox="border-box"==h.boxSizing,l=0;l<s;l++){var d=o[l],p=h[d],f=parseFloat(p);u[d]=isNaN(f)?0:f}var m=u.paddingLeft+u.paddingRight,g=u.paddingTop+u.paddingBottom,y=u.marginLeft+u.marginRight,v=u.marginTop+u.marginBottom,b=u.borderLeftWidth+u.borderRightWidth,x=u.borderTopWidth+u.borderBottomWidth,_=c&&n,w=t(h.width);!1!==w&&(u.width=w+(_?0:m+b));var T=t(h.height);return!1!==T&&(u.height=T+(_?0:g+x)),u.innerWidth=u.width-(m+b),u.innerHeight=u.height-(g+x),u.outerWidth=u.width+y,u.outerHeight=u.height+v,u}}var n,r="undefined"==typeof console?function(){}:function(t){console.error(t)},o=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],s=o.length,a=!1;return i})},lCxr:function(t,e,i){"use strict";var n=i("qbdv"),r=i("/oeL"),o=i("BkNc"),s=i("LaOa"),a=i("TO51"),h=i("xIGM"),u=i("qLnt"),c=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},l=function(t){function e(e,i){t.call(this)}return c(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(u.a),d=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},p=function(t){function e(e,i){t.call(this,e,i),this.scheduler=e,this.work=i,this.pending=!1}return d(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t,this.pending=!0;var i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,e)),this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),h.a.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),null!==i&&this.delay===i&&!1===this.pending)return e;h.a.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var i=!1,n=void 0;try{this.work(t)}catch(t){i=!0,n=!!t&&t||new Error(t)}if(i)return this.unsubscribe(),n},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,i=e.actions,n=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&i.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(l),f=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},m=function(t){function e(e,i){t.call(this,e,i),this.scheduler=e,this.work=i}return f(e,t),e.prototype.schedule=function(e,i){return void 0===i&&(i=0),i>0?t.prototype.schedule.call(this,e,i):(this.delay=i,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,i){return i>0||this.closed?t.prototype.execute.call(this,e,i):this._execute(e,i)},e.prototype.requestAsyncId=function(e,i,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?t.prototype.requestAsyncId.call(this,e,i,n):e.flush(this)},e}(p),g=function(){function t(e,i){void 0===i&&(i=t.now),this.SchedulerAction=e,this.now=i}return t.prototype.schedule=function(t,e,i){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(i,e)},t.now=Date.now?Date.now:function(){return+new Date},t}(),y=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},v=function(t){function e(){t.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return y(e,t),e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}},e}(g),b=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},x=new(function(t){function e(){t.apply(this,arguments)}return b(e,t),e}(v))(m),_=i("YRqN"),w=i("Upor"),T=i("jaVc"),S=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},E=function(t){function e(e,i,n){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===i&&(i=Number.POSITIVE_INFINITY),t.call(this),this.scheduler=n,this._events=[],this._bufferSize=e<1?1:e,this._windowTime=i<1?1:i}return S(e,t),e.prototype.next=function(e){var i=this._getNow();this._events.push(new C(i,e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,i=this._trimBufferThenGetEvents(),n=this.scheduler;if(this.closed)throw new w.a;this.hasError?e=u.a.EMPTY:this.isStopped?e=u.a.EMPTY:(this.observers.push(t),e=new T.a(this,t)),n&&t.add(t=new _.a(t,n));for(var r=i.length,o=0;o<r&&!t.closed;o++)t.next(i[o].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||x).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,i=this._windowTime,n=this._events,r=n.length,o=0;o<r&&!(t-n[o].time<i);)o++;return r>e&&(o=Math.max(o,r-e)),o>0&&n.splice(0,o),n},e}(a.a),C=function(){return function(t,e){this.time=t,this.value=e}}(),P=function(){return function(){this.pageTracking={autoTrackVirtualPages:!0,basePath:"",excludedRoutes:[],clearIds:!1},this.developerMode=!1,this.ga={},this.appInsights={},this.gtm={}}}(),M=new r.v("ANGULARTICS2"),A=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},R=function(){function t(t,e,i){this.pageTrack=new E(10),this.eventTrack=new E(10),this.exceptionTrack=new E(10),this.setAlias=new E(10),this.setUsername=new E(10),this.setUserProperties=new E(10),this.setUserPropertiesOnce=new E(10),this.setSuperProperties=new E(10),this.setSuperPropertiesOnce=new E(10),this.userTimings=new E(10);var n=new P;this.settings=A({},n,i.settings),this.settings.pageTracking=A({},n.pageTracking,i.settings.pageTracking),this.trackLocation(t,e)}return t.prototype.trackLocation=function(t,e){var i=this;e.events.pipe(Object(s.a)(function(t){return t instanceof o.e}),Object(s.a)(function(){return!i.settings.developerMode})).subscribe(function(e){return i.trackUrlChange(e.urlAfterRedirects,t)})},t.prototype.virtualPageviews=function(t){this.settings.pageTracking.autoTrackVirtualPages=t},t.prototype.excludeRoutes=function(t){this.settings.pageTracking.excludedRoutes=t},t.prototype.withBase=function(t){this.settings.pageTracking.basePath=t},t.prototype.clearIds=function(t){this.settings.pageTracking.clearIds=t},t.prototype.developerMode=function(t){this.settings.developerMode=t},t.prototype.trackUrlChange=function(t,e){if(this.settings.pageTracking.autoTrackVirtualPages&&!this.matchesExcludedRoute(t)){var i=this.clearUrl(t);this.pageTrack.next({path:this.settings.pageTracking.basePath.length?this.settings.pageTracking.basePath+i:e.prepareExternalUrl(i),location:e})}},t.prototype.matchesExcludedRoute=function(t){for(var e=0,i=this.settings.pageTracking.excludedRoutes;e<i.length;e++){var n=i[e];if(n instanceof RegExp&&n.test(t)||-1!==t.indexOf(n))return!0}return!1},t.prototype.clearUrl=function(t){return this.settings.pageTracking.clearIds?t.split("/").filter(function(t){return!t.match(/\d+/)}).join("/"):t},t.decorators=[{type:r.u}],t.ctorParameters=function(){return[{type:n.h},{type:o.n},{type:void 0,decorators:[{type:r.t,args:[M]}]}]},t}(),L=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},O=function(){function t(t,e,i){this.elRef=t,this.angulartics2=e,this.renderer=i,this.angularticsProperties={}}return t.prototype.ngAfterContentInit=function(){var t=this;this.renderer.listen(this.elRef.nativeElement,this.angulartics2On||"click",function(e){return t.eventTrack(e)})},t.prototype.eventTrack=function(t){var e=this.angularticsAction,i=L({},this.angularticsProperties,{eventType:t.type});this.angularticsCategory&&(i.category=this.angularticsCategory),this.angularticsLabel&&(i.label=this.angularticsLabel),this.angularticsValue&&(i.value=this.angularticsValue),this.angulartics2.eventTrack.next({action:e,properties:i})},t.decorators=[{type:r.u},{type:r.m,args:[{selector:"[angulartics2On]"}]}],t.ctorParameters=function(){return[{type:r.n},{type:R},{type:r.N}]},t.propDecorators={angulartics2On:[{type:r.x,args:["angulartics2On"]}],angularticsAction:[{type:r.x}],angularticsCategory:[{type:r.x}],angularticsLabel:[{type:r.x}],angularticsValue:[{type:r.x}],angularticsProperties:[{type:r.x}]},t}(),I=function(){function t(){}return t.forRoot=function(e,i){return void 0===i&&(i={}),{ngModule:t,providers:[{provide:M,useValue:{providers:e,settings:i}},R].concat(e)}},t.decorators=[{type:r.B,args:[{declarations:[O],exports:[O]}]}],t.ctorParameters=function(){return[]},t}();i.d(e,"b",function(){return R}),i.d(e,"c",function(){return I}),i.d(e,"a",function(){return M}),i.d(e,!1,function(){return O}),i.d(e,!1,function(){return P})},lI6h:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("E9/g"),r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.notifyNext=function(t,e,i,n,r){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(n.a)},mHG6:function(t,e,i){"use strict";e.a=function(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},mz3w:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=function(t){var e,i=t.Symbol;return"function"==typeof i?i.observable?e=i.observable:(e=i("observable"),i.observable=e):e="@@observable",e}(i("xIGM").a)},qLnt:function(t,e,i){"use strict";function n(){try{return s.apply(this,arguments)}catch(t){return c.e=t,c}}function r(t){return s=t,n}function o(t){return t.reduce(function(t,e){return t.concat(e instanceof d?e.errors:e)},[])}var s,a=i("1j/l"),h=i("NGRF"),u=i("B1iP"),c={e:{}},l=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},d=function(t){function e(e){t.call(this),this.errors=e;var i=Error.call(this,e?e.length+" errors occurred during unsubscription:\n  "+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"");this.name=i.name="UnsubscriptionError",this.stack=i.stack,this.message=i.message}return l(e,t),e}(Error);i.d(e,"a",function(){return p});var p=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var i=this._parent,n=this._parents,s=this._unsubscribe,l=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var p=-1,f=n?n.length:0;i;)i.remove(this),i=++p<f&&n[p]||null;if(Object(u.a)(s)){r(s).call(this)===c&&(e=!0,t=t||(c.e instanceof d?o(c.e.errors):[c.e]))}if(Object(a.a)(l))for(p=-1,f=l.length;++p<f;){var m=l[p];if(Object(h.a)(m)){if(r(m.unsubscribe).call(m)===c){e=!0,t=t||[];var g=c.e;g instanceof d?t=t.concat(o(g.errors)):t.push(g)}}}if(e)throw new d(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var i=e;switch(typeof e){case"function":i=new t(e);case"object":if(i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if("function"!=typeof i._addParent){var n=i;(i=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(i),i._addParent(this),i},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}},t.prototype._addParent=function(t){var e=this._parent,i=this._parents;e&&e!==t?i?-1===i.indexOf(t)&&i.push(t):this._parents=[t]:this._parent=t},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}()},qbdv:function(t,e,i){"use strict";function n(t){return t.replace(/\/index.html$/,"")}function r(t,e,i){var n="="+t;if(e.indexOf(n)>-1)return n;if(n=i.getPluralCategory(t),e.indexOf(n)>-1)return n;if(e.indexOf("other")>-1)return"other";throw new Error('No plural message found for value "'+t+'"')}function o(t,e){e=encodeURIComponent(e);for(var i=0,n=t.split(";");i<n.length;i++){var r=n[i],o=r.indexOf("="),s=-1==o?[r,""]:[r.slice(0,o),r.slice(o+1)],a=s[1];if(s[0].trim()===e)return decodeURIComponent(a)}return null}function s(t,e){return Error("InvalidPipeArgument: '"+e+"' for pipe '"+Object(w._34)(t)+"'")}function a(t){return function(e,i){var n=t(e,i);return 1==n.length?"0"+n:n}}function h(t){return function(e,i){return t(e,i).split(" ")[0]}}function u(t,e,i){return new Intl.DateTimeFormat(e,i).format(t).replace(/[\u200e\u200f]/g,"")}function c(t){var e={hour:"2-digit",hour12:!1,timeZoneName:t};return function(t,i){var n=u(t,i,e);return n?n.substring(3):""}}function l(t,e){return t.hour12=e,t}function d(t,e){var i={};return i[t]=2===e?"2-digit":"numeric",i}function p(t,e){var i={};return i[t]=e<4?e>1?"short":"narrow":"long",i}function f(t){return t.reduce(function(t,e){return Object.assign({},t,e)},{})}function m(t){return function(e,i){return u(e,i,t)}}function g(t,e,i,n,r,o,a){if(void 0===o&&(o=null),void 0===a&&(a=!1),null==i)return null;if("number"!=typeof(i="string"==typeof i&&v(i)?+i:i))throw s(t,i);var h=void 0,u=void 0,c=void 0;if(n!==it.Currency&&(h=1,u=0,c=3),r){var l=r.match(ut);if(null===l)throw new Error(r+" is not a valid digit info for number pipes");null!=l[1]&&(h=y(l[1])),null!=l[3]&&(u=y(l[3])),null!=l[5]&&(c=y(l[5]))}return nt.format(i,e,n,{minimumIntegerDigits:h,minimumFractionDigits:u,maximumFractionDigits:c,currency:o,currencyAsSymbol:a})}function y(t){var e=parseInt(t);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+t);return e}function v(t){return!isNaN(t-parseFloat(t))}function b(t){return t instanceof Date&&!isNaN(t.valueOf())}function x(t){return parseInt(t,10)}i.d(e,"m",function(){return L}),i.d(e,"n",function(){return R}),i.d(e,"r",function(){return o}),i.d(e,"c",function(){return _t}),i.d(e,"j",function(){return I}),i.d(e,"k",function(){return D}),i.d(e,"l",function(){return U}),i.d(e,"d",function(){return Tt}),i.d(e,"b",function(){return J}),i.d(e,"e",function(){return ft}),i.d(e,"q",function(){return St}),i.d(e,"p",function(){return T}),i.d(e,"g",function(){return S}),i.d(e,"i",function(){return E}),i.d(e,"a",function(){return C}),i.d(e,"f",function(){return M}),i.d(e,"o",function(){return A}),i.d(e,"h",function(){return P});var _=i("6Xbx"),w=i("/oeL"),T=function(){function t(){}return t.prototype.getBaseHrefFromDOM=function(){},t.prototype.onPopState=function(t){},t.prototype.onHashChange=function(t){},t.prototype.pathname=function(){},t.prototype.search=function(){},t.prototype.hash=function(){},t.prototype.replaceState=function(t,e,i){},t.prototype.pushState=function(t,e,i){},t.prototype.forward=function(){},t.prototype.back=function(){},t}(),S=new w.v("Location Initialized"),E=function(){function t(){}return t.prototype.path=function(t){},t.prototype.prepareExternalUrl=function(t){},t.prototype.pushState=function(t,e,i,n){},t.prototype.replaceState=function(t,e,i,n){},t.prototype.forward=function(){},t.prototype.back=function(){},t.prototype.onPopState=function(t){},t.prototype.getBaseHref=function(){},t}(),C=new w.v("appBaseHref"),P=function(){function t(e){var i=this;this._subject=new w.p,this._platformStrategy=e;var r=this._platformStrategy.getBaseHref();this._baseHref=t.stripTrailingSlash(n(r)),this._platformStrategy.onPopState(function(t){i._subject.emit({url:i.path(!0),pop:!0,type:t.type})})}return t.prototype.path=function(t){return void 0===t&&(t=!1),this.normalize(this._platformStrategy.path(t))},t.prototype.isCurrentPathEqualTo=function(e,i){return void 0===i&&(i=""),this.path()==this.normalize(e+t.normalizeQueryParams(i))},t.prototype.normalize=function(e){return t.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,n(e)))},t.prototype.prepareExternalUrl=function(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)},t.prototype.go=function(t,e){void 0===e&&(e=""),this._platformStrategy.pushState(null,"",t,e)},t.prototype.replaceState=function(t,e){void 0===e&&(e=""),this._platformStrategy.replaceState(null,"",t,e)},t.prototype.forward=function(){this._platformStrategy.forward()},t.prototype.back=function(){this._platformStrategy.back()},t.prototype.subscribe=function(t,e,i){return this._subject.subscribe({next:t,error:e,complete:i})},t.normalizeQueryParams=function(t){return t&&"?"!==t[0]?"?"+t:t},t.joinWithSlash=function(t,e){if(0==t.length)return e;if(0==e.length)return t;var i=0;return t.endsWith("/")&&i++,e.startsWith("/")&&i++,2==i?t+e.substring(1):1==i?t+e:t+"/"+e},t.stripTrailingSlash=function(t){var e=t.match(/#|\?|$/),i=e&&e.index||t.length,n=i-("/"===t[i-1]?1:0);return t.slice(0,n)+t.slice(i)},t}();P.decorators=[{type:w.u}],P.ctorParameters=function(){return[{type:E}]};var M=function(t){function e(e,i){var n=t.call(this)||this;return n._platformLocation=e,n._baseHref="",null!=i&&(n._baseHref=i),n}return _.a(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e},e.prototype.prepareExternalUrl=function(t){var e=P.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e},e.prototype.pushState=function(t,e,i,n){var r=this.prepareExternalUrl(i+P.normalizeQueryParams(n));0==r.length&&(r=this._platformLocation.pathname),this._platformLocation.pushState(t,e,r)},e.prototype.replaceState=function(t,e,i,n){var r=this.prepareExternalUrl(i+P.normalizeQueryParams(n));0==r.length&&(r=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,r)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(E);M.decorators=[{type:w.u}],M.ctorParameters=function(){return[{type:T},{type:void 0,decorators:[{type:w.H},{type:w.t,args:[C]}]}]};var A=function(t){function e(e,i){var n=t.call(this)||this;if(n._platformLocation=e,null==i&&(i=n._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return n._baseHref=i,n}return _.a(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.prepareExternalUrl=function(t){return P.joinWithSlash(this._baseHref,t)},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.pathname+P.normalizeQueryParams(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?""+e+i:e},e.prototype.pushState=function(t,e,i,n){var r=this.prepareExternalUrl(i+P.normalizeQueryParams(n));this._platformLocation.pushState(t,e,r)},e.prototype.replaceState=function(t,e,i,n){var r=this.prepareExternalUrl(i+P.normalizeQueryParams(n));this._platformLocation.replaceState(t,e,r)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(E);A.decorators=[{type:w.u}],A.ctorParameters=function(){return[{type:T},{type:void 0,decorators:[{type:w.H},{type:w.t,args:[C]}]}]};var R=function(){function t(){}return t.prototype.getPluralCategory=function(t){},t}(),L=function(t){function e(e){var i=t.call(this)||this;return i.locale=e,i}return _.a(e,t),e.prototype.getPluralCategory=function(t){switch(function(t,e){"string"==typeof e&&(e=parseInt(e,10));var i=e,n=i.toString().replace(/^[^.]*\.?/,""),r=Math.floor(Math.abs(i)),o=n.length,s=parseInt(n,10),a=parseInt(i.toString().replace(/^[^.]*\.?|0+$/g,""),10)||0;switch(t.split("-")[0].toLowerCase()){case"af":case"asa":case"az":case"bem":case"bez":case"bg":case"brx":case"ce":case"cgg":case"chr":case"ckb":case"ee":case"el":case"eo":case"es":case"eu":case"fo":case"fur":case"gsw":case"ha":case"haw":case"hu":case"jgo":case"jmc":case"ka":case"kk":case"kkj":case"kl":case"ks":case"ksb":case"ky":case"lb":case"lg":case"mas":case"mgo":case"ml":case"mn":case"nb":case"nd":case"ne":case"nn":case"nnh":case"nyn":case"om":case"or":case"os":case"ps":case"rm":case"rof":case"rwk":case"saq":case"seh":case"sn":case"so":case"sq":case"ta":case"te":case"teo":case"tk":case"tr":case"ug":case"uz":case"vo":case"vun":case"wae":case"xog":return 1===i?O.One:O.Other;case"ak":case"ln":case"mg":case"pa":case"ti":return i===Math.floor(i)&&i>=0&&i<=1?O.One:O.Other;case"am":case"as":case"bn":case"fa":case"gu":case"hi":case"kn":case"mr":case"zu":return 0===r||1===i?O.One:O.Other;case"ar":return 0===i?O.Zero:1===i?O.One:2===i?O.Two:i%100===Math.floor(i%100)&&i%100>=3&&i%100<=10?O.Few:i%100===Math.floor(i%100)&&i%100>=11&&i%100<=99?O.Many:O.Other;case"ast":case"ca":case"de":case"en":case"et":case"fi":case"fy":case"gl":case"it":case"nl":case"sv":case"sw":case"ur":case"yi":return 1===r&&0===o?O.One:O.Other;case"be":return i%10==1&&i%100!=11?O.One:i%10===Math.floor(i%10)&&i%10>=2&&i%10<=4&&!(i%100>=12&&i%100<=14)?O.Few:i%10==0||i%10===Math.floor(i%10)&&i%10>=5&&i%10<=9||i%100===Math.floor(i%100)&&i%100>=11&&i%100<=14?O.Many:O.Other;case"br":return i%10==1&&i%100!=11&&i%100!=71&&i%100!=91?O.One:i%10==2&&i%100!=12&&i%100!=72&&i%100!=92?O.Two:i%10===Math.floor(i%10)&&(i%10>=3&&i%10<=4||i%10==9)&&!(i%100>=10&&i%100<=19||i%100>=70&&i%100<=79||i%100>=90&&i%100<=99)?O.Few:0!==i&&i%1e6==0?O.Many:O.Other;case"bs":case"hr":case"sr":return 0===o&&r%10==1&&r%100!=11||s%10==1&&s%100!=11?O.One:0===o&&r%10===Math.floor(r%10)&&r%10>=2&&r%10<=4&&!(r%100>=12&&r%100<=14)||s%10===Math.floor(s%10)&&s%10>=2&&s%10<=4&&!(s%100>=12&&s%100<=14)?O.Few:O.Other;case"cs":case"sk":return 1===r&&0===o?O.One:r===Math.floor(r)&&r>=2&&r<=4&&0===o?O.Few:0!==o?O.Many:O.Other;case"cy":return 0===i?O.Zero:1===i?O.One:2===i?O.Two:3===i?O.Few:6===i?O.Many:O.Other;case"da":return 1===i||0!==a&&(0===r||1===r)?O.One:O.Other;case"dsb":case"hsb":return 0===o&&r%100==1||s%100==1?O.One:0===o&&r%100==2||s%100==2?O.Two:0===o&&r%100===Math.floor(r%100)&&r%100>=3&&r%100<=4||s%100===Math.floor(s%100)&&s%100>=3&&s%100<=4?O.Few:O.Other;case"ff":case"fr":case"hy":case"kab":return 0===r||1===r?O.One:O.Other;case"fil":return 0===o&&(1===r||2===r||3===r)||0===o&&r%10!=4&&r%10!=6&&r%10!=9||0!==o&&s%10!=4&&s%10!=6&&s%10!=9?O.One:O.Other;case"ga":return 1===i?O.One:2===i?O.Two:i===Math.floor(i)&&i>=3&&i<=6?O.Few:i===Math.floor(i)&&i>=7&&i<=10?O.Many:O.Other;case"gd":return 1===i||11===i?O.One:2===i||12===i?O.Two:i===Math.floor(i)&&(i>=3&&i<=10||i>=13&&i<=19)?O.Few:O.Other;case"gv":return 0===o&&r%10==1?O.One:0===o&&r%10==2?O.Two:0!==o||r%100!=0&&r%100!=20&&r%100!=40&&r%100!=60&&r%100!=80?0!==o?O.Many:O.Other:O.Few;case"he":return 1===r&&0===o?O.One:2===r&&0===o?O.Two:0!==o||i>=0&&i<=10||i%10!=0?O.Other:O.Many;case"is":return 0===a&&r%10==1&&r%100!=11||0!==a?O.One:O.Other;case"ksh":return 0===i?O.Zero:1===i?O.One:O.Other;case"kw":case"naq":case"se":case"smn":return 1===i?O.One:2===i?O.Two:O.Other;case"lag":return 0===i?O.Zero:0!==r&&1!==r||0===i?O.Other:O.One;case"lt":return i%10!=1||i%100>=11&&i%100<=19?i%10===Math.floor(i%10)&&i%10>=2&&i%10<=9&&!(i%100>=11&&i%100<=19)?O.Few:0!==s?O.Many:O.Other:O.One;case"lv":case"prg":return i%10==0||i%100===Math.floor(i%100)&&i%100>=11&&i%100<=19||2===o&&s%100===Math.floor(s%100)&&s%100>=11&&s%100<=19?O.Zero:i%10==1&&i%100!=11||2===o&&s%10==1&&s%100!=11||2!==o&&s%10==1?O.One:O.Other;case"mk":return 0===o&&r%10==1||s%10==1?O.One:O.Other;case"mt":return 1===i?O.One:0===i||i%100===Math.floor(i%100)&&i%100>=2&&i%100<=10?O.Few:i%100===Math.floor(i%100)&&i%100>=11&&i%100<=19?O.Many:O.Other;case"pl":return 1===r&&0===o?O.One:0===o&&r%10===Math.floor(r%10)&&r%10>=2&&r%10<=4&&!(r%100>=12&&r%100<=14)?O.Few:0===o&&1!==r&&r%10===Math.floor(r%10)&&r%10>=0&&r%10<=1||0===o&&r%10===Math.floor(r%10)&&r%10>=5&&r%10<=9||0===o&&r%100===Math.floor(r%100)&&r%100>=12&&r%100<=14?O.Many:O.Other;case"pt":return i===Math.floor(i)&&i>=0&&i<=2&&2!==i?O.One:O.Other;case"ro":return 1===r&&0===o?O.One:0!==o||0===i||1!==i&&i%100===Math.floor(i%100)&&i%100>=1&&i%100<=19?O.Few:O.Other;case"ru":case"uk":return 0===o&&r%10==1&&r%100!=11?O.One:0===o&&r%10===Math.floor(r%10)&&r%10>=2&&r%10<=4&&!(r%100>=12&&r%100<=14)?O.Few:0===o&&r%10==0||0===o&&r%10===Math.floor(r%10)&&r%10>=5&&r%10<=9||0===o&&r%100===Math.floor(r%100)&&r%100>=11&&r%100<=14?O.Many:O.Other;case"shi":return 0===r||1===i?O.One:i===Math.floor(i)&&i>=2&&i<=10?O.Few:O.Other;case"si":return 0===i||1===i||0===r&&1===s?O.One:O.Other;case"sl":return 0===o&&r%100==1?O.One:0===o&&r%100==2?O.Two:0===o&&r%100===Math.floor(r%100)&&r%100>=3&&r%100<=4||0!==o?O.Few:O.Other;case"tzm":return i===Math.floor(i)&&i>=0&&i<=1||i===Math.floor(i)&&i>=11&&i<=99?O.One:O.Other;default:return O.Other}}(this.locale,t)){case O.Zero:return"zero";case O.One:return"one";case O.Two:return"two";case O.Few:return"few";case O.Many:return"many";default:return"other"}},e}(R);L.decorators=[{type:w.u}],L.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[w.A]}]}]};var O={};O.Zero=0,O.One=1,O.Two=2,O.Few=3,O.Many=4,O.Other=5,O[O.Zero]="Zero",O[O.One]="One",O[O.Two]="Two",O[O.Few]="Few",O[O.Many]="Many",O[O.Other]="Other";var I=function(){function t(t,e,i,n){this._iterableDiffers=t,this._keyValueDiffers=e,this._ngEl=i,this._renderer=n,this._initialClasses=[]}return Object.defineProperty(t.prototype,"klass",{set:function(t){this._applyInitialClasses(!0),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyInitialClasses(!1),this._applyClasses(this._rawClass,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngClass",{set:function(t){this._cleanupClasses(this._rawClass),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Object(w._20)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())},enumerable:!0,configurable:!0}),t.prototype.ngDoCheck=function(){if(this._iterableDiffer){var t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){var e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}},t.prototype._cleanupClasses=function(t){this._applyClasses(t,!0),this._applyInitialClasses(!1)},t.prototype._applyKeyValueChanges=function(t){var e=this;t.forEachAddedItem(function(t){return e._toggleClass(t.key,t.currentValue)}),t.forEachChangedItem(function(t){return e._toggleClass(t.key,t.currentValue)}),t.forEachRemovedItem(function(t){t.previousValue&&e._toggleClass(t.key,!1)})},t.prototype._applyIterableChanges=function(t){var e=this;t.forEachAddedItem(function(t){if("string"!=typeof t.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got "+Object(w._34)(t.item));e._toggleClass(t.item,!0)}),t.forEachRemovedItem(function(t){return e._toggleClass(t.item,!1)})},t.prototype._applyInitialClasses=function(t){var e=this;this._initialClasses.forEach(function(i){return e._toggleClass(i,!t)})},t.prototype._applyClasses=function(t,e){var i=this;t&&(Array.isArray(t)||t instanceof Set?t.forEach(function(t){return i._toggleClass(t,!e)}):Object.keys(t).forEach(function(n){null!=t[n]&&i._toggleClass(n,!e)}))},t.prototype._toggleClass=function(t,e){var i=this;(t=t.trim())&&t.split(/\s+/g).forEach(function(t){i._renderer.setElementClass(i._ngEl.nativeElement,t,!!e)})},t}();I.decorators=[{type:w.m,args:[{selector:"[ngClass]"}]}],I.ctorParameters=function(){return[{type:w.y},{type:w.z},{type:w.n},{type:w.M}]},I.propDecorators={klass:[{type:w.x,args:["class"]}],ngClass:[{type:w.x}]};var B=function(){function t(t){this._viewContainerRef=t,this._componentRef=null,this._moduleRef=null}return t.prototype.ngOnChanges=function(t){if(this._viewContainerRef.clear(),this._componentRef=null,this.ngComponentOutlet){var e=this.ngComponentOutletInjector||this._viewContainerRef.parentInjector;if(t.ngComponentOutletNgModuleFactory)if(this._moduleRef&&this._moduleRef.destroy(),this.ngComponentOutletNgModuleFactory){var i=e.get(w.E);this._moduleRef=this.ngComponentOutletNgModuleFactory.create(i.injector)}else this._moduleRef=null;var n=(this._moduleRef?this._moduleRef.componentFactoryResolver:e.get(w.k)).resolveComponentFactory(this.ngComponentOutlet);this._componentRef=this._viewContainerRef.createComponent(n,this._viewContainerRef.length,e,this.ngComponentOutletContent)}},t.prototype.ngOnDestroy=function(){this._moduleRef&&this._moduleRef.destroy()},t}();B.decorators=[{type:w.m,args:[{selector:"[ngComponentOutlet]"}]}],B.ctorParameters=function(){return[{type:w.Y}]},B.propDecorators={ngComponentOutlet:[{type:w.x}],ngComponentOutletInjector:[{type:w.x}],ngComponentOutletContent:[{type:w.x}],ngComponentOutletNgModuleFactory:[{type:w.x}]};var k=function(){function t(t,e,i,n){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=n}return Object.defineProperty(t.prototype,"first",{get:function(){return 0===this.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this.index===this.count-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"even",{get:function(){return this.index%2==0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"odd",{get:function(){return!this.even},enumerable:!0,configurable:!0}),t}(),D=function(){function t(t,e,i){this._viewContainer=t,this._template=e,this._differs=i,this._differ=null}return Object.defineProperty(t.prototype,"ngForTrackBy",{get:function(){return this._trackByFn},set:function(t){Object(w._5)()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(t)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngForTemplate",{set:function(t){t&&(this._template=t)},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){if("ngForOf"in t){var e=t.ngForOf.currentValue;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(t){throw new Error("Cannot find a differ supporting object '"+e+"' of type '"+function(t){return t.name||typeof t}(e)+"'. NgFor only supports binding to Iterables such as Arrays.")}}},t.prototype.ngDoCheck=function(){if(this._differ){var t=this._differ.diff(this.ngForOf);t&&this._applyChanges(t)}},t.prototype._applyChanges=function(t){var e=this,i=[];t.forEachOperation(function(t,n,r){if(null==t.previousIndex){var o=e._viewContainer.createEmbeddedView(e._template,new k(null,e.ngForOf,-1,-1),r),s=new F(t,o);i.push(s)}else if(null==r)e._viewContainer.remove(n);else{o=e._viewContainer.get(n);e._viewContainer.move(o,r);s=new F(t,o);i.push(s)}});for(var n=0;n<i.length;n++)this._perViewChange(i[n].view,i[n].record);n=0;for(var r=this._viewContainer.length;n<r;n++){var o=this._viewContainer.get(n);o.context.index=n,o.context.count=r}t.forEachIdentityChange(function(t){e._viewContainer.get(t.currentIndex).context.$implicit=t.item})},t.prototype._perViewChange=function(t,e){t.context.$implicit=e.item},t}();D.decorators=[{type:w.m,args:[{selector:"[ngFor][ngForOf]"}]}],D.ctorParameters=function(){return[{type:w.Y},{type:w.V},{type:w.y}]},D.propDecorators={ngForOf:[{type:w.x}],ngForTrackBy:[{type:w.x}],ngForTemplate:[{type:w.x}]};var F=function(){return function(t,e){this.record=t,this.view=e}}(),U=function(){function t(t,e){this._viewContainer=t,this._context=new N,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}return Object.defineProperty(t.prototype,"ngIf",{set:function(t){this._context.$implicit=this._context.ngIf=t,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfThen",{set:function(t){this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfElse",{set:function(t){this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),t.prototype._updateView=function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))},t}();U.decorators=[{type:w.m,args:[{selector:"[ngIf]"}]}],U.ctorParameters=function(){return[{type:w.Y},{type:w.V}]},U.propDecorators={ngIf:[{type:w.x}],ngIfThen:[{type:w.x}],ngIfElse:[{type:w.x}]};var N=function(){return function(){this.$implicit=null,this.ngIf=null}}(),G=function(){function t(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}return t.prototype.create=function(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)},t.prototype.destroy=function(){this._created=!1,this._viewContainerRef.clear()},t.prototype.enforceState=function(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()},t}(),j=function(){function t(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}return Object.defineProperty(t.prototype,"ngSwitch",{set:function(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)},enumerable:!0,configurable:!0}),t.prototype._addCase=function(){return this._caseCount++},t.prototype._addDefault=function(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)},t.prototype._matchCase=function(t){var e=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||e,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),e},t.prototype._updateDefaultCases=function(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(var e=0;e<this._defaultViews.length;e++){this._defaultViews[e].enforceState(t)}}},t}();j.decorators=[{type:w.m,args:[{selector:"[ngSwitch]"}]}],j.ctorParameters=function(){return[]},j.propDecorators={ngSwitch:[{type:w.x}]};var V=function(){function t(t,e,i){this.ngSwitch=i,i._addCase(),this._view=new G(t,e)}return t.prototype.ngDoCheck=function(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))},t}();V.decorators=[{type:w.m,args:[{selector:"[ngSwitchCase]"}]}],V.ctorParameters=function(){return[{type:w.Y},{type:w.V},{type:j,decorators:[{type:w.q}]}]},V.propDecorators={ngSwitchCase:[{type:w.x}]};var H=function(){return function(t,e,i){i._addDefault(new G(t,e))}}();H.decorators=[{type:w.m,args:[{selector:"[ngSwitchDefault]"}]}],H.ctorParameters=function(){return[{type:w.Y},{type:w.V},{type:j,decorators:[{type:w.q}]}]};var z=function(){function t(t){this._localization=t,this._caseViews={}}return Object.defineProperty(t.prototype,"ngPlural",{set:function(t){this._switchValue=t,this._updateView()},enumerable:!0,configurable:!0}),t.prototype.addCase=function(t,e){this._caseViews[t]=e},t.prototype._updateView=function(){this._clearViews();var t=Object.keys(this._caseViews),e=r(this._switchValue,t,this._localization);this._activateView(this._caseViews[e])},t.prototype._clearViews=function(){this._activeView&&this._activeView.destroy()},t.prototype._activateView=function(t){t&&(this._activeView=t,this._activeView.create())},t}();z.decorators=[{type:w.m,args:[{selector:"[ngPlural]"}]}],z.ctorParameters=function(){return[{type:R}]},z.propDecorators={ngPlural:[{type:w.x}]};var W=function(){return function(t,e,i,n){this.value=t;var r=!isNaN(Number(t));n.addCase(r?"="+t:t,new G(i,e))}}();W.decorators=[{type:w.m,args:[{selector:"[ngPluralCase]"}]}],W.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.h,args:["ngPluralCase"]}]},{type:w.V},{type:w.Y},{type:z,decorators:[{type:w.q}]}]};var X=function(){function t(t,e,i){this._differs=t,this._ngEl=e,this._renderer=i}return Object.defineProperty(t.prototype,"ngStyle",{set:function(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())},enumerable:!0,configurable:!0}),t.prototype.ngDoCheck=function(){if(this._differ){var t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}},t.prototype._applyChanges=function(t){var e=this;t.forEachRemovedItem(function(t){return e._setStyle(t.key,null)}),t.forEachAddedItem(function(t){return e._setStyle(t.key,t.currentValue)}),t.forEachChangedItem(function(t){return e._setStyle(t.key,t.currentValue)})},t.prototype._setStyle=function(t,e){var i=t.split("."),n=i[0],r=i[1];e=null!=e&&r?""+e+r:e,this._renderer.setElementStyle(this._ngEl.nativeElement,n,e)},t}();X.decorators=[{type:w.m,args:[{selector:"[ngStyle]"}]}],X.ctorParameters=function(){return[{type:w.z},{type:w.n},{type:w.M}]},X.propDecorators={ngStyle:[{type:w.x}]};var q=function(){function t(t){this._viewContainerRef=t}return Object.defineProperty(t.prototype,"ngOutletContext",{set:function(t){this.ngTemplateOutletContext=t},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){this._viewRef&&this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._viewRef)),this.ngTemplateOutlet&&(this._viewRef=this._viewContainerRef.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext))},t}();q.decorators=[{type:w.m,args:[{selector:"[ngTemplateOutlet]"}]}],q.ctorParameters=function(){return[{type:w.Y}]},q.propDecorators={ngTemplateOutletContext:[{type:w.x}],ngTemplateOutlet:[{type:w.x}],ngOutletContext:[{type:w.x}]};var Y=[I,B,D,U,q,X,j,V,H,z,W],K=function(){function t(){}return t.prototype.createSubscription=function(t,e){return t.subscribe({next:e,error:function(t){throw t}})},t.prototype.dispose=function(t){t.unsubscribe()},t.prototype.onDestroy=function(t){t.unsubscribe()},t}(),Z=new(function(){function t(){}return t.prototype.createSubscription=function(t,e){return t.then(e,function(t){throw t})},t.prototype.dispose=function(t){},t.prototype.onDestroy=function(t){},t}()),Q=new K,J=function(){function t(t){this._ref=t,this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null,this._strategy=null}return t.prototype.ngOnDestroy=function(){this._subscription&&this._dispose()},t.prototype.transform=function(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue===this._latestReturnedValue?this._latestReturnedValue:(this._latestReturnedValue=this._latestValue,w._0.wrap(this._latestValue)):(t&&this._subscribe(t),this._latestReturnedValue=this._latestValue,this._latestValue)},t.prototype._subscribe=function(t){var e=this;this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,function(i){return e._updateLatestValue(t,i)})},t.prototype._selectStrategy=function(e){if(Object(w._22)(e))return Z;if(Object(w._21)(e))return Q;throw s(t,e)},t.prototype._dispose=function(){this._strategy.dispose(this._subscription),this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null},t.prototype._updateLatestValue=function(t,e){t===this._obj&&(this._latestValue=e,this._ref.markForCheck())},t}();J.decorators=[{type:w.L,args:[{name:"async",pure:!1}]}],J.ctorParameters=function(){return[{type:w.i}]};var $=function(){function t(){}return t.prototype.transform=function(e){if(!e)return e;if("string"!=typeof e)throw s(t,e);return e.toLowerCase()},t}();$.decorators=[{type:w.L,args:[{name:"lowercase"}]}],$.ctorParameters=function(){return[]};var tt=function(){function t(){}return t.prototype.transform=function(e){if(!e)return e;if("string"!=typeof e)throw s(t,e);return e.split(/\b/g).map(function(t){return function(t){return t?t[0].toUpperCase()+t.substr(1).toLowerCase():t}(t)}).join("")},t}();tt.decorators=[{type:w.L,args:[{name:"titlecase"}]}],tt.ctorParameters=function(){return[]};var et=function(){function t(){}return t.prototype.transform=function(e){if(!e)return e;if("string"!=typeof e)throw s(t,e);return e.toUpperCase()},t}();et.decorators=[{type:w.L,args:[{name:"uppercase"}]}],et.ctorParameters=function(){return[]};var it={};it.Decimal=0,it.Percent=1,it.Currency=2,it[it.Decimal]="Decimal",it[it.Percent]="Percent",it[it.Currency]="Currency";var nt=function(){function t(){}return t.format=function(t,e,i,n){void 0===n&&(n={});var r=n.minimumIntegerDigits,o=n.minimumFractionDigits,s=n.maximumFractionDigits,a=n.currency,h=n.currencyAsSymbol,u=void 0!==h&&h,c={minimumIntegerDigits:r,minimumFractionDigits:o,maximumFractionDigits:s,style:it[i].toLowerCase()};return i==it.Currency&&(c.currency="string"==typeof a?a:void 0,c.currencyDisplay=u?"symbol":"code"),new Intl.NumberFormat(e,c).format(t)},t}(),rt=/((?:[^yMLdHhmsazZEwGjJ']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|J+|j+|m+|s+|a|z|Z|G+|w+))(.*)/,ot={yMMMdjms:m(f([d("year",1),p("month",3),d("day",1),d("hour",1),d("minute",1),d("second",1)])),yMdjm:m(f([d("year",1),d("month",1),d("day",1),d("hour",1),d("minute",1)])),yMMMMEEEEd:m(f([d("year",1),p("month",4),p("weekday",4),d("day",1)])),yMMMMd:m(f([d("year",1),p("month",4),d("day",1)])),yMMMd:m(f([d("year",1),p("month",3),d("day",1)])),yMd:m(f([d("year",1),d("month",1),d("day",1)])),jms:m(f([d("hour",1),d("second",1),d("minute",1)])),jm:m(f([d("hour",1),d("minute",1)]))},st={yyyy:m(d("year",4)),yy:m(d("year",2)),y:m(d("year",1)),MMMM:m(p("month",4)),MMM:m(p("month",3)),MM:m(d("month",2)),M:m(d("month",1)),LLLL:m(p("month",4)),L:m(p("month",1)),dd:m(d("day",2)),d:m(d("day",1)),HH:a(h(m(l(d("hour",2),!1)))),H:h(m(l(d("hour",1),!1))),hh:a(h(m(l(d("hour",2),!0)))),h:h(m(l(d("hour",1),!0))),jj:m(d("hour",2)),j:m(d("hour",1)),mm:a(m(d("minute",2))),m:m(d("minute",1)),ss:a(m(d("second",2))),s:m(d("second",1)),sss:m(d("second",3)),EEEE:m(p("weekday",4)),EEE:m(p("weekday",3)),EE:m(p("weekday",2)),E:m(p("weekday",1)),a:function(t){return function(e,i){return t(e,i).split(" ")[1]}}(m(l(d("hour",1),!0))),Z:c("short"),z:c("long"),ww:m({}),w:m({}),G:m(p("era",1)),GG:m(p("era",2)),GGG:m(p("era",3)),GGGG:m(p("era",4))},at=new Map,ht=function(){function t(){}return t.format=function(t,e,i){return function(t,e,i){var n=ot[t];if(n)return n(e,i);var r=t,o=at.get(r);if(!o){o=[];var s=void 0;rt.exec(t);for(var a=t;a;)(s=rt.exec(a))?a=(o=o.concat(s.slice(1))).pop():(o.push(a),a=null);at.set(r,o)}return o.reduce(function(t,n){var r=st[n];return t+(r?r(e,i):function(t){return"''"===t?"'":t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}(n))},"")}(i,t,e)},t}(),ut=/^(\d+)?\.((\d+)(-(\d+))?)?$/,ct=function(){function t(t){this._locale=t}return t.prototype.transform=function(e,i){return g(t,this._locale,e,it.Decimal,i)},t}();ct.decorators=[{type:w.L,args:[{name:"number"}]}],ct.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[w.A]}]}]};var lt=function(){function t(t){this._locale=t}return t.prototype.transform=function(e,i){return g(t,this._locale,e,it.Percent,i)},t}();lt.decorators=[{type:w.L,args:[{name:"percent"}]}],lt.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[w.A]}]}]};var dt=function(){function t(t){this._locale=t}return t.prototype.transform=function(e,i,n,r){return void 0===i&&(i="USD"),void 0===n&&(n=!1),g(t,this._locale,e,it.Currency,r,i,n)},t}();dt.decorators=[{type:w.L,args:[{name:"currency"}]}],dt.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[w.A]}]}]};var pt=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ft=function(){function t(t){this._locale=t}return t.prototype.transform=function(e,i){void 0===i&&(i="mediumDate");var n;if(function(t){return null==t||""===t}(e)||e!=e)return null;if("string"==typeof e&&(e=e.trim()),b(e))n=e;else if(v(e))n=new Date(parseFloat(e));else if("string"==typeof e&&/^(\d{4}-\d{1,2}-\d{1,2})$/.test(e)){var r=e.split("-").map(function(t){return parseInt(t,10)}),o=r[0],a=r[1],h=r[2];n=new Date(o,a-1,h)}else n=new Date(e);if(!b(n)){var u=void 0;if("string"!=typeof e||!(u=e.match(pt)))throw s(t,e);n=function(t){var e=new Date(0),i=0,n=0,r=t[8]?e.setUTCFullYear:e.setFullYear,o=t[8]?e.setUTCHours:e.setHours;t[9]&&(i=x(t[9]+t[10]),n=x(t[9]+t[11])),r.call(e,x(t[1]),x(t[2])-1,x(t[3]));var s=x(t[4]||"0")-i,a=x(t[5]||"0")-n,h=x(t[6]||"0"),u=Math.round(1e3*parseFloat("0."+(t[7]||0)));return o.call(e,s,a,h,u),e}(u)}return ht.format(n,this._locale,t._ALIASES[i]||i)},t}();ft._ALIASES={medium:"yMMMdjms",short:"yMdjm",fullDate:"yMMMMEEEEd",longDate:"yMMMMd",mediumDate:"yMMMd",shortDate:"yMd",mediumTime:"jms",shortTime:"jm"},ft.decorators=[{type:w.L,args:[{name:"date",pure:!0}]}],ft.ctorParameters=function(){return[{type:void 0,decorators:[{type:w.t,args:[w.A]}]}]};var mt=/#/g,gt=function(){function t(t){this._localization=t}return t.prototype.transform=function(e,i){if(null==e)return"";if("object"!=typeof i||null===i)throw s(t,i);return i[r(e,Object.keys(i),this._localization)].replace(mt,e.toString())},t}();gt.decorators=[{type:w.L,args:[{name:"i18nPlural",pure:!0}]}],gt.ctorParameters=function(){return[{type:R}]};var yt=function(){function t(){}return t.prototype.transform=function(e,i){if(null==e)return"";if("object"!=typeof i||"string"!=typeof e)throw s(t,i);return i.hasOwnProperty(e)?i[e]:i.hasOwnProperty("other")?i.other:""},t}();yt.decorators=[{type:w.L,args:[{name:"i18nSelect",pure:!0}]}],yt.ctorParameters=function(){return[]};var vt=function(){function t(){}return t.prototype.transform=function(t){return JSON.stringify(t,null,2)},t}();vt.decorators=[{type:w.L,args:[{name:"json",pure:!1}]}],vt.ctorParameters=function(){return[]};var bt=function(){function t(){}return t.prototype.transform=function(e,i,n){if(null==e)return e;if(!this.supports(e))throw s(t,e);return e.slice(i,n)},t.prototype.supports=function(t){return"string"==typeof t||Array.isArray(t)},t}();bt.decorators=[{type:w.L,args:[{name:"slice",pure:!1}]}],bt.ctorParameters=function(){return[]};var xt=[J,et,$,vt,bt,ct,lt,tt,dt,ft,gt,yt],_t=function(){return function(){}}();_t.decorators=[{type:w.B,args:[{declarations:[Y,xt],exports:[Y,xt],providers:[{provide:R,useClass:L}]}]}],_t.ctorParameters=function(){return[]};var wt=function(){return function(){}}();wt.decorators=[{type:w.B,args:[{declarations:[],exports:[]}]}],wt.ctorParameters=function(){return[]};var Tt=new w.v("DocumentToken"),St="browser";new w.X("4.4.6")},qgI0:function(t,e,i){"use strict";var n=i("xIGM"),r=i("kQVV"),o=i("mHG6"),s=i("NGRF"),a=i("AP4T"),h=i("X3fp"),u=i("E9/g"),c=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},l=function(t){function e(e,i,n){t.call(this),this.parent=e,this.outerValue=i,this.outerIndex=n,this.index=0}return c(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(u.a),d=i("mz3w");e.a=function(t,e,i,u){var c=new l(t,i,u);if(c.closed)return null;if(e instanceof a.a)return e._isScalar?(c.next(e.value),c.complete(),null):(c.syncErrorThrowable=!0,e.subscribe(c));if(Object(r.a)(e)){for(var p=0,f=e.length;p<f&&!c.closed;p++)c.next(e[p]);c.closed||c.complete()}else{if(Object(o.a)(e))return e.then(function(t){c.closed||(c.next(t),c.complete())},function(t){return c.error(t)}).then(null,function(t){n.a.setTimeout(function(){throw t})}),c;if(e&&"function"==typeof e[h.a])for(var m=e[h.a]();;){var g=m.next();if(g.done){c.complete();break}if(c.next(g.value),c.closed)break}else if(e&&"function"==typeof e[d.a]){var y=e[d.a]();if("function"==typeof y.subscribe)return y.subscribe(new l(t,i,u));c.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var v="You provided "+(Object(s.a)(e)?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";c.error(new TypeError(v))}}return null}},skhl:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("6nA8"),r=function(){function t(t,e){void 0===t&&(t=100),void 0===e&&(e=.8),this.k=t,this.viscosity=e,this.liftForce=new n.Point}return t.prototype.applyAABBBuoyancyForces=function(t,e){var i=new n.Point,r=t.sprite.getBounds();if(r.y>e.y)i=t.sprite.position,t.sprite.width*t.sprite.height;else{if(!(r.y+r.height>e.y))return void(t.angularDamping=.1);r.width,Math.abs(r.y-e.y);t.sprite.width*t.sprite.height,i=t.sprite.position}this.liftForce=n.Point.subtract(i,e),i=n.Point.subtract(i,t.sprite.position),t.velocity.x=t.velocity.x*this.viscosity,t.velocity.y=t.velocity.y*this.viscosity,t.angularDamping=.9,this.liftForce.y>0&&t.applyForce([0,this.liftForce.y],i.x,i.y)},t}();e.BuoyancyManager=r},wP3s:function(t,e,i){"use strict";e.a=function(t,e,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),function(n){return"number"==typeof e&&(i=e,e=null),n.lift(new s(t,e,i))}};var n=i("qgI0"),r=i("lI6h"),o=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},s=function(){function t(t,e,i){void 0===i&&(i=Number.POSITIVE_INFINITY),this.project=t,this.resultSelector=e,this.concurrent=i}return t.prototype.call=function(t,e){return e.subscribe(new a(t,this.project,this.resultSelector,this.concurrent))},t}(),a=function(t){function e(e,i,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY),t.call(this,e),this.project=i,this.resultSelector=n,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return o(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,i=this.index++;try{e=this.project(t,i)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,i)},e.prototype._innerSub=function(t,e,i){this.add(Object(n.a)(this,t,e,i))},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},e.prototype.notifyNext=function(t,e,i,n,r){this.resultSelector?this._notifyResultSelector(t,e,i,n):this.destination.next(e)},e.prototype._notifyResultSelector=function(t,e,i,n){var r;try{r=this.resultSelector(t,e,i,n)}catch(t){return void this.destination.error(t)}this.destination.next(r)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(r.a)},xIGM:function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return o});var n="undefined"!=typeof window&&window,r="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,o=n||"undefined"!=typeof t&&t||r}).call(e,i("fRUx"))}});